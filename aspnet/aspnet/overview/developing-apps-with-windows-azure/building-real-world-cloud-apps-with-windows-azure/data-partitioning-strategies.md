---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-partitioning-strategies
title: データのパーティション分割の方法 (Azure と実際のクラウド アプリのビルド) |Microsoft ドキュメント
author: MikeWasson
description: Azure の電子書籍と構築実世界クラウド アプリは、Scott Guthrie が開発したプレゼンテーションに基づいています。 13 のパターンと彼をできるベスト プラクティスについて説明しています.
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/12/2014
ms.topic: article
ms.assetid: 513837a7-cfea-4568-a4e9-1f5901245d24
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/data-partitioning-strategies
msc.type: authoredcontent
ms.openlocfilehash: 9ff7f37a03d8d3dfab50e8007a6645bb0d88f453
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30871351"
---
<a name="data-partitioning-strategies-building-real-world-cloud-apps-with-azure"></a>データのパーティション分割の方法 (Azure と実際のクラウド アプリのビルド)
====================
によって[Mike Wasson](https://github.com/MikeWasson)、 [Rick Anderson](https://github.com/Rick-Anderson)、 [Tom Dykstra](https://github.com/tdykstra)

[ダウンロード修正プロジェクト](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)または[電子書籍をダウンロード](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **現実世界クラウド アプリのビルドと Azure**電子書籍は Scott Guthrie が開発したプレゼンテーションに基づいています。 13 パターンについて説明します、プラクティスするのに役立つ、クラウドの web アプリの開発が成功します。 系列の詳細については、次を参照してください。[第 1 章](introduction.md)です。


以前に追加し、web サーバーを削除して、クラウド アプリケーションの web 層のスケールがいかに簡単が見られました。 それらすべてが発生する、同じデータ ストア、アプリケーションのボトルネックになっていると移動するフロント エンドから、バックエンドに、データ層は、最も困難なスケールを設定します。 この章を行う方法と、データ層拡張性の高い複数のリレーショナル データベースにデータをパーティション分割または他のデータ ストレージ オプションとリレーショナル データベースの記憶域を組み合わせることによって見てください。

最適なパーティション分割構成の設定は、同じ理由で述べた前面を元に戻す: アプリは、実稼働環境で後に、データ記憶域の戦略を変更することは困難です。 思う場合ハード前払いさまざまな方法は、「Twitter しばらく」アプリがクラッシュまたはアプリのデータとデータ アクセス コードを再編成するときに、長期間ダウンの必要があります。

## <a name="the-three-vs-of-data-storage"></a>データ記憶域の 3 つの Vs

パーティション分割戦略とする必要がありますが必要かどうかを決定するために、データに関する質問の 3 つを検討してください。

- ボリューム – データの量はするが最終的に保存しますか。 いくつかのギガバイトですか。 いくつかの数百ギガバイトですか。 テラバイトですか。 ペタバイト級しますか。
- ベロシティ –、データが増加するレートとは何ですか。 大量のデータを生成していない内部アプリですか。 顧客は、画像やビデオに、アップロードは外部アプリしますか。
- さまざまな – データは、の入力を保存しますか。 リレーショナル、画像、キーと値のペア、ソーシャル グラフしますか。

ボリューム、速度、または各種が多数存在する場合は、パーティション分割構成の種類には、アプリに合わせて効率的かつ効果的に増加、およびボトルネックを実行しないことを確認するには有効になります最適を慎重に検討する必要があります。

基本的には、パーティション分割する 3 つの方法があります。

- 垂直方向のパーティション分割
- 水平方向のパーティション分割
- ハイブリッド パーティション分割

## <a name="vertical-partitioning"></a>垂直方向のパーティション分割

列でテーブルを分割することに似ています垂直 portioning: 列の 1 つのセットが 1 つのデータ ストアになるし、別の列のセットが別のデータ ストアに移動します。

たとえば、アプリ イメージを含む、人に関するデータを格納するとします。

![データ テーブル](data-partitioning-strategies/_static/image1.png)

このデータをテーブルとしてを表すデータの種類を確認すると、左側の 3 つの列がある効率的に格納できる、リレーショナル データベースで、右側に 2 つの列は基本的にバイト配列の文字列データ c を確認できます。イメージ ファイルからホームです。 リレーショナル データベース内の記憶域の画像ファイル データを行うことが、多数のユーザーなは、ファイル システムにデータを保存しません。 必要な量のデータを格納できるファイル システムがないか、独立したバックアップを管理し、システムを復元するようにする場合があります。 この方法は、内部設置型データベースとクラウドのデータベース内のデータ量が少ないもは動作します。 内部設置型環境ですべての DBA は、この処理は自動的に簡単に場合があります。

クラウド データベースの記憶域は比較的安く、大量の画像のでしたする動作が効率的に制限を超えるデータベースのサイズします。 これらの問題は、データのテーブルで各列に対して最も適切なデータ ストアを選択することを意味するデータを垂直方向にパーティション分割して対応できます。 リレーショナル データベースと Blob ストレージ内のイメージに、文字列データを格納するにはどのような場合がありますに最適な次の例です。

![垂直方向にパーティション分割されたデータ テーブル](data-partitioning-strategies/_static/image2.png)

イメージを格納するデータベースではなく Blob ストレージには、ファイル サーバーを設定またはバックアップと復元のリレーショナル データベースの外部に格納されているデータの管理について心配する必要がないためよりクラウド、オンプレミス環境でより実用的: すべてによって、Blob ストレージ サービスを自動的に処理をされます。

これは、パーティション分割アプローチの修正、アプリでお実装されでそのコードを紹介、 [Blob 記憶域章](unstructured-blob-storage.md)です。 このパーティション構成、および 3 のメガバイト数の平均のイメージのサイズを想定して、修正、アプリがのみできなければ 150 ギガバイト単位の最大データベース サイズを検索する前に約 40,000 タスクを保存できません。 イメージを削除した後、データベースが 10 倍のタスクを格納できます。水平方向のパーティション構成を実装することを考慮する必要があるまでにかなり長いを移動できます。 アプリのスケールを設定、支出の数を拡張より遅くなり、記憶域に関するニーズの大部分は非常に低価格の Blob ストレージに入るためです。

## <a name="horizontal-partitioning-sharding"></a>水平方向のパーティション分割 (シャーディング)

行ごとに分割して、テーブルのようには、水平 portioning: 行の 1 つのセットが 1 つのデータ ストアになるし、別の行のセットが別のデータ ストアに移動します。

データの同じセットを指定するには、別のオプションがある異なるデータベースに異なる範囲の顧客名を格納します。

![水平方向にパーティション分割されたデータ テーブル](data-partitioning-strategies/_static/image3.png)

ホット スポットを回避するために、データを均等に分散するかどうかを確認する、分割スキームについて十分に注意します。 この簡単な例を姓と名の最初の文字を使用して多くの人が特定の一般的な文字で始まる姓があるため、その要件と一致しません。 テーブル サイズの制限はほとんどが小さいされている間に、一部のデータベースが非常に大きな得られるためにを予期したよりも前ヒットはします。

水平方向のパーティション分割のマイナス面は、すべてのデータの間でクエリを行うには難しいとかもしれませんです。 この例では、クエリは、すべてのアプリによって保存されたデータを取得する最大 26 個の異なるデータベースから描画する必要があります。

## <a name="hybrid-partitioning"></a>ハイブリッド パーティション分割

垂直および水平方向のパーティション分割を組み合わせることができます。 たとえば、データの例にする、イメージを Blob ストレージに格納し、文字列データを水平方向にパーティション分割します。

![データ テーブルのハイブリッド パーティション分割](data-partitioning-strategies/_static/image4.png)

## <a name="partitioning-a-production-application"></a>実稼働アプリケーションをパーティション分割

概念的にはパーティション構成は、のしくみをわかりやすくが任意のパーティション分割構成がコードの複雑さが増加し、対処する必要のある新しい多く複雑さの一部を紹介します。 Blob ストレージへのイメージを移動する場合はどうすれば、記憶域サービスがダウンした場合ですか。 Blob のセキュリティの処理方法 同期データベースと blob ストレージを取得するとどうなりますか。 シャーディングの場合はへの対処方法のすべてのデータベース間でクエリを実行しますか。

複雑さの一部は、実稼働環境に移動する前にそれらの計画をしている限り、管理しやすいです。 せずに多くの人が後で必要です。 Customer Advisory Team (CAT) チームがお客様のアプリが巨大な方法で抹消から月に 1 回の電話をかけるパニック状態を取得する平均とこの計画はありませんでした。 ようなものとします"にご協力。 すべてのものを 1 つのデータ ストアに配置して 45 日以内にするつもりで領域が不足!」 データ ストアにアクセスする方法に組み込まれているビジネス ロジックの多くがあり、アプリを使用しているユーザーがある場合は、良いを移行するときに、1 日のにはありません。 私たちは、これは、顧客のパーティションを支援するそこら取り組みからのデータをダウンタイムなしで即座に終了します。 それが非常に魅力的な非常に恐ろしいとメカニズムではない場合に使用することを回避できます! これについて事前に検討し、アプリに統合されては楽ずっと後で、アプリが大きくなる場合。

## <a name="summary"></a>まとめ

有効なパーティション分割構成では、スケール単位からペタバイト単位のボトルネックがないクラウド内のデータをクラウド アプリを有効にできます。 内部設置型データ センターで、アプリを実行していた場合、大規模なコンピューターまたは広範なインフラストラクチャの前払い支払いがないとします。 クラウドにすることができますすると、必要なだけ料金を支払っている使用している場合に限り使用しているときに増分、容量を追加できます。

[次のチャプター](unstructured-blob-storage.md)修正アプリがイメージを Blob ストレージに保存することで垂直方向にパーティション分割を実装する方法をお見せします。

## <a name="resources"></a>リソース

パーティション分割の方法の詳細については、次のリソースを参照してください。

ドキュメント:

- [Windows Azure クラウド サービスで大規模なサービスのデザインに関するヒント集](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)です。 Mark Simms、Michael Thomassy、ホワイト ペーパー。
- [Microsoft Patterns and Practices - クラウド設計パターン](https://msdn.microsoft.com/library/dn568099.aspx)です。 データのパーティション分割ガイダンスについては、シャーディング パターンを参照してください。

ビデオ:

- [フェール セーフ: スケーラブル、かつ回復力のクラウド サービスの構築](https://channel9.msdn.com/Series/FailSafe)です。 Ulrich Homann、Marc Mercuri、Mark Simms、系列を 9 つの部分で構成します。 実際のお客様と Microsoft Customer ・ Advisory Team (CAT) エクスペリエンスから抽出されたストーリーで非常にアクセス可能な興味深い方法で高度な概念とアーキテクチャの原則を説明します。 エピソード 7 のパーティション分割の説明を参照してください。
- [構築 Big: Windows Azure のお客様 - パート I から学んだ教訓](https://channel9.msdn.com/Events/Build/2012/3-029)です。Mark Simms がパーティション分割スキームの場合、シャーディング戦略について説明シャーディング、および SQL Database Federation、19時 49分始まるを実装する方法です。 フェール セーフ系列の詳細の操作方法に関する詳細情報になるに似ています。

サンプル コード: 

- [クラウドで、Windows Azure サービスの基礎](https://code.msdn.microsoft.com/Cloud-Service-Fundamentals-4ca72649)です。 シャーディングされたデータベースを含むサンプル アプリケーションです。 詳細については、分割スキームが実装されている、次を参照してください。 [DAL – シャーディングの RDBMS](https://blogs.msdn.com/b/windowsazure/archive/2013/09/05/dal-sharding-of-rdbms.aspx) Windows Azure ブログのです。

> [!div class="step-by-step"]
> [前へ](data-storage-options.md)
> [次へ](unstructured-blob-storage.md)
