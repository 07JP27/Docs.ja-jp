---
uid: aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
title: 障害 (Azure と実際のクラウド アプリのビルド) にも対処デザイン |Microsoft ドキュメント
author: MikeWasson
description: Azure の電子書籍と構築実世界クラウド アプリは、Scott Guthrie が開発したプレゼンテーションに基づいています。 13 のパターンと彼をできるベスト プラクティスについて説明しています.
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/12/2014
ms.topic: article
ms.assetid: 364ce84e-5af8-4e08-afc9-75a512b01f84
ms.technology: ''
ms.prod: .net-framework
msc.legacyurl: /aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/design-to-survive-failures
msc.type: authoredcontent
ms.openlocfilehash: 01883cb0be3e7c7b5dc8d32b784ccb3a28652f1e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30874110"
---
<a name="design-to-survive-failures-building-real-world-cloud-apps-with-azure"></a>障害 (Azure と実際のクラウド アプリのビルド) にも対処デザインします。
====================
によって[Mike Wasson](https://github.com/MikeWasson)、 [Rick Anderson](https://github.com/Rick-Anderson)、 [Tom Dykstra](https://github.com/tdykstra)

[ダウンロード修正プロジェクト](http://code.msdn.microsoft.com/Fix-It-app-for-Building-cdd80df4)または[電子書籍をダウンロード](http://blogs.msdn.com/b/microsoft_press/archive/2014/07/23/free-ebook-building-cloud-apps-with-microsoft-azure.aspx)

> **現実世界クラウド アプリのビルドと Azure**電子書籍は Scott Guthrie が開発したプレゼンテーションに基づいています。 13 パターンについて説明します、プラクティスするのに役立つ、クラウドの web アプリの開発が成功します。 電子書籍の詳細については、次を参照してください。[第 1 章](introduction.md)です。


正常にエラーを処理して価値を提供する続行できるように、アプリを設計する方法はのいずれかのアプリケーションでは、特に、多くの人を使用する、クラウドで実行される任意の型を作成する場合について検討する必要がある限り考えられる。 十分な時間を指定するには、進捗状況を任意の環境またはソフトウェアの任意のシステムで問題が発生します。 アプリがそのような状況を処理する方法を調べ、お客様の取得方法不安を感じている時間の分析と問題の解決にかかります。

## <a name="types-of-failures"></a>失敗の種類

異なる方法で処理する必要ありますエラーの 2 つの基本的なカテゴリがあります。

- 一時的なもの、断続的なネットワーク接続の問題などのエラーを自己修復します。
- 操作が必要な障害を支えます。

一時的な障害は、迅速かつ自動的に、アプリが復旧時間の大部分を確保するための再試行ポリシーを実装することができます。 お客様は応答時間が長くなる可能性がありますに注意してくださいが、それ以外の場合、影響しません。 これらのエラーを処理する方法を説明します、[章の一時的な障害処理](transient-fault-handling.md)です。

エラーを支えますの監視と問題が発生して、根本原因分析を容易にするときにすぐに通知する機能をログ記録を実装できます。 これらのエラーの上に維持できるように、いくつかの方法を説明します、[監視と遠隔測定の章](monitoring-and-telemetry.md)です。

## <a name="failure-scope"></a>障害のスコープ

考慮する必要がエラー スコープ – は、1 台のコンピューターが影響を受けるかどうかなど、SQL データベースやストレージ、または地域全体全体のサービスです。

![障害のスコープ](design-to-survive-failures/_static/image1.png)

### <a name="machine-failures"></a>コンピューターの障害

Azure では、障害が発生したサーバーは自動的に置き換え、新しいものと適切に設計されたクラウド アプリケーションは、自動的かつ迅速にこの種類のエラーから回復します。 ステートレス web 層のスケーラビリティ上のメリットを強調して以前であり、障害が発生したサーバーからの回復性のステートレス性の利点の 1 つ。 回復性も SQL データベースと Azure App Service Web Apps などのサービスとしてのプラットフォーム (PaaS) 機能の利点の 1 つあります。 ハードウェアの障害はまれですが、これらのサービスは、それらを自動的に処理が発生しました。これらのサービスを使用しているときに、コンピューターの障害を処理するコードを記述する必要はありません。

### <a name="service-failures"></a>サービスの失敗

クラウド アプリは、通常複数のサービスを使用します。 たとえば、修正アプリで、SQL データベース サービス、ストレージ サービスを使用し、Azure App Service に web アプリを展開します。 アプリは何に依存しているサービスの 1 つが失敗した場合か。 障害をわかりやすいサービスいくつかの"申し訳ありませんが、後で再試行"メッセージに行うことができます最適な可能性があります。 多くのシナリオで行うことができます向上。 たとえば、バックエンド データ ストアは、ときにユーザー入力を受け付ける、"、要求が受信された、"を表示して他の任意の場所の入力を一時的に格納必要なサービスがもう一度、運用し、入力を取得してそれを処理することができます。

[キュー中心作業パターン](queue-centric-work-pattern.md)章がこのシナリオを処理する方法を示しています。 SQL データベースが下向きのときの操作を終了する必要はありませんは、修正、アプリは、SQL データベースでタスクを保存します。 章では、キューにタスクのユーザー入力を保存し、ワーカー プロセスを使用してキューを読み取るし、タスクを更新する方法が表示されます。 修正タスクを作成する機能は影響を受ける; SQL がダウンしている場合はありません。ワーカー プロセスでは、待機でき、SQL データベースが使用可能な場合に、新しいタスクを処理することができます。

### <a name="region-failures"></a>地域の障害

地域全体が失敗する可能性があります。 自然災害がデータ センターに壊れる可能性がありますの meteor でフラット化された可能性がありますを取得、backhoe など cow 埋没させる farmer によって、データ センターにトランク行を切り取る。アプリが stricken データ センターでホストされている場合は何か。 ある場合、災害いずれかで、別の領域で実行されているを続行するように、複数の地域で同時に実行する Azure でのアプリを設定することができます。 このような障害は非常にまれな回の出現とほとんどのアプリはこの種のエラーをサービスが中断されないようにするために必要な分かれてジャンプしません。 地域の障害も、使用可能なアプリを保持する方法についての章の末尾には、リソースを参照してください。

はるかに簡単障害のような種類のすべての処理を行うには、Azure の目標とどのように行ってを次の章での例をいくつかが表示されます。

## <a name="slas"></a>Sla

ユーザーは多くの場合、クラウド環境内のサービス レベル アグリーメント (Sla) に関する聞きます。 基本的に、これらは、そのサービスの信頼性の高い方法に関する企業した約束を守るです。 SLA は、99.9% は、サービスを正しく機能している 99.9% の時間を想定する必要があります。 SLA の非常に典型的な値であるのと音が非常に大量のようがどの程度のダウンタイムが気付かない可能性があります。 1% が実際には金額をします。 さまざまな SLA の割合が、年、月、および 1 週間で金額をどの程度のダウンタイムを示すテーブルを次に示します。

![SLA テーブル](design-to-survive-failures/_static/image2.png)

したがって年または 43.2 分 1 か月稼働ダウン、99.9% の SLA は、サービスを意味があります。 よりダウン時間よりも多くの人を実現します。 開発者は、ある程度のダウン タイムが可能なことに注意してください、正常な方法で処理したいです。 ある時点でアプリでは、使用する予定のユーザーは、サービスが停止しているしようとしたお客様にその影響を及ぼすを最小限に抑えたいです。

SLA を知っておく必要が 1 つの点はどのような時間枠を参照して: に毎週、毎月、または毎年、時計はリセットを取得しますか? Azure yearly SLA も良いか月間の一連のオフセットによって正しくないか月間を非表示にするための年間の SLA をよりはすべての月をクロックにリセットします。

もちろんお常にユーザーに気付かれない SLA; よりも優れた通常よりもより少ないダウンことになります。 Promise は、私たちはこれまで下へのダウン時間の最大長を超えて場合でも、返金にもらうことができます。 金額を取得する可能性はありませんが完全に補償のたびに、余分なビジネスへの影響が、SLA の部分は強制ポリシーとして機能することがわかったことは、非常に深刻なことができます。

### <a name="composite-slas"></a>複合 Sla

Sla で表示している場合を考慮して、重要な点は、個別の SLA を持つ各サービスとアプリケーションでは、複数のサービスを使用しての影響です。 たとえば、修正、アプリは、Azure App Service Web Apps、Azure ストレージ、および SQL データベースを使用します。 時点でこの電子ブックは、2013 年 12 月で記述されている場合は、その SLA 番号を次に示します。

![Web サイト、ストレージ、SQL データベースの SLA](design-to-survive-failures/_static/image3.png)

これらのサービスの Sla に基づいてアプリが期待する時間を最大値とは何ですか。 ダウンタイムことが、最悪の SLA の割合、または 99.9% に等しいここでを想定する可能性があります。 True の場合は、同時に 3 つすべてのサービスが常に失敗しましたが、それは必ずしも実際の動作です。 各サービスが失敗していない個別に異なるタイミングで個別の SLA の数値を乗算することによって、複合 SLA を計算する必要があるためです。

![複合 SLA](design-to-survive-failures/_static/image4.png)

このため、アプリは、ダウンしている 43.2 分だけでなく、1 か月、3 倍になる、1 か月 – 108 分と、まだ Azure SLA の制限内である可能性があります。

この問題は、Azure に一意ではありません。 実際に提供する最適なクラウド、使用可能なすべてのクラウド サービスの Sla と同様の問題に任意のベンダーのクラウド サービスを使用する場合に対処する必要があります。 この強調表示は、重要性、顧客やユーザーに影響する多くの場合ほど、発生する可能性がありますので、必然的なサービスのエラーを適切に処理するアプリを設計する方法について検討します。

### <a name="cloud-slas-compared-to-enterprise-down-time-experience"></a>エンタープライズ ダウン時のエクスペリエンスと比較してクラウド Sla

場合によってと言われる、「エンタープライズ アプリしない問題があるこれら」 1 か月のどの程度のダウンタイムを依頼する場合、実際にあるは、通常言った「も、発生する場合があります」 どのくらいの頻度を依頼する場合、許可を「をバックアップするか、新しいサーバーまたは更新プログラムのソフトウェアをインストールする必要はあります」。 もちろん、するはダウン時間としてカウントします。 ほとんどのエンタープライズ アプリで特にミッション クリティカルでない限り、ダウンしている実際には、サービスの Sla で許容される量より多くの。 終了時間小さい不安を感じする傾向があるとは、サーバーとインフラストラクチャにしたり、そのコントロールでするできたら。 他のユーザーに依存しているクラウド環境で不明な何が起こってためより気を取得する傾向がある可能性があります。

獲得すると、エンタープライズ クラウド SLA から取得するよりも大きい稼働時間をパーセント、それらによって実行するハードウェアにより多くのコストを費やすです。 クラウド サービスでは、操作を行うことが、そのサービスの多くを充電する必要があります。 代わりに、コスト効果の高いサービスを利用し、必然的な障害は、顧客に最小の中断を引き起こすできるように、ソフトウェアをデザインします。 クラウド アプリの設計者は、ジョブができないようにしてください災害、エラーを回避するのにはあまりで行うにはハードウェアではなく、ソフトウェアに注目すること。 一方、エンタープライズ アプリでは、平均故障間隔を最大化しようとして、クラウド アプリが平均復旧時間を最小限に抑えるに努めています。

### <a name="not-all-cloud-services-have-slas"></a>すべてのクラウド サービスの Sla があります。

注意してくださいもいないすべてのクラウド サービスは、SLA をでもは。 アプリが稼働時間保証はありませんでサービスに依存する場合は、想像よりも長くダウンすることもできます。 たとえば、Facebook、Twitter などのソーシャル プロバイダーを使用して、サイトに、ログで有効にすると場合、は、どうか調べます、SLA がある場合がありますがない場合にサービス プロバイダーに確認します。 顧客がアプリからロックアウトされている場合は認証サービスがダウンしても、大量の要求をサポートするようになっています。 日数以上、ダウンしている可能性があります。 1 つの新しいアプリの作成元が必要数億件のダウンロードと Facebook 認証 – に対する依存関係が進んでライブと検出された遅すぎます Facebook に説明しませんでしたそのサービスの SLA がないこと。

### <a name="not-all-downtime-counts-toward-slas"></a>Sla に向けたいないダウンタイム ページ数

いくつかのクラウド サービスは、アプリが過剰に使用する場合、サービスを拒否意図的に可能性があります。 これと呼ばれる*調整*です。 サービスに SLA がある場合は、条件は、するが抑制される可能性がある、アプリケーションの設計する必要がありますそれらの状態を回避して発生する場合は、調整を適切に対処される、条件の状態にする必要があります。 たとえば、サービスへの要求を開始できない 1 秒あたりの特定の数を超過すると、場合自動再試行が続行を調整することと、迅速に発生しないことを確認します。 必要があるの制限についての詳細、[章の一時的な障害処理](transient-fault-handling.md)です。

## <a name="summary"></a>まとめ

この章が、現実の世界クラウド アプリに障害を適切に存続するように設計する理由を実現できるようにしようとしています。 以降で、[次のチャプター](monitoring-and-telemetry.md)、このシリーズの残りのパターンの移動を行うには使用できるいくつかの戦略について詳細に説明します。

- 良いが[監視と遠隔測定](monitoring-and-telemetry.md)、問題を解決するための十分な情報を使用して、操作は必要のある失敗に関するすばやくを調べるようにします。
- [一時的なエラー処理](transient-fault-handling.md)でき、にフォールバックするときに、アプリが自動的にリカバリするように、インテリジェントな再試行ロジックを実装することによって[遮断器](transient-fault-handling.md#circuitbreakers)ロジックできない場合。
- 使用して[分散キャッシュ](distributed-caching.md)データベース アクセスのスループット、待ち時間、および接続の問題を最小限に抑える。
- 疎結合を使用して実装、[キュー中心作業パターン](queue-centric-work-pattern.md)バックエンドが下にあるときに、アプリのフロント エンドを続行するため、します。

## <a name="resources"></a>リソース

詳細については、この電子書籍と、次のリソースの後の章を参照してください。

ドキュメント:

- [フェール セーフ: 回復力のあるクラウド アーキテクチャについて](https://msdn.microsoft.com/library/windowsazure/jj853352.aspx)です。 Marc Mercuri、Ulrich Homann、Andrew Townhill、ホワイト ペーパー。 フェール セーフ ビデオ シリーズの web ページ バージョンです。
- [Azure クラウド サービスで大規模なサービスのデザインに関するヒント集](https://msdn.microsoft.com/library/windowsazure/jj717232.aspx)です。 Mark Simms、Michael Thomassy、ホワイト ペーパー。
- [Azure のビジネス継続性テクニカル ガイダンス](https://msdn.microsoft.com/library/windowsazure/hh873027.aspx)です。 Patrick Wickline、Jason Roth、ホワイト ペーパー。
- [災害復旧と Azure アプリケーションの高可用性](https://msdn.microsoft.com/library/windowsazure/dn251004.aspx)です。 Michael McKeown、Hanu Kommalapati Jason Roth、ホワイト ペーパー。
- [Microsoft Patterns and Practices - Azure ガイダンス](https://msdn.microsoft.com/library/dn568099.aspx)です。 複数のデータ センターの展開ガイド、遮断器のパターンを参照してください。
- [Azure のサポート - サービス レベル契約](https://azure.microsoft.com/support/legal/sla/)です。
- [Azure SQL データベースにおけるビジネス継続性](https://msdn.microsoft.com/library/windowsazure/hh852669.aspx)です。 SQL データベース高可用性と災害復旧機能に関するドキュメントです。
- [高可用性と Azure の仮想マシンにおける SQL Server の災害復旧](https://msdn.microsoft.com/library/windowsazure/jj870962.aspx)です。

ビデオ:

- [フェール セーフ: スケーラブル、かつ回復力のクラウド サービスの構築](https://channel9.msdn.com/Series/FailSafe)です。 Ulrich Homann、Marc Mercuri、Mark Simms、系列を 9 つの部分で構成します。 実際のお客様と Microsoft Customer ・ Advisory Team (CAT) エクスペリエンスから抽出されたストーリーで非常にアクセス可能な興味深い方法で高度な概念とアーキテクチャの原則を説明します。 1 から 8 のエピソード数は、障害にも対処クラウド アプリをデザインする理由に徹底的に移動します。 49:57、障害点と障害モード 56:05、始まるエピソード 2 での説明およびブレーカー 40:55 始まるエピソード 3 での説明で 2 回の起動に制限のフォロー アップの説明を参照してください。
- [構築 Big: Azure のお客様のパート II から学んだ教訓](https://channel9.msdn.com/Events/Build/2012/3-030)です。 Mark Simms は、エラーのための設計と、すべてのインストルメント化について説明します。 フェール セーフ系列の詳細の操作方法に関する詳細情報になるに似ています。

> [!div class="step-by-step"]
> [前へ](unstructured-blob-storage.md)
> [次へ](monitoring-and-telemetry.md)
