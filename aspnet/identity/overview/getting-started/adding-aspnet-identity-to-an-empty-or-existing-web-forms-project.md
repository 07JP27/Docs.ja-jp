---
uid: identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
title: "ASP.NET Identity 空であるか既存の web プロジェクトのフォームを追加する |Microsoft ドキュメント"
author: raquelsa
description: "このチュートリアルでは、ASP.NET アプリケーションを ASP.NET Identity (ASP.NET の新しいメンバーシップ システム) を追加する方法を示します。 作成する場合、新しい Web フォームまたは MVC しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/23/2013
ms.topic: article
ms.assetid: 1cbc0ed2-5bd6-4b62-8d34-4c193dcd8b25
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /identity/overview/getting-started/adding-aspnet-identity-to-an-empty-or-existing-web-forms-project
msc.type: authoredcontent
ms.openlocfilehash: 3ab67b93a32106c0b79f9e8d739d47835391edb5
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="adding-aspnet-identity-to-an-empty-or-existing-web-forms-project"></a><span data-ttu-id="b9c4e-104">追加の ASP.NET Identity 空であるか既存の web プロジェクトをフォームします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-104">Adding ASP.NET Identity to an Empty or Existing Web Forms Project</span></span>
====================
<span data-ttu-id="b9c4e-105">によって[Raquel Soares De Almeida](https://github.com/raquelsa)</span><span class="sxs-lookup"><span data-stu-id="b9c4e-105">by [Raquel Soares De Almeida](https://github.com/raquelsa)</span></span>

> <span data-ttu-id="b9c4e-106">このチュートリアルは、追加する方法を示します[ASP.NET Identity](introduction-to-aspnet-identity.md) (ASP.NET の新しいメンバーシップ システム) を ASP.NET アプリケーションにします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-106">This tutorial shows you how to add [ASP.NET Identity](introduction-to-aspnet-identity.md) (the new membership system for ASP.NET) to an ASP.NET application.</span></span>
> 
> <span data-ttu-id="b9c4e-107">Visual Studio 2013 の RTM で個々 のアカウントで新しい Web フォームまたは MVC プロジェクトを作成する場合、Visual Studio は必要なすべてのパッケージをインストールし、必要なすべてのクラスを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-107">When you create a new Web Forms or MVC project in Visual Studio 2013 RTM with Individual Accounts, Visual Studio will install all the required packages and add all necessary classes for you.</span></span> <span data-ttu-id="b9c4e-108">このチュートリアルでは、既存の Web フォーム プロジェクト、または新しい空のプロジェクトに ASP.NET Id のサポートを追加する手順を示します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-108">This tutorial will illustrate the steps to add ASP.NET Identity support to your existing Web Forms project or a new empty project.</span></span> <span data-ttu-id="b9c4e-109">すれば説明は、すべての NuGet パッケージをインストールする必要があり、クラスを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-109">I will outline all the NuGet packages you need to install, and classes you need to add.</span></span> <span data-ttu-id="b9c4e-110">新しいユーザーを登録して、ユーザーの管理と認証用のすべてのメイン エントリ ポイント Api を強調表示しながらログ記録のサンプル Web フォームか検討されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-110">I will go over sample Web Forms for registering new users and logging in while highlighting all main entry point APIs for user management and authentication.</span></span> <span data-ttu-id="b9c4e-111">このサンプルでは、ASP.NET Identity の既定の実装を Entity Framework で構築された SQL データ記憶域の使用します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-111">This sample will use the ASP.NET Identity default implementation for SQL data storage which is built on Entity Framework.</span></span> <span data-ttu-id="b9c4e-112">このチュートリアルでは、SQL データベースの LocalDB を使用します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-112">This tutorial, we will use LocalDB for the SQL database.</span></span>
> 
> <span data-ttu-id="b9c4e-113">このチュートリアルは Raquel Soares De Almeida と Rick Anderson によって書き込まれました ( [ @RickAndMSFT ](https://twitter.com/#!/RickAndMSFT) )。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-113">This tutorial was written by Raquel Soares De Almeida and Rick Anderson ( [@RickAndMSFT](https://twitter.com/#!/RickAndMSFT) ).</span></span>


## <a name="getting-started-aspnet-identity"></a><span data-ttu-id="b9c4e-114">ASP.NET Identity を開始します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-114">Getting Started ASP.NET Identity</span></span>

1. <span data-ttu-id="b9c4e-115">インストールと実行によって開始[Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058)または[Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566)です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-115">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span>
2. <span data-ttu-id="b9c4e-116">をクリックして**新しいプロジェクト**先頭からページ、または、メニューを使用して選択、**ファイル**、し**新しいプロジェクト**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-116">Click **New Project** from the Start page, or you can use the menu and select **File**, and then **New Project**.</span></span>
3. <span data-ttu-id="b9c4e-117">選択**Visual c# i** n し、左側のウィンドウ**Web**し、 **ASP.NET Web アプリケーション**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-117">Select **Visual C# i** n the left pane, then **Web** and then select **ASP.NET Web Application**.</span></span> <span data-ttu-id="b9c4e-118">プロジェクト"WebFormsIdentity"の名前を指定し、をクリックして**OK**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-118">Name your project "WebFormsIdentity" and then click **OK**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image1.png)
4. <span data-ttu-id="b9c4e-119">**新しい ASP.NET プロジェクト**ダイアログで、選択、**空**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-119">In the **New ASP.NET Project** dialog, select the **Empty** template.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image2.png)  
  
 <span data-ttu-id="b9c4e-120">通知、**認証の変更**ボタンが無効になり、このテンプレートでの認証のサポートは提供されません。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-120">Notice the **Change Authentication** button is disabled and no authentication support is provided in this template.</span></span> <span data-ttu-id="b9c4e-121">Web フォーム、MVC、Web API テンプレートを使用すると、認証方法を選択できます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-121">The Web Forms, MVC and Web API templates allow you to select the authentication approach.</span></span> <span data-ttu-id="b9c4e-122">詳細については、次を参照してください。[認証の概要](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth)です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-122">For more information, see [Overview of Authentication](../../../visual-studio/overview/2013/creating-web-projects-in-visual-studio.md#auth) .</span></span>

## <a name="adding-identity-packages-to-your-app"></a><span data-ttu-id="b9c4e-123">アプリへの Id のパッケージの追加</span><span class="sxs-lookup"><span data-stu-id="b9c4e-123">Adding Identity Packages to your App</span></span>

<span data-ttu-id="b9c4e-124">ソリューション エクスプ ローラーで、プロジェクトを右クリックし、 **NuGet パッケージの管理**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-124">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="b9c4e-125">検索テキスト ボックス ダイアログ ボックスで次のように入力します。"*Identity.E*"です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-125">In the search text box dialog, type "*Identity.E*".</span></span> <span data-ttu-id="b9c4e-126">このパッケージのインストール をクリックします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-126">Click install for this package.</span></span>   
  
![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image3.png)  
  
<span data-ttu-id="b9c4e-127">このパッケージの依存関係パッケージがインストールされる注: EntityFramework と Microsoft ASP.NET Identity Core です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-127">Note that this package will install the dependency packages: EntityFramework and Microsoft ASP.NET Identity Core.</span></span>

## <a name="adding-web-forms-to-register-users"></a><span data-ttu-id="b9c4e-128">ユーザーの登録を行う Web フォームを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-128">Adding Web Forms to Register Users</span></span>

1. <span data-ttu-id="b9c4e-129">**ソリューション エクスプ ローラー**プロジェクトを右クリックし、クリックして、**追加**、し**Web フォーム**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-129">In **Solution Explorer**, right-click your project and click **Add**, and then **Web Form**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image4.png)
2. <span data-ttu-id="b9c4e-130">**項目の名前を指定** ダイアログ ボックスに、名前の新しい web フォーム**登録**、クリックして**ok**</span><span class="sxs-lookup"><span data-stu-id="b9c4e-130">In the **Specify Name for Item** dialog box, name the new web form **Register**, and then click **OK**</span></span>
3. <span data-ttu-id="b9c4e-131">生成されたマークアップを置き換える*Register.aspx*次のコードでのファイルです。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-131">Replace the markup in the generated *Register.aspx* file with the code below.</span></span> <span data-ttu-id="b9c4e-132">コードの変更が強調表示されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-132">The code changes are highlighted.</span></span>   

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample1.aspx?highlight=9,12-40)]

    > [!NOTE]
    > <span data-ttu-id="b9c4e-133">これは簡略化されたバージョンののみ、 *Register.aspx*新しい ASP.NET Web フォーム プロジェクトを作成するときに作成されるファイルです。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-133">This is just a simplified version of the *Register.aspx* file that is created when you create a new ASP.NET Web Forms project.</span></span> <span data-ttu-id="b9c4e-134">上記のマークアップでは、フォーム フィールドと、新しいユーザーを登録するためのボタンを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-134">The markup above adds form fields and a button to register a new user.</span></span>
4. <span data-ttu-id="b9c4e-135">開く、 *Register.aspx.cs*ファイルおよびファイルの内容を次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-135">Open the *Register.aspx.cs* file and replace the contents of the file with the following code:</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample2.cs)]

    > [!NOTE] 
    > 
    > 1. <span data-ttu-id="b9c4e-136">上記のコードが簡略化、 *Register.aspx.cs*新しい ASP.NET Web フォーム プロジェクトを作成するときに作成されるファイルです。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-136">The code above is a simplified version of the *Register.aspx.cs* file that is created when you create a new ASP.NET Web Forms project.</span></span>
    > 2. <span data-ttu-id="b9c4e-137">*IdentityUser*クラスは、既定の EntityFramework 実装、 *IUser*インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-137">The *IdentityUser* class is the default EntityFramework implementation of the *IUser* interface.</span></span> <span data-ttu-id="b9c4e-138">*IUser*インターフェイスは、ASP.NET Identity Core 上のユーザーの最小限のインターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-138">*IUser* interface is the minimal interface for a user on ASP.NET Identity Core.</span></span>
    > 3. <span data-ttu-id="b9c4e-139">*UserStore*クラスは、ユーザー ストアの既定の EntityFramework 実装します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-139">The *UserStore* class is the default EntityFramework implementation of a user store.</span></span> <span data-ttu-id="b9c4e-140">このクラスは ASP.NET Identity Core の最小限のインターフェイスを実装します*IUserStore*、 *IUserLoginStore*、 *IUserClaimStore*と*IUserRoleStore。*.</span><span class="sxs-lookup"><span data-stu-id="b9c4e-140">This class implements the ASP.NET Identity Core's minimal interfaces: *IUserStore*, *IUserLoginStore*, *IUserClaimStore* and *IUserRoleStore*.</span></span>
    > 4. <span data-ttu-id="b9c4e-141">*UserManager*への変更が自動的に保存するクラスが公開ユーザー関連 Api、 *UserStore*です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-141">The *UserManager* class exposes user related APIs which will automatically save changes to the *UserStore*.</span></span>
    > 5. <span data-ttu-id="b9c4e-142">*IdentityResult*クラス id 操作の結果を表します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-142">The *IdentityResult* class represents the result of an identity operation.</span></span>
5. <span data-ttu-id="b9c4e-143">**ソリューション エクスプ ローラー**プロジェクトを右クリックし、クリックして、**追加**、 **ASP.NET フォルダーの追加**し**アプリ\_データ**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-143">In **Solution Explorer**, right-click your project and click **Add**, **Add ASP.NET Folder** and then **App\_Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image5.png)
6. <span data-ttu-id="b9c4e-144">開く、 *Web.config*ファイルし、を使用してユーザー情報を格納するデータベースの接続文字列のエントリを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-144">Open the *Web.config* file and add a connection string entry for the database we will use to store user information.</span></span> <span data-ttu-id="b9c4e-145">データベースは、その EntityFramework で Identity エンティティの実行時に作成されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-145">The database will be created at runtime by EntityFramework for the Identity entities.</span></span> <span data-ttu-id="b9c4e-146">接続文字列は、いずれかの新しい Web フォーム プロジェクトを作成すると作成に似ています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-146">The connection string is similar to one created for you when you create a new Web Forms project.</span></span> <span data-ttu-id="b9c4e-147">強調表示されたコードは、追加する必要があります、マークアップを示しています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-147">The highlighted code shows the markup you should add:</span></span>

    [!code-xml[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample3.xml?highlight=11-14)]
    
    > [!NOTE] 
    > <span data-ttu-id="b9c4e-148">Visual Studio 2015 以降では、または置換`(localdb)\v11.0`で`(localdb)\MSSQLLocalDB`接続文字列にします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-148">For Visual Studio 2015 or higher, replace `(localdb)\v11.0` with `(localdb)\MSSQLLocalDB` in your connection string.</span></span>
    
7. <span data-ttu-id="b9c4e-149">ファイルを右クリックして*Register.aspx*を選択してプロジェクト**スタート ページとして設定**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-149">Right click file *Register.aspx* in your project and select **Set as Start Page**.</span></span> <span data-ttu-id="b9c4e-150">ビルドおよび web アプリケーションを実行するには、ctrl キーを押しながら F5 キーを押します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-150">Press Ctrl + F5 to build and run the web application.</span></span> <span data-ttu-id="b9c4e-151">新しいユーザー名とパスワードを入力し、をクリックして**登録**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-151">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image6.png)  

    > [!NOTE]
    > <span data-ttu-id="b9c4e-152">ASP.NET の Id が検証をサポートし、このサンプルでは、ユーザー名とパスワードの既定の動作を確認することができます、Identity Core パッケージからの検証コントロール。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-152">ASP.NET Identity has support for validation and in this sample you can verify the default behavior on User and Password validators that come from the Identity Core package.</span></span> <span data-ttu-id="b9c4e-153">ユーザーの既定の検証コントロール (`UserValidator`) プロパティが含まれる`AllowOnlyAlphanumericUserNames`設定された既定値を持つ`true`します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-153">The default validator for User (`UserValidator`) has a property `AllowOnlyAlphanumericUserNames` that has default value set to `true`.</span></span> <span data-ttu-id="b9c4e-154">既定のパスワードの検証コントロール (`MinimumLengthValidator`) によりそのパスワードは 6 文字以上です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-154">The default validator for Password (`MinimumLengthValidator`) ensures that password has at least 6 characters.</span></span> <span data-ttu-id="b9c4e-155">これらの検証コントロールのプロパティは、`UserManager`カスタムの検証する場合をオーバーライドすることができます</span><span class="sxs-lookup"><span data-stu-id="b9c4e-155">These validators are properties on `UserManager` that can be overridden if you want to have custom validation,</span></span>

## <a name="verifying-the-localdb-identity-database-and-tables-generated-by-entity-framework"></a><span data-ttu-id="b9c4e-156">LocalDb のユーザー データベースと Entity Framework によって生成されたテーブルを確認します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-156">Verifying the LocalDb Identity Database and Tables Generated by Entity Framework</span></span>

1. <span data-ttu-id="b9c4e-157">**ビュー**  メニューをクリックして**サーバー エクスプ ローラー**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-157">In the **View** menu, click **Server Explorer**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image7.png)
2. <span data-ttu-id="b9c4e-158">展開**DefaultConnection (WebFormsIdentity)**、展開**テーブル**を右クリックして**AspNetUsers**  をクリック**テーブル データの表示**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-158">Expand **DefaultConnection (WebFormsIdentity)**, expand **Tables**, right click **AspNetUsers** and click **Show Table Data**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image8.png)  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image9.png)

## <a name="configuring-the-application-for-owin-authentication"></a><span data-ttu-id="b9c4e-159">OWIN 認証用のアプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-159">Configuring the application for OWIN authentication</span></span>

<span data-ttu-id="b9c4e-160">この時点でユーザーを作成するためのサポートのみ追加されました。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-160">At this point we have only added support for creating users.</span></span> <span data-ttu-id="b9c4e-161">ここで、認証ユーザーのログインを追加できる方法を示すためになっています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-161">Now, we are going to demonstrate how we can add authentication to login a user.</span></span> <span data-ttu-id="b9c4e-162">ASP.NET Identity は、Microsoft OWIN 認証ミドルウェアをフォーム認証を使用します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-162">ASP.NET Identity uses Microsoft OWIN Authentication middleware for forms authentication.</span></span> <span data-ttu-id="b9c4e-163">OWIN の Cookie 認証は要求ベースの認証メカニズムでホストされている任意のフレームワークで使用できる、cookie [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx)または IIS です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-163">The OWIN Cookie Authentication is a cookie and claims based authentication mechanism that can be used by any framework hosted on [OWIN](https://msdn.microsoft.com/magazine/dn451439.aspx) or IIS.</span></span> <span data-ttu-id="b9c4e-164">このモデルでは、ASP.NET MVC、Web フォームを含む複数のフレームワークで同じ認証パッケージを使用できます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-164">With this model, the same authentication packages can be used across multiple frameworks including ASP.NET MVC and Web Forms.</span></span> <span data-ttu-id="b9c4e-165">プロジェクト Katana とホストの柔軟な参照でミドルウェアを実行する方法の詳細について[Katana プロジェクトの使用を開始する](https://msdn.microsoft.com/magazine/dn451439.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-165">For more information on project Katana and how to run middleware in a host agnostic see [Getting Started with the Katana Project](https://msdn.microsoft.com/magazine/dn451439.aspx).</span></span>

## <a name="installing-authentication-packages-to-your-application"></a><span data-ttu-id="b9c4e-166">アプリケーションに認証パッケージをインストールします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-166">Installing authentication packages to your application</span></span>

1. <span data-ttu-id="b9c4e-167">ソリューション エクスプ ローラーで、プロジェクトを右クリックし、 **NuGet パッケージの管理**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-167">In Solution Explorer, right-click your project and select **Manage NuGet Packages**.</span></span> <span data-ttu-id="b9c4e-168">検索テキスト ボックス ダイアログ ボックスで次のように入力します。"*Identity.Owin*"です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-168">In the search text box dialog, type "*Identity.Owin*".</span></span> <span data-ttu-id="b9c4e-169">このパッケージのインストール をクリックします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-169">Click install for this package.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image10.png)
2. <span data-ttu-id="b9c4e-170">パッケージを検索***Microsoft.Owin.Host.SystemWeb***し、インストールします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-170">Search for package ***Microsoft.Owin.Host.SystemWeb*** and install it.</span></span>   

    > [!NOTE]
    > <span data-ttu-id="b9c4e-171">**Microsoft.Aspnet.Identity.Owin**パッケージには、一連管理および ASP.NET Identity Core パッケージでの使用を OWIN 認証ミドルウェアを構成する OWIN 拡張機能のクラスにはが含まれています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-171">The **Microsoft.Aspnet.Identity.Owin** package contains a set of OWIN extension classes to manage and configure OWIN authentication middleware to be consumed by ASP.NET Identity Core packages.</span></span>  
    > <span data-ttu-id="b9c4e-172">**Microsoft.Owin.Host.SystemWeb**を ASP.NET の要求パイプラインを使用して IIS 上で実行する OWIN ベースのアプリケーションを有効にする OWIN サーバーがパッケージに含まれています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-172">The **Microsoft.Owin.Host.SystemWeb** package contains an OWIN server that enables OWIN-based applications to run on IIS using the ASP.NET request pipeline.</span></span> <span data-ttu-id="b9c4e-173">詳細については、次を参照してください。 [、IIS での OWIN ミドルウェア パイプラインを統合する](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md)です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-173">For more information see [OWIN Middleware in the IIS integrated pipeline](../../../aspnet/overview/owin-and-katana/owin-middleware-in-the-iis-integrated-pipeline.md).</span></span>

## <a name="adding-owin-startup-and-authentication-configuration-classes"></a><span data-ttu-id="b9c4e-174">OWIN 起動し、認証の構成クラスを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-174">Adding OWIN Startup and Authentication Configuration Classes</span></span>

1. <span data-ttu-id="b9c4e-175">**ソリューション エクスプ ローラー**プロジェクトを右クリックしをクリックして**追加**、し**新しい項目の追加**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-175">In **Solution Explorer**, right-click your project, click **Add**, and then **Add New Item**.</span></span> <span data-ttu-id="b9c4e-176">検索テキスト ボックス ダイアログ ボックスで次のように入力します。"*owin*"です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-176">In the search text box dialog, type "*owin*".</span></span> <span data-ttu-id="b9c4e-177">クラスに名前を"*スタートアップ*"をクリックして**追加**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-177">Name the class "*Startup*" and click **Add**.</span></span>   
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image11.png)
2. <span data-ttu-id="b9c4e-178">Startup.cs ファイルでは、OWIN cookie 認証を構成する以下の強調表示されたコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-178">In the Startup.cs file, add the highlighted code shown below to configure OWIN cookie authentication.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample4.cs?highlight=1,3,15-19)]

    > [!NOTE]
    > <span data-ttu-id="b9c4e-179">このクラスに含まれる、 `OwinStartup` OWIN スタートアップ クラスを指定するための属性です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-179">This class contains the `OwinStartup` attribute for specifying the OWIN startup class.</span></span> <span data-ttu-id="b9c4e-180">すべての OWIN アプリケーションには、アプリケーション パイプラインのコンポーネントを指定したスタートアップ クラスがあります。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-180">Every OWIN application has a startup class where you specify components for the application pipeline.</span></span> <span data-ttu-id="b9c4e-181">参照してください[OWIN スタートアップ クラス検出](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md)このモデルについての詳細。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-181">See [OWIN Startup Class Detection](../../../aspnet/overview/owin-and-katana/owin-startup-class-detection.md) for more info on this model.</span></span>

## <a name="adding-web-forms-for-registering-and-logging-in-users"></a><span data-ttu-id="b9c4e-182">登録して、ユーザーのログ記録用の Web フォームの追加</span><span class="sxs-lookup"><span data-stu-id="b9c4e-182">Adding Web Forms for Registering and Logging in Users</span></span>

1. <span data-ttu-id="b9c4e-183">開く、 *Register.cs*ファイルし、登録が成功したときに、ユーザーがログインする次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-183">Open the *Register.cs* file and add the following code which will log in the user when registration succeeds.</span></span> <span data-ttu-id="b9c4e-184">以下は、変更が強調表示されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-184">The changes are highlighted below.</span></span>

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample5.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="b9c4e-185">フレームワークに生成するアプリの開発者が必要ですし、ASP.NET Identity OWIN の Cookie 認証は要求ベースのシステムであるため、 [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx)ユーザー。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-185">Since ASP.NET Identity and OWIN Cookie Authentication are claims based system, the framework requires the app developer to generate a [ClaimsIdentity](https://msdn.microsoft.com/library/microsoft.identitymodel.claims.claimsidentity.aspx) for the user.</span></span> <span data-ttu-id="b9c4e-186">ClaimsIdentity には、ユーザーが属するロールなど、ユーザーのすべての要求に関する情報があります。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-186">ClaimsIdentity has information about all the claims for the user such as what Roles the user belongs to.</span></span> <span data-ttu-id="b9c4e-187">この段階で、ユーザーのクレームを追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-187">You can also add more claims for the user at this stage.</span></span>
    > - <span data-ttu-id="b9c4e-188">ユーザーをサインインするには、OWIN と呼び出し元からの AuthenticationManager を使用して、`SignIn`上記のように、ClaimsIdentity を渡しています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-188">You can sign in the user by using the AuthenticationManager from OWIN and calling `SignIn` and passing in the ClaimsIdentity as shown above.</span></span> <span data-ttu-id="b9c4e-189">このコードは、ユーザーにサインインしも cookie を生成します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-189">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="b9c4e-190">この呼び出しはに似て[FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx)によって使用される、 [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)モジュール。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-190">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
2. <span data-ttu-id="b9c4e-191">**ソリューション エクスプ ローラー**、プロジェクトをクリックしてを右クリックして**追加**、し**Web フォーム**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-191">In **Solution Explorer**, right-click your project click **Add**, and then **Web Form**.</span></span> <span data-ttu-id="b9c4e-192">Web フォームの名前を付けます**ログイン**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-192">Name the web form **Login**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image12.png)
3. <span data-ttu-id="b9c4e-193">内容を置き換える、 *Login.aspx*を次のコード ファイル。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-193">Replace the contents of the *Login.aspx* file with the following code:</span></span>  

    [!code-aspx[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample6.aspx)]
4. <span data-ttu-id="b9c4e-194">内容を置き換える、 *Login.aspx.cs*を次のファイル。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-194">Replace the contents of the *Login.aspx.cs* file with the following:</span></span>  

    [!code-csharp[Main](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/samples/sample7.cs)]

    > [!NOTE] 
    > 
    > - <span data-ttu-id="b9c4e-195">`Page_Load`の現在のユーザーの状態を確認し、に基づいてアクションを今すぐその`Context.User.Identity.IsAuthenticated`状態です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-195">The `Page_Load` now checks for the status of current user and takes action based on its `Context.User.Identity.IsAuthenticated` status.</span></span>  
    >     <span data-ttu-id="b9c4e-196">**ユーザー名のログインを表示**: 拡張メソッドを追加で、Microsoft ASP.NET Identity Framework[どのオブジェクト タイプも](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx)を取得することができます、`UserName`と`UserId`用、ユーザーに記録されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-196">**Display Logged in User Name** : The Microsoft ASP.NET Identity Framework has added extension methods on [System.Security.Principal.IIdentity](https://msdn.microsoft.com/library/system.security.principal.iidentity.aspx) that allows you to get the `UserName` and `UserId`  for the logged in User.</span></span> <span data-ttu-id="b9c4e-197">これらの拡張メソッドが定義されている、`Microsoft.AspNet.Identity.Core`アセンブリ。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-197">These extension methods are defined in the `Microsoft.AspNet.Identity.Core` assembly.</span></span> <span data-ttu-id="b9c4e-198">これらの拡張メソッドは、置換の[HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-198">These extension methods are the replacement for [HttpContext.User.Identity.Name](https://msdn.microsoft.com/library/system.web.httpcontext.user.aspx) .</span></span>
    > - <span data-ttu-id="b9c4e-199">SignIn メソッド:</span><span class="sxs-lookup"><span data-stu-id="b9c4e-199">SignIn method:</span></span>   
    >     <span data-ttu-id="b9c4e-200">`This`メソッドは、以前に置き換えて`CreateUser_Click`メソッドでこのサンプルと、ユーザーが正常に作成した後、ユーザー サインインようになりました。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-200">`This` method replaces the previous `CreateUser_Click` method in this sample and now signs in the user after successfully creating the user.</span></span>   
    >  <span data-ttu-id="b9c4e-201">拡張メソッドを追加で、Microsoft OWIN Framework`System.Web.HttpContext`への参照を取得することができます、`IOwinContext`です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-201">The Microsoft OWIN Framework has added extension methods on `System.Web.HttpContext` that allows you to get a reference to an `IOwinContext`.</span></span> <span data-ttu-id="b9c4e-202">これらの拡張メソッドが定義されている`Microsoft.Owin.Host.SystemWeb`アセンブリ。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-202">These extension methods are defined in `Microsoft.Owin.Host.SystemWeb` assembly.</span></span> <span data-ttu-id="b9c4e-203">`OwinContext`クラスが公開する`IAuthenticationManager`を現在の要求で使用可能な認証ミドルウェアの機能を表すプロパティ。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-203">The `OwinContext` class exposes an `IAuthenticationManager` property that represents the Authentication middleware functionality available on the current request.</span></span>  
    >  <span data-ttu-id="b9c4e-204">ユーザーをサインインするを使用して、 `AuthenticationManager` OWIN と呼び出し元から`SignIn`およびを渡して、`ClaimsIdentity`上記のようにします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-204">You can sign in the user by using the `AuthenticationManager` from OWIN and calling `SignIn`  and passing in the `ClaimsIdentity`  as shown above.</span></span>   
    >  <span data-ttu-id="b9c4e-205">フレームワークを生成するアプリを必要とし、ASP.NET Identity OWIN の Cookie 認証は要求ベースのシステムであるため、`ClaimsIdentity`ユーザー。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-205">Because ASP.NET Identity and OWIN Cookie Authentication are claims-based system, the framework requires the app to generate a `ClaimsIdentity` for the user.</span></span>   
    >  <span data-ttu-id="b9c4e-206">`ClaimsIdentity`ユーザーが属するロールなどのユーザーのすべての要求に関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-206">The `ClaimsIdentity` has information about all the claims for the user, such as what roles the user belongs to.</span></span> <span data-ttu-id="b9c4e-207">この段階で、ユーザーのクレームを追加することもできます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-207">You can also add more claims for the user at this stage</span></span>  
    >  <span data-ttu-id="b9c4e-208">このコードは、ユーザーにサインインしも cookie を生成します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-208">This code will sign in the user and generate a cookie as well.</span></span> <span data-ttu-id="b9c4e-209">この呼び出しはに似て[FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx)によって使用される、 [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)モジュール。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-209">This call is analogous to [FormAuthentication.SetAuthCookie](https://msdn.microsoft.com/library/system.web.security.formsauthentication.setauthcookie.aspx) used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
    > - <span data-ttu-id="b9c4e-210">`SignOut`方法:</span><span class="sxs-lookup"><span data-stu-id="b9c4e-210">`SignOut` method:</span></span>   
    >  <span data-ttu-id="b9c4e-211">参照を取得、 `AuthenticationManager` OWIN と呼び出しから`SignOut`です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-211">Gets a reference to the `AuthenticationManager` from OWIN and calls `SignOut`.</span></span> <span data-ttu-id="b9c4e-212">これは、メソッドは[FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx)で使用する方法、 [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx)モジュール。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-212">This is analogous to [FormsAuthentication.SignOut](https://msdn.microsoft.com/library/system.web.security.formsauthentication.signout.aspx) method used by the [FormsAuthentication](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx) module.</span></span>
5. <span data-ttu-id="b9c4e-213">キーを押して**ctrl キーを押しながら f5 キーを押して**をビルドして、web アプリケーションを実行します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-213">Press **Ctrl + F5** to build and run the web application.</span></span> <span data-ttu-id="b9c4e-214">新しいユーザー名とパスワードを入力し、をクリックして**登録**です。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-214">Enter a new user name and password and then click on **Register**.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image13.png)  
 <span data-ttu-id="b9c4e-215">注: この時点では、新しいユーザーが作成されに記録します。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-215">Note: At this point, the new user is created and logged in.</span></span>
6. <span data-ttu-id="b9c4e-216">をクリックして**ログアウト**ボタンをクリックします。フォームでログにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-216">Click on **Log out** button.You will be redirected to the Log in form.</span></span>
7. <span data-ttu-id="b9c4e-217">無効なユーザー名またはパスワードとクリックを入力**ログイン**ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-217">Enter an invalid user name or password and Click on **Log in** button.</span></span>   
 <span data-ttu-id="b9c4e-218">`UserManager.Find`メソッドは null が返され、エラー メッセージ:"*無効なユーザー名またはパスワード*"が表示されます。</span><span class="sxs-lookup"><span data-stu-id="b9c4e-218">The `UserManager.Find`  method will return null and the error message: " *Invalid user name or password* " will be displayed.</span></span>  
  
    ![](adding-aspnet-identity-to-an-empty-or-existing-web-forms-project/_static/image14.png)
