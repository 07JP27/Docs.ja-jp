---
uid: mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
title: "5 – のイテレーションを作成する単体テスト (VB) |Microsoft ドキュメント"
author: microsoft
description: "5 番目のイテレーションでおやすく、アプリケーションを維持し、単体テストを追加して変更できます。 データ モデル クラスを模擬表示し、o の単体テストをビルドしています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2009
ms.topic: article
ms.assetid: c6e5c036-2265-4fa7-a9eb-47f197bdc262
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-5-create-unit-tests-vb
msc.type: authoredcontent
ms.openlocfilehash: ab9ff5629cb468b785f5b82178f9f6247a55cacb
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="iteration-5--create-unit-tests-vb"></a><span data-ttu-id="166df-104">イテレーション #5-単体テストの作成 (VB)</span><span class="sxs-lookup"><span data-stu-id="166df-104">Iteration #5 – Create unit tests (VB)</span></span>
====================
<span data-ttu-id="166df-105">によって[Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="166df-105">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="166df-106">コードをダウンロードします。</span><span class="sxs-lookup"><span data-stu-id="166df-106">Download Code</span></span>](iteration-5-create-unit-tests-vb/_static/contactmanager_5_vb1.zip)

> <span data-ttu-id="166df-107">5 番目のイテレーションでおやすく、アプリケーションを維持し、単体テストを追加して変更できます。</span><span class="sxs-lookup"><span data-stu-id="166df-107">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="166df-108">データ モデル クラスを模擬表示し、コント ローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="166df-108">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>


## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a><span data-ttu-id="166df-109">連絡先管理 ASP.NET MVC アプリケーション (VB) のビルド</span><span class="sxs-lookup"><span data-stu-id="166df-109">Building a Contact Management ASP.NET MVC Application (VB)</span></span>

<span data-ttu-id="166df-110">この一連のチュートリアルは、連絡先管理アプリケーション全体が開始されてから完了するを構築します。</span><span class="sxs-lookup"><span data-stu-id="166df-110">In this series of tutorials, we build an entire Contact Management application from start to finish.</span></span> <span data-ttu-id="166df-111">お問い合わせのマネージャー アプリケーションでは、人のユーザーの一覧については使用すると、連絡先情報の名前、電話番号、電子メール アドレスを格納できます。</span><span class="sxs-lookup"><span data-stu-id="166df-111">The Contact Manager application enables you to store contact information - names, phone numbers and email addresses - for a list of people.</span></span>

<span data-ttu-id="166df-112">私たちは、複数のイテレーションにおける、アプリケーションを構築します。</span><span class="sxs-lookup"><span data-stu-id="166df-112">We build the application over multiple iterations.</span></span> <span data-ttu-id="166df-113">各イテレーションで、アプリケーション、徐々 に向上します。</span><span class="sxs-lookup"><span data-stu-id="166df-113">With each iteration, we gradually improve the application.</span></span> <span data-ttu-id="166df-114">この複数のイテレーション アプローチの目的は、各変更の理由を理解するためです。</span><span class="sxs-lookup"><span data-stu-id="166df-114">The goal of this multiple iteration approach is to enable you to understand the reason for each change.</span></span>

- <span data-ttu-id="166df-115">イテレーション 1 には、アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-115">Iteration #1 - Create the application.</span></span> <span data-ttu-id="166df-116">最初のイテレーションでお連絡先のマネージャー最も簡単な方法で可能なを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-116">In the first iteration, we create the Contact Manager in the simplest way possible.</span></span> <span data-ttu-id="166df-117">基本的なデータベース操作のサポートを追加します: 作成、読み取り、更新、および削除 (CRUD)。</span><span class="sxs-lookup"><span data-stu-id="166df-117">We add support for basic database operations: Create, Read, Update, and Delete (CRUD).</span></span>

- <span data-ttu-id="166df-118">イテレーション 2 では、素敵に見えるアプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-118">Iteration #2 - Make the application look nice.</span></span> <span data-ttu-id="166df-119">このイテレーションで、アプリケーションの外観を向上させる、既定の ASP.NET MVC ビュー マスター ページを変更し、カスケード スタイル シート。</span><span class="sxs-lookup"><span data-stu-id="166df-119">In this iteration, we improve the appearance of the application by modifying the default ASP.NET MVC view master page and cascading style sheet.</span></span>

- <span data-ttu-id="166df-120">イテレーション 3 - フォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-120">Iteration #3 - Add form validation.</span></span> <span data-ttu-id="166df-121">3 番目のイテレーションは、基本フォーム検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-121">In the third iteration, we add basic form validation.</span></span> <span data-ttu-id="166df-122">おは人が必要なフォームのフィールドを完了しなくても、フォームを送信することを防ぐ。</span><span class="sxs-lookup"><span data-stu-id="166df-122">We prevent people from submitting a form without completing required form fields.</span></span> <span data-ttu-id="166df-123">私たちも電子メール アドレスと電話番号を検証します。</span><span class="sxs-lookup"><span data-stu-id="166df-123">We also validate email addresses and phone numbers.</span></span>

- <span data-ttu-id="166df-124">4: イテレーションは、疎結合アプリケーションを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-124">Iteration #4 - Make the application loosely coupled.</span></span> <span data-ttu-id="166df-125">この 3 番目のイテレーションで利用の保守し、連絡先のマネージャー アプリケーションの変更を容易にできるようにするソフトウェア設計パターンをいくつかのです。</span><span class="sxs-lookup"><span data-stu-id="166df-125">In this third iteration, we take advantage of several software design patterns to make it easier to maintain and modify the Contact Manager application.</span></span> <span data-ttu-id="166df-126">たとえば、リポジトリ パターンと依存関係の挿入のパターンを使用するようにアプリケーションをリファクターします。</span><span class="sxs-lookup"><span data-stu-id="166df-126">For example, we refactor our application to use the Repository pattern and the Dependency Injection pattern.</span></span>

- <span data-ttu-id="166df-127">イテレーション #5 - 単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-127">Iteration #5 - Create unit tests.</span></span> <span data-ttu-id="166df-128">5 番目のイテレーションでおやすく、アプリケーションを維持し、単体テストを追加して変更できます。</span><span class="sxs-lookup"><span data-stu-id="166df-128">In the fifth iteration, we make our application easier to maintain and modify by adding unit tests.</span></span> <span data-ttu-id="166df-129">データ モデル クラスを模擬表示し、コント ローラーと検証ロジックの単体テストをビルドします。</span><span class="sxs-lookup"><span data-stu-id="166df-129">We mock our data model classes and build unit tests for our controllers and validation logic.</span></span>

- <span data-ttu-id="166df-130">イテレーション 6 - テスト駆動開発を使用します。</span><span class="sxs-lookup"><span data-stu-id="166df-130">Iteration #6 - Use test-driven development.</span></span> <span data-ttu-id="166df-131">この 6 番目のイテレーションでは、アプリケーションに新しい機能を追加おには、まず単体テストを記述し、単体テストに対してコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="166df-131">In this sixth iteration, we add new functionality to our application by writing unit tests first and writing code against the unit tests.</span></span> <span data-ttu-id="166df-132">このイテレーションは、連絡先グループを追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-132">In this iteration, we add contact groups.</span></span>

- <span data-ttu-id="166df-133">イテレーション #7 - Ajax 機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-133">Iteration #7 - Add Ajax functionality.</span></span> <span data-ttu-id="166df-134">7 番目のイテレーションでお、応答性およびパフォーマンスの向上、アプリケーションの Ajax のサポートを追加することで。</span><span class="sxs-lookup"><span data-stu-id="166df-134">In the seventh iteration, we improve the responsiveness and performance of our application by adding support for Ajax.</span></span>


## <a name="this-iteration"></a><span data-ttu-id="166df-135">このイテレーション</span><span class="sxs-lookup"><span data-stu-id="166df-135">This Iteration</span></span>

<span data-ttu-id="166df-136">連絡先のマネージャー アプリケーションの前回のイテレーションより緩やかに結合されアプリケーションにリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="166df-136">In the previous iteration of the Contact Manager application, we refactored the application to be more loosely coupled.</span></span> <span data-ttu-id="166df-137">ここには、個別のコント ローラー、サービス、およびリポジトリ レイヤーへのアプリケーションが区切られます。</span><span class="sxs-lookup"><span data-stu-id="166df-137">We separated the application into distinct controller, service, and repository layers.</span></span> <span data-ttu-id="166df-138">各レイヤーは、インターフェイスを通じて下のレイヤーと通信します。</span><span class="sxs-lookup"><span data-stu-id="166df-138">Each layer interacts with the layer beneath it through interfaces.</span></span>

<span data-ttu-id="166df-139">アプリケーションを容易に保守して変更するアプリケーションをリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="166df-139">We refactored the application to make the application easier to maintain and modify.</span></span> <span data-ttu-id="166df-140">たとえば、新しいデータ アクセス テクノロジを使用する必要がある場合、は、リポジトリ層をコント ローラーまたはサービス層に触れることがなくに変更できます単におです。</span><span class="sxs-lookup"><span data-stu-id="166df-140">For example, if we need to use a new data access technology, we can simply change the repository layer without touching the controller or service layer.</span></span> <span data-ttu-id="166df-141">疎結合、連絡先のマネージャーをすることによりアプリケーションを作成を変更する回復性が向上しています。</span><span class="sxs-lookup"><span data-stu-id="166df-141">By making the Contact Manager loosely coupled, we ve made the application more resilient to change.</span></span>

<span data-ttu-id="166df-142">連絡先のマネージャー アプリケーションに新しい機能を追加するとどうなりますか。</span><span class="sxs-lookup"><span data-stu-id="166df-142">But, what happens when we need to add a new feature to the Contact Manager application?</span></span> <span data-ttu-id="166df-143">または、バグ修正とどうなりますか。</span><span class="sxs-lookup"><span data-stu-id="166df-143">Or, what happens when we fix a bug?</span></span> <span data-ttu-id="166df-144">コードの記述、残念ながら、実績のある情報源に新しいバグが生じるリスクを作成するコードをタッチするときに、です。</span><span class="sxs-lookup"><span data-stu-id="166df-144">A sad, but well proven, truth of writing code is that whenever you touch code you create the risk of introducing new bugs.</span></span>

<span data-ttu-id="166df-145">たとえば、問題の 1 日、上司可能性があります求められる Contact Manager に新しい機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-145">For example, one fine day, your manager might ask you to add a new feature to the Contact Manager.</span></span> <span data-ttu-id="166df-146">連絡先グループのサポートを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-146">She wants you to add support for Contact Groups.</span></span> <span data-ttu-id="166df-147">友人やビジネスなどのグループに、連絡先を整理するユーザーを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-147">She wants you to enable users to organize their contacts into groups such as Friends, Business, and so on.</span></span>

<span data-ttu-id="166df-148">この新しい機能を実装するために、連絡先のマネージャー アプリケーションのすべての 3 つの層を変更する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-148">In order to implement this new feature, you'll need to modify all three layers of the Contact Manager application.</span></span> <span data-ttu-id="166df-149">コント ローラー、サービス層、およびリポジトリに新しい機能を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-149">You'll need to add new functionality to the controllers, the service layer, and the repository.</span></span> <span data-ttu-id="166df-150">コードの変更を開始するとすぐに、前に動作していた機能を損なう可能性があります。</span><span class="sxs-lookup"><span data-stu-id="166df-150">As soon as you start modifying code, you risk breaking functionality that worked before.</span></span>

<span data-ttu-id="166df-151">良いことが前回のイテレーションで行ったように、アプリケーションを別のレイヤーをリファクタリングします。</span><span class="sxs-lookup"><span data-stu-id="166df-151">Refactoring our application into separate layers, as we did in the previous iteration, was a good thing.</span></span> <span data-ttu-id="166df-152">これにより、アプリケーションの残りの部分に触れることがなく、レイヤー全体に変更を加えるため良いことでした。</span><span class="sxs-lookup"><span data-stu-id="166df-152">It was a good thing because it enables us to make changes to entire layers without touching the rest of the application.</span></span> <span data-ttu-id="166df-153">ただし、レイヤー内のコードを容易に保守して変更する場合は、コードの単体テストを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-153">However, if you want to make the code within a layer easier to maintain and modify, you need to create unit tests for the code.</span></span>

<span data-ttu-id="166df-154">使用する単位をテスト コードの個別の単位。</span><span class="sxs-lookup"><span data-stu-id="166df-154">You use a unit test to test an individual unit of code.</span></span> <span data-ttu-id="166df-155">これらの単位のコードは、全体のアプリケーション層よりも小さいです。</span><span class="sxs-lookup"><span data-stu-id="166df-155">These units of code are smaller than entire application layers.</span></span> <span data-ttu-id="166df-156">通常、コード内の特定のメソッドが期待どおりに動作するかどうかを確認するのに単体テストを使用します。</span><span class="sxs-lookup"><span data-stu-id="166df-156">Typically, you use a unit test to verify whether a particular method in your code behaves in the way that you expect.</span></span> <span data-ttu-id="166df-157">たとえば、ContactManagerService クラスによって公開される CreateContact() メソッドの単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-157">For example, you would create a unit test for the CreateContact() method exposed by the ContactManagerService class.</span></span>

<span data-ttu-id="166df-158">単なるアプリケーション作業に単体テストでは、安全策と同様にします。</span><span class="sxs-lookup"><span data-stu-id="166df-158">The unit tests for an application work just like a safety net.</span></span> <span data-ttu-id="166df-159">アプリケーションのコードを変更するたびに、一連の変更が既存の機能を中断するかどうかを確認する単体テストを実行できます。</span><span class="sxs-lookup"><span data-stu-id="166df-159">Whenever you modify code in an application, you can run a set of unit tests to check whether the modification breaks existing functionality.</span></span> <span data-ttu-id="166df-160">単体テスト、コードを容易に変更しても安全です。</span><span class="sxs-lookup"><span data-stu-id="166df-160">Unit tests make your code safe to modify.</span></span> <span data-ttu-id="166df-161">単体テストのすべてのコード、アプリケーションで回復力を高めるを変更します。</span><span class="sxs-lookup"><span data-stu-id="166df-161">Unit tests make all of the code in your application more resilient to change.</span></span>

<span data-ttu-id="166df-162">このイテレーションでは、単体テストを追加お、連絡先のマネージャー アプリケーションにします。</span><span class="sxs-lookup"><span data-stu-id="166df-162">In this iteration, we add unit tests to our Contact Manager application.</span></span> <span data-ttu-id="166df-163">こうすれば、次のイテレーションでお連絡先グループに追加できますアプリケーション既存の機能の重大な気にせずします。</span><span class="sxs-lookup"><span data-stu-id="166df-163">That way, in the next iteration, we can add Contact Groups to our application without worrying about breaking existing functionality.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="166df-164">さまざまな単体テスト フレームワーク NUnit、xUnit.net、MbUnit などがあります。</span><span class="sxs-lookup"><span data-stu-id="166df-164">There are a variety of unit testing frameworks including NUnit, xUnit.net, and MbUnit.</span></span> <span data-ttu-id="166df-165">このチュートリアルでは、単体テスト フレームワークが Visual Studio に含まれているを使用します。</span><span class="sxs-lookup"><span data-stu-id="166df-165">In this tutorial, we use the unit testing framework included with Visual Studio.</span></span> <span data-ttu-id="166df-166">ただし、同じくらい簡単に使用できますのこれらの代替フレームワークのいずれか。</span><span class="sxs-lookup"><span data-stu-id="166df-166">However, you could just as easily use one of these alternative frameworks.</span></span>


## <a name="what-gets-tested"></a><span data-ttu-id="166df-167">テストのものを取得</span><span class="sxs-lookup"><span data-stu-id="166df-167">What Gets Tested</span></span>

<span data-ttu-id="166df-168">理想の世界では、すべてのコードは単体テストでカバーが。</span><span class="sxs-lookup"><span data-stu-id="166df-168">In the perfect world, all of your code would be covered by unit tests.</span></span> <span data-ttu-id="166df-169">理想の世界では、完全な安全策があります。</span><span class="sxs-lookup"><span data-stu-id="166df-169">In the perfect world, you would have the perfect safety net.</span></span> <span data-ttu-id="166df-170">アプリケーションのコードの任意の行を変更し、把握、すぐに、単体テストを実行することによって、変更が既存の機能を中断するかどうかをすることができます。</span><span class="sxs-lookup"><span data-stu-id="166df-170">You would be able to modify any line of code in your application and know instantly, by executing your unit tests, whether the change broke existing functionality.</span></span>

<span data-ttu-id="166df-171">ただし、完全な世界でライブ t をありません。</span><span class="sxs-lookup"><span data-stu-id="166df-171">However, we don t live in a perfect world.</span></span> <span data-ttu-id="166df-172">実際には、単体テストを記述する場合は、ビジネス ロジック (たとえば、検証ロジック) のテストの記述に集中します。</span><span class="sxs-lookup"><span data-stu-id="166df-172">In practice, when writing unit tests, you concentrate on writing tests for your business logic (for example, validation logic).</span></span> <span data-ttu-id="166df-173">具体的には、する*しない*データの単体テストを記述ロジックや、ビュー ロジックにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="166df-173">In particular, you *do not* write unit tests for your data access logic or your view logic.</span></span>

<span data-ttu-id="166df-174">便利ですが、非常に短時間単体テストで実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-174">To be useful, unit tests must execute very quickly.</span></span> <span data-ttu-id="166df-175">アプリケーションの単体テストの数百台 (または何千も) を蓄積することが簡単にします。</span><span class="sxs-lookup"><span data-stu-id="166df-175">You easily can accumulate hundreds (or even thousands) of unit tests for an application.</span></span> <span data-ttu-id="166df-176">単体テストを実行する時間がかかる場合は、それらの実行を回避します。</span><span class="sxs-lookup"><span data-stu-id="166df-176">If the unit tests take a long time to run then you'll avoid executing them.</span></span> <span data-ttu-id="166df-177">つまり、実行時間の長い単体テストは、毎日コーディング目的の役に立たなくです。</span><span class="sxs-lookup"><span data-stu-id="166df-177">In other words, long running unit tests are useless for day to day coding purposes.</span></span>

<span data-ttu-id="166df-178">このため、通常書きデータベースとやり取りするコードの単体テストをします。</span><span class="sxs-lookup"><span data-stu-id="166df-178">For this reason, you typically do not write unit tests for code that interacts with a database.</span></span> <span data-ttu-id="166df-179">ライブ データベースに対して何百もの単体テストを実行しているに遅くなりすぎてできなくなります。</span><span class="sxs-lookup"><span data-stu-id="166df-179">Running hundreds of unit tests against a live database would be too slow.</span></span> <span data-ttu-id="166df-180">代わりに、データベースを模擬表示し、(触れ以下のデータベースをモック) モック データベースと対話するコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="166df-180">Instead, you mock your database and write code that interacts with the mock database (we discuss mocking a database below).</span></span>

<span data-ttu-id="166df-181">ような理由から、通常書きビューの単体テストをします。</span><span class="sxs-lookup"><span data-stu-id="166df-181">For a similar reason, you typically do not write unit tests for views.</span></span> <span data-ttu-id="166df-182">ビューをテストするのには、web サーバーをスピンアップする必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-182">In order to test a view, you must spin up a web server.</span></span> <span data-ttu-id="166df-183">Web サーバーをスピンアップは比較的低速なプロセスなので、ビューの単体テストの作成はお勧めできません。</span><span class="sxs-lookup"><span data-stu-id="166df-183">Because spinning up a web server is a relatively slow process, creating unit tests for your views is not recommended.</span></span>

<span data-ttu-id="166df-184">ビューには、複雑なロジックが含まれている場合にヘルパー メソッドのロジックを移動を検討してください。</span><span class="sxs-lookup"><span data-stu-id="166df-184">If your view contains complicated logic then you should consider moving the logic into Helper methods.</span></span> <span data-ttu-id="166df-185">スピン、web サーバーを使用せずに実行するヘルパー メソッドの単体テストを記述することができます。</span><span class="sxs-lookup"><span data-stu-id="166df-185">You can write unit tests for Helper methods that execute without spinning up a web server.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="166df-186">データ アクセス ロジックに対するテストを作成または表示ロジックがないことをお勧め単体テストを記述する場合、中には、関数型構築または統合テスト時にこれらのテストが非常に重要なできます。</span><span class="sxs-lookup"><span data-stu-id="166df-186">While writing tests for data access logic or view logic is not a good idea when writing unit tests, these tests can be very valuable when building functional or integration tests.</span></span>


> [!NOTE] 
> 
> <span data-ttu-id="166df-187">ASP.NET MVC は、Web フォーム ビュー エンジンです。</span><span class="sxs-lookup"><span data-stu-id="166df-187">ASP.NET MVC is the Web Forms View Engine.</span></span> <span data-ttu-id="166df-188">Web フォーム ビュー エンジンは、web サーバーに依存するその他のビュー エンジンがあります。</span><span class="sxs-lookup"><span data-stu-id="166df-188">While the Web Forms View Engine is dependent on a web server, other view engines might not be.</span></span>


## <a name="using-a-mock-object-framework"></a><span data-ttu-id="166df-189">モック オブジェクト フレームワークを使用します。</span><span class="sxs-lookup"><span data-stu-id="166df-189">Using a Mock Object Framework</span></span>

<span data-ttu-id="166df-190">単体テストを作成するときにほとんどの場合、モック オブジェクト フレームワークを活用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-190">When building unit tests, you almost always need to take advantage of a Mock Object framework.</span></span> <span data-ttu-id="166df-191">モック オブジェクト フレームワークでは、アプリケーションでモックとスタブ クラスを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="166df-191">A Mock Object framework enables you to create mocks and stubs for the classes in your application.</span></span>

<span data-ttu-id="166df-192">たとえば、モック オブジェクト フレームワークを使用すると、モック リポジトリ クラスのバージョンを生成します。</span><span class="sxs-lookup"><span data-stu-id="166df-192">For example, you can use a Mock Object framework to generate a mock version of your repository class.</span></span> <span data-ttu-id="166df-193">このように、単体テストで、実際のリポジトリ クラスの代わりにもモック リポジトリ クラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="166df-193">That way, you can use the mock repository class instead of the real repository class in your unit tests.</span></span> <span data-ttu-id="166df-194">モック リポジトリを使用するには、単体テストを実行するときにデータベース コードの実行を回避することができます。</span><span class="sxs-lookup"><span data-stu-id="166df-194">Using the mock repository enables you to avoid executing database code when executing a unit test.</span></span>

<span data-ttu-id="166df-195">Visual Studio では、モック オブジェクト フレームワークは含まれません。</span><span class="sxs-lookup"><span data-stu-id="166df-195">Visual Studio does not include a Mock Object framework.</span></span> <span data-ttu-id="166df-196">ただし、いくつかの商用およびオープン ソース モック オブジェクト フレームワーク、.NET framework を使用できます。</span><span class="sxs-lookup"><span data-stu-id="166df-196">However, there are several commercial and open source Mock Object frameworks available for the .NET framework:</span></span>

1. <span data-ttu-id="166df-197">Moq - このフレームワークはオープン ソース BSD ライセンスの下で使用できます。</span><span class="sxs-lookup"><span data-stu-id="166df-197">Moq - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="166df-198">Moq をダウンロードする[https://code.google.com/p/moq/](https://code.google.com/p/moq/)です。</span><span class="sxs-lookup"><span data-stu-id="166df-198">You can download Moq from [https://code.google.com/p/moq/](https://code.google.com/p/moq/).</span></span>
2. <span data-ttu-id="166df-199">Rhino Mocks - このフレームワークは、オープン ソース BSD ライセンスで使用できます。</span><span class="sxs-lookup"><span data-stu-id="166df-199">Rhino Mocks - This framework is available under the open source BSD license.</span></span> <span data-ttu-id="166df-200">Rhino が Mocks からダウンロードできます[http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="166df-200">You can download Rhino Mocks from [http://ayende.com/projects/rhino-mocks.aspx](http://ayende.com/projects/rhino-mocks.aspx).</span></span>
3. <span data-ttu-id="166df-201">Typemock Isolator - これは、商用のフレームワークです。</span><span class="sxs-lookup"><span data-stu-id="166df-201">Typemock Isolator - This is a commercial framework.</span></span> <span data-ttu-id="166df-202">評価版をダウンロードする[http://www.typemock.com/](http://www.typemock.com/)です。</span><span class="sxs-lookup"><span data-stu-id="166df-202">You can download a trial version from [http://www.typemock.com/](http://www.typemock.com/).</span></span>

<span data-ttu-id="166df-203">このチュートリアルでは Moq を使用することにしました。</span><span class="sxs-lookup"><span data-stu-id="166df-203">In this tutorial, I decided to use Moq.</span></span> <span data-ttu-id="166df-204">ただし、同じくらい簡単に使用する Rhino Mocks したり、連絡先のマネージャー アプリケーションのオブジェクトをモックを作成する Typemock Isolator です。</span><span class="sxs-lookup"><span data-stu-id="166df-204">However, you could just as easily use Rhino Mocks or Typemock Isolator to create the Mock objects for the Contact Manager application.</span></span>

<span data-ttu-id="166df-205">Moq を使用することができます、前に、次の手順を完了する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-205">Before you can use Moq, you need to complete the following steps:</span></span>

1. <span data-ttu-id="166df-206">。</span><span class="sxs-lookup"><span data-stu-id="166df-206">.</span></span>
2. <span data-ttu-id="166df-207">ダウンロードを解凍する前に、ファイルを右クリックしてボタンをクリックすることを確認してください**ブロックを解除する**(図 1 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="166df-207">Before you unzip the download, make sure that you right-click the file and click the button labeled **Unblock** (see Figure 1).</span></span>
3. <span data-ttu-id="166df-208">ダウンロードを解凍します。</span><span class="sxs-lookup"><span data-stu-id="166df-208">Unzip the download.</span></span>
4. <span data-ttu-id="166df-209">テスト プロジェクトにメニュー オプションを選択して Moq アセンブリへの参照を追加**プロジェクトで、参照の追加**を開くには、**参照の追加**ダイアログ。</span><span class="sxs-lookup"><span data-stu-id="166df-209">Add a reference to the Moq assembly to your Test project by selecting the menu option **Project, Add Reference** to open the **Add Reference** dialog.</span></span> <span data-ttu-id="166df-210">参照 タブで、Moq を解凍したフォルダーに移動し、Moq.dll アセンブリを選択します。</span><span class="sxs-lookup"><span data-stu-id="166df-210">Under the Browse tab, browse to the folder where you unzipped Moq and select the Moq.dll assembly.</span></span> <span data-ttu-id="166df-211">クリックして、 **OK** (図 2 を参照してください) ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="166df-211">Click the **OK** button (see Figure 2).</span></span>


<span data-ttu-id="166df-212">[![ブロック解除 Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="166df-212">[![Unblocking Moq](iteration-5-create-unit-tests-vb/_static/image1.jpg)](iteration-5-create-unit-tests-vb/_static/image1.png)</span></span>

<span data-ttu-id="166df-213">**図 01**: ブロック解除 Moq ([フルサイズのイメージを表示するをクリックして](iteration-5-create-unit-tests-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="166df-213">**Figure 01**: Unblocking Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image2.png))</span></span>


<span data-ttu-id="166df-214">[![Moq を追加した後の参照](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="166df-214">[![References after adding Moq](iteration-5-create-unit-tests-vb/_static/image2.jpg)](iteration-5-create-unit-tests-vb/_static/image3.png)</span></span>

<span data-ttu-id="166df-215">**図 02**: Moq を追加した後の参照 ([フルサイズのイメージを表示するをクリックして](iteration-5-create-unit-tests-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="166df-215">**Figure 02**: References after adding Moq([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image4.png))</span></span>


## <a name="creating-unit-tests-for-the-service-layer"></a><span data-ttu-id="166df-216">サービス層の単体テストの作成</span><span class="sxs-lookup"><span data-stu-id="166df-216">Creating Unit Tests for the Service Layer</span></span>

<span data-ttu-id="166df-217">S、連絡先のマネージャー アプリケーションのサービス層の単体テストのセットを作成することで開始できるようにします。</span><span class="sxs-lookup"><span data-stu-id="166df-217">Let s start by creating a set of unit tests for our Contact Manager application s service layer.</span></span> <span data-ttu-id="166df-218">これらのテストを使用して、検証ロジックを確認してください。</span><span class="sxs-lookup"><span data-stu-id="166df-218">We'll use these tests to verify our validation logic.</span></span>

<span data-ttu-id="166df-219">ContactManager.Tests プロジェクトでモデルをという名前の新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-219">Create a new folder named Models in the ContactManager.Tests project.</span></span> <span data-ttu-id="166df-220">次に、Models フォルダーを右クリックし **追加、新しいテスト**です。</span><span class="sxs-lookup"><span data-stu-id="166df-220">Next, right-click the Models folder and select **Add, New Test**.</span></span> <span data-ttu-id="166df-221">**新しいテストの追加**図 3 に示すダイアログが表示されます。</span><span class="sxs-lookup"><span data-stu-id="166df-221">The **Add New Test** dialog shown in Figure 3 appears.</span></span> <span data-ttu-id="166df-222">選択、**単体テスト**テンプレートし、新しいテスト ContactManagerServiceTest.vb の名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="166df-222">Select the **Unit Test** template and name your new test ContactManagerServiceTest.vb.</span></span> <span data-ttu-id="166df-223">をクリックして、 **OK**テスト プロジェクトに新しいテストを追加するボタンです。</span><span class="sxs-lookup"><span data-stu-id="166df-223">Click the **OK** button to add your new test to your Test Project.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="166df-224">一般に、ASP.NET MVC プロジェクトのフォルダー構造と一致するテスト プロジェクトのフォルダー構造をします。</span><span class="sxs-lookup"><span data-stu-id="166df-224">In general, you want the folder structure of your Test Project to match the folder structure of your ASP.NET MVC project.</span></span> <span data-ttu-id="166df-225">たとえば、モデルのテスト、Models フォルダーに、コント ローラーのフォルダーにコント ローラーのテストを配置および表示します。</span><span class="sxs-lookup"><span data-stu-id="166df-225">For example, you place controller tests in a Controllers folder, model tests in a Models folder, and so on.</span></span>


<span data-ttu-id="166df-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="166df-226">[![Models\ContactManagerServiceTest.cs](iteration-5-create-unit-tests-vb/_static/image3.jpg)](iteration-5-create-unit-tests-vb/_static/image5.png)</span></span>

<span data-ttu-id="166df-227">**図 03**: Models\ContactManagerServiceTest.cs ([フルサイズのイメージを表示するをクリックして](iteration-5-create-unit-tests-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="166df-227">**Figure 03**: Models\ContactManagerServiceTest.cs([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image6.png))</span></span>


<span data-ttu-id="166df-228">最初に、ContactManagerService クラスによって公開される CreateContact() メソッドをテストします。</span><span class="sxs-lookup"><span data-stu-id="166df-228">Initially, we want to test the CreateContact() method exposed by the ContactManagerService class.</span></span> <span data-ttu-id="166df-229">次の 5 つのテストを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-229">We'll create the following five tests:</span></span>

- <span data-ttu-id="166df-230">CreateContact() - その CreateContact() のテストは、有効な連絡先がメソッドに渡されるときに値 true を返します。</span><span class="sxs-lookup"><span data-stu-id="166df-230">CreateContact() - Tests that CreateContact() returns the value true when a valid Contact is passed to the method.</span></span>
- <span data-ttu-id="166df-231">CreateContactRequiredFirstName() - テスト エラー メッセージが不足している名前との接続時に、モデルの状態に追加されたことは、CreateContact() メソッドに渡されます。</span><span class="sxs-lookup"><span data-stu-id="166df-231">CreateContactRequiredFirstName() - Tests that an error message is added to model state when a Contact with a missing first name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="166df-232">CreateContactRequredLastName() - テスト エラー メッセージがモデル状態のときに不足している最後の名前の連絡先に追加されたことは、CreateContact() メソッドに渡されます。</span><span class="sxs-lookup"><span data-stu-id="166df-232">CreateContactRequredLastName() - Tests that an error message is added to model state when a Contact with a missing last name is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="166df-233">CreateContactInvalidPhone() - テスト エラー メッセージが無効な電話番号との接続時に、モデルの状態に追加されたことは、CreateContact() メソッドに渡されます。</span><span class="sxs-lookup"><span data-stu-id="166df-233">CreateContactInvalidPhone() - Tests that an error message is added to model state when a Contact with an invalid phone number is passed to the CreateContact() method.</span></span>
- <span data-ttu-id="166df-234">CreateContactInvalidEmail() - テスト エラー メッセージがモデル状態のときに無効な電子メール アドレスを持つ連絡先に追加されたことは、CreateContact() メソッドに渡されます.</span><span class="sxs-lookup"><span data-stu-id="166df-234">CreateContactInvalidEmail() - Tests that an error message is added to model state when a Contact with an invalid email address is passed to the CreateContact() method..</span></span>

<span data-ttu-id="166df-235">最初のテストでは、有効な連絡先で検証エラーが発生しないことを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-235">The first test verifies that a valid Contact does not generate a validation error.</span></span> <span data-ttu-id="166df-236">残りのテストは、それぞれの検証ルールを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-236">The remaining tests check each of the validation rules.</span></span>

<span data-ttu-id="166df-237">これらのテストのコードは、1 のリストに含まれます。</span><span class="sxs-lookup"><span data-stu-id="166df-237">The code for these tests is contained in Listing 1.</span></span>

<span data-ttu-id="166df-238">**1 - Models\ContactManagerServiceTest.vb を一覧表示します。**</span><span class="sxs-lookup"><span data-stu-id="166df-238">**Listing 1 - Models\ContactManagerServiceTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample1.vb)]


<span data-ttu-id="166df-239">リスト 1 の連絡先クラスを使用して、ため、テスト プロジェクトに Microsoft Entity Framework への参照を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-239">Because we use the Contact class in Listing 1, we need to add a reference to the Microsoft Entity Framework to our Test project.</span></span> <span data-ttu-id="166df-240">System.Data.Entity アセンブリへの参照を追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-240">Add a reference to the System.Data.Entity assembly.</span></span>


<span data-ttu-id="166df-241">1 を一覧表示するには、[TestInitialize] 属性で装飾された Initialize() という名前のメソッドが含まれます。</span><span class="sxs-lookup"><span data-stu-id="166df-241">Listing 1 contains a method named Initialize() that is decorated with the [TestInitialize] attribute.</span></span> <span data-ttu-id="166df-242">各単体テストの実行前に、このメソッドが自動的に呼び出されます (回呼び出された 5、単体テストの各直前)。</span><span class="sxs-lookup"><span data-stu-id="166df-242">This method is called automatically before each of the unit tests is run (it is called 5 times right before each of the unit tests).</span></span> <span data-ttu-id="166df-243">Initialize() メソッドでは、次のコード行をモック リポジトリを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-243">The Initialize() method creates a mock repository with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample2.vb)]

<span data-ttu-id="166df-244">次のコード行では、Moq フレームワークを使用して、IContactManagerRepository インターフェイスからモック リポジトリを生成します。</span><span class="sxs-lookup"><span data-stu-id="166df-244">This line of code uses the Moq framework to generate a mock repository from the IContactManagerRepository interface.</span></span> <span data-ttu-id="166df-245">実際の EntityContactManagerRepository 代わりには、モック リポジトリを使用して各単体テストを実行すると、データベースへのアクセスを回避します。</span><span class="sxs-lookup"><span data-stu-id="166df-245">The mock repository is used instead of the actual EntityContactManagerRepository to avoid accessing the database when each unit test is run.</span></span> <span data-ttu-id="166df-246">モック リポジトリが IContactManagerRepository インターフェイスのメソッドを実装しますが、メソッドは実際に何も実行します。</span><span class="sxs-lookup"><span data-stu-id="166df-246">The mock repository implements the methods of the IContactManagerRepository interface, but the methods don t actually do anything.</span></span>

> [!NOTE] 
> 
> <span data-ttu-id="166df-247">Moq フレームワークを使用する場合は、区別\_mockRepository と\_mockRepository.Object です。</span><span class="sxs-lookup"><span data-stu-id="166df-247">When using the Moq framework, there is a distinction between \_mockRepository and \_mockRepository.Object.</span></span> <span data-ttu-id="166df-248">前者のモック リポジトリの動作を指定するためのメソッドを含むモック (の IContactManagerRepository) クラスを参照します。</span><span class="sxs-lookup"><span data-stu-id="166df-248">The former refers to the Mock(Of IContactManagerRepository) class that contains methods for specifying how the mock repository will behave.</span></span> <span data-ttu-id="166df-249">後者 IContactManagerRepository インターフェイスを実装する実際のモック リポジトリを参照します。</span><span class="sxs-lookup"><span data-stu-id="166df-249">The latter refers to the actual mock repository that implements the IContactManagerRepository interface.</span></span>


<span data-ttu-id="166df-250">ContactManagerService クラスのインスタンスを作成するときに、モック リポジトリを Initialize() メソッドで使用されます。</span><span class="sxs-lookup"><span data-stu-id="166df-250">The mock repository is used in the Initialize() method when creating an instance of the ContactManagerService class.</span></span> <span data-ttu-id="166df-251">すべての個々 の単体テストは、ContactManagerService クラスのこのインスタンスを使用します。</span><span class="sxs-lookup"><span data-stu-id="166df-251">All of the individual unit tests use this instance of the ContactManagerService class.</span></span>

<span data-ttu-id="166df-252">1 を一覧表示するには、単体テストのそれぞれに対応する 5 つのメソッドが含まれます。</span><span class="sxs-lookup"><span data-stu-id="166df-252">Listing 1 contains five methods that correspond to each of the unit tests.</span></span> <span data-ttu-id="166df-253">これらの各メソッドは、[TestMethod] 属性で装飾します。</span><span class="sxs-lookup"><span data-stu-id="166df-253">Each of these methods is decorated with the [TestMethod] attribute.</span></span> <span data-ttu-id="166df-254">単体テストを実行すると、この属性を持つ任意のメソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="166df-254">When you run the unit tests, any method that has this attribute is called.</span></span> <span data-ttu-id="166df-255">つまり、[TestMethod] 属性で装飾されているメソッドは、単体テストです。</span><span class="sxs-lookup"><span data-stu-id="166df-255">In other words, any method that is decorated with the [TestMethod] attribute is a unit test.</span></span>

<span data-ttu-id="166df-256">CreateContact()、という名前を最初の単体テストでは、こと CreateContact() を呼び出し、値は true を返します連絡先クラスの有効なインスタンスが、メソッドに渡されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-256">The first unit test, named CreateContact(), verifies that calling CreateContact() returns the value true when a valid instance of the Contact class is passed to the method.</span></span> <span data-ttu-id="166df-257">テストは、連絡先クラスのインスタンスを作成するには、CreateContact() メソッドを呼び出しおよび CreateContact() を値 true を返すことを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-257">The test creates an instance of the Contact class, calls the CreateContact() method, and verifies that CreateContact() returns the value true.</span></span>

<span data-ttu-id="166df-258">残りのテストいることを確認無効な連絡先と CreateContact() メソッドが呼び出されたときに、メソッドが false を返します、予想される検証エラー メッセージがモデルの状態に追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-258">The remaining tests verify that when the CreateContact() method is called with an invalid Contact then the method returns false and the expected validation error message is added to model state.</span></span> <span data-ttu-id="166df-259">たとえば、CreateContactRequiredFirstName() テストは、その FirstName プロパティに空の文字列を連絡先クラスのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="166df-259">For example, the CreateContactRequiredFirstName() test creates an instance of the Contact class with an empty string for its FirstName property.</span></span> <span data-ttu-id="166df-260">次に、無効な連絡先と CreateContact() メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="166df-260">Next, the CreateContact() method is called with the invalid Contact.</span></span> <span data-ttu-id="166df-261">最後を検証 CreateContact() が false を返すことと、モデルの状態が含まれている予期された検証エラー メッセージには「名が必要」です。</span><span class="sxs-lookup"><span data-stu-id="166df-261">Finally, the test verifies that CreateContact() returns false and that model state contains the expected validation error message "First name is required."</span></span>

<span data-ttu-id="166df-262">メニュー オプションを選択してリスト 1 の単体テストを実行することができます**(CTRL + R、A) のソリューション内のすべてのテストを実行します。 テスト**です。</span><span class="sxs-lookup"><span data-stu-id="166df-262">You can run the unit tests in Listing 1 by selecting the menu option **Test, Run, All Tests in Solution (CTRL+R, A)**.</span></span> <span data-ttu-id="166df-263">テスト結果 ウィンドウで、テストの結果が表示されます (図 4 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="166df-263">The results of the tests are displayed in the Test Results window (see Figure 4).</span></span>


<span data-ttu-id="166df-264">[![テスト結果](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="166df-264">[![Test Results](iteration-5-create-unit-tests-vb/_static/image4.jpg)](iteration-5-create-unit-tests-vb/_static/image7.png)</span></span>

<span data-ttu-id="166df-265">**図 04**: テストの結果 ([フルサイズのイメージを表示するをクリックして](iteration-5-create-unit-tests-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="166df-265">**Figure 04**: Test Results ([Click to view full-size image](iteration-5-create-unit-tests-vb/_static/image8.png))</span></span>


## <a name="creating-unit-tests-for-controllers"></a><span data-ttu-id="166df-266">コント ローラーの単体テストの作成</span><span class="sxs-lookup"><span data-stu-id="166df-266">Creating Unit Tests for Controllers</span></span>

<span data-ttu-id="166df-267">ASP.NET MVC アプリケーションでは、ユーザーとの対話のフローを制御します。</span><span class="sxs-lookup"><span data-stu-id="166df-267">ASP.NET MVC application control the flow of user interaction.</span></span> <span data-ttu-id="166df-268">コント ローラーが右のアクションの結果とビューのデータを返すかどうかをテストするコント ローラーをテストする場合。</span><span class="sxs-lookup"><span data-stu-id="166df-268">When testing a controller, you want to test whether the controller returns the right action result and view data.</span></span> <span data-ttu-id="166df-269">コント ローラーが期待どおりのようにモデルのクラスと対話するかどうかをテストするも可能性があります。</span><span class="sxs-lookup"><span data-stu-id="166df-269">You also might want to test whether a controller interacts with model classes in the manner expected.</span></span>

<span data-ttu-id="166df-270">たとえば、2 一覧表示するにはには、連絡先のコント ローラー Create() メソッドの 2 つの単体テストが含まれています。</span><span class="sxs-lookup"><span data-stu-id="166df-270">For example, Listing 2 contains two unit tests for the Contact controller Create() method.</span></span> <span data-ttu-id="166df-271">最初の単体テストは、インデックスの操作に Create() メソッドをリダイレクトし、有効な連絡先が Create() メソッドに渡されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-271">The first unit test verifies that when a valid Contact is passed to the Create() method then the Create() method redirects to the Index action.</span></span> <span data-ttu-id="166df-272">つまり、渡されると、有効な連絡先、Create() メソッドは、インデックスの操作を表す RedirectToRouteResult を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-272">In other words, when passed a valid Contact, the Create() method should return a RedirectToRouteResult that represents the Index action.</span></span>

<span data-ttu-id="166df-273">コント ローラーのレイヤーをテストするときに、ContactManager サービス層をテストしたくありません。</span><span class="sxs-lookup"><span data-stu-id="166df-273">We don t want to test the ContactManager service layer when we are testing the controller layer.</span></span> <span data-ttu-id="166df-274">そのため、初期化メソッドでは、次のコードにサービス層をモックします。</span><span class="sxs-lookup"><span data-stu-id="166df-274">Therefore, we mock the service layer with the following code in the Initialize method:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample3.vb)]

<span data-ttu-id="166df-275">CreateValidContact() 単体テストでは、サービス層の次のコード行を持つ CreateContact() メソッドを呼び出す動作模擬表示します。</span><span class="sxs-lookup"><span data-stu-id="166df-275">In the CreateValidContact() unit test, we mock the behavior of calling the service layer CreateContact() method with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample4.vb)]

<span data-ttu-id="166df-276">次のコード行は、その CreateContact() メソッドが呼び出されたときに、値 true を返しモック ContactManager サービスです。</span><span class="sxs-lookup"><span data-stu-id="166df-276">This line of code causes the mock ContactManager service to return the value true when its CreateContact() method is called.</span></span> <span data-ttu-id="166df-277">サービス層をモック作成では、サービス層のすべてのコードを実行しなくても、コント ローラーの動作をテストおできます。</span><span class="sxs-lookup"><span data-stu-id="166df-277">By mocking the service layer, we can test the behavior of our controller without needing to execute any code in the service layer.</span></span>

<span data-ttu-id="166df-278">2 番目の単体テストでは、Create() アクションでは、無効な連絡先がメソッドに渡されるときに、ビューを作成するを返すことを確認します。</span><span class="sxs-lookup"><span data-stu-id="166df-278">The second unit test verifies that the Create() action returns the Create view when an invalid contact is passed to the method.</span></span> <span data-ttu-id="166df-279">サービス層を次のコード行で値 false を返す CreateContact() メソッドが発生しました。</span><span class="sxs-lookup"><span data-stu-id="166df-279">We cause the service layer CreateContact() method to return the value false with the following line of code:</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample5.vb)]

<span data-ttu-id="166df-280">場合は、サービス レイヤーは、値 false を返したときに、メソッドの動作は期待して Create() はビューを作成するを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-280">If the Create() method behaves as we expect then it should return the Create view when the service layer returns the value false.</span></span> <span data-ttu-id="166df-281">こうすれば、コント ローラーの検証エラー メッセージに表示ビューを作成するし、ユーザーをその無効な連絡先のプロパティを修正します。</span><span class="sxs-lookup"><span data-stu-id="166df-281">That way, the controller can display the validation error messages in the Create view and the user has a chance to correct that invalid Contact properties.</span></span>


<span data-ttu-id="166df-282">コント ローラーの単体テストをビルドする予定の場合は、コント ローラーのアクションからの明示的なビュー名を返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="166df-282">If you plan to build unit tests for your controllers then you need to return explicit view names from your controller actions.</span></span> <span data-ttu-id="166df-283">たとえば、次のようにビューを返さない。</span><span class="sxs-lookup"><span data-stu-id="166df-283">For example, do not return a view like this:</span></span>

<span data-ttu-id="166df-284">戻り値の View()</span><span class="sxs-lookup"><span data-stu-id="166df-284">Return View()</span></span>

<span data-ttu-id="166df-285">代わりに、次のようにビューが返されます。</span><span class="sxs-lookup"><span data-stu-id="166df-285">Instead, return the view like this:</span></span>

<span data-ttu-id="166df-286">戻り値の View("Create")</span><span class="sxs-lookup"><span data-stu-id="166df-286">Return View("Create")</span></span>

<span data-ttu-id="166df-287">いない場合は明示的なビューを返すときに、ViewResult.ViewName プロパティは、空の文字列を返します。</span><span class="sxs-lookup"><span data-stu-id="166df-287">If you are not explicit when returning a view then the ViewResult.ViewName property returns an empty string.</span></span>


<span data-ttu-id="166df-288">**2 - Controllers\ContactControllerTest.vb を一覧表示します。**</span><span class="sxs-lookup"><span data-stu-id="166df-288">**Listing 2 - Controllers\ContactControllerTest.vb**</span></span>

[!code-vb[Main](iteration-5-create-unit-tests-vb/samples/sample6.vb)]

## <a name="summary"></a><span data-ttu-id="166df-289">概要</span><span class="sxs-lookup"><span data-stu-id="166df-289">Summary</span></span>

<span data-ttu-id="166df-290">このイテレーションでは、連絡先のマネージャー アプリケーションの単体テストを作成しました。</span><span class="sxs-lookup"><span data-stu-id="166df-290">In this iteration, we created unit tests for our Contact Manager application.</span></span> <span data-ttu-id="166df-291">アプリケーションが予想される方法で引き続き動作を確認するのには、いつでもこれらの単体テストを実行できます。</span><span class="sxs-lookup"><span data-stu-id="166df-291">We can run these unit tests at any time to verify that our application still behaves in the manner that we expect.</span></span> <span data-ttu-id="166df-292">単体テストは、安全に後でアプリケーションを変更することを有効にする、アプリケーションの安全策として機能します。</span><span class="sxs-lookup"><span data-stu-id="166df-292">The unit tests act as a safety net for our application enabling us to safely modify our application in the future.</span></span>

<span data-ttu-id="166df-293">2 つのセットの単体テストを作成しました。</span><span class="sxs-lookup"><span data-stu-id="166df-293">We created two sets of unit tests.</span></span> <span data-ttu-id="166df-294">最初に、このサービス層の単体テストを作成することで、検証ロジックをテストしました。</span><span class="sxs-lookup"><span data-stu-id="166df-294">First, we tested our validation logic by creating unit tests for our service layer.</span></span> <span data-ttu-id="166df-295">次に、コント ローラー、レイヤーの単体テストを作成することで、フロー制御ロジックをテストしました。</span><span class="sxs-lookup"><span data-stu-id="166df-295">Next, we tested our flow control logic by creating unit tests for our controller layer.</span></span> <span data-ttu-id="166df-296">サービス層をテストする際にお別に分離されたマイクロソフトによるテスト、サービス層のリポジトリの層から、リポジトリのレイヤーをモックします。</span><span class="sxs-lookup"><span data-stu-id="166df-296">When testing our service layer, we isolated our tests for our service layer from our repository layer by mocking our repository layer.</span></span> <span data-ttu-id="166df-297">コント ローラーのレイヤーをテストする際にお別に分離されたマイクロソフトによるテスト コント ローラー、レイヤーのサービス層をモックします。</span><span class="sxs-lookup"><span data-stu-id="166df-297">When testing the controller layer, we isolated our tests for our controller layer by mocking the service layer.</span></span>

<span data-ttu-id="166df-298">次のイテレーションで連絡先グループをサポートするように、連絡先のマネージャー アプリケーションを変更します。</span><span class="sxs-lookup"><span data-stu-id="166df-298">In the next iteration, we modify the Contact Manager application so that it supports Contact Groups.</span></span> <span data-ttu-id="166df-299">この新しい機能をテスト駆動開発と呼ばれるソフトウェアのデザイン プロセスを使用して、アプリケーションに追加します。</span><span class="sxs-lookup"><span data-stu-id="166df-299">We'll add this new functionality to our application using a software design process called test-driven development.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="166df-300">[前へ](iteration-4-make-the-application-loosely-coupled-vb.md)
[次へ](iteration-6-use-test-driven-development-vb.md)</span><span class="sxs-lookup"><span data-stu-id="166df-300">[Previous](iteration-4-make-the-application-loosely-coupled-vb.md)
[Next](iteration-6-use-test-driven-development-vb.md)</span></span>
