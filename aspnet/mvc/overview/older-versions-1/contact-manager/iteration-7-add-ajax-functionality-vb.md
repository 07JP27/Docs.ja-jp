---
uid: mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
title: 'イテレーション #7 – 追加の Ajax 機能 (VB) |Microsoft ドキュメント'
author: microsoft
description: 7 番目のイテレーションでお、応答性およびパフォーマンスの向上、アプリケーションの Ajax のサポートを追加することで。
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2009
ms.topic: article
ms.assetid: f640e063-150e-453d-8cfc-7e54a6ce0f1e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/contact-manager/iteration-7-add-ajax-functionality-vb
msc.type: authoredcontent
ms.openlocfilehash: 35d961ee39d7b87a31c7208645148b45c7b0c563
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
---
<a name="iteration-7--add-ajax-functionality-vb"></a>イテレーション #7 – 追加の Ajax 機能 (VB)
====================
によって[Microsoft](https://github.com/microsoft)

[コードをダウンロードします。](iteration-7-add-ajax-functionality-vb/_static/contactmanager_7_vb1.zip)

> 7 番目のイテレーションでお、応答性およびパフォーマンスの向上、アプリケーションの Ajax のサポートを追加することで。


## <a name="building-a-contact-management-aspnet-mvc-application-vb"></a>連絡先管理 ASP.NET MVC アプリケーション (VB) のビルド
  

この一連のチュートリアルは、連絡先管理アプリケーション全体が開始されてから完了するを構築します。 お問い合わせのマネージャー アプリケーションでは、人のユーザーの一覧については使用すると、連絡先情報の名前、電話番号、電子メール アドレスを格納できます。

私たちは、複数のイテレーションにおける、アプリケーションを構築します。 各イテレーションで、アプリケーション、徐々 に向上します。 この複数のイテレーション アプローチの目的は、各変更の理由を理解するためです。

- イテレーション 1 には、アプリケーションを作成します。 最初のイテレーションでお連絡先のマネージャー最も簡単な方法で可能なを作成します。 基本的なデータベース操作のサポートを追加します: 作成、読み取り、更新、および削除 (CRUD)。

- イテレーション 2 では、素敵に見えるアプリケーションを作成します。 このイテレーションで、アプリケーションの外観を向上させる、既定の ASP.NET MVC ビュー マスター ページを変更し、カスケード スタイル シート。

- イテレーション 3 - フォーム検証を追加します。 3 番目のイテレーションは、基本フォーム検証を追加します。 おは人が必要なフォームのフィールドを完了しなくても、フォームを送信することを防ぐ。 私たちも電子メール アドレスと電話番号を検証します。

- 4: イテレーションは、疎結合アプリケーションを作成します。 この 3 番目のイテレーションで利用の保守し、連絡先のマネージャー アプリケーションの変更を容易にできるようにするソフトウェア設計パターンをいくつかのです。 たとえば、リポジトリ パターンと依存関係の挿入のパターンを使用するようにアプリケーションをリファクターします。

- イテレーション #5 - 単体テストを作成します。 5 番目のイテレーションでおやすく、アプリケーションを維持し、単体テストを追加して変更できます。 データ モデル クラスを模擬表示し、コント ローラーと検証ロジックの単体テストをビルドします。

- イテレーション 6 - テスト駆動開発を使用します。 この 6 番目のイテレーションでは、アプリケーションに新しい機能を追加おには、まず単体テストを記述し、単体テストに対してコードを記述します。 このイテレーションは、連絡先グループを追加します。

- イテレーション #7 - Ajax 機能を追加します。 7 番目のイテレーションでお、応答性およびパフォーマンスの向上、アプリケーションの Ajax のサポートを追加することで。

## <a name="this-iteration"></a>このイテレーション

連絡先のマネージャー アプリケーションのこのイテレーションは、Ajax を使用するようにアプリケーションをリファクターします。 Ajax を利用してを行う場合、アプリケーション応答性が向上します。 ページで特定の領域のみを更新する必要なときにページ全体をレンダリングお回避できます。

新しい連絡先グループが選択されるたびに、ページ全体を再表示する必要があるように、インデックス ビューをリファクターおします。 代わりに、連絡先グループをクリックしたときおを連絡先の一覧を更新してだけ残りのページだけです。

Delete の動作にリンクする方法も変更します。 別の確認ページを表示するには、代わりに、JavaScript の確認ダイアログ ボックス表示します。 連絡先を削除することを確認する場合、HTTP DELETE 操作がデータベースからの連絡先レコードを削除するサーバーに対して実行します。

さらに、利点は、インデックス ビューにアニメーション効果を追加する jQuery のことになります。 サーバーから新しい連絡先の一覧がフェッチされるときにアニメーションを表示します。

最後に、ブラウザーの履歴を管理するための ASP.NET AJAX framework のサポートを活用をみましょう。 連絡先の一覧を更新するための Ajax 呼び出しを実行するたびに、履歴ポイントを作成します。 このように、ブラウザーとの下位と転送ボタンは機能します。

## <a name="why-use-ajax"></a>Ajax を使用する理由

Ajax には、多くの利点があります。 最初に、ユーザー エクスペリエンスを向上させるでアプリケーションの結果に Ajax 機能を追加します。 標準的な web アプリケーションで全体のページする必要があるにポスト バックされた、サーバー ユーザー アクションを実行するたびにします。 アクションを実行するたびにブラウザー ロックやユーザー待つ必要がありますページ全体をフェッチし、再表示されます。

デスクトップ アプリケーションの場合、不正なエクスペリエンスになります。 ただし、従来、お続かない web アプリケーションの場合は、この無効なユーザー エクスペリエンスと、高いすればおがわからないため。 ときに、実際には、当社 imaginations の制限だけが web アプリケーションの制限事項と考えました。

Ajax アプリケーションでページを更新するだけ停止する、ユーザー エクスペリエンスを表示する必要はありません。 代わりに、ページを更新するバック グラウンドで非同期要求を実行できます。 ユーザーがページの一部の更新を取得する間お待ち t 強制はありません。

Ajax を利用してもに、アプリケーションのパフォーマンスを向上できます。 連絡先のマネージャー アプリケーションの動作今すぐ Ajax 機能のないことを検討してください。 連絡先グループをクリックすると、インデックス ビュー全体が再表示されます必要があります。 連絡先の一覧および連絡先グループの一覧は、データベース サーバーから取得する必要があります。 すべてのデータに渡すことが、ネットワーク経由で web サーバーから web ブラウザー。

Ajax 機能をアプリケーションを追加おただし、回避できます、ユーザーが連絡先グループをクリックすると、ページ全体を再表示します。 データベースからの連絡先、グループを取得する必要がなくなります。 ネットワーク経由で全体のインデックス ビューをプッシュする必要もありません。 Ajax を利用して、データベース サーバーに必要な作業量を削減し、アプリケーションで必要なネットワーク トラフィックの量を削減します。

## <a name="don-t-be-afraid-of-ajax"></a>ないことを恐れての Ajax をします。

一部の開発者は、下位レベルのブラウザーについて心配する必要があるために、Ajax を使用しないでください。 JavaScript をサポートしていないブラウザーでアクセスするときに、自分の web アプリケーションがまだ動作するかどうかを確認します。 Ajax は、JavaScript に依存しているために、一部の開発者は、Ajax を使用しないでください。

ただし、Ajax を実装する方法については注意する場合は、上位レベルと下位レベルの両方のブラウザーで動作するアプリケーションを構築できます。 連絡先のマネージャー アプリケーションは、JavaScript をサポートしているブラウザーとそうでないブラウザーで動作します。

JavaScript をサポートするブラウザーで、連絡先のマネージャー アプリケーションを使用する場合、ユーザー エクスペリエンスを向上させるがあります。 たとえば、連絡先グループをクリックすると、アドレス帳に表示されるページの領域のみが更新されます。

一方、JavaScript をサポートしていない (または JavaScript が無効になっているを含む) のブラウザーで、連絡先のマネージャー アプリケーションを使用した場合は、少し望ましいユーザー エクスペリエンスがあります。 たとえば、連絡先グループをクリックすると、全体のインデックス ビュー必要があるにポスト バックされたブラウザー一致する連絡先の一覧を表示するためにします。

## <a name="adding-the-required-javascript-files"></a>必要な JavaScript ファイルを追加します。

次の 3 つの JavaScript ファイルを使用して Ajax 機能をアプリケーションに追加する必要があります。 新しい ASP.NET MVC アプリケーションの スクリプト フォルダーは、これらのファイルの 3 つすべてが含まれています。

複数のページに、アプリケーションで Ajax を使用する場合、理にかなってアプリケーションのビュー マスター ページに、必要な JavaScript ファイルを含める。 こうすれば、JavaScript ファイルが含まれますすべてのアプリケーションのページに自動的に。

内部が含まれています、次の JavaScript には追加、&lt;ヘッド&gt;ビュー マスター ページのタグ。

[!code-html[Main](iteration-7-add-ajax-functionality-vb/samples/sample1.html)]

## <a name="refactoring-the-index-view-to-use-ajax"></a>Ajax を使用するインデックス ビューのリファクタリング

連絡先グループをクリックすると連絡先を表示するビューの領域のみが更新されるように、インデックス ビューを変更することによって開始 s を使用できます。 図 1 に赤いボックスには、更新する領域が含まれています。


[![連絡先だけを更新](iteration-7-add-ajax-functionality-vb/_static/image1.jpg)](iteration-7-add-ajax-functionality-vb/_static/image1.png)

**図 01**: 連絡先だけを更新 ([フルサイズのイメージを表示するをクリックして](iteration-7-add-ajax-functionality-vb/_static/image2.png))


最初の手順では、別の部分 (ビューのユーザー コントロール) に非同期的に更新するビューの一部を区切ります。 連絡先のテーブルを表示するインデックス ビューのセクションでは、リスト 1 の部分に移動されました。

**1 - Views\Contact\ContactList.ascx を一覧表示します。**

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample2.aspx)]

リスト 1 の一部が、インデックス ビューよりも、別のモデルを持つことに注意してください。 *Inherits*属性、 &lt;% ページ % @&gt;ディレクティブでは、部分が、ViewUserControl から継承されている指定&lt;グループ&gt;クラスです。

更新されたインデックス ビューは、一覧表示する 2 に含まれます。

**Listing 2 - Views\Contact\Index.aspx**

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample3.aspx)]

リスト 2 で更新されたビューに関する注意すべき 2 つの点があります。 まず、Html.RenderPartial() への呼び出しに置き換えられるすべてのコンテンツが、部分的に移動したことに注意してください。 Html.RenderPartial() メソッドは、アドレス帳の初期セットを表示するために、インデックス ビューが最初に要求されたときに呼び出されます。

次に、連絡先グループを表示するために使用 Html.ActionLink() が、Ajax.ActionLink() で置き換えられたことに注意してください。 次のパラメーターで、Ajax.ActionLink() が呼び出されます。

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample4.aspx)]

最初のパラメーターは、リンクを表示するテキストを表す、2 番目のパラメーター値を表す、ルート、および 3 番目のパラメーターは、Ajax オプションを表します。 この場合、おオプションを使用して、UpdateTargetId Ajax HTML をポイント&lt;div&gt; Ajax 要求が完了した後に更新するタグです。 更新する、 &lt;div&gt;新しい連絡先のリストを持つタグ。

連絡先コント ローラーの更新された Index() メソッドは、3 の一覧に含まれます。

**3 - Controllers\ContactController.vb (インデックス メソッド) を一覧表示します。**

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample5.vb)]

更新された Index() アクションでは、次の 2 つのいずれかの条件付きで返します。 Ajax 要求により Index() アクションが呼び出された場合、コント ローラーは、部分的なを返します。 それ以外の場合、Index() アクションはビュー全体を返します。

Index() アクションが Ajax 要求によって呼び出されたときにできるだけ多くのデータを返す必要がないことに注意してください。 通常の要求のコンテキストでは、インデックスの操作は、すべての連絡先のグループと、選択した連絡先グループの一覧を返します。 Ajax 要求のコンテキストでは、Index() アクションは、選択したグループのみを返します。 Ajax には、データベース サーバーで処理量が少ないことを意味します。

変更した、インデックス ビューは、上位レベルと下位レベルの両方のブラウザーの場合は動作します。 連絡先グループをクリックすると、ブラウザーが JavaScript をサポートしている、連絡先の一覧を含むビューの領域のみが更新されます。 その一方で、お使いのブラウザーは JavaScript をサポートしていない場合は、ビュー全体が更新されます。


この更新されたインデックス ビューには、1 つの問題があります。 連絡先グループをクリックすると、選択したグループが強調表示されません。 グループの一覧表示されるので、Ajax 要求中に更新される領域の外部で、適切なグループは取得強調表示されません。 この問題を修正、次のセクションでします。


## <a name="adding-jquery-animation-effects"></a>JQuery アニメーション効果を追加します。

通常、web ページのリンクをクリックすると、ブラウザーが更新されたコンテンツをフェッチしてアクティブにするかどうかを検出するために、ブラウザーの進行状況バーを使用できます。 Ajax 要求を実行するときにその一方で、ブラウザーの進行状況バーは表示されません、進行状況。 ユーザーが神経質に行うことができます。 ブラウザーが固定されているかどうかを知る方法

作業が Ajax 要求の実行中に実行されることをユーザーに示すことのできるいくつかの方法はあります。 1 つの方法では、単純なアニメーションを表示します。 たとえば、Ajax 要求が開始され、要求が完了したときに、地域のフェードイン、領域をフェードアウトことができます。

アニメーション効果を作成する、Microsoft ASP.NET MVC フレームワークに含まれている jQuery ライブラリが使用されます。 更新されたインデックス ビューは、リスト 4 に含まれます。

**Listing 4 - Views\Contact\Index.aspx**

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample6.aspx)]

更新されたインデックス ビューに 3 つの新しい JavaScript 関数が含まれていることを確認します。 最初の 2 つの関数は、フェードアウトして新しい連絡先グループをクリックすると、連絡先の一覧で、フェード jQuery を使用します。 3 番目の関数では、エラー (たとえば、ネットワークのタイムアウト) の Ajax 要求の結果とエラー メッセージが表示されます。

最初の関数も処理の選択したグループを強調表示します。 クラス = 選択した属性がクリックされた要素の親要素 (LI 要素) に追加します。 もう一度、jQuery しやすい右の要素を選択し、CSS クラスを追加します。

これらのスクリプトは Ajax.ActionLink() AjaxOptions パラメーターのヘルプを持つグループ リンクに関連付けられています。 更新された Ajax.ActionLink() メソッドの呼び出しは、このようになります。

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample7.aspx)]

## <a name="adding-browser-history-support"></a>ブラウザーの履歴のサポートを追加します。

通常、ページを更新するリンクをクリックすると、ブラウザーの履歴が更新されます。 このように、ページの直前の状態に時刻で移動するブラウザーの戻るボタンをクリックできます。 たとえば、友人の連絡先グループをクリックして、ビジネス連絡先グループ をクリックして場合、は、友人の連絡先グループを選択したときに、ページの状態に戻るにブラウザーの戻る ボタンをクリックします。

残念ながら、Ajax 要求の実行はブラウザーの履歴自動的に更新されません。 連絡先グループをクリックすると、Ajax 要求に該当する連絡先の一覧を取得、ブラウザーの履歴は更新されません。 新しい連絡先グループを選択した後、連絡先グループに戻るには、ブラウザーの [戻る] ボタンを使うことはできません。

Ajax 要求を実行する後ユーザーが戻る、ブラウザーを使用できるボタンを検索する場合は、もう少しの作業を実行する必要があります。 ASP.NET AJAX Framework に組み込まれているブラウザーの履歴の管理機能を活用する必要があります。

ASP.NET AJAX ブラウザーの履歴、3 つの作業を行う必要があります。

1. EnableBrowserHistory プロパティを true に設定して、ブラウザーの履歴を有効にします。
2. AddHistoryPoint() メソッドを呼び出すことによって、ビューの状態が変更されたときに、履歴ポイントを保存します。
3. [移動] イベントが発生したときに、ビューの状態を再構築します。

更新されたインデックス ビューは、リスト 5 に含まれます。

**Listing 5 - Views\Contact\Index.aspx**

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample8.aspx)]

5 の一覧表示するのには、ブラウザーの履歴は pageInit() 関数で有効にします。 PageInit() 関数は、[移動] イベントのイベント ハンドラーを設定するも使用されます。 ブラウザーの進むまたは戻る ボタンを変更するページの状態を発生するたびに、navigate イベントが発生します。

BeginContactList() メソッドは、連絡先グループをクリックしたときに呼び出されます。 このメソッドは、addHistoryPoint() メソッドを呼び出すことによって、新しい履歴ポイントを作成します。 クリックされた連絡先グループの id は、履歴に追加されます。

グループ id は、連絡先グループ リンクに expando 属性から取得されます。 Ajax.ActionLink() に次の呼び出しでは、リンクが描画されます。

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample9.aspx)]

最後に、Ajax.ActionLink() に渡されるパラメーターは、小文字 XHTML の互換性のためのリンクを groupid をという名前の expando 属性を追加します。

ユーザーに達すると、ブラウザーの 戻るまたは 進む ボタン、移動 イベントが発生し、navigate() メソッドが呼び出されます。 このメソッドは、navigate メソッドに渡されるブラウザーの履歴ポイントに対応するページの状態と一致するページに表示される連絡先を更新します。

## <a name="performing-ajax-deletes"></a>削除 Ajax を実行します。

現時点では、連絡先を削除するためにする必要があります、削除 リンクをクリックし、削除の確認 ページに表示される 削除 ボタンをクリックして (図 2 を参照してください)。 これは、多数のページ要求のデータベース レコードを削除するような単純な処理を行うように見えます。


[![削除の確認 ページ](iteration-7-add-ajax-functionality-vb/_static/image2.jpg)](iteration-7-add-ajax-functionality-vb/_static/image3.png)

**図 02**: 削除の確認 ページ ([フルサイズのイメージを表示するをクリックして](iteration-7-add-ajax-functionality-vb/_static/image4.png))


これは削除の確認 ページをスキップし、インデックス ビューから直接、連絡先を削除しようとしがちです。 セキュリティ ホール、アプリケーションが開かれるこの方法を使用するために、この誘惑を避ける必要があります。 一般が表示されないが、web アプリケーションの状態を変更する操作を呼び出すときに、HTTP GET 操作を実行するとします。 削除を行う場合、HTTP POST を実行したり、さらには、HTTP DELETE 操作します。

[削除] リンクは、[contactlist] 部分に含まれます。 [Contactlist] 部分の更新バージョンは、6 の一覧に含まれます。

**Listing 6 - Views\Contact\ContactList.ascx**

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample10.aspx)]

Ajax.ImageActionLink() メソッドに次の呼び出しでは、[削除] リンクがレンダリングされます。

[!code-aspx[Main](iteration-7-add-ajax-functionality-vb/samples/sample11.aspx)]

> [!NOTE] 
> 
> Ajax.ImageActionLink() は、ASP.NET MVC フレームワークの標準部分ではないです。 Ajax.ImageActionLink() は、連絡先のマネージャーのプロジェクトに含まれるカスタム ヘルパー メソッドです。


AjaxOptions パラメーターには、2 つのプロパティがあります。 最初に、確認プロパティは、ポップアップ JavaScript 確認のダイアログ ボックスを表示する使用されます。 次に、HttpMethod プロパティは HTTP DELETE 操作の実行に使用されます。

7 を一覧表示するには、連絡先のコント ローラーに追加された新しい AjaxDelete() アクションが含まれます。

**7 - Controllers\ContactController.vb (AjaxDelete) を一覧表示します。**   

[!code-vb[Main](iteration-7-add-ajax-functionality-vb/samples/sample12.vb)]

AjaxDelete() アクションは AcceptVerbs 属性で修飾します。 この属性は、HTTP DELETE 操作以外の HTTP 操作によってを除く呼び出されているアクションをしないようにします。 具体的には、この操作には、HTTP GET を呼び出すことはできません。

データベース レコードを削除した後は、削除されたレコードが含まれていない連絡先の更新の一覧を表示する必要があります。 AjaxDelete() メソッドは、[contactlist] 部分と連絡先の更新されたリストを返します。

## <a name="summary"></a>まとめ

このイテレーションでは、この連絡先のマネージャー アプリケーションに Ajax 機能を追加しました。 Ajax を使用して、応答性とアプリケーションのパフォーマンスが向上しました。

最初に、連絡先グループ をクリックしてもビュー全体が更新されないように、インデックス ビューにリファクタリングします。 代わりに、連絡先グループ をクリックすると、連絡先の一覧のみ更新します。

次にフェードアウトして連絡先の一覧で、フェード jQuery アニメーション効果を使用します。 等価のブラウザーの進行状況バーに、アプリケーションのユーザーに提供する、Ajax アプリケーションへのアニメーションの追加を使用できます。

また、Ajax アプリケーションに履歴のブラウザー サポートを追加しました。 ここには、ブラウザーの [戻る] をクリックして、インデックス ビューの状態を変更するためにボタンを転送するユーザーが有効になります。

最後に、HTTP DELETE 操作をサポートする [削除] リンクを作成します。 Ajax の削除を実行する追加の削除の確認 ページを要求するユーザーを必要とせずにデータベース レコードを削除するユーザーが有効にします。

> [!div class="step-by-step"]
> [前へ](iteration-6-use-test-driven-development-vb.md)
