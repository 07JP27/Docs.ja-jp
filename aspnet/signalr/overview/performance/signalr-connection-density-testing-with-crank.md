---
uid: signalr/overview/performance/signalr-connection-density-testing-with-crank
title: "SignalR 接続の密度がクランクでのテスト |Microsoft ドキュメント"
author: tfitzmac
description: "SignalR 接続の密度がクランクでテストします。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/22/2015
ms.topic: article
ms.assetid: 148d9ca7-1af1-44b6-a9fb-91e261b9b463
ms.technology: dotnet-signalr
ms.prod: .net-framework
msc.legacyurl: /signalr/overview/performance/signalr-connection-density-testing-with-crank
msc.type: authoredcontent
ms.openlocfilehash: a3e8fdb47bd80d819358f9c48cd82fd51d6c0400
ms.sourcegitcommit: fe880bf4ed1c8116071c0e47c0babf3623b7f44a
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/21/2017
---
<a name="signalr-connection-density-testing-with-crank"></a><span data-ttu-id="a5a8a-103">SignalR 接続の密度がクランクでテストします。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-103">SignalR Connection Density Testing with Crank</span></span>
====================
<span data-ttu-id="a5a8a-104">によって[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="a5a8a-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="a5a8a-105">この記事では、クランク ツールを使用して、複数のシミュレートされたクライアント アプリケーションをテストする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-105">This article describes how to use the Crank tool to test an application with multiple simulated clients.</span></span>


<span data-ttu-id="a5a8a-106">アプリケーションが (いずれか、Azure web ロール、IIS、または自己ホスト型 Owin を使用して) そのホスティング環境で実行されていると、クランク ツールを使用して接続密度の高いレベルへのアプリケーションの応答をテストできます。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-106">Once your application is running in its hosting environment (either an Azure web role, IIS, or self-hosted using Owin), you can test application's response to a high level of connection density using the Crank tool.</span></span> <span data-ttu-id="a5a8a-107">ホスティング環境には、インターネット インフォメーション サービス (IIS) サーバー、Owin ホストでは、または Azure web ロールを指定できます。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-107">The hosting environment can be an Internet Information Services (IIS) server, an Owin host, or an Azure web role.</span></span> <span data-ttu-id="a5a8a-108">(注: 接続密度テストからパフォーマンス データを取得することはできませんので、パフォーマンス カウンターを Azure App Service Web Apps で使用できることはできません)。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-108">(Note: Performance counters are not available on Azure App Service Web Apps, so you will not be able to get performance data from a connection density test.)</span></span>

<span data-ttu-id="a5a8a-109">接続の密度は、サーバー上に確立できる同時 TCP 接続の数を示します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-109">Connection Density refers to the number of simultaneous TCP connections that can be established on a server.</span></span> <span data-ttu-id="a5a8a-110">各 TCP 接続が独自のオーバーヘッドが発生し、多数のアイドル状態の接続を開くと、メモリのボトルネックは最終的に作成します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-110">Each TCP connection incurs its own overhead, and opening a large number of idle connections will eventually create a memory bottleneck.</span></span>

<span data-ttu-id="a5a8a-111">[SignalR のコードベース](https://github.com/signalr/signalr)と呼ばれる、ロード テスト ツールが含まれています**Crank**です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-111">[The SignalR codebase](https://github.com/signalr/signalr) includes a load-testing tool called **Crank**.</span></span> <span data-ttu-id="a5a8a-112">クランクの最新バージョンは含まれて[Dev 分岐](https://github.com/SignalR/signalr/tree/dev)GitHub でします。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-112">The latest version of Crank can be found in [the Dev branch](https://github.com/SignalR/signalr/tree/dev) on GitHub.</span></span> <span data-ttu-id="a5a8a-113">Zip アーカイブされた SignalR の Dev 分岐のコードベースをダウンロードする[ここ](https://github.com/SignalR/SignalR/archive/dev.zip)です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-113">You can download a Zip archive of the Dev branch of the SignalR codebase [here](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span>

<span data-ttu-id="a5a8a-114">完全サーバーのメモリが飽和状態には、クランクのサーバー ハードウェアに可能なアイドル状態の接続の合計数を計算するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-114">Crank may be used to fully saturate the server's memory in order to calculate the total number of idle connections possible on the server hardware.</span></span> <span data-ttu-id="a5a8a-115">または、可能性がありますも使用するクランクを読み込むテスト一定量のメモリ不足、下にあるサーバー特定数または特定のメモリしきい値に到達するまで、接続を変化させることによってです。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-115">Alternatively, you may also use Crank to load test the server under a certain amount of memory pressure, by ramping up connections until a specific count or a specific memory threshold is reached.</span></span>

<span data-ttu-id="a5a8a-116">をテストする場合は、リモート クライアントを使用して (つまり、TCP 接続およびメモリ) のリソースの競合を回避する必要があります。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-116">When testing, it is important to use remote client(s) to avoid any competition for resources (i.e., TCP connections and memory).</span></span> <span data-ttu-id="a5a8a-117">サーバーがすべての容量 (メモリや CPU) に到達するを防ぐことがあります、ボトルネックがヒットいないことを確認するクライアントを監視します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-117">Monitor the client(s) to ensure that they are not hitting any bottlenecks that may prevent the server from reaching its full capacity (memory or CPU).</span></span> <span data-ttu-id="a5a8a-118">サーバーを完全に読み込むためにクライアントの数を増やす必要があります。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-118">You may need to increase the number of clients in order to fully load the server.</span></span>

### <a name="running-a-connection-density-test"></a><span data-ttu-id="a5a8a-119">接続密度テストを実行します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-119">Running a Connection Density Test</span></span>

<span data-ttu-id="a5a8a-120">このセクションでは、SignalR アプリケーションで接続密度テストを実行するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-120">This section describes the steps needed to run a connection density test on a SignalR application.</span></span>

1. <span data-ttu-id="a5a8a-121">ビルドをダウンロードして、 [SignalR の Dev 分岐 codebase](https://github.com/SignalR/SignalR/archive/dev.zip)です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-121">Download and build the [Dev branch of the SignalR codebase](https://github.com/SignalR/SignalR/archive/dev.zip).</span></span> <span data-ttu-id="a5a8a-122">コマンド プロンプトで、に移動&lt;プロジェクト ディレクトリ&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-122">In a command prompt, navigate to &lt;project directory&gt;\src\Microsoft.AspNet.SignalR.Crank\bin\debug.</span></span>
2. <span data-ttu-id="a5a8a-123">目的のホスティング環境にアプリケーションを配置します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-123">Deploy your application to its intended hosting environment.</span></span> <span data-ttu-id="a5a8a-124">アプリケーションが使用するエンドポイントのメモします。作成したアプリケーションなどで、[チュートリアル入門](../getting-started/tutorial-getting-started-with-signalr.md)、エンドポイントが`http://<yourhost>:8080/signalr`です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-124">Make a note of the endpoint that your application uses; for example, in the application created in the [Getting Started tutorial](../getting-started/tutorial-getting-started-with-signalr.md), the endpoint is `http://<yourhost>:8080/signalr`.</span></span>
3. <span data-ttu-id="a5a8a-125">インストール[SignalR パフォーマンス カウンター](signalr-performance.md#perfcounters)サーバーにします。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-125">Install [SignalR performance counters](signalr-performance.md#perfcounters) on the server.</span></span> <span data-ttu-id="a5a8a-126">アプリケーションが Azure で実行されている場合は、次を参照してください。 [Azure Web ロールで SignalR パフォーマンス カウンターを使用して](using-signalr-performance-counters-in-an-azure-web-role.md)です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-126">If your application is running on Azure, see [Using SignalR Performance Counters in an Azure Web Role](using-signalr-performance-counters-in-an-azure-web-role.md).</span></span>

<span data-ttu-id="a5a8a-127">ダウンロードし、コードベースを構築し、ホストのパフォーマンス カウンターをインストールしたら、クランク コマンド ライン ツールは含まれて、`src\Microsoft.AspNet.SignalR.Crank\bin\Debug`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-127">Once you've downloaded and built the codebase, and installed performance counters on your host, the Crank command-line tool can be found in the `src\Microsoft.AspNet.SignalR.Crank\bin\Debug` folder.</span></span>

<span data-ttu-id="a5a8a-128">クランク ツールの使用可能なオプションは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-128">Available options for the Crank tool include:</span></span>

- <span data-ttu-id="a5a8a-129">**/?**: ヘルプ画面を示しています。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-129">**/?**: Shows the help screen.</span></span> <span data-ttu-id="a5a8a-130">場合にも使用可能なオプションが表示されます、 **Url**パラメーターを省略するとします。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-130">The available options are also displayed if the **Url** parameter is omitted.</span></span>
- <span data-ttu-id="a5a8a-131">**/Url**: SignalR 接続の URL。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-131">**/Url**: The URL for SignalR connections.</span></span> <span data-ttu-id="a5a8a-132">このパラメーターは必須です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-132">This parameter is required.</span></span> <span data-ttu-id="a5a8a-133">既定のマッピングを使用して SignalR アプリケーションのパスの末尾が"/signalr"です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-133">For a SignalR application using the default mapping, the path will end in "/signalr".</span></span>
- <span data-ttu-id="a5a8a-134">**/トランスポート**: 使用するトランスポートの名前。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-134">**/Transport**: The name of the transport used.</span></span> <span data-ttu-id="a5a8a-135">既定値は`auto`、最適使用可能なプロトコルを選択するされます。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-135">The default is `auto`, which will select the best available protocol.</span></span> <span data-ttu-id="a5a8a-136">オプションがあります。 `WebSockets`、 `ServerSentEvents`、および`LongPolling`(`ForeverFrame`オプションがない実際の .NET クライアントから Internet Explorer を使用するのではなく)。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-136">Options include `WebSockets`, `ServerSentEvents`, and `LongPolling` (`ForeverFrame` is not an option for Crank, since the .NET client rather than Internet Explorer is used).</span></span> <span data-ttu-id="a5a8a-137">SignalR のトランスポートを選択する方法の詳細については、次を参照してください。[トランスポートとフォールバック](../getting-started/introduction-to-signalr.md#transports)です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-137">For more information on how SignalR selects transports, see [Transports and Fallbacks](../getting-started/introduction-to-signalr.md#transports).</span></span>
- <span data-ttu-id="a5a8a-138">**/BatchSize**: 各バッチで追加されたクライアントの数。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-138">**/BatchSize**: The number of clients added in each batch.</span></span> <span data-ttu-id="a5a8a-139">既定値は 50 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-139">The default is 50.</span></span>
- <span data-ttu-id="a5a8a-140">**/ConnectInterval**: 接続を追加するまでのミリ秒の間隔。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-140">**/ConnectInterval**: The interval in milliseconds between adding connections.</span></span> <span data-ttu-id="a5a8a-141">既定値は 500 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-141">The default is 500.</span></span>
- <span data-ttu-id="a5a8a-142">**/接続**: ロード テスト アプリケーションを使用する接続の数。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-142">**/Connections**: The number of connections used to load-test the application.</span></span> <span data-ttu-id="a5a8a-143">既定値は 100,000 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-143">The default is 100,000.</span></span>
- <span data-ttu-id="a5a8a-144">**/ConnectTimeout**: テストを中止するまでの秒単位のタイムアウト。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-144">**/ConnectTimeout**: The timeout in seconds before aborting the test.</span></span> <span data-ttu-id="a5a8a-145">既定値は、300 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-145">The default is 300.</span></span>
- <span data-ttu-id="a5a8a-146">**MinServerMBytes**: サーバーの最小メガバイト数に到達します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-146">**MinServerMBytes**: The minimum server megabytes to reach.</span></span> <span data-ttu-id="a5a8a-147">既定値は 500 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-147">The default is 500.</span></span>
- <span data-ttu-id="a5a8a-148">**SendBytes**: (バイト単位)、サーバーに送信されるペイロードのサイズ。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-148">**SendBytes**: The size of the payload sent to the server in bytes.</span></span> <span data-ttu-id="a5a8a-149">既定値は 0 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-149">The default is 0.</span></span>
- <span data-ttu-id="a5a8a-150">**SendInterval**: サーバーへのメッセージまでのミリ秒の遅延します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-150">**SendInterval**: The delay in milliseconds between messages to the server.</span></span> <span data-ttu-id="a5a8a-151">既定値は 500 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-151">The default is 500.</span></span>
- <span data-ttu-id="a5a8a-152">**SendTimeout**: サーバーへのメッセージをミリ秒でタイムアウトします。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-152">**SendTimeout**: The timeout in milliseconds for messages to the server.</span></span> <span data-ttu-id="a5a8a-153">既定値は、300 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-153">The default is 300.</span></span>
- <span data-ttu-id="a5a8a-154">**ControllerUrl**: 1 台のクライアントがハブ コント ローラーをホストする Url。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-154">**ControllerUrl**: The Url where one client will host a controller hub.</span></span> <span data-ttu-id="a5a8a-155">既定値は null (コント ローラー ハブはありません)。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-155">The default is null (no controller hub).</span></span> <span data-ttu-id="a5a8a-156">クランク セッションが開始されるときに、コント ローラーのハブが開始します。それ以上、コント ローラー ハブ クランクと連絡先が行われます。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-156">The controller hub is started when the Crank session starts; no further contact between the controller hub and Crank is made.</span></span>
- <span data-ttu-id="a5a8a-157">**NumClients**: アプリケーションへの接続にシミュレートされたクライアントの数。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-157">**NumClients**: The number of simulated clients to connect to the application.</span></span> <span data-ttu-id="a5a8a-158">既定では 1 つ。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-158">The default is one.</span></span>
- <span data-ttu-id="a5a8a-159">**Logfile**: テストの実行のログ ファイルのファイル名。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-159">**Logfile**: The filename for the logfile for the test run.</span></span> <span data-ttu-id="a5a8a-160">既定値は、`crank.csv` です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-160">The default is `crank.csv`.</span></span>
- <span data-ttu-id="a5a8a-161">**SampleInterval**: パフォーマンス カウンターのサンプルの間隔をミリ秒で時間。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-161">**SampleInterval**: The time in milliseconds between performance counter samples.</span></span> <span data-ttu-id="a5a8a-162">既定値は 1000 です。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-162">The default is 1000.</span></span>
- <span data-ttu-id="a5a8a-163">**SignalRInstance**: サーバーのパフォーマンス カウンターのインスタンス名。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-163">**SignalRInstance**: The instance name for the performance counters on the server.</span></span> <span data-ttu-id="a5a8a-164">既定では、クライアント接続の状態を使用します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-164">The default is to use the client connection state.</span></span>

### <a name="example"></a><span data-ttu-id="a5a8a-165">例</span><span class="sxs-lookup"><span data-stu-id="a5a8a-165">Example</span></span>

<span data-ttu-id="a5a8a-166">次のコマンドはというサイトをテスト`pfsignalr`"ControllerHub"という名前のハブでポート 8080 でアプリケーションをホストする Azure で 100 個の接続を使用します。</span><span class="sxs-lookup"><span data-stu-id="a5a8a-166">The following command will test a site called `pfsignalr` on Azure that hosts an application on port 8080 with a hub named "ControllerHub", using 100 connections.</span></span>

`crank /Connections:100 /Url:http://pfsignalr.cloudapp.net:8080/signalr`
