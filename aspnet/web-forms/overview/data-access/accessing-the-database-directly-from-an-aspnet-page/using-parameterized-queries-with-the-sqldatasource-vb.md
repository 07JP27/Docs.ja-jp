---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
title: "SqlDataSource (VB) によるパラメーター化クエリを使用して |Microsoft ドキュメント"
author: rick-anderson
description: "このチュートリアルは、SqlDataSource コントロールで、外観を続行し、パラメーター化クエリを定義する方法について説明します。 パラメーターを指定する両方 decla しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: e322f34c-83b7-41ea-ab65-ab1e0bdcc609
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: b1cda18620a970c45b05039dd380c393e3854889
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="using-parameterized-queries-with-the-sqldatasource-vb"></a><span data-ttu-id="60af8-104">SqlDataSource (VB) でパラメーター化クエリの使用</span><span class="sxs-lookup"><span data-stu-id="60af8-104">Using Parameterized Queries with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="60af8-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="60af8-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="60af8-106">[サンプル アプリをダウンロード](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe)または[PDF のダウンロード](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="60af8-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span></span>

> <span data-ttu-id="60af8-107">このチュートリアルは、SqlDataSource コントロールで、外観を続行し、パラメーター化クエリを定義する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="60af8-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="60af8-108">パラメーターは、プログラムでは、両方の宣言でと指定することができます、数など、クエリ文字列、セッション状態、その他のコントロール、および複数の場所からプルできます。</span><span class="sxs-lookup"><span data-stu-id="60af8-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="60af8-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="60af8-109">Introduction</span></span>

<span data-ttu-id="60af8-110">前のチュートリアルでは、SqlDataSource コントロールを使用して、データベースから直接データを取得する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="60af8-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="60af8-111">データ ソースの構成ウィザードを使用して、おでした選択データベースし、いずれかの: テーブルまたはビューから返す列を選択カスタムの SQL ステートメントです。または、ストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="60af8-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="60af8-112">テーブルまたはビューから列を選択するか、カスタム SQL ステートメントを入力する、SqlDataSource が s を制御するかどうか`SelectCommand`プロパティには、アドホック sql ステートメントが割り当てられている`SELECT`ステートメントがこの`SELECT`ステートメントが実行すると実行、SqlDataSource の`Select()`メソッドが呼び出されます (プログラムによってまたは自動的に Web コントロールのデータから)。</span><span class="sxs-lookup"><span data-stu-id="60af8-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="60af8-113">SQL`SELECT`ステートメントが不足して前のチュートリアル デモで使用される`WHERE`句。</span><span class="sxs-lookup"><span data-stu-id="60af8-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="60af8-114">`SELECT`ステートメント、`WHERE`返される結果を制限する句を使用できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="60af8-115">たとえば、コスト 50.00 ドル以上の製品の名前を表示するには、次のクエリを使用おでした。</span><span class="sxs-lookup"><span data-stu-id="60af8-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="60af8-116">通常で使用する値、`WHERE`句をクエリ文字列値、セッション変数、またはページ上の Web コントロールからのユーザー入力など、いくつかの外部ソースから決定されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="60af8-117">使用するとこのような入力を指定することをお勧め*パラメーター*です。</span><span class="sxs-lookup"><span data-stu-id="60af8-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="60af8-118">使用して、Microsoft SQL Server でのパラメーターが示されて`@parameterName`など。</span><span class="sxs-lookup"><span data-stu-id="60af8-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="60af8-119">SqlDataSource が、両方のパラメーター化クエリをサポートしている`SELECT`ステートメントと`INSERT`、 `UPDATE`、および`DELETE`ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="60af8-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="60af8-120">さらに、パラメーター値できますプルされ、自動的にさまざまなソースから、クエリ文字列、セッションの状態 ページで、コントロールとなどまたはプログラムによって割り当てられることができます。</span><span class="sxs-lookup"><span data-stu-id="60af8-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="60af8-121">このチュートリアルではパラメーター化クエリもを宣言またはプログラムによって値パラメーターを指定する方法を定義する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="60af8-122">前のチュートリアルでは、概念的な類似性に注意してください、SqlDataSource によるチュートリアルでは、まず 46 経由で任意の当社のツールが行われた ObjectDataSource と比較されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="60af8-123">こうした類似性は、パラメーターを拡張することもできます。</span><span class="sxs-lookup"><span data-stu-id="60af8-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="60af8-124">ビジネス ロジック層内のメソッドの入力パラメーターにマップされた ObjectDataSource のパラメーター。</span><span class="sxs-lookup"><span data-stu-id="60af8-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="60af8-125">SqlDataSource、パラメーターが、SQL クエリ内で直接定義されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="60af8-126">両方のコントロールのパラメーターのコレクションがある、 `Select()`、 `Insert()`、 `Update()`、および`Delete()`メソッド、および両方には、これらのパラメーター値 (のクエリ文字列値、セッション変数、およびに事前に定義されたソースから設定を持つことができます) またはプログラムによって割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="60af8-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="60af8-127">パラメーター クエリの作成</span><span class="sxs-lookup"><span data-stu-id="60af8-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="60af8-128">SqlDataSource コントロールのデータ ソース構成ウィザードでは、データベース レコードを取得するために実行するコマンドを定義するための 3 つの手段を提供します。</span><span class="sxs-lookup"><span data-stu-id="60af8-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="60af8-129">既存のテーブルまたはビューから列を選択して</span><span class="sxs-lookup"><span data-stu-id="60af8-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="60af8-130">カスタムの SQL ステートメントを入力して、または</span><span class="sxs-lookup"><span data-stu-id="60af8-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="60af8-131">ストアド プロシージャを選択して</span><span class="sxs-lookup"><span data-stu-id="60af8-131">By choosing a stored procedure</span></span>

<span data-ttu-id="60af8-132">既存のテーブルまたはビューのパラメーターからの列を選択するときに、`WHERE`句を追加して指定する必要があります`WHERE`句 ダイアログ ボックス。</span><span class="sxs-lookup"><span data-stu-id="60af8-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="60af8-133">カスタム SQL ステートメントを作成するときに、パラメーターを入力できますに直接、`WHERE`句 (を使用して`@parameterName`各パラメーターを示すため)。</span><span class="sxs-lookup"><span data-stu-id="60af8-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="60af8-134">A[ストアド プロシージャ](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1)の 1 つまたは複数の SQL ステートメントで構成し、これらのステートメントをパラメーター化することができます。</span><span class="sxs-lookup"><span data-stu-id="60af8-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="60af8-135">SQL ステートメントで使用されるパラメーターただしに渡すことがで入力パラメーターとしてストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="60af8-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="60af8-136">パラメーター化クエリを作成する方法によって異なりますので SqlDataSource の`SelectCommand`が指定すると、使用すると、見てみましょうすべての 3 つの方法です。</span><span class="sxs-lookup"><span data-stu-id="60af8-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="60af8-137">最初に開く、 `ParameterizedQueries.aspx`  ページで、`SqlDataSource`フォルダー、SqlDataSource コントロールをツールボックスからデザイナーにドラッグし、設定、`ID`に`Products25BucksAndUnderDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="60af8-138">次に、コントロールのスマート タグからのデータ ソースの構成のリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="60af8-139">使用するデータベースを選択 (`NORTHWINDConnectionString`) し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="60af8-140">手順 1: 追加、`WHERE`句のテーブルまたはビューから列を選択するときに</span><span class="sxs-lookup"><span data-stu-id="60af8-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="60af8-141">SqlDataSource コントロールを持つデータベースから返されるデータを選択すると、データ ソース構成ウィザードにより、単に既存のテーブルから返したり (図 1 を参照してください) を表示する列を選択します。</span><span class="sxs-lookup"><span data-stu-id="60af8-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="60af8-142">SQL を作成して、自動的`SELECT`ステートメントで、データベースに送信されるときに、SqlDataSource の`Select()`メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="60af8-143">前のチュートリアルで行ったように、ドロップダウン リストから、Products テーブルを選択し、確認、 `ProductID`、 `ProductName`、および`UnitPrice`列です。</span><span class="sxs-lookup"><span data-stu-id="60af8-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="60af8-144">[![テーブルまたはビューから返す列を選択します。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="60af8-145">**図 1**: テーブルまたはビューからの戻り値に列を選択 ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="60af8-146">含める、`WHERE`句、`SELECT`ステートメントでは、をクリックして、 `WHERE`  ボタンの追加 を`WHERE`句 ダイアログ ボックス (図 2 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="60af8-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="60af8-147">によって返される結果を制限するパラメーターを追加する、`SELECT`クエリで最初にデータをフィルター処理する列を選択します。</span><span class="sxs-lookup"><span data-stu-id="60af8-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="60af8-148">次に、フィルター処理に使用する演算子を選択 (=、 &lt;、 &lt;=、&gt;など)。</span><span class="sxs-lookup"><span data-stu-id="60af8-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="60af8-149">クエリ文字列またはセッションの状態からなど、パラメーターの値のソースを最後に、選択します。</span><span class="sxs-lookup"><span data-stu-id="60af8-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="60af8-150">パラメーターを構成した後に含める追加 をクリックして、`SELECT`クエリ。</span><span class="sxs-lookup"><span data-stu-id="60af8-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="60af8-151">この例では、let s のみ結果を返す、場所、 `UnitPrice` 2,500 ドル未満の値がします。</span><span class="sxs-lookup"><span data-stu-id="60af8-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="60af8-152">そのため、選択`UnitPrice`列のドロップダウン リストからおよび&lt;= 演算子のドロップダウン リストからです。</span><span class="sxs-lookup"><span data-stu-id="60af8-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="60af8-153">(ドル 2,500) などのパラメーターのハードコード値を使用する場合、またはパラメーター値が、プログラムで指定する場合は、ソースのドロップダウン リストから [なし] を選択します。</span><span class="sxs-lookup"><span data-stu-id="60af8-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="60af8-154">次に、2,500 値のテキスト ボックスで、パラメーターのハードコード値を入力し、[追加] ボタンをクリックしてプロセスを完了します。</span><span class="sxs-lookup"><span data-stu-id="60af8-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="60af8-155">[![返される結果を制限する、追加 WHERE 句 ダイアログ ボックス](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="60af8-156">**図 2**: 追加から返される結果を制限する`WHERE`句 ダイアログ ボックス ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="60af8-157">パラメーターを追加すると、データ ソース構成ウィザードに戻るには [ok] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="60af8-158">`SELECT`ウィザードの下部にあるステートメントを含める必要があります今すぐ、`WHERE`という名前のパラメーターを含む句`@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="60af8-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="60af8-159">複数の条件を指定する場合、`WHERE`句の追加から`WHERE`句 ダイアログ ボックス、ウィザードで結合、`AND`演算子。</span><span class="sxs-lookup"><span data-stu-id="60af8-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="60af8-160">含める必要がある場合、`OR`で、`WHERE`句 (など`WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) を作成し、`SELECT`カスタム SQL ステートメント 画面でのステートメント。</span><span class="sxs-lookup"><span data-stu-id="60af8-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="60af8-161">SqlDataSource (クリックして次に、し、[完了]) の構成を完了し、SqlDataSource s の宣言型マークアップを検査します。</span><span class="sxs-lookup"><span data-stu-id="60af8-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="60af8-162">マークアップが含まれています、`<SelectParameters>`コレクションで、ソースでは、パラメーターを詳しく、`SelectCommand`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample4.aspx)]

<span data-ttu-id="60af8-163">ときに、SqlDataSource s`Select()`メソッドが呼び出され、`UnitPrice`パラメーター値 (2,500) に適用されます、`@UnitPrice`内のパラメーター、`SelectCommand`データベースに送信される前にします。</span><span class="sxs-lookup"><span data-stu-id="60af8-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="60af8-164">最終的な結果から返される 2,500 ドル未満の製品だけであるは、`Products`テーブル。</span><span class="sxs-lookup"><span data-stu-id="60af8-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="60af8-165">、これを確認 GridView のページに、このデータ ソースにバインドを追加し、ブラウザーからページを表示します。</span><span class="sxs-lookup"><span data-stu-id="60af8-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="60af8-166">図 3 の確認としての要素が 2,500 円、小さいが表示されている製品のみが表示されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="60af8-167">[![これらの製品より小さいまたは 2,500 円に等しいかどうかのみが表示されます。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="60af8-168">**図 3**: のみこれらの製品より小さいか、2,500 円に等しいかどうかが表示されます ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="60af8-169">手順 2: カスタム SQL ステートメントにパラメーターを追加します。</span><span class="sxs-lookup"><span data-stu-id="60af8-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="60af8-170">カスタム SQL ステートメントを追加する場合は、入力、`WHERE`句に明示的にかクエリ ビルダーのフィルターのセルに値を指定します。</span><span class="sxs-lookup"><span data-stu-id="60af8-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="60af8-171">これを示すためには、価格が特定のしきい値よりも GridView にこれらの製品だけを表示する秒を使用できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="60af8-172">テキスト ボックスを追加して、開始、`ParameterizedQueries.aspx`ユーザーからこのしきい値の値を収集するページ。</span><span class="sxs-lookup"><span data-stu-id="60af8-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="60af8-173">集合 TextBox s`ID`プロパティを`MaxPrice`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="60af8-174">Button Web コントロールを追加し、設定、`Text`プロパティに一致する製品の表示にします。</span><span class="sxs-lookup"><span data-stu-id="60af8-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="60af8-175">次に、GridView をページにドラッグして、スマート タグをという名前の新しい SqlDataSource を作成する`ProductsFilteredByPriceDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="60af8-176">データ ソース構成ウィザードから続行を指定するカスタム SQL ステートメントまたはストアド プロシージャの画面 (図 4 を参照) と、次のクエリを入力します。</span><span class="sxs-lookup"><span data-stu-id="60af8-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample5.sql)]

<span data-ttu-id="60af8-177">(手動でまたはクエリ ビルダーから) は、クエリを入力すると、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="60af8-178">[![パラメーターの値以下でなければ製品のみを返す](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="60af8-179">**図 4**: 返すのみこれらの製品より小さいか、パラメーター値に等しいかどうか ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="60af8-180">クエリには、パラメーターが含まれているため、ウィザードの次の画面は、パラメーター値のソースに us を求めます。</span><span class="sxs-lookup"><span data-stu-id="60af8-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="60af8-181">パラメーターのソースのドロップダウン リストからコントロールを選択し、 `MaxPrice` (TextBox コントロールの`ID`値) ControlID ドロップダウン リストからです。</span><span class="sxs-lookup"><span data-stu-id="60af8-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="60af8-182">ユーザーに任意のテキストの入力がない場合に使用するための省略可能な既定値を入力することも、 `MaxPrice`  テキスト ボックス。</span><span class="sxs-lookup"><span data-stu-id="60af8-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="60af8-183">当面の既定値を入力できません。</span><span class="sxs-lookup"><span data-stu-id="60af8-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="60af8-184">[![テキストのプロパティは、パラメーターのソースとして使用 ボックスに MaxPrice s](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="60af8-185">**図 5**: `MaxPrice` TextBox s`Text`プロパティは、パラメーターのソースとして使用 ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="60af8-186">次をクリックして、データ ソースの構成ウィザードを完了し、完了します。</span><span class="sxs-lookup"><span data-stu-id="60af8-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="60af8-187">宣言型マークアップ GridView、 テキスト ボックス、ボタン、および SqlDataSource を次に示します。</span><span class="sxs-lookup"><span data-stu-id="60af8-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample6.aspx)]

<span data-ttu-id="60af8-188">注意してください SqlDataSource s 内のパラメーター`<SelectParameters>`セクションは、`ControlParameter`のような追加のプロパティを含む`ControlID`と`PropertyName`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="60af8-189">ときに、SqlDataSource s`Select()`メソッドが呼び出され、 `ControlParameter` Web コントロールの指定したプロパティの値を取得し、それに対応するパラメーターに、`SelectCommand`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="60af8-190">この例では、`MaxPrice`として s Text プロパティが使用される、`@MaxPrice`パラメーターの値。</span><span class="sxs-lookup"><span data-stu-id="60af8-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="60af8-191">ブラウザーからこのページを表示する分ほどをかかります。</span><span class="sxs-lookup"><span data-stu-id="60af8-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="60af8-192">最初のページにアクセスしたとき、またはたびに、 `MaxPrice`  テキスト ボックスが GridView でレコードが表示されない値がありません。</span><span class="sxs-lookup"><span data-stu-id="60af8-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="60af8-193">[![レコードは、表示されるときに、MaxPrice テキスト ボックスが空でないです。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="60af8-194">**図 6**: いいえレコードが表示されるときに、`MaxPrice`テキスト ボックスが空 ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="60af8-195">製品が表示されない理由は、既定では、パラメーターの値に空の文字列がデータベースに変換されたため`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="60af8-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="60af8-196">以降の比較`[UnitPrice] <= NULL`評価は常に False と結果は返されません。</span><span class="sxs-lookup"><span data-stu-id="60af8-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="60af8-197">5.00 と同様に、テキスト ボックスに値を入力し、一致する製品の表示 ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="60af8-198">ポストバックでは、SqlDataSource は GridView のパラメーターのソースの 1 つが変更を通知します。</span><span class="sxs-lookup"><span data-stu-id="60af8-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="60af8-199">その結果、GridView は、$5.00 をこれらの製品小さい以下を表示すること、SqlDataSource を再バインドします。</span><span class="sxs-lookup"><span data-stu-id="60af8-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="60af8-200">[![製品より小さいか、$5.00 を等しいかどうかが表示されます。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="60af8-201">**図 7**: 製品より小さいか、$5.00 を等しいかどうかが表示されます ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="60af8-202">すべての製品を最初に表示します。</span><span class="sxs-lookup"><span data-stu-id="60af8-202">Initially Displaying All Products</span></span>

<span data-ttu-id="60af8-203">表示いない製品ページが最初に読み込まれたときではなく表示したい場合があります*すべて*製品です。</span><span class="sxs-lookup"><span data-stu-id="60af8-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="60af8-204">すべての製品を一覧表示する方法の 1 つされるたびに、 `MaxPrice`  テキスト ボックスが空になんらかの非常に高い値パラメーターの既定値を設定することです 1000000 と同様に以降 s 珍しいこと Northwind Traders はこれまでがインベントリ単価を超えています $1,000,000 をします。</span><span class="sxs-lookup"><span data-stu-id="60af8-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="60af8-205">ただし、このアプローチは shortsighted は、他の状況で動作しない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="60af8-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="60af8-206">-前のチュートリアルで[宣言型のパラメーター](../basic-reporting/declarative-parameters-vb.md)と[マスター/詳細のフィルター処理で、DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md)おは同様の問題に直面していました。</span><span class="sxs-lookup"><span data-stu-id="60af8-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-vb.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) we were faced with a similar problem.</span></span> <span data-ttu-id="60af8-207">あるソリューションは、ビジネス ロジック層にこのロジックを記述するでした。</span><span class="sxs-lookup"><span data-stu-id="60af8-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="60af8-208">具体的には、BLL が受信した値を調べるおよび、それが`NULL`または予約されているいくつかの値、返されたすべてのレコードを DAL メソッドへの呼び出しが送信されました。</span><span class="sxs-lookup"><span data-stu-id="60af8-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="60af8-209">パラメーター化されたために使用する SQL ステートメントを実行する DAL メソッドに呼び出しを試みました受信した値が通常のフィルター選択値である場合は、`WHERE`句で指定された値。</span><span class="sxs-lookup"><span data-stu-id="60af8-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="60af8-210">残念ながら、アーキテクチャが SqlDataSource を使用する場合はバイパスされます。</span><span class="sxs-lookup"><span data-stu-id="60af8-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="60af8-211">代わりに、インテリジェントな場合にすべてのレコードを取得する SQL ステートメントをカスタマイズする必要があります、`@MaximumPrice`パラメーターは`NULL`またはいくつかの予約済みの値。</span><span class="sxs-lookup"><span data-stu-id="60af8-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="60af8-212">この演習では、let s があるそのようにする場合、`@MaximumPrice`パラメーターと等しい`-1.0`、し、*すべて*レコードが返される (`-1.0`製品が、負の値があるないために、予約済みの値としては機能`UnitPrice`値)。</span><span class="sxs-lookup"><span data-stu-id="60af8-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="60af8-213">これを実現するには、次の SQL ステートメントを使用できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="60af8-214">これは、`WHERE`句を返します*すべて*場合、`@MaximumPrice`パラメーターと等しい`-1.0`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="60af8-215">パラメーター値がない場合`-1.0`、製品のみが`UnitPrice`と同じかそれよりも少ない、`@MaximumPrice`パラメーターの値が返されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="60af8-216">既定値を設定して、`@MaximumPrice`パラメーターを`-1.0`、最初のページ読み込みの (またはたびに、 `MaxPrice`  テキスト ボックスが空)、`@MaximumPrice`の値を持つ`-1.0`とすべての製品が表示されます。</span><span class="sxs-lookup"><span data-stu-id="60af8-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="60af8-217">[![これで、すべての製品表示されるときに、MaxPrice テキスト ボックスが空](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="60af8-218">**図 8**: 現在のすべての製品が表示されるときに、`MaxPrice`テキスト ボックスが空 ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span></span>


<span data-ttu-id="60af8-219">これは、いくつかの注意事項がこの方法に注意してください。</span><span class="sxs-lookup"><span data-stu-id="60af8-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="60af8-220">最初に、これによって、パラメーター %s のデータ型が推論されることに注意して、SQL クエリで s 使用します。</span><span class="sxs-lookup"><span data-stu-id="60af8-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="60af8-221">変更した場合、`WHERE`から句`@MaximumPrice = -1.0`に`@MaximumPrice = -1`ランタイムは、整数として、パラメーターを処理します。</span><span class="sxs-lookup"><span data-stu-id="60af8-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="60af8-222">割り当てるしようとする場合、 `MaxPrice` (5.00) のような 10 進数値をテキスト ボックスに、エラーが発生 5.00 整数に変換できないためです。</span><span class="sxs-lookup"><span data-stu-id="60af8-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="60af8-223">これを解決するには、いずれかの確認を使用すること`@MaximumPrice = -1.0`で、`WHERE`句、またはそれ以上がまだ、設定、`ControlParameter`オブジェクトの`Type`プロパティを 10 進数。</span><span class="sxs-lookup"><span data-stu-id="60af8-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="60af8-224">追加することで、次に、`OR @MaximumPrice = -1.0`を`WHERE`句、クエリ エンジンは、インデックスを使用できないで`UnitPrice`(存在する)、これにより、テーブル スキャンの結果として得られます。</span><span class="sxs-lookup"><span data-stu-id="60af8-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="60af8-225">影響する可能性がパフォーマンスのレコード数が十分な大きさがある場合、`Products`テーブル。</span><span class="sxs-lookup"><span data-stu-id="60af8-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="60af8-226">優れた方法はストアド プロシージャにこのロジックを移動することで、`IF`ステートメントは実行するか、`SELECT`からクエリ、`Products`なしテーブル、`WHERE`句のすべてのレコードが返される必要がある場合、またはそのいずれかが`WHERE`句のみを含み、`UnitPrice`条件、インデックスを使用できるようにします。</span><span class="sxs-lookup"><span data-stu-id="60af8-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="60af8-227">手順 3: を作成して、パラメーター化されたストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="60af8-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="60af8-228">ストアド プロシージャは、ストアド プロシージャ内で定義されている SQL ステートメントで使用できる、入力パラメーターのセットを含めることができます。</span><span class="sxs-lookup"><span data-stu-id="60af8-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="60af8-229">入力パラメーターを受け取るストアド プロシージャを使用して SqlDataSource を構成する場合と同様に、アドホック SQL ステートメントと同じ手法を使用してこれらのパラメーター値を指定できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="60af8-230">Let s が Northwind データベースの名前付きで新しいストアド プロシージャを作成、SqlDataSource でストアド プロシージャの使用を示すためには、 `GetProductsByCategory`、という名前のパラメーターを受け入れる`@CategoryID`し、すべての製品の列を返しますが`CategoryID`列に一致する`@CategoryID`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="60af8-231">ストアド プロシージャを作成する、サーバー エクスプ ローラーに移動し、ドリルダウン、`NORTHWND.MDF`データベース。</span><span class="sxs-lookup"><span data-stu-id="60af8-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="60af8-232">サーバー エクスプ ローラーが表示されない場合は、したり (表示 メニューに移動し、サーバー エクスプ ローラーのオプションを選択します。)</span><span class="sxs-lookup"><span data-stu-id="60af8-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="60af8-233">`NORTHWND.MDF`データベース、Stored Procedures フォルダーを右クリックし、新しいストアド プロシージャの追加、選択、および、次の構文を入力します。</span><span class="sxs-lookup"><span data-stu-id="60af8-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample8.sql)]

<span data-ttu-id="60af8-234">保存 アイコン (または Ctrl + S) ストアド プロシージャを保存する をクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="60af8-235">Stored Procedures フォルダーを右クリックして実行 を選択して、ストアド プロシージャをテストできます。</span><span class="sxs-lookup"><span data-stu-id="60af8-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="60af8-236">これはの入力を求め、s のストアド プロシージャのパラメーター (`@CategoryID`がこのインスタンスで)、どれ結果を表示するのには、出力ウィンドウの後にします。</span><span class="sxs-lookup"><span data-stu-id="60af8-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="60af8-237">[![GetProductsByCategory ストアド プロシージャを実行すると、 @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span></span>

<span data-ttu-id="60af8-238">**図 9**:`GetProductsByCategory`ストアド プロシージャを実行すると、 `@CategoryID` 1 ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span></span>


<span data-ttu-id="60af8-239">このストアド プロシージャを使用して GridView に、飲料カテゴリのすべての製品を表示する秒を使用できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="60af8-240">新しい GridView をページに追加し、という名前の新しい SqlDataSource にバインド`BeverageProductsDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="60af8-241">カスタム SQL ステートメントまたはストアド プロシージャの画面の指定を続行し、ストアド プロシージャのラジオ ボタンを選択し、、`GetProductsByCategory`ドロップダウン リストからストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="60af8-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="60af8-242">[![選択、GetProductsByCategory ドロップダウン リストからストアド プロシージャ](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span></span>

<span data-ttu-id="60af8-243">**図 10**: 選択、`GetProductsByCategory`ドロップダウン リストからストアド プロシージャ ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span></span>


<span data-ttu-id="60af8-244">ストアド プロシージャは、入力パラメーターを受け入れるため (`@CategoryID`)、このパラメーターの値のソースを指定することを求める [次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="60af8-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="60af8-245">飲み物`CategoryID`1 に設定されてため None パラメーターのソースのドロップダウン リストのままにして、DefaultValue ボックスに 1 を入力します。</span><span class="sxs-lookup"><span data-stu-id="60af8-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="60af8-246">[![1 のハードコード値を使用して、飲料カテゴリの製品を返す](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span></span>

<span data-ttu-id="60af8-247">**図 11**: 1 の Hard-Coded 値を使用して、飲料カテゴリの製品を返す ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span></span>


<span data-ttu-id="60af8-248">SqlDataSource s、ストアド プロシージャを使用する場合は次の宣言型マークアップ示すとして`SelectCommand`プロパティが、ストアド プロシージャの名前に設定され、 [ `SelectCommandType`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx)に設定されている`StoredProcedure`ことを示す`SelectCommand`アドホック SQL ステートメントではなく、ストアド プロシージャの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="60af8-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="60af8-249">ブラウザーでページをテストします。</span><span class="sxs-lookup"><span data-stu-id="60af8-249">Test out the page in a browser.</span></span> <span data-ttu-id="60af8-250">飲み物のカテゴリに属する製品だけが表示されますが、*すべて*以降、製品のフィールドの表示、`GetProductsByCategory`ストアド プロシージャが返すすべての列から、`Products`テーブル。</span><span class="sxs-lookup"><span data-stu-id="60af8-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="60af8-251">もちろん、制限したり、GridView 列の編集 ダイアログ ボックスから GridView に表示されるフィールドをカスタマイズお可能性があります。</span><span class="sxs-lookup"><span data-stu-id="60af8-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="60af8-252">[![飲み物のすべてが表示されます。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span></span>

<span data-ttu-id="60af8-253">**図 12**: 飲み物のすべてが表示されます ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="60af8-254">手順 4: が SqlDataSource s をプログラムで呼び出す`Select()`ステートメント</span><span class="sxs-lookup"><span data-stu-id="60af8-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="60af8-255">例は前のチュートリアルとこのチュートリアルでこれまで見てきましたが、GridView に直接 SqlDataSource コントロールをバインドします。</span><span class="sxs-lookup"><span data-stu-id="60af8-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="60af8-256">SqlDataSource コントロールのデータただし、プログラムでアクセスしてコードで列挙します。</span><span class="sxs-lookup"><span data-stu-id="60af8-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="60af8-257">検査し、データをクエリする必要がありますが、それを表示する必要がないある場合は特に便利にできます。</span><span class="sxs-lookup"><span data-stu-id="60af8-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="60af8-258">すべてのデータベースへの接続、コマンドを指定し、結果を取得して ADO.NET コード定型句を書き込むのではなくこの単調コード処理 SqlDataSource をさせることができます。</span><span class="sxs-lookup"><span data-stu-id="60af8-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="60af8-259">SqlDataSource s の扱いを説明するためにデータ プログラムでは、想像してください、上司は、ランダムに選択したカテゴリと関連付けられた製品の名前を表示する web ページを作成する要求に近づきます。</span><span class="sxs-lookup"><span data-stu-id="60af8-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="60af8-260">つまり、ユーザーがこのページにアクセスしたいからカテゴリをランダムに選択、`Categories`テーブルをカテゴリ名を表示し、そのカテゴリに属している製品の一覧です。</span><span class="sxs-lookup"><span data-stu-id="60af8-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="60af8-261">これを実現する 2 つ SqlDataSource コントロール 1 からランダムなカテゴリを取得する必要があります、`Categories`テーブルと製品カテゴリを取得します。</span><span class="sxs-lookup"><span data-stu-id="60af8-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="60af8-262">このステップでは; でランダムなカテゴリ レコードを取得する SqlDataSource ビルドします手順 5 はカテゴリの製品を取得する SqlDataSource を作成します。</span><span class="sxs-lookup"><span data-stu-id="60af8-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="60af8-263">SqlDataSource を追加することによって開始`ParameterizedQueries.aspx`設定とその`ID`に`RandomCategoryDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="60af8-264">次の SQL クエリを使用するように構成します。</span><span class="sxs-lookup"><span data-stu-id="60af8-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="60af8-265">`ORDER BY NEWID()`ランダムな順序で並べ替えられたレコードを返します (を参照してください[Using`NEWID()`ランダムにレコードの並べ替えに](http://www.sqlteam.com/item.asp?ItemID=8747))。</span><span class="sxs-lookup"><span data-stu-id="60af8-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="60af8-266">`SELECT TOP 1`結果セットから最初のレコードを返します。</span><span class="sxs-lookup"><span data-stu-id="60af8-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="60af8-267">まとめるには、このクエリを返します、`CategoryID`と`CategoryName`、ランダムに選択された 1 つのカテゴリの列の値。</span><span class="sxs-lookup"><span data-stu-id="60af8-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="60af8-268">カテゴリ s を表示する`CategoryName`値 Label Web コントロールをページに追加設定その`ID`プロパティを`CategoryNameLabel`、クリアとその`Text`プロパティ。</span><span class="sxs-lookup"><span data-stu-id="60af8-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="60af8-269">SqlDataSource コントロールからプログラムでデータを取得する必要がありますを呼び出す、`Select()`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="60af8-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="60af8-270">[ `Select()`メソッド](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx)型の単一の入力パラメーターが必要ですが[ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx)、返される前に、データをメッセージする方法を指定します。</span><span class="sxs-lookup"><span data-stu-id="60af8-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="60af8-271">これにより、並べ替えと、データをフィルター処理に指示を含めることができ、Web コントロールの並べ替えまたは SqlDataSource コントロールからのデータを取得するときにデータで使用されています。</span><span class="sxs-lookup"><span data-stu-id="60af8-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="60af8-272">この例では、お返される前に変更する t 必要データはなく、そのために渡されます、`DataSourceSelectArguments.Empty`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="60af8-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="60af8-273">`Select()`メソッドを実装するオブジェクトを返します`IEnumerable`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="60af8-274">SqlDataSource コントロール秒の値に依存に返される正確な型[`DataSourceMode`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="60af8-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="60af8-275">このプロパティをいずれかの値に設定できる前のチュートリアルで既に説明した、`DataSet`または`DataReader`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="60af8-276">場合に設定`DataSet`、`Select()`メソッドを返します、 [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx)オブジェクト以外に設定した場合`DataReader`を実装するオブジェクトを返します[ `IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="60af8-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="60af8-277">以降、 `RandomCategoryDataSource` SqlDataSource がその`DataSourceMode`プロパティに設定`DataSet`(既定)、おを操作し、DataView オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="60af8-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="60af8-278">次のコードからレコードを取得する方法を示しています、 `RandomCategoryDataSource` DataView として SqlDataSource を読み取る方法だけでなく、 `CategoryName` DataView の最初の行の列の値。</span><span class="sxs-lookup"><span data-stu-id="60af8-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="60af8-279">`randomCategoryView(0)`最初を返します`DataRowView`DataView でします。</span><span class="sxs-lookup"><span data-stu-id="60af8-279">`randomCategoryView(0)` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="60af8-280">`randomCategoryView(0)("CategoryName")`値を返します、`CategoryName`この最初の行に列です。</span><span class="sxs-lookup"><span data-stu-id="60af8-280">`randomCategoryView(0)("CategoryName")` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="60af8-281">DataView は、厳密に型は注意してください。</span><span class="sxs-lookup"><span data-stu-id="60af8-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="60af8-282">特定の列の値を参照するには、列の名前 (このケースでは CategoryName) を文字列として渡す必要があります。</span><span class="sxs-lookup"><span data-stu-id="60af8-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="60af8-283">図 13 に表示されるメッセージを示しています、`CategoryNameLabel`ページを表示するときにします。</span><span class="sxs-lookup"><span data-stu-id="60af8-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="60af8-284">によって表示される実際のカテゴリ名をランダムに選択もちろん、 `RandomCategoryDataSource` SqlDataSource (ポストバックを含む)、ページへのアクセスにします。</span><span class="sxs-lookup"><span data-stu-id="60af8-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="60af8-285">[![名前が表示されるカテゴリをランダムに選択されている s](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span></span>

<span data-ttu-id="60af8-286">**図 13**: 名前が表示される、ランダムに選択したカテゴリ s ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="60af8-287">SqlDataSource コントロール s 場合`DataSourceMode`プロパティに設定された`DataReader`からの戻り値、`Select()`メソッドにキャストする必要がある`IDataReader`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="60af8-288">読み取り、 `CategoryName` d は最初の行の列の値のようなコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="60af8-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample12.vb)]

<span data-ttu-id="60af8-289">SqlDataSource でランダムに選択するカテゴリでは、カテゴリの製品を一覧表示する GridView を追加する準備ができたらします。</span><span class="sxs-lookup"><span data-stu-id="60af8-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="60af8-290">カテゴリの名前を表示するには、ラベルの Web コントロールを使用してではなくおでしたが FormView または DetailsView に追加 ページで、SqlDataSource にバインドすること。</span><span class="sxs-lookup"><span data-stu-id="60af8-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="60af8-291">ただし、SqlDataSource s をプログラムで呼び出す方法を調査することを許可、ラベルを使用して、`Select()`ステートメントとコードの結果として得られるそのデータを操作します。</span><span class="sxs-lookup"><span data-stu-id="60af8-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="60af8-292">手順 5: プログラムによってパラメーター値を割り当てる</span><span class="sxs-lookup"><span data-stu-id="60af8-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="60af8-293">すべての例は、パラメーターのハードコード値または定義済みパラメーターのソース (クエリ文字列値、ページ上の Web コントロール) のいずれかから行われた、このチュートリアルでこれまで見てきましたが使用します。</span><span class="sxs-lookup"><span data-stu-id="60af8-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="60af8-294">ただし、SqlDataSource コントロールのパラメーターを設定することもプログラムでします。</span><span class="sxs-lookup"><span data-stu-id="60af8-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="60af8-295">完了するには、現在の使用例をすべての指定したカテゴリに属する製品を返す SqlDataSource 必要があります。</span><span class="sxs-lookup"><span data-stu-id="60af8-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="60af8-296">この SqlDataSource されますが、`CategoryID`を設定する必要がある値を持つパラメーターに基づいて、`CategoryID`によって返される列の値、`RandomCategoryDataSource`で SqlDataSource、`Page_Load`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="60af8-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="60af8-297">GridView をページに追加することで開始し、という名前の新しい SqlDataSource にバインド`ProductsByCategoryDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="60af8-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="60af8-298">かなりよう手順 3. を呼び出すようにの構成、SqlDataSource、`GetProductsByCategory`ストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="60af8-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="60af8-299">ままにして、パラメーター ソース ドロップダウン リストを [なし] が、プログラムでこの既定値は設定、既定値を入力してくださいはありません。</span><span class="sxs-lookup"><span data-stu-id="60af8-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="60af8-300">[![パラメーターのソースまたは既定値を指定しません。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span></span>

<span data-ttu-id="60af8-301">**図 14**: パラメーターのソースまたは既定値を指定しない ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span></span>


<span data-ttu-id="60af8-302">SqlDataSource ウィザードを完了すると、結果として得られる宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="60af8-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample13.aspx)]

<span data-ttu-id="60af8-303">私たちを割り当てることができます、`DefaultValue`の`CategoryID`パラメーターをプログラム的に、`Page_Load`イベントのハンドラー。</span><span class="sxs-lookup"><span data-stu-id="60af8-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample14.vb)]

<span data-ttu-id="60af8-304">この追加すると、ページには、ランダムに選択したカテゴリに関連付けられている製品を表示する GridView が含まれます。</span><span class="sxs-lookup"><span data-stu-id="60af8-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="60af8-305">[![パラメーターのソースまたは既定値を指定しません。](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="60af8-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span></span>

<span data-ttu-id="60af8-306">**図 15**: パラメーターのソースまたは既定値を指定しない ([フルサイズのイメージを表示するをクリックして](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="60af8-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="60af8-307">まとめ</span><span class="sxs-lookup"><span data-stu-id="60af8-307">Summary</span></span>

<span data-ttu-id="60af8-308">SqlDataSource 開発者はページをパラメーター値を持つハード コーディングされた、定義済みパラメーターのソースから取得したりプログラムによって割り当てられているパラメーター化クエリを定義できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="60af8-309">このチュートリアルでは、アドホック SQL クエリとストアド プロシージャの両方のデータ ソース構成ウィザードからのパラメーター化クエリを作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="60af8-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="60af8-310">についても説明しましたパラメーターのハードコード ソース、パラメーターのソースとしての Web コントロールを使用して、プログラムで、パラメーターの値を指定します。</span><span class="sxs-lookup"><span data-stu-id="60af8-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="60af8-311">ように、ObjectDataSource SqlDataSource も提供しています、基になるデータを変更する機能。</span><span class="sxs-lookup"><span data-stu-id="60af8-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="60af8-312">次のチュートリアルでは紹介を定義する方法で`INSERT`、 `UPDATE`、および`DELETE`SqlDataSource によるステートメントです。</span><span class="sxs-lookup"><span data-stu-id="60af8-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="60af8-313">これらのステートメントが追加されると、挿入、編集、および、GridView、DetailsView、およびフォーム ビュー コントロールに固有の機能を削除すると、組み込みを利用できます。</span><span class="sxs-lookup"><span data-stu-id="60af8-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="60af8-314">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="60af8-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="60af8-315">作成者について</span><span class="sxs-lookup"><span data-stu-id="60af8-315">About the Author</span></span>

<span data-ttu-id="60af8-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="60af8-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="60af8-317">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="60af8-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="60af8-318">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="60af8-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="60af8-319">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="60af8-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="60af8-320">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="60af8-320">Special Thanks To</span></span>

<span data-ttu-id="60af8-321">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="60af8-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="60af8-322">このチュートリアルの潜在顧客レビュー担当者には、Scott クライド、Randell Schmidt Ken Pespisa がされていました。</span><span class="sxs-lookup"><span data-stu-id="60af8-322">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="60af8-323">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="60af8-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="60af8-324">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="60af8-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="60af8-325">[前へ](querying-data-with-the-sqldatasource-control-vb.md)
[次へ](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="60af8-325">[Previous](querying-data-with-the-sqldatasource-control-vb.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span></span>
