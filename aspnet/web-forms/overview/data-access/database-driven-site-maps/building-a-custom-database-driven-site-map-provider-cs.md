---
uid: web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
title: カスタム データベース駆動型サイト マップ プロバイダー (c#) のビルド |Microsoft ドキュメント
author: rick-anderson
description: ASP.NET 2.0 の既定のサイト マップ プロバイダーは、静的な XML ファイルからのデータを取得します。 XML ベースのプロバイダーが適切に多くの小規模および中規模 siz 中.
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: 04b7591d-106f-4f05-87e9-d416cb65a8a6
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/database-driven-site-maps/building-a-custom-database-driven-site-map-provider-cs
msc.type: authoredcontent
ms.openlocfilehash: cab1b02dff27e9bacec2f4d4f7facc9f99d76b0a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878010"
---
<a name="building-a-custom-database-driven-site-map-provider-c"></a><span data-ttu-id="f0915-104">カスタム データベース駆動型サイト マップ プロバイダー (c#) のビルド</span><span class="sxs-lookup"><span data-stu-id="f0915-104">Building a Custom Database-Driven Site Map Provider (C#)</span></span>
====================
<span data-ttu-id="f0915-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f0915-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f0915-106">[コードをダウンロードする](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip)または[PDF のダウンロード](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f0915-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_62_CS.zip) or [Download PDF](building-a-custom-database-driven-site-map-provider-cs/_static/datatutorial62cs1.pdf)</span></span>

> <span data-ttu-id="f0915-107">ASP.NET 2.0 の既定のサイト マップ プロバイダーは、静的な XML ファイルからのデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="f0915-107">The default site map provider in ASP.NET 2.0 retrieves its data from a static XML file.</span></span> <span data-ttu-id="f0915-108">XML ベースのプロバイダーは、多くの小規模および中規模の Web サイトに適していますが、大規模な Web アプリケーションより動的なサイト マップが必要です。</span><span class="sxs-lookup"><span data-stu-id="f0915-108">While the XML-based provider is suitable to many small and medium-sized Web sites, larger Web applications require a more dynamic site map.</span></span> <span data-ttu-id="f0915-109">このチュートリアルでは、ビジネス ロジック層からそのデータを取得するカスタムのサイト マップ プロバイダーをビルドでをさらに、データベースからデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="f0915-109">In this tutorial we'll build a custom site map provider that retrieves its data from the Business Logic Layer, which in turn retrieves data from the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="f0915-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="f0915-110">Introduction</span></span>

<span data-ttu-id="f0915-111">ASP.NET 2.0 のサイト マップ機能などの XML ファイルに、永続的ないくつか中で web アプリケーションのサイト マップを定義するページの開発者を有効にします。</span><span class="sxs-lookup"><span data-stu-id="f0915-111">ASP.NET 2.0 s site map feature enables a page developer to define a web application s site map in some persistent medium, such as in an XML file.</span></span> <span data-ttu-id="f0915-112">サイト マップ データをプログラムでを介してアクセスできますを定義した後、 [ `SiteMap`クラス](https://msdn.microsoft.com/library/system.web.sitemap.aspx)で、 [ `System.Web`名前空間](https://msdn.microsoft.com/library/system.web.aspx)など、さまざまなナビゲーション Web コントロール、または、サイト マップ パス、メニューのおよびツリー ビュー コントロール。</span><span class="sxs-lookup"><span data-stu-id="f0915-112">Once defined, the site map data can be accessed programmatically through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx) or through a variety of navigation Web controls, such as the SiteMapPath, Menu, and TreeView controls.</span></span> <span data-ttu-id="f0915-113">マップのサイト システムを使用して、[プロバイダー モデル](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)別のサイト マップのシリアル化の実装を作成し、web アプリケーションに接続されているようにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-113">The site map system uses the [provider model](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx) so that different site map serialization implementations can be created and plugged into a web application.</span></span> <span data-ttu-id="f0915-114">ASP.NET 2.0 に付属する既定のサイト マップ プロバイダーには、XML ファイル内のサイト マップ構造が永続化します。</span><span class="sxs-lookup"><span data-stu-id="f0915-114">The default site map provider that ships with ASP.NET 2.0 persists site map structure in an XML file.</span></span> <span data-ttu-id="f0915-115">戻り、[マスター ページとサイトのナビゲーション](../introduction/master-pages-and-site-navigation-cs.md)という名前のファイルを作成したチュートリアル`Web.sitemap`をこの構造体に含まれ、新しいチュートリアル セクションで、XML を更新されています。</span><span class="sxs-lookup"><span data-stu-id="f0915-115">Back in the [Master Pages and Site Navigation](../introduction/master-pages-and-site-navigation-cs.md) tutorial we created a file named `Web.sitemap` that contained this structure and have been updating its XML with each new tutorial section.</span></span>

<span data-ttu-id="f0915-116">既定の XML ベースのサイト マップ プロバイダーは、サイト マップの構造は、これらのチュートリアルのなど、比較的静的な場合はうまく機能します。</span><span class="sxs-lookup"><span data-stu-id="f0915-116">The default XML-based site map provider works well if the site map s structure is fairly static, such as for these tutorials.</span></span> <span data-ttu-id="f0915-117">多くのシナリオでただしより動的なサイト マップが必要です。</span><span class="sxs-lookup"><span data-stu-id="f0915-117">In many scenarios, however, a more dynamic site map is needed.</span></span> <span data-ttu-id="f0915-118">各分類と製品を web サイトの構造内のセクションとして表示される、図 1 に示すサイト マップを検討してください。</span><span class="sxs-lookup"><span data-stu-id="f0915-118">Consider the site map shown in Figure 1, where each category and product appear as sections in the website s structure.</span></span> <span data-ttu-id="f0915-119">このサイト マップを使用したルート ノードに対応する web ページへのアクセス可能性がありますすべてを一覧表示、カテゴリの一方、そのカテゴリの製品のリストが特定のカテゴリの web ページにアクセスし、特定の製品の web ページを表示するはその製品 s の詳細を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-119">With this site map, visiting the web page corresponding to the root node might list all of the categories, whereas visiting a particular category s web page would list that category s products and viewing a particular product s web page would show that product s details.</span></span>


<span data-ttu-id="f0915-120">[![カテゴリおよび製品の構成、サイト マップ s 構造体](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-120">[![The Categories and Products Makeup the Site Map s Structure](building-a-custom-database-driven-site-map-provider-cs/_static/image1.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image1.png)</span></span>

<span data-ttu-id="f0915-121">**図 1**:、カテゴリおよび製品の構成はサイト マップの構造 ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-121">**Figure 1**: The Categories and Products Makeup the Site Map s Structure ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image2.png))</span></span>


<span data-ttu-id="f0915-122">この分類および製品に基づく構造体にハードコーディングでしたが、`Web.sitemap`ファイル、ファイルごとにカテゴリを更新する必要がありますまたは製品が追加、削除、または名前を変更します。</span><span class="sxs-lookup"><span data-stu-id="f0915-122">While this category- and product-based structure could be hard-coded into the `Web.sitemap` file, the file would need to be updated each time a category or product was added, removed, or renamed.</span></span> <span data-ttu-id="f0915-123">そのため、サイト マップの保守は大幅に簡略化、データベースからまたは、理想的には、アプリケーションのアーキテクチャのビジネス ロジック層から、その構造が取得された場合。</span><span class="sxs-lookup"><span data-stu-id="f0915-123">Consequently, the site map maintenance would be greatly simplified if its structure was retrieved from the database or, ideally, from the Business Logic Layer of the application s architecture.</span></span> <span data-ttu-id="f0915-124">こうすれば、製品およびカテゴリが追加されるため、名前変更、または削除、これらの変更を反映するように、サイト マップが自動的に更新します。</span><span class="sxs-lookup"><span data-stu-id="f0915-124">That way, as products and categories were added, renamed, or deleted, the site map would automatically update to reflect these changes.</span></span>

<span data-ttu-id="f0915-125">ASP.NET 2.0 のサイト マップのシリアル化がプロバイダー モデルの上に組み込まれているため、データベースやアーキテクチャなど、代替データ ストアからデータを取得する独自のカスタム サイト マップ プロバイダーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-125">Since ASP.NET 2.0 s site map serialization is built atop the provider model, we can create our own custom site map provider that grabs its data from an alternate data store, such as the database or architecture.</span></span> <span data-ttu-id="f0915-126">このチュートリアルでは、BLL からそのデータを取得する、カスタム プロバイダーを作成おします。</span><span class="sxs-lookup"><span data-stu-id="f0915-126">In this tutorial we'll build a custom provider that retrieves its data from the BLL.</span></span> <span data-ttu-id="f0915-127">開始 s を let!</span><span class="sxs-lookup"><span data-stu-id="f0915-127">Let s get started!</span></span>

> [!NOTE]
> <span data-ttu-id="f0915-128">このチュートリアルで作成したカスタムのサイト マップ プロバイダーは、アプリケーションのアーキテクチャとデータ モデルに密接に結び付いてます。</span><span class="sxs-lookup"><span data-stu-id="f0915-128">The custom site map provider created in this tutorial is tightly coupled to the application s architecture and data model.</span></span> <span data-ttu-id="f0915-129">Jeff Prosise s [SQL Server のサイト マップを格納する](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)と[SQL サイト マップ プロバイダーしている待機](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)アーティクルに SQL Server でのサイト マップ データを格納する汎用的なアプローチを確認します。</span><span class="sxs-lookup"><span data-stu-id="f0915-129">Jeff Prosise s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx) articles examine a generalized approach to storing site map data in SQL Server.</span></span>


## <a name="step-1-creating-the-custom-site-map-provider-web-pages"></a><span data-ttu-id="f0915-130">手順 1: カスタムのサイト マップ プロバイダーの Web ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="f0915-130">Step 1: Creating the Custom Site Map Provider Web Pages</span></span>

<span data-ttu-id="f0915-131">開始前にカスタムのサイト マップ プロバイダーを作成する、s が最初に追加しなければならない、このチュートリアルでは ASP.NET ページを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-131">Before we start creating a custom site map provider, let s first add the ASP.NET pages we'll need for this tutorial.</span></span> <span data-ttu-id="f0915-132">という名前の新しいフォルダーを追加することによって開始`SiteMapProvider`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-132">Start by adding a new folder named `SiteMapProvider`.</span></span> <span data-ttu-id="f0915-133">次に、各ページに関連付けるように、そのフォルダーに次の ASP.NET ページを追加、`Site.master`マスター ページ。</span><span class="sxs-lookup"><span data-stu-id="f0915-133">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `ProductsByCategory.aspx`
- `ProductDetails.aspx`

<span data-ttu-id="f0915-134">追加も、`CustomProviders`には、サブフォルダー、`App_Code`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="f0915-134">Also add a `CustomProviders` subfolder to the `App_Code` folder.</span></span>


![サイト マップ プロバイダーに関連するチュートリアルについては、ASP.NET ページを追加します。](building-a-custom-database-driven-site-map-provider-cs/_static/image2.gif)

<span data-ttu-id="f0915-136">**図 2**: 追加のサイトの ASP.NET ページ マップ プロバイダーに関連するチュートリアル</span><span class="sxs-lookup"><span data-stu-id="f0915-136">**Figure 2**: Add the ASP.NET Pages for the Site Map Provider-Related Tutorials</span></span>


<span data-ttu-id="f0915-137">このセクションの 1 つだけのチュートリアルなので、必要ありません`Default.aspx`s セクションのチュートリアルの一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-137">Since there is only one tutorial for this section, we don t need `Default.aspx` to list the section s tutorials.</span></span> <span data-ttu-id="f0915-138">代わりに、 `Default.aspx` GridView コントロールのカテゴリが表示されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-138">Instead, `Default.aspx` will display the categories in a GridView control.</span></span> <span data-ttu-id="f0915-139">これは、手順 2. で取り組むします。</span><span class="sxs-lookup"><span data-stu-id="f0915-139">We'll tackle this in Step 2.</span></span>

<span data-ttu-id="f0915-140">次に、更新`Web.sitemap`への参照を含める、`Default.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="f0915-140">Next, update `Web.sitemap` to include a reference to the `Default.aspx` page.</span></span> <span data-ttu-id="f0915-141">具体的には、キャッシュ後に、次のマークアップを追加`<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="f0915-141">Specifically, add the following markup after the Caching `<siteMapNode>`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample1.xml)]

<span data-ttu-id="f0915-142">更新した後に`Web.sitemap`ブラウザーを使って、チュートリアルの web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-142">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="f0915-143">左側のメニューには、唯一のサイト マップ プロバイダー チュートリアルでは、項目が含まれています。</span><span class="sxs-lookup"><span data-stu-id="f0915-143">The menu on the left now includes an item for the sole site map provider tutorial.</span></span>


![サイト マップではサイト マップ プロバイダー チュートリアルでは、エントリが含まれるようになりました](building-a-custom-database-driven-site-map-provider-cs/_static/image3.gif)

<span data-ttu-id="f0915-145">**図 3**: サイト マップではサイト マップ プロバイダー チュートリアルでは、エントリが含まれるようになりました</span><span class="sxs-lookup"><span data-stu-id="f0915-145">**Figure 3**: The Site Map Now Includes an Entry for the Site Map Provider Tutorial</span></span>


<span data-ttu-id="f0915-146">このチュートリアルの主な作業では、カスタムのサイト マップ プロバイダーを作成して、そのプロバイダーを使用する web アプリケーションの構成を示すためです。</span><span class="sxs-lookup"><span data-stu-id="f0915-146">This tutorial s main focus is to illustrate creating a custom site map provider and configuring a web application to use that provider.</span></span> <span data-ttu-id="f0915-147">具体的には、図 1 に示されている各分類および製品のノードとルート ノードを含むサイト マップを表すプロバイダーおビルドします。</span><span class="sxs-lookup"><span data-stu-id="f0915-147">In particular, we'll build a provider that returns a site map that includes a root node along with a node for each category and product, as depicted in Figure 1.</span></span> <span data-ttu-id="f0915-148">一般に、サイト マップ内の各ノードは、URL を指定することがあります。</span><span class="sxs-lookup"><span data-stu-id="f0915-148">In general, each node in the site map may specify a URL.</span></span> <span data-ttu-id="f0915-149">マイクロソフトのサイト マップのルート ノードの URL になります`~/SiteMapProvider/Default.aspx`データベース内のカテゴリをすべて一覧します。</span><span class="sxs-lookup"><span data-stu-id="f0915-149">For our site map, the root node s URL will be `~/SiteMapProvider/Default.aspx`, which will list all of the categories in the database.</span></span> <span data-ttu-id="f0915-150">サイト マップ内の各カテゴリ ノードを指す URL になります`~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`、指定した製品をすべて一覧する*categoryID*です。</span><span class="sxs-lookup"><span data-stu-id="f0915-150">Each category node in the site map will have a URL that points to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`, which will list all of the products in the specified *categoryID*.</span></span> <span data-ttu-id="f0915-151">最後に、各製品サイト マップ ノードが指す`~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`、特定の製品の詳細が表示されるされます。</span><span class="sxs-lookup"><span data-stu-id="f0915-151">Finally, each product site map node will point to `~/SiteMapProvider/ProductDetails.aspx?ProductID=productID`, which will display the specific product s details.</span></span>

<span data-ttu-id="f0915-152">開始するを作成する必要があります、 `Default.aspx`、 `ProductsByCategory.aspx`、および`ProductDetails.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="f0915-152">To start we need to create the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="f0915-153">これらのページについては、それぞれ 2、3、および第 4 のステップで完了します。</span><span class="sxs-lookup"><span data-stu-id="f0915-153">These pages are completed in Steps 2, 3, and 4, respectively.</span></span> <span data-ttu-id="f0915-154">サイト マップ プロバイダーには、このチュートリアルのため、および過去のチュートリアルを説明を作成するため、このような複数ページのマスター/詳細が報告から手順 2 から 4 までに急いではおします。</span><span class="sxs-lookup"><span data-stu-id="f0915-154">Since the thrust of this tutorial is on site map providers, and since past tutorials have covered creating these sorts of multi-page master/detail reports, we will hurry through Steps 2 through 4.</span></span> <span data-ttu-id="f0915-155">複数のページにまたがるマスター/詳細レポートの作成の状態更新機能を必要がある場合に戻って、[マスター/詳細フィルター間で 2 つのページ](../masterdetail/master-detail-filtering-across-two-pages-cs.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="f0915-155">If you need a refresher on creating master/detail reports that span multiple pages, refer back to the [Master/Detail Filtering Across Two Pages](../masterdetail/master-detail-filtering-across-two-pages-cs.md) tutorial.</span></span>

## <a name="step-2-displaying-a-list-of-categories"></a><span data-ttu-id="f0915-156">手順 2: カテゴリの一覧を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-156">Step 2: Displaying a List of Categories</span></span>

<span data-ttu-id="f0915-157">開く、 `Default.aspx`  ページで、`SiteMapProvider`フォルダーと、デザイナーの設定には、ツールボックスからドラッグ、GridView、`ID`に`Categories`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-157">Open the `Default.aspx` page in the `SiteMapProvider` folder and drag a GridView from the Toolbox onto the Designer, setting its `ID` to `Categories`.</span></span> <span data-ttu-id="f0915-158">GridView s のスマート タグからにバインドして、という名前の新しい ObjectDataSource`CategoriesDataSource`しを使用してそのデータを取得するため、構成、`CategoriesBLL`クラスの`GetCategories`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="f0915-158">From the GridView s smart tag, bind it to a new ObjectDataSource named `CategoriesDataSource` and configure it so that it retrieves its data using the `CategoriesBLL` class s `GetCategories` method.</span></span> <span data-ttu-id="f0915-159">この GridView だけカテゴリを表示、データ変更機能を提供しませんので、UPDATE、INSERT でドロップダウン リストを設定し、(なし) にタブを削除します。</span><span class="sxs-lookup"><span data-stu-id="f0915-159">Since this GridView just displays the categories and does not provide data modification capabilities, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="f0915-160">[![返すメソッドを使用してカテゴリ ObjectDataSource を構成します。](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-160">[![Configure the ObjectDataSource to Return Categories Using the GetCategories Method](building-a-custom-database-driven-site-map-provider-cs/_static/image4.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image3.png)</span></span>

<span data-ttu-id="f0915-161">**図 4**: 構成カテゴリを返すを使用してに ObjectDataSource、`GetCategories`メソッド ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-161">**Figure 4**: Configure the ObjectDataSource to Return Categories Using the `GetCategories` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image4.png))</span></span>


<span data-ttu-id="f0915-162">[![UPDATE、INSERT のドロップダウン リストを設定し、(なし) タブを削除します。](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-162">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image5.png)</span></span>

<span data-ttu-id="f0915-163">**図 5**: (なし) に、UPDATE、INSERT、および削除のタブで、ドロップダウン リストを設定 ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-163">**Figure 5**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image6.png))</span></span>


<span data-ttu-id="f0915-164">Visual Studio がの BoundField を追加、データ ソースの構成ウィザードを完了すると、 `CategoryID`、 `CategoryName`、 `Description`、 `NumberOfProducts`、および`BrochurePath`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-164">After completing the Configure Data Source wizard, Visual Studio will add a BoundField for `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath`.</span></span> <span data-ttu-id="f0915-165">GridView の編集のみが含まれるように、`CategoryName`と`Description`BoundFields し、更新、 `CategoryName` BoundField の`HeaderText`プロパティ カテゴリをします。</span><span class="sxs-lookup"><span data-stu-id="f0915-165">Edit the GridView so that it only contains the `CategoryName` and `Description` BoundFields and update the `CategoryName` BoundField s `HeaderText` property to Category .</span></span>

<span data-ttu-id="f0915-166">次に、内を追加して、そのように配置が s、左端のフィールドです。</span><span class="sxs-lookup"><span data-stu-id="f0915-166">Next, add a HyperLinkField and position it so that it s the left-most field.</span></span> <span data-ttu-id="f0915-167">設定、`DataNavigateUrlFields`プロパティを`CategoryID`と`DataNavigateUrlFormatString`プロパティを`~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-167">Set the `DataNavigateUrlFields` property to `CategoryID` and the `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID={0}`.</span></span> <span data-ttu-id="f0915-168">設定、`Text`製品を表示するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="f0915-168">Set the `Text` property to View Products .</span></span>


![カテゴリ GridView に内を追加します。](building-a-custom-database-driven-site-map-provider-cs/_static/image6.gif)

<span data-ttu-id="f0915-170">**図 6**: を内の追加、 `Categories` GridView</span><span class="sxs-lookup"><span data-stu-id="f0915-170">**Figure 6**: Add a HyperLinkField to the `Categories` GridView</span></span>


<span data-ttu-id="f0915-171">後、ObjectDataSource を作成して、GridView のフィールドのカスタマイズ、宣言型マークアップを 2 つのコントロールは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="f0915-171">After creating the ObjectDataSource and customizing the GridView s fields, the two controls declarative markup will look like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample2.aspx)]

<span data-ttu-id="f0915-172">図 7 は`Default.aspx`ブラウザーで表示したときにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-172">Figure 7 shows `Default.aspx` when viewed through a browser.</span></span> <span data-ttu-id="f0915-173">カテゴリの製品の表示をクリックするとリンクをクリックすると、 `ProductsByCategory.aspx?CategoryID=categoryID`、ここでは手順 3. で構築します。</span><span class="sxs-lookup"><span data-stu-id="f0915-173">Clicking a category s View Products link takes you to `ProductsByCategory.aspx?CategoryID=categoryID`, which we will build in Step 3.</span></span>


<span data-ttu-id="f0915-174">[![各カテゴリは、ビューの製品リンクを含むに沿って表示されています。](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-174">[![Each Category is Listed Along with a View Products Link](building-a-custom-database-driven-site-map-provider-cs/_static/image7.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image7.png)</span></span>

<span data-ttu-id="f0915-175">**図 7**: の製品のリンクにビューに表示されているに沿っては、各カテゴリ ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-175">**Figure 7**: Each Category is Listed Along with a View Products Link ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image8.png))</span></span>


## <a name="step-3-listing-the-selected-category-s-products"></a><span data-ttu-id="f0915-176">手順 3:、選択したカテゴリの製品が一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-176">Step 3: Listing the Selected Category s Products</span></span>

<span data-ttu-id="f0915-177">開く、`ProductsByCategory.aspx`ページし、その名前を付け、GridView を追加`ProductsByCategory`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-177">Open the `ProductsByCategory.aspx` page and add a GridView, naming it `ProductsByCategory`.</span></span> <span data-ttu-id="f0915-178">スマート タグからという名前の新しい ObjectDataSource を GridView にバインド`ProductsByCategoryDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-178">From its smart tag, bind the GridView to a new ObjectDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="f0915-179">構成を使用する ObjectDataSource、`ProductsBLL`クラスの`GetProductsByCategoryID(categoryID)`メソッドおよびセット ドロップダウン リストが UPDATE、INSERT、および DELETE の各タブで (なし) に一覧します。</span><span class="sxs-lookup"><span data-stu-id="f0915-179">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProductsByCategoryID(categoryID)` method and set the drop-down lists to (None) in the UPDATE, INSERT, and DELETE tabs.</span></span>


<span data-ttu-id="f0915-180">[![ProductsBLL クラスの GetProductsByCategoryID(categoryID) メソッドを使用します。](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-180">[![Use the ProductsBLL Class s GetProductsByCategoryID(categoryID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image8.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image9.png)</span></span>

<span data-ttu-id="f0915-181">**図 8**: を使用して、`ProductsBLL`クラス s`GetProductsByCategoryID(categoryID)`メソッド ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-181">**Figure 8**: Use the `ProductsBLL` Class s `GetProductsByCategoryID(categoryID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image10.png))</span></span>


<span data-ttu-id="f0915-182">データ ソース構成ウィザードの最後の手順のパラメーターのソースの入力を求める*categoryID*です。</span><span class="sxs-lookup"><span data-stu-id="f0915-182">The final step in the Configure Data Source wizard prompts for a parameter source for *categoryID*.</span></span> <span data-ttu-id="f0915-183">この情報はクエリ文字列フィールドを介して渡されるため`CategoryID`ドロップダウン リストから QueryString を選択して、図 9 に示すように、QueryStringField ボックスで、categoryid を入力します。</span><span class="sxs-lookup"><span data-stu-id="f0915-183">Since this information is passed through the querystring field `CategoryID`, select QueryString from the drop-down list and enter CategoryID in the QueryStringField textbox as shown in Figure 9.</span></span> <span data-ttu-id="f0915-184">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-184">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="f0915-185">[![CategoryID パラメーターの使用 [categoryid] Querystring フィールド](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-185">[![Use the CategoryID Querystring Field for the categoryID Parameter](building-a-custom-database-driven-site-map-provider-cs/_static/image9.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image11.png)</span></span>

<span data-ttu-id="f0915-186">**図 9**: を使用して、`CategoryID`のクエリ文字列フィールド、 *categoryID*パラメーター ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-186">**Figure 9**: Use the `CategoryID` Querystring Field for the *categoryID* Parameter ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image12.png))</span></span>


<span data-ttu-id="f0915-187">ウィザードを完了するは、Visual Studio は製品のデータ フィールドの GridView にも、対応する BoundFields と、CheckBoxField に追加されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-187">After completing the wizard, Visual Studio will add corresponding BoundFields and a CheckBoxField to the GridView for the product data fields.</span></span> <span data-ttu-id="f0915-188">削除が、 `ProductName`、 `UnitPrice`、および`SupplierName`BoundFields です。</span><span class="sxs-lookup"><span data-stu-id="f0915-188">Remove all but the `ProductName`, `UnitPrice`, and `SupplierName` BoundFields.</span></span> <span data-ttu-id="f0915-189">これら 3 つ BoundFields をカスタマイズ`HeaderText`読み取れません製品、価格、および供給業者、それぞれのプロパティです。</span><span class="sxs-lookup"><span data-stu-id="f0915-189">Customize these three BoundFields `HeaderText` properties to read Product, Price, and Supplier, respectively.</span></span> <span data-ttu-id="f0915-190">形式、`UnitPrice`通貨として BoundField です。</span><span class="sxs-lookup"><span data-stu-id="f0915-190">Format the `UnitPrice` BoundField as a currency.</span></span>

<span data-ttu-id="f0915-191">次に、内に追加し、左端の位置に移動します。</span><span class="sxs-lookup"><span data-stu-id="f0915-191">Next, add a HyperLinkField and move it to the left-most position.</span></span> <span data-ttu-id="f0915-192">設定の`Text`詳細を表示、プロパティ、`DataNavigateUrlFields`プロパティを`ProductID`、およびその`DataNavigateUrlFormatString`プロパティを`~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-192">Set its `Text` property to View Details, its `DataNavigateUrlFields` property to `ProductID`, and its `DataNavigateUrlFormatString` property to `~/SiteMapProvider/ProductDetails.aspx?ProductID={0}`.</span></span>


![ProductDetails.aspx を指すビューの詳細内を追加します。](building-a-custom-database-driven-site-map-provider-cs/_static/image10.gif)

<span data-ttu-id="f0915-194">**図 10**: ビューの詳細を指す内の追加 `ProductDetails.aspx`</span><span class="sxs-lookup"><span data-stu-id="f0915-194">**Figure 10**: Add a View Details HyperLinkField that Points to `ProductDetails.aspx`</span></span>


<span data-ttu-id="f0915-195">これらのカスタマイズを行った後、GridView と ObjectDataSource s 宣言型マークアップが、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="f0915-195">After making these customizations, the GridView and ObjectDataSource s declarative markup should resemble the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample3.aspx)]

<span data-ttu-id="f0915-196">表示に戻る`Default.aspx`飲み物のリンクをブラウザーや製品の表示をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-196">Return to viewing `Default.aspx` through a browser and click on the View Products link for Beverages.</span></span> <span data-ttu-id="f0915-197">これは、操作により`ProductsByCategory.aspx?CategoryID=1`飲み物のカテゴリに属している Northwind データベースの名前、価格、および製品の仕入先を表示する (図 11 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="f0915-197">This will take you to `ProductsByCategory.aspx?CategoryID=1`, displaying the names, prices, and suppliers of the products in the Northwind database that belong to the Beverages category (see Figure 11).</span></span> <span data-ttu-id="f0915-198">ユーザー ページに戻り、カテゴリの一覧へのリンクを含めるには、このページをさらに強化するためにもかまいません (`Default.aspx`) と DetailsView またはフォーム ビューのコントロールで、選択したカテゴリの名前と説明を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-198">Feel free to further enhance this page to include a link to return users to the category listing page (`Default.aspx`) and a DetailsView or FormView control that displays the selected category s name and description.</span></span>


<span data-ttu-id="f0915-199">[![飲み物の名前、価格、および仕入先が表示されます。](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-199">[![The Beverages Names, Prices, and Suppliers are Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image11.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image13.png)</span></span>

<span data-ttu-id="f0915-200">**図 11**:、飲み物の名前、価格、および仕入先が表示されます ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-200">**Figure 11**: The Beverages Names, Prices, and Suppliers are Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image14.png))</span></span>


## <a name="step-4-showing-a-product-s-details"></a><span data-ttu-id="f0915-201">手順 4: 製品の詳細を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-201">Step 4: Showing a Product s Details</span></span>

<span data-ttu-id="f0915-202">最終ページで、 `ProductDetails.aspx`、選択した製品の詳細を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-202">The final page, `ProductDetails.aspx`, displays the selected products details.</span></span> <span data-ttu-id="f0915-203">開いている`ProductDetails.aspx`DetailsView をツールボックスからデザイナーにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="f0915-203">Open `ProductDetails.aspx` and drag a DetailsView from the Toolbox onto the Designer.</span></span> <span data-ttu-id="f0915-204">DetailsView s を設定`ID`プロパティを`ProductInfo`をクリアし、`Height`と`Width`プロパティの値。</span><span class="sxs-lookup"><span data-stu-id="f0915-204">Set the DetailsView s `ID` property to `ProductInfo` and clear out its `Height` and `Width` property values.</span></span> <span data-ttu-id="f0915-205">スマート タグから DetailsView をという名前の新しい ObjectDataSource にバインド`ProductDataSource`、ObjectDataSource からそのデータをプルする構成、`ProductsBLL`クラスの`GetProductByProductID(productID)`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="f0915-205">From its smart tag, bind the DetailsView to a new ObjectDataSource named `ProductDataSource`, configuring the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProductByProductID(productID)` method.</span></span> <span data-ttu-id="f0915-206">同様に手順 2. および 3. で作成された以前の web ページ、UPDATE、INSERT でのドロップダウン リストの設定を (なし) タブを削除します。</span><span class="sxs-lookup"><span data-stu-id="f0915-206">As with the previous web pages created in Steps 2 and 3, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None) .</span></span>


<span data-ttu-id="f0915-207">[![ObjectDataSource GetProductByProductID(productID) メソッドを使用して構成します。](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-207">[![Configure the ObjectDataSource to Use the GetProductByProductID(productID) Method](building-a-custom-database-driven-site-map-provider-cs/_static/image12.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.png)</span></span>

<span data-ttu-id="f0915-208">**図 12**: 構成を使用する ObjectDataSource、`GetProductByProductID(productID)`メソッド ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-208">**Figure 12**: Configure the ObjectDataSource to Use the `GetProductByProductID(productID)` Method ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image16.png))</span></span>


<span data-ttu-id="f0915-209">データ ソース構成ウィザードの最後の手順は、元のメッセージが表示されます、 *productID*パラメーター。</span><span class="sxs-lookup"><span data-stu-id="f0915-209">The last step of the Configure Data Source wizard prompts for the source of the *productID* parameter.</span></span> <span data-ttu-id="f0915-210">このデータは、クエリ文字列フィールドを介して渡されたため`ProductID`、クエリ文字列と ProductID する QueryStringField テキスト ボックスに、ドロップダウン リストを設定します。</span><span class="sxs-lookup"><span data-stu-id="f0915-210">Since this data comes through the querystring field `ProductID`, set the drop-down list to QueryString and the QueryStringField textbox to ProductID.</span></span> <span data-ttu-id="f0915-211">最後に、ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-211">Finally, click the Finish button to complete the wizard.</span></span>


<span data-ttu-id="f0915-212">[![ProductID ProductID Querystring フィールドからその値を取得するパラメーターを構成します。](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-212">[![Configure the productID Parameter to Pull its Value from the ProductID Querystring Field](building-a-custom-database-driven-site-map-provider-cs/_static/image13.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image17.png)</span></span>

<span data-ttu-id="f0915-213">**図 13**: 構成、 *productID*からその値を取得するパラメーター、 `ProductID` Querystring フィールド ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-213">**Figure 13**: Configure the *productID* Parameter to Pull its Value from the `ProductID` Querystring Field ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image18.png))</span></span>


<span data-ttu-id="f0915-214">データ ソース構成ウィザードを完了すると、Visual Studio が対応する BoundFields および、CheckBoxField を製品のデータ フィールドの DetailsView に作成されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-214">After completing the Configure Data Source wizard, Visual Studio will create corresponding BoundFields and a CheckBoxField in the DetailsView for the product data fields.</span></span> <span data-ttu-id="f0915-215">削除、 `ProductID`、 `SupplierID`、および`CategoryID`BoundFields し、必要に応じて表示とその他のフィールドを構成します。</span><span class="sxs-lookup"><span data-stu-id="f0915-215">Remove the `ProductID`, `SupplierID`, and `CategoryID` BoundFields and configure the remaining fields as you see fit.</span></span> <span data-ttu-id="f0915-216">美しく配置構成のいくつか後、は、my DetailsView および ObjectDataSource s 宣言型マークアップは、次のように検索。</span><span class="sxs-lookup"><span data-stu-id="f0915-216">After a handful of aesthetic configurations, my DetailsView and ObjectDataSource s declarative markup looked like the following:</span></span>


[!code-aspx[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample4.aspx)]

<span data-ttu-id="f0915-217">このページをテストするを返す`Default.aspx`飲み物のカテゴリの製品の表示をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-217">To test this page, return to `Default.aspx` and click on View Products for the Beverages category.</span></span> <span data-ttu-id="f0915-218">飲み物の製品の一覧については、チャイの詳細を表示するリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-218">From the listing of beverage products, click on the View Details link for Chai Tea.</span></span> <span data-ttu-id="f0915-219">これは、操作により`ProductDetails.aspx?ProductID=1`チャイ s (図 14 を参照してください) の詳細が示されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-219">This will take you to `ProductDetails.aspx?ProductID=1`, which shows a Chai Tea s details (see Figure 14).</span></span>


<span data-ttu-id="f0915-220">[![チャイ s 供給業者、カテゴリ、価格、およびその他の情報が表示されます。](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-220">[![Chai Tea s Supplier, Category, Price, and Other Information is Displayed](building-a-custom-database-driven-site-map-provider-cs/_static/image14.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image19.png)</span></span>

<span data-ttu-id="f0915-221">**図 14**: チャイ s 供給業者、カテゴリ、価格、およびその他の情報が表示されます ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-221">**Figure 14**: Chai Tea s Supplier, Category, Price, and Other Information is Displayed ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.png))</span></span>


## <a name="step-5-understanding-the-inner-workings-of-a-site-map-provider"></a><span data-ttu-id="f0915-222">手順 5: サイト マップ プロバイダーの内部動作を理解します。</span><span class="sxs-lookup"><span data-stu-id="f0915-222">Step 5: Understanding the Inner Workings of a Site Map Provider</span></span>

<span data-ttu-id="f0915-223">サイト マップが web サーバーのメモリ内のコレクションとして表される`SiteMapNode`階層を形成するインスタンス。</span><span class="sxs-lookup"><span data-stu-id="f0915-223">The site map is represented in the web server s memory as a collection of `SiteMapNode` instances that form a hierarchy.</span></span> <span data-ttu-id="f0915-224">正確に 1 つのルートである必要があります、ただ 1 つの親ノードが必要ですがルート以外のすべてのノードおよびすべてのノードが子の任意の数を含めることがあります。</span><span class="sxs-lookup"><span data-stu-id="f0915-224">There must be exactly one root, all non-root nodes must have exactly one parent node, and all nodes may have an arbitrary number of children.</span></span> <span data-ttu-id="f0915-225">各`SiteMapNode`オブジェクトは、web サイトの構造内のセクションを表します。 これらのセクションでは、対応する web ページをよくがあります。</span><span class="sxs-lookup"><span data-stu-id="f0915-225">Each `SiteMapNode` object represents a section in the website s structure; these sections commonly have a corresponding web page.</span></span> <span data-ttu-id="f0915-226">その結果、 [ `SiteMapNode`クラス](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx)などのプロパティを持つ`Title`、 `Url`、および`Description`、セクションの情報を提供する、`SiteMapNode`を表します。</span><span class="sxs-lookup"><span data-stu-id="f0915-226">Consequently, the [`SiteMapNode` class](https://msdn.microsoft.com/library/system.web.sitemapnode.aspx) has properties like `Title`, `Url`, and `Description`, which provide information for the section the `SiteMapNode` represents.</span></span> <span data-ttu-id="f0915-227">`Key`それぞれを一意に識別するプロパティ`SiteMapNode`、階層、だけでなくこの階層を確立するために使用されるプロパティ`ChildNodes`、 `ParentNode`、 `NextSibling`、`PreviousSibling`などのようにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-227">There is also a `Key` property that uniquely identifies each `SiteMapNode` in the hierarchy, as well as properties used to establish this hierarchy `ChildNodes`, `ParentNode`, `NextSibling`, `PreviousSibling`, and so forth.</span></span>

<span data-ttu-id="f0915-228">図 15 は、図 1 であっても、実装の詳細より詳細にスケッチを持つ、全般的なサイト マップ構造を示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-228">Figure 15 shows the general site map structure from Figure 1, but with the implementation details sketched out in finer detail.</span></span>


<span data-ttu-id="f0915-229">[![各 SiteMapNode はプロパティと同様にタイトル、Url、キー、およびなど](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span><span class="sxs-lookup"><span data-stu-id="f0915-229">[![Each SiteMapNode has Properties Like Title, Url, Key, and So On](building-a-custom-database-driven-site-map-provider-cs/_static/image16.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image15.gif)</span></span>

<span data-ttu-id="f0915-230">**図 15**: 各`SiteMapNode`プロパティなどが`Title`、 `Url`、`Key`され ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span><span class="sxs-lookup"><span data-stu-id="f0915-230">**Figure 15**: Each `SiteMapNode` has Properties Like `Title`, `Url`, `Key`, and So On ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image17.gif))</span></span>


<span data-ttu-id="f0915-231">サイト マップが経由でアクセスできる、 [ `SiteMap`クラス](https://msdn.microsoft.com/library/system.web.sitemap.aspx)で、 [ `System.Web`名前空間](https://msdn.microsoft.com/library/system.web.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-231">The site map is accessible through the [`SiteMap` class](https://msdn.microsoft.com/library/system.web.sitemap.aspx) in the [`System.Web` namespace](https://msdn.microsoft.com/library/system.web.aspx).</span></span> <span data-ttu-id="f0915-232">このクラス s`RootNode`プロパティは、サイト マップのルートを返します`SiteMapNode`インスタンス。`CurrentNode`を返します、`SiteMapNode`が`Url`現在の要求されたページの URL と一致するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="f0915-232">This class s `RootNode` property returns the site map s root `SiteMapNode` instance; `CurrentNode` returns the `SiteMapNode` whose `Url` property matches the URL of the currently requested page.</span></span> <span data-ttu-id="f0915-233">このクラスは、ASP.NET 2.0 のナビゲーション Web コントロールによって内部的に使用します。</span><span class="sxs-lookup"><span data-stu-id="f0915-233">This class is used internally by ASP.NET 2.0 s navigation Web controls.</span></span>

<span data-ttu-id="f0915-234">ときに、`SiteMap`クラス s のプロパティにアクセスは、メモリにいくつかの永続的なメディアからのサイト マップ構造がシリアル化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f0915-234">When the `SiteMap` class s properties are accessed, it must serialize the site map structure from some persistent medium into memory.</span></span> <span data-ttu-id="f0915-235">ただし、サイト マップのシリアル化ロジックはハードにコード化された、`SiteMap`クラスです。</span><span class="sxs-lookup"><span data-stu-id="f0915-235">However, the site map serialization logic is not hard coded into the `SiteMap` class.</span></span> <span data-ttu-id="f0915-236">代わりに、実行時に、`SiteMap`クラスは、サイトのマップを決定*プロバイダー*にシリアル化に使用します。</span><span class="sxs-lookup"><span data-stu-id="f0915-236">Instead, at runtime the `SiteMap` class determines which site map *provider* to use for serialization.</span></span> <span data-ttu-id="f0915-237">既定では、 [ `XmlSiteMapProvider`クラス](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx)使用が適切にフォーマットされた XML ファイルからサイト マップ s 構造体を読み取ります。</span><span class="sxs-lookup"><span data-stu-id="f0915-237">By default, the [`XmlSiteMapProvider` class](https://msdn.microsoft.com/library/system.web.xmlsitemapprovider.aspx) is used, which reads the site map s structure from a properly-formatted XML file.</span></span> <span data-ttu-id="f0915-238">ただし、作業のほとんどのビットを使用して、独自のカスタムのサイト マップ プロバイダーを作成できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-238">However, with a little bit of work we can create our own custom site map provider.</span></span>

<span data-ttu-id="f0915-239">すべてのサイト マップ プロバイダーはから派生する必要があります、 [ `SiteMapProvider`クラス](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx)重要なメソッドを含む、およびサイトに必要なプロパティは、プロバイダーをマップが、実装の詳細の多くを省略します。</span><span class="sxs-lookup"><span data-stu-id="f0915-239">All site map providers must be derived from the [`SiteMapProvider` class](https://msdn.microsoft.com/library/system.web.sitemapprovider.aspx), which includes the essential methods and properties needed for site map providers, but omits many of the implementation details.</span></span> <span data-ttu-id="f0915-240">2 番目のクラスを[ `StaticSiteMapProvider` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx)、拡張、`SiteMapProvider`クラスし、必要な機能のより堅牢に実装が含まれています。</span><span class="sxs-lookup"><span data-stu-id="f0915-240">A second class, [`StaticSiteMapProvider`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.aspx), extends the `SiteMapProvider` class and contains a more robust implementation of the needed functionality.</span></span> <span data-ttu-id="f0915-241">内部的には、`StaticSiteMapProvider`格納、`SiteMapNode`のマップに、サイトのインスタンス、`Hashtable`などのメソッドを提供し、 `AddNode(child, parent)`、`RemoveNode(siteMapNode),`と`Clear()`追加および削除する`SiteMapNode`内部 s`Hashtable`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-241">Internally, the `StaticSiteMapProvider` stores the `SiteMapNode` instances of the site map in a `Hashtable` and provides methods like `AddNode(child, parent)`, `RemoveNode(siteMapNode),` and `Clear()` that add and remove `SiteMapNode` s to the internal `Hashtable`.</span></span> <span data-ttu-id="f0915-242">`XmlSiteMapProvider` は、`StaticSiteMapProvider` から派生しています。</span><span class="sxs-lookup"><span data-stu-id="f0915-242">`XmlSiteMapProvider` is derived from `StaticSiteMapProvider`.</span></span>

<span data-ttu-id="f0915-243">拡張するカスタムのサイト マップ プロバイダーを作成するときに`StaticSiteMapProvider`、2 つの抽象メソッドをオーバーライドする必要があります: [ `BuildSiteMap` ](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx)と[ `GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-243">When creating a custom site map provider that extends `StaticSiteMapProvider`, there are two abstract methods that must be overridden: [`BuildSiteMap`](https://msdn.microsoft.com/library/system.web.staticsitemapprovider.buildsitemap.aspx) and [`GetRootNodeCore`](https://msdn.microsoft.com/library/system.web.sitemapprovider.getrootnodecore.aspx).</span></span> <span data-ttu-id="f0915-244">`BuildSiteMap`、名前からわかるように、は永続的なストレージからのサイト マップ構造体の読み込みと、メモリ内で構築を行います。</span><span class="sxs-lookup"><span data-stu-id="f0915-244">`BuildSiteMap`, as its name implies, is responsible for loading the site map structure from persistent storage and constructing it in memory.</span></span> <span data-ttu-id="f0915-245">`GetRootNodeCore` サイト マップのルート ノードを返します。</span><span class="sxs-lookup"><span data-stu-id="f0915-245">`GetRootNodeCore` returns the root node in the site map.</span></span>

<span data-ttu-id="f0915-246">前に、web アプリケーションは、アプリケーションの構成に登録する必要がありますが、サイト マップ プロバイダーを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-246">Before a web application can use a site map provider it must be registered in the application s configuration.</span></span> <span data-ttu-id="f0915-247">既定では、`XmlSiteMapProvider`クラスが名前で登録されている`AspNetXmlSiteMapProvider`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-247">By default, the `XmlSiteMapProvider` class is registered using the name `AspNetXmlSiteMapProvider`.</span></span> <span data-ttu-id="f0915-248">追加のサイト マップ プロバイダーを登録するには、次に示すマークアップを追加`Web.config`:</span><span class="sxs-lookup"><span data-stu-id="f0915-248">To register additional site map providers, add the following markup to `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample5.xml)]

<span data-ttu-id="f0915-249">*名前*値が中にプロバイダーを人間が判読できる名前を割り当てます*型*サイト マップ プロバイダーの完全修飾型名を指定します。</span><span class="sxs-lookup"><span data-stu-id="f0915-249">The *name* value assigns a human-readable name to the provider while *type* specifies the fully-qualified type name of the site map provider.</span></span> <span data-ttu-id="f0915-250">具体的な値を見ていきましょう、*名前*と*型*手順 7. で値された後、カスタムのサイト マップ プロバイダーを作成しました。</span><span class="sxs-lookup"><span data-stu-id="f0915-250">We'll explore concrete values for the *name* and *type* values in Step 7, after we ve created our custom site map provider.</span></span>

<span data-ttu-id="f0915-251">詳細については、サイトの プロバイダー クラスのマップには、初めてからアクセスがインスタンス化される、`SiteMap`クラスとは、web アプリケーションの有効期間中にメモリに残ります。</span><span class="sxs-lookup"><span data-stu-id="f0915-251">The site map provider class is instantiated the first time it is accessed from the `SiteMap` class and remains in memory for the lifetime of the web application.</span></span> <span data-ttu-id="f0915-252">プロバイダーのメソッドである必要が呼び出された場合、複数の同時実行の web サイトの訪問者からのサイト マップ プロバイダーのインスタンスを 1 つだけなので、*スレッド セーフである*です。</span><span class="sxs-lookup"><span data-stu-id="f0915-252">Since there is only one instance of the site map provider that may be invoked from multiple, concurrent web site visitors, it is imperative that the provider s methods be *thread-safe*.</span></span>

<span data-ttu-id="f0915-253">パフォーマンスとスケーラビリティ上の理由から、メモリ内のサイト キャッシュすることが重要は構造体をマップし、これはキャッシュたびに再作成するのではなく、構造体を返す、`BuildSiteMap`メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-253">For performance and scalability reasons, it s important that we cache the in-memory site map structure and return this cached structure rather than recreating it every time the `BuildSiteMap` method is invoked.</span></span> <span data-ttu-id="f0915-254">`BuildSiteMap` 可能性があります複数回呼び出すページと、サイト マップ構造の深さで使用中のナビゲーション コントロールによって、ユーザーごとのページ要求ごと。</span><span class="sxs-lookup"><span data-stu-id="f0915-254">`BuildSiteMap` may be called several times per page request per user, depending on the navigation controls in use on the page and the depth of the site map structure.</span></span> <span data-ttu-id="f0915-255">いかなる場合においても場合は、サイト マップ構造にキャッシュしないお`BuildSiteMap`られようとしてが呼び出されるたび、再 (あるため、クエリをデータベースに) アーキテクチャから製品と分類の情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="f0915-255">In any case, if we do not cache the site map structure in `BuildSiteMap` then each time it is invoked we would need to re-retrieve the product and category information from the architecture (which would result in a query to the database).</span></span> <span data-ttu-id="f0915-256">キャッシュの前のチュートリアルで説明したよう、キャッシュされたデータが古くなることができます。</span><span class="sxs-lookup"><span data-stu-id="f0915-256">As we discussed in the previous caching tutorials, cached data can become stale.</span></span> <span data-ttu-id="f0915-257">この対処するため、時間、または SQL キャッシュ依存関係に基づく切れのいずれかを使用できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-257">To combat this, we can use either time- or SQL cache dependency-based expiries.</span></span>

> [!NOTE]
> <span data-ttu-id="f0915-258">サイト マップ プロバイダーが必要に応じてオーバーライドして、 [ `Initialize`メソッド](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-258">A site map provider may optionally override the [`Initialize` method](https://msdn.microsoft.com/library/system.web.sitemapprovider.initialize.aspx).</span></span> <span data-ttu-id="f0915-259">`Initialize` サイト マップ プロバイダーが最初にインスタンス化され、プロバイダーに割り当てられているカスタム属性に渡されるときに呼び出される`Web.config`で、`<add>`ような要素:`<add name="name" type="type" customAttribute="value" />`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-259">`Initialize` is invoked when the site map provider is first instantiated and is passed any custom attributes assigned to the provider in `Web.config` in the `<add>` element like: `<add name="name" type="type" customAttribute="value" />`.</span></span> <span data-ttu-id="f0915-260">プロバイダーのコードを変更することがなくさまざまなサイト マップ プロバイダーに関連する設定を指定するページの開発者を許可する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="f0915-260">It is useful if you want to allow a page developer to specify various site map provider-related settings without having to modify the provider s code.</span></span> <span data-ttu-id="f0915-261">たとえば、分類と製品データを可能性があります d おアーキテクチャではなく、データベースから直接読み取るおされた場合を許可するを通じてデータベース接続文字列を指定するページの開発者`Web.config`ハード コーディングされたを使用するのではなくプロバイダーのコード内の値。</span><span class="sxs-lookup"><span data-stu-id="f0915-261">For example, if we were reading the category and products data directly from the database as opposed to through the architecture, we d likely want to let the page developer specify the database connection string through `Web.config` rather than using a hard coded value in the provider s code.</span></span> <span data-ttu-id="f0915-262">手順 6 でビルド、カスタムのサイト マップ プロバイダーがこれをオーバーライドしません`Initialize`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="f0915-262">The custom site map provider we'll build in Step 6 does not override this `Initialize` method.</span></span> <span data-ttu-id="f0915-263">使用する例については、`Initialize`メソッドを参照してください[Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [SQL Server のサイト マップを格納する](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)資料です。</span><span class="sxs-lookup"><span data-stu-id="f0915-263">For an example of using the `Initialize` method, refer to [Jeff Prosise](http://www.wintellect.com/Weblogs/CategoryView,category,Jeff%20Prosise.aspx) s [Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) article.</span></span>


## <a name="step-6-creating-the-custom-site-map-provider"></a><span data-ttu-id="f0915-264">手順 6: カスタムのサイト マップ プロバイダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="f0915-264">Step 6: Creating the Custom Site Map Provider</span></span>

<span data-ttu-id="f0915-265">カテゴリおよび Northwind データベース内の製品からのサイト マップを構築するカスタムのサイト マップ プロバイダーを作成する必要がありますを拡張するクラスを作成する`StaticSiteMapProvider`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-265">To create a custom site map provider that builds the site map from the categories and products in the Northwind database, we need to create a class that extends `StaticSiteMapProvider`.</span></span> <span data-ttu-id="f0915-266">手順 1. で求められるを追加する、`CustomProviders`内のフォルダー、`App_Code`フォルダー - このという名前のフォルダーに新しいクラスを追加`NorthwindSiteMapProvider`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-266">In Step 1 I asked you to add a `CustomProviders` folder in the `App_Code` folder - add a new class to this folder named `NorthwindSiteMapProvider`.</span></span> <span data-ttu-id="f0915-267">`NorthwindSiteMapProvider` クラスに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="f0915-267">Add the following code to the `NorthwindSiteMapProvider` class:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample6.cs)]

<span data-ttu-id="f0915-268">このクラス s の探索で始まる s をできるように`BuildSiteMap`で始まるメソッド、 [ `lock`ステートメント](https://msdn.microsoft.com/library/c5kehkcz.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-268">Let s start with exploring this class s `BuildSiteMap` method, which starts with a [`lock` statement](https://msdn.microsoft.com/library/c5kehkcz.aspx).</span></span> <span data-ttu-id="f0915-269">`lock`ステートメントのみが 1 つのスレッドを入力する時にこれにより、コードへのアクセスのシリアル化され、2 つの同時実行スレッドが互い s 生まれたでステップ実行するを妨げています。</span><span class="sxs-lookup"><span data-stu-id="f0915-269">The `lock` statement only allows one thread at a time to enter, thereby serializing access to its code and preventing two concurrent threads from stepping on one another s toes.</span></span>

<span data-ttu-id="f0915-270">クラス レベル`SiteMapNode`変数`root`サイト マップ構造のキャッシュに使用します。</span><span class="sxs-lookup"><span data-stu-id="f0915-270">The class-level `SiteMapNode` variable `root` is used to cache the site map structure.</span></span> <span data-ttu-id="f0915-271">サイト マップが構築されている場合、最初に、または基になるデータが変更された後に初めて`root`なります`null`サイト マップ構造が作成されるとします。</span><span class="sxs-lookup"><span data-stu-id="f0915-271">When the site map is constructed for the first time, or for the first time after the underlying data has been modified, `root` will be `null` and the site map structure will be constructed.</span></span> <span data-ttu-id="f0915-272">サイト マップのルート ノードに割り当てられた`root`構築時にプロセスを次にこのメソッドが呼び出された`root`されません`null`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-272">The site map s root node is assigned to `root` during the construction process so that the next time this method is called, `root` will not be `null`.</span></span> <span data-ttu-id="f0915-273">その結果、限り`root`は`null`サイト マップ構造が再作成することがなく、呼び出し元に返されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-273">Consequently, so long as `root` is not `null` the site map structure will be returned to the caller without having to recreate it.</span></span>

<span data-ttu-id="f0915-274">ルートが場合`null`製品とカテゴリ情報からサイト マップ構造体を作成します。</span><span class="sxs-lookup"><span data-stu-id="f0915-274">If root is `null`, the site map structure is created from the product and category information.</span></span> <span data-ttu-id="f0915-275">作成することで、サイト マップが構築された、`SiteMapNode`インスタンスとしを呼び出すことで、階層を形成する、`StaticSiteMapProvider`クラスの`AddNode`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="f0915-275">The site map is built by creating the `SiteMapNode` instances and then forming the hierarchy through calls to the `StaticSiteMapProvider` class s `AddNode` method.</span></span> <span data-ttu-id="f0915-276">`AddNode` 格納する、さまざまな内部のブックキーピングを実行`SiteMapNode`のインスタンスにある、`Hashtable`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-276">`AddNode` performs the internal bookkeeping, storing the assorted `SiteMapNode` instances in a `Hashtable`.</span></span> <span data-ttu-id="f0915-277">まず、階層の構築を開始する前に、は、呼び出すことによって、`Clear`メソッドの内部からの要素を消去`Hashtable`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-277">Before we start constructing the hierarchy, we start by calling the `Clear` method, which clears out the elements from the internal `Hashtable`.</span></span> <span data-ttu-id="f0915-278">次に、`ProductsBLL`クラス s`GetProducts`メソッドおよび結果`ProductsDataTable`はローカル変数に格納します。</span><span class="sxs-lookup"><span data-stu-id="f0915-278">Next, the `ProductsBLL` class s `GetProducts` method and the resulting `ProductsDataTable` are stored in local variables.</span></span>

<span data-ttu-id="f0915-279">ルート ノードを作成してに割り当てることによって、サイト マップ s を構築を開始`root`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-279">The site map s construction begins by creating the root node and assigning it to `root`.</span></span> <span data-ttu-id="f0915-280">オーバー ロード、 [ `SiteMapNode` s のコンス トラクター](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx)ここで、ここで使用される`BuildSiteMap`は、次の情報に渡されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-280">The overload of the [`SiteMapNode` s constructor](https://msdn.microsoft.com/library/system.web.sitemapnode.sitemapnode.aspx) used here and throughout this `BuildSiteMap` is passed the following information:</span></span>

- <span data-ttu-id="f0915-281">サイト マップ プロバイダーへの参照を (`this`)。</span><span class="sxs-lookup"><span data-stu-id="f0915-281">A reference to the site map provider (`this`).</span></span>
- <span data-ttu-id="f0915-282">`SiteMapNode` S`Key`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-282">The `SiteMapNode` s `Key`.</span></span> <span data-ttu-id="f0915-283">これは、必須の値をそれぞれに一意にする必要があります`SiteMapNode`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-283">This required value must be unique for each `SiteMapNode`.</span></span>
- <span data-ttu-id="f0915-284">`SiteMapNode` S`Url`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-284">The `SiteMapNode` s `Url`.</span></span> <span data-ttu-id="f0915-285">`Url` オプションですが、指定した場合、それぞれが、 `SiteMapNode` s`Url`値は一意である必要があります。</span><span class="sxs-lookup"><span data-stu-id="f0915-285">`Url` is optional, but if provided, each `SiteMapNode` s `Url` value must be unique.</span></span>
- <span data-ttu-id="f0915-286">`SiteMapNode` S`Title`に必要になります。</span><span class="sxs-lookup"><span data-stu-id="f0915-286">The `SiteMapNode` s `Title`, which is required.</span></span>

<span data-ttu-id="f0915-287">`AddNode(root)`メソッドの呼び出しを追加、 `SiteMapNode` `root`ルートとしてサイト マップにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-287">The `AddNode(root)` method call adds the `SiteMapNode` `root` to the site map as the root.</span></span> <span data-ttu-id="f0915-288">次に、各`ProductRow`で、`ProductsDataTable`列挙されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-288">Next, each `ProductRow` in the `ProductsDataTable` is enumerated.</span></span> <span data-ttu-id="f0915-289">場合は既に存在する`SiteMapNode`現在の製品のカテゴリの参照されています。</span><span class="sxs-lookup"><span data-stu-id="f0915-289">If there already exists a `SiteMapNode` for the current product s category, it is referenced.</span></span> <span data-ttu-id="f0915-290">それ以外の場合、新しい`SiteMapNode`カテゴリが作成され、追加の子として、`SiteMapNode``root`を通じて、`AddNode(categoryNode, root)`メソッドの呼び出しです。</span><span class="sxs-lookup"><span data-stu-id="f0915-290">Otherwise, a new `SiteMapNode` for the category is created and added as a child of the `SiteMapNode``root` through the `AddNode(categoryNode, root)` method call.</span></span> <span data-ttu-id="f0915-291">適切なカテゴリの後に`SiteMapNode`ノードが見つからないか、作成された、`SiteMapNode`が、現在の製品作成され、カテゴリの子として追加`SiteMapNode`を介して`AddNode(productNode, categoryNode)`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-291">After the appropriate category `SiteMapNode` node has been found or created, a `SiteMapNode` is created for the current product and added as a child of the category `SiteMapNode` via `AddNode(productNode, categoryNode)`.</span></span> <span data-ttu-id="f0915-292">注意してください、カテゴリ`SiteMapNode`s`Url`プロパティの値が`~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID`製品を while `SiteMapNode` s`Url`プロパティが割り当てられている`~/SiteMapNode/ProductDetails.aspx?ProductID=productID`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-292">Note that the category `SiteMapNode` s `Url` property value is `~/SiteMapProvider/ProductsByCategory.aspx?CategoryID=categoryID` while the product `SiteMapNode` s `Url` property is assigned `~/SiteMapNode/ProductDetails.aspx?ProductID=productID`.</span></span>

> [!NOTE]
> <span data-ttu-id="f0915-293">データベースが存在している製品`NULL`値をその`CategoryID`、カテゴリの下でグループ化`SiteMapNode`が`Title`プロパティが None およびに設定`Url`プロパティが空の文字列に設定します。</span><span class="sxs-lookup"><span data-stu-id="f0915-293">Those products that have a database `NULL` value for their `CategoryID` are grouped under a category `SiteMapNode` whose `Title` property is set to None and whose `Url` property is set to an empty string.</span></span> <span data-ttu-id="f0915-294">設定することにしました`Url`から空の文字列を`ProductBLL`クラス s`GetProductsByCategory(categoryID)`メソッドを返すには、これらの製品と機能を現在がない、 `NULL` `CategoryID`値。</span><span class="sxs-lookup"><span data-stu-id="f0915-294">I decided to set `Url` to an empty string since the `ProductBLL` class s `GetProductsByCategory(categoryID)` method currently lacks the capability to return just those products with a `NULL` `CategoryID` value.</span></span> <span data-ttu-id="f0915-295">また、ナビゲーション コントロールの表示方法を示すたい、`SiteMapNode`の値が不足しているその`Url`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="f0915-295">Also, I wanted to demonstrate how the navigation controls render a `SiteMapNode` that lacks a value for its `Url` property.</span></span> <span data-ttu-id="f0915-296">このチュートリアルを拡張することをお勧めできるように、None `SiteMapNode` s`Url`プロパティが指す`ProductsByCategory.aspx`の製品をまだのみが表示されます`NULL``CategoryID`値。</span><span class="sxs-lookup"><span data-stu-id="f0915-296">I encourage you to extend this tutorial so that the None `SiteMapNode` s `Url` property points to `ProductsByCategory.aspx`, yet only displays the products with `NULL` `CategoryID` values.</span></span>


<span data-ttu-id="f0915-297">サイト マップを構築した後で、SQL キャッシュ依存関係を使用して、データ キャッシュに任意のオブジェクトが追加、`Categories`と`Products`テーブルを介して、`AggregateCacheDependency`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="f0915-297">After constructing the site map, an arbitrary object is added to the data cache using a SQL cache dependency on the `Categories` and `Products` tables through an `AggregateCacheDependency` object.</span></span> <span data-ttu-id="f0915-298">前のチュートリアルでの SQL キャッシュ依存関係の使用を検討お*を使用して SQL キャッシュ依存関係*です。</span><span class="sxs-lookup"><span data-stu-id="f0915-298">We explored using SQL cache dependencies in the preceding tutorial, *Using SQL Cache Dependencies*.</span></span> <span data-ttu-id="f0915-299">カスタム サイト マップ プロバイダーは、ただし、データ キャッシュ s のオーバー ロードを使用`Insert`メソッド私たちを探索するには、まだしました。</span><span class="sxs-lookup"><span data-stu-id="f0915-299">The custom site map provider, however, uses an overload of the data cache s `Insert` method that we ve yet to explore.</span></span> <span data-ttu-id="f0915-300">このオーバー ロードは、その最後の入力パラメーターとして、オブジェクトがキャッシュから削除されたときに呼び出されるデリゲートを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="f0915-300">This overload accepts as its final input parameter a delegate that is called when the object is removed from the cache.</span></span> <span data-ttu-id="f0915-301">具体的には、新規の渡します[`CacheItemRemovedCallback`委任](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx)を指す、`OnSiteMapChanged`メソッド定義の下、`NorthwindSiteMapProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="f0915-301">Specifically, we pass in a new [`CacheItemRemovedCallback` delegate](https://msdn.microsoft.com/library/system.web.caching.cacheitemremovedcallback.aspx) that points to the `OnSiteMapChanged` method defined further down in the `NorthwindSiteMapProvider` class.</span></span>

> [!NOTE]
> <span data-ttu-id="f0915-302">クラス レベルの変数を介してサイト マップのメモリ内表現がキャッシュされる`root`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-302">The in-memory representation of the site map is cached through the class-level variable `root`.</span></span> <span data-ttu-id="f0915-303">Web アプリケーションでそのインスタンスはすべてのスレッド間で共有されているためと、カスタムのサイト マップ プロバイダー クラスのインスタンスを 1 つだけなので、このクラスの変数は、キャッシュとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f0915-303">Since there is only one instance of the custom site map provider class and since that instance is shared among all threads in the web application, this class variable serves as a cache.</span></span> <span data-ttu-id="f0915-304">`BuildSiteMap`メソッドは、データベースでデータを基になるときに通知を受信するための手段としてのみ、データ キャッシュを使用するも、`Categories`または`Products`テーブルを変更します。</span><span class="sxs-lookup"><span data-stu-id="f0915-304">The `BuildSiteMap` method also uses the data cache, but only as a means to receive notification when the underlying database data in the `Categories` or `Products` tables changes.</span></span> <span data-ttu-id="f0915-305">データ キャッシュに格納値が現在の日付と時刻だけであることを注意してください。</span><span class="sxs-lookup"><span data-stu-id="f0915-305">Note that the value put into the data cache is just the current date and time.</span></span> <span data-ttu-id="f0915-306">実際のサイト マップ データが*いない*をデータ キャッシュに格納します。</span><span class="sxs-lookup"><span data-stu-id="f0915-306">The actual site map data is *not* put in the data cache.</span></span>


<span data-ttu-id="f0915-307">`BuildSiteMap`メソッドは、サイト マップのルート ノードを返すことによって完了するとします。</span><span class="sxs-lookup"><span data-stu-id="f0915-307">The `BuildSiteMap` method completes by returning the root node of the site map.</span></span>

<span data-ttu-id="f0915-308">残りのメソッドは、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="f0915-308">The remaining methods are fairly straightforward.</span></span> <span data-ttu-id="f0915-309">`GetRootNodeCore` ルート ノードを返すことを担当します。</span><span class="sxs-lookup"><span data-stu-id="f0915-309">`GetRootNodeCore` is responsible for returning the root node.</span></span> <span data-ttu-id="f0915-310">`BuildSiteMap` 、ルートを返します`GetRootNodeCore`を単純に返します`BuildSiteMap`s が値を返します。</span><span class="sxs-lookup"><span data-stu-id="f0915-310">Since `BuildSiteMap` returns the root, `GetRootNodeCore` simply returns `BuildSiteMap` s return value.</span></span> <span data-ttu-id="f0915-311">`OnSiteMapChanged`メソッドのセット`root`に`null`キャッシュ項目が削除されたとき。</span><span class="sxs-lookup"><span data-stu-id="f0915-311">The `OnSiteMapChanged` method sets `root` back to `null` when the cache item is removed.</span></span> <span data-ttu-id="f0915-312">ルートのセットに戻すと`null`、次回`BuildSiteMap`が呼び出されると、サイト マップ構造が再構築されます。</span><span class="sxs-lookup"><span data-stu-id="f0915-312">With root set back to `null`, the next time `BuildSiteMap` is invoked, the site map structure will be rebuilt.</span></span> <span data-ttu-id="f0915-313">最後に、`CachedDate`プロパティは、このような値が存在する場合に、データ キャッシュに格納されている日付と時刻の値を返します。</span><span class="sxs-lookup"><span data-stu-id="f0915-313">Lastly, the `CachedDate` property returns the date and time value stored in the data cache, if such a value exists.</span></span> <span data-ttu-id="f0915-314">このプロパティは、サイト マップ データが最後にキャッシュされてを確認 ページの開発者によって使用できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-314">This property can be used by a page developer to determine when the site map data was last cached.</span></span>

## <a name="step-7-registering-thenorthwindsitemapprovider"></a><span data-ttu-id="f0915-315">手順 7: 登録します`NorthwindSiteMapProvider`</span><span class="sxs-lookup"><span data-stu-id="f0915-315">Step 7: Registering the`NorthwindSiteMapProvider`</span></span>

<span data-ttu-id="f0915-316">使用するように web アプリケーションの順序で、`NorthwindSiteMapProvider`手順 6 で作成したサイト マップ プロバイダーに登録する必要があります、`<siteMap>`のセクション`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-316">In order for our web application to use the `NorthwindSiteMapProvider` site map provider created in Step 6, we need to register it in the `<siteMap>` section of `Web.config`.</span></span> <span data-ttu-id="f0915-317">具体的には、内で次のマークアップを追加、`<system.web>`内の要素`Web.config`:</span><span class="sxs-lookup"><span data-stu-id="f0915-317">Specifically, add the following markup within the `<system.web>` element in `Web.config`:</span></span>


[!code-xml[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample7.xml)]

<span data-ttu-id="f0915-318">このマークアップは次の 2 つ: ことを示して最初に、組み込み`AspNetXmlSiteMapProvider`既定のサイト マップ プロバイダーは、次に、Northwind のわかりやすい名前を持つ手順 6 で作成したカスタムのサイト マップ プロバイダーを登録します。</span><span class="sxs-lookup"><span data-stu-id="f0915-318">This markup does two things: first, it indicates that the built-in `AspNetXmlSiteMapProvider` is the default site map provider; second, it registers the custom site map provider created in Step 6 with the human-friendly name Northwind .</span></span>

> [!NOTE]
> <span data-ttu-id="f0915-319">アプリケーション %s にあるサイト マップ プロバイダー`App_Code`フォルダーの値、`type`属性は、単純なクラス名。</span><span class="sxs-lookup"><span data-stu-id="f0915-319">For site map providers located in the application s `App_Code` folder, the value of the `type` attribute is simply the class name.</span></span> <span data-ttu-id="f0915-320">また、カスタムのサイト マップ プロバイダーでしたで作成されている、別のクラス ライブラリ プロジェクトで、コンパイルされたアセンブリに web アプリケーションの配置`/Bin`ディレクトリ。</span><span class="sxs-lookup"><span data-stu-id="f0915-320">Alternatively, the custom site map provider could have been created in a separate Class Library project with the compiled assembly placed in the web application s `/Bin` directory.</span></span> <span data-ttu-id="f0915-321">その場合は、`type`属性値になります*Namespace*.*ClassName*、 *AssemblyName*です。</span><span class="sxs-lookup"><span data-stu-id="f0915-321">In that case, the `type` attribute value would be *Namespace*.*ClassName*, *AssemblyName* .</span></span>


<span data-ttu-id="f0915-322">更新した後に`Web.config`、すぐをブラウザーで、チュートリアルから任意のページを表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-322">After updating `Web.config`, take a moment to view any page from the tutorials in a browser.</span></span> <span data-ttu-id="f0915-323">左側のナビゲーション インターフェイスであっても、セクションでは、およびチュートリアルがで定義されていることに注意してください`Web.sitemap`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-323">Note that the navigation interface on the left still shows the sections and tutorials defined in `Web.sitemap`.</span></span> <span data-ttu-id="f0915-324">これは、ので`AspNetXmlSiteMapProvider`既定のプロバイダーとして。</span><span class="sxs-lookup"><span data-stu-id="f0915-324">This is because we left `AspNetXmlSiteMapProvider` as the default provider.</span></span> <span data-ttu-id="f0915-325">使用するナビゲーション ユーザー インターフェイス要素を作成するために、 `NorthwindSiteMapProvider`Northwind のサイト マップ プロバイダーを使用することを明示的に指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f0915-325">In order to create a navigation user interface element that uses the `NorthwindSiteMapProvider`, we'll need to explicitly specify that the Northwind site map provider should be used.</span></span> <span data-ttu-id="f0915-326">手順 8 で実行する方法を会いしましょう。</span><span class="sxs-lookup"><span data-stu-id="f0915-326">We'll see how to accomplish this in Step 8.</span></span>

## <a name="step-8-displaying-site-map-information-using-the-custom-site-map-provider"></a><span data-ttu-id="f0915-327">手順 8: カスタムのサイト マップ プロバイダーを使用してサイト マップ情報を表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-327">Step 8: Displaying Site Map Information Using the Custom Site Map Provider</span></span>

<span data-ttu-id="f0915-328">サイトとのカスタム マップ プロバイダーが作成されで登録`Web.config`、おナビゲーション コントロールを追加する準備ができたら、 `Default.aspx`、 `ProductsByCategory.aspx`、および`ProductDetails.aspx`内のページ、`SiteMapProvider`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="f0915-328">With the custom site map provider created and registered in `Web.config`, we re ready to add navigation controls to the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="f0915-329">開いて開始、`Default.aspx`ページし、ドラッグ、`SiteMapPath`ツールボックスからデザイナーにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-329">Start by opening the `Default.aspx` page and drag a `SiteMapPath` from the Toolbox onto the Designer.</span></span> <span data-ttu-id="f0915-330">サイト マップ パス コントロールは、ツールボックスの [ナビゲーション] セクションにあります。</span><span class="sxs-lookup"><span data-stu-id="f0915-330">The SiteMapPath control is located in the Navigation section of the Toolbox.</span></span>


<span data-ttu-id="f0915-331">[![Default.aspx に、サイト マップ パスを追加します。](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span><span class="sxs-lookup"><span data-stu-id="f0915-331">[![Add a SiteMapPath to Default.aspx](building-a-custom-database-driven-site-map-provider-cs/_static/image19.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image18.gif)</span></span>

<span data-ttu-id="f0915-332">**図 16**: 追加するサイト マップ パス`Default.aspx`([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span><span class="sxs-lookup"><span data-stu-id="f0915-332">**Figure 16**: Add a SiteMapPath to `Default.aspx` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image20.gif))</span></span>


<span data-ttu-id="f0915-333">サイト マップ パス コントロールは、サイト マップ内で現在のページ s の位置を示す、階層リンクを表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-333">The SiteMapPath control displays a breadcrumb, indicating the current page s location within the site map.</span></span> <span data-ttu-id="f0915-334">マスター ページの上部に、サイト マップ パスを追加おに戻り、*マスター ページとサイト ナビゲーション*チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="f0915-334">We added a SiteMapPath to the top of the master page back in the *Master Pages and Site Navigation* tutorial.</span></span>

<span data-ttu-id="f0915-335">ブラウザーからこのページを表示するのにはしばらくを実行します。</span><span class="sxs-lookup"><span data-stu-id="f0915-335">Take a moment to view this page through a browser.</span></span> <span data-ttu-id="f0915-336">図 16 で追加サイト マップ パス プロバイダーを使用して、デフォルト サイト マップ、そのデータを抽出`Web.sitemap`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-336">The SiteMapPath added in Figure 16 uses the default site map provider, pulling its data from `Web.sitemap`.</span></span> <span data-ttu-id="f0915-337">したがって、ある階層リンクを示しますホーム&gt;右上隅にある階層リンクと同じように、サイト マップをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="f0915-337">Therefore, the breadcrumb shows Home &gt; Customizing the Site Map, just like the breadcrumb in the upper-right corner.</span></span>


<span data-ttu-id="f0915-338">[![ある階層リンクが既定のサイト マップ プロバイダーを使用します。](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span><span class="sxs-lookup"><span data-stu-id="f0915-338">[![The Breadcrumb Uses the Default Site Map Provider](building-a-custom-database-driven-site-map-provider-cs/_static/image22.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.gif)</span></span>

<span data-ttu-id="f0915-339">**図 17**: 階層リンク プロバイダーを使用して、既定のサイト マップ ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span><span class="sxs-lookup"><span data-stu-id="f0915-339">**Figure 17**: The Breadcrumb Uses the Default Site Map Provider ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image23.gif))</span></span>


<span data-ttu-id="f0915-340">サイト マップ パス図 16 の追加手順 6 で作成したカスタムのサイト マップ プロバイダーを使用するのには、次のように設定します。 その[`SiteMapProvider`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx)、northwind データベースを名前おに割り当てられている、`NorthwindSiteMapProvider`で`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-340">To have the SiteMapPath added in Figure 16 use the custom site map provider we created in Step 6, set its [`SiteMapProvider` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sitemappath.sitemapprovider.aspx) to Northwind, the name we assigned to the `NorthwindSiteMapProvider` in `Web.config`.</span></span> <span data-ttu-id="f0915-341">残念ながら、デザイナーが既定のサイト マップ プロバイダーを使用し続けますが、場合、このプロパティの変更を行った後、ブラウザーからページを参照してください階層リンクは、カスタムのサイト マップ プロバイダーを今すぐ使用も表示します。</span><span class="sxs-lookup"><span data-stu-id="f0915-341">Unfortunately, the Designer continues to use the default site map provider, but if you visit the page through a browser after making this property change you'll see that the breadcrumb now uses the custom site map provider.</span></span>


<span data-ttu-id="f0915-342">[![ある階層リンクはカスタムのサイト マップ プロバイダー NorthwindSiteMapProvider を使用するようになりました](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span><span class="sxs-lookup"><span data-stu-id="f0915-342">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image25.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image24.gif)</span></span>

<span data-ttu-id="f0915-343">**図 18**: 階層リンクは、カスタムのサイト マップ プロバイダーを使用するようになりました`NorthwindSiteMapProvider`([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span><span class="sxs-lookup"><span data-stu-id="f0915-343">**Figure 18**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image26.gif))</span></span>


<span data-ttu-id="f0915-344">サイト マップ パス コントロールでより機能的ユーザー インターフェイスを表示、`ProductsByCategory.aspx`と`ProductDetails.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="f0915-344">The SiteMapPath control displays a more functional user interface in the `ProductsByCategory.aspx` and `ProductDetails.aspx` pages.</span></span> <span data-ttu-id="f0915-345">これらのページは、設定に、サイト マップ パスを追加、`SiteMapProvider`を Northwind に両方のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="f0915-345">Add a SiteMapPath to these pages, setting the `SiteMapProvider` property in both to Northwind.</span></span> <span data-ttu-id="f0915-346">`Default.aspx`飲み物の製品の表示のリンクとチャイの詳細を表示するリンクし をクリックします。</span><span class="sxs-lookup"><span data-stu-id="f0915-346">From `Default.aspx` click on the View Products link for Beverages, and then on the View Details link for Chai Tea.</span></span> <span data-ttu-id="f0915-347">現在のサイト マップ セクション (チャイ) とその先祖が階層リンクに含まれています図 19 に示す: Beverages とすべてのカテゴリ。</span><span class="sxs-lookup"><span data-stu-id="f0915-347">As Figure 19 shows, the breadcrumb includes the current site map section ( Chai Tea ) and its ancestors: Beverages and All Categories .</span></span>


<span data-ttu-id="f0915-348">[![ある階層リンクはカスタムのサイト マップ プロバイダー NorthwindSiteMapProvider を使用するようになりました](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="f0915-348">[![The Breadcrumb Now Uses the Custom Site Map Provider NorthwindSiteMapProvider](building-a-custom-database-driven-site-map-provider-cs/_static/image27.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image21.png)</span></span>

<span data-ttu-id="f0915-349">**図 19**: 階層リンクは、カスタムのサイト マップ プロバイダーを使用するようになりました`NorthwindSiteMapProvider`([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="f0915-349">**Figure 19**: The Breadcrumb Now Uses the Custom Site Map Provider `NorthwindSiteMapProvider` ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image22.png))</span></span>


<span data-ttu-id="f0915-350">メニューと TreeView コントロールなどサイト マップ パスだけでなく、他のナビゲーションのユーザー インターフェイス要素を使用できます。</span><span class="sxs-lookup"><span data-stu-id="f0915-350">Other navigation user interface elements can be used in addition to the SiteMapPath, such as the Menu and TreeView controls.</span></span> <span data-ttu-id="f0915-351">`Default.aspx`、 `ProductsByCategory.aspx`、および`ProductDetails.aspx`このチュートリアルでは、たとえば、ダウンロードのページにはすべてが含まれてメニュー コントロールが (図 20 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="f0915-351">The `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages in the download for this tutorial, for example, all include Menu controls (see Figure 20).</span></span> <span data-ttu-id="f0915-352">参照してください[ASP.NET 2.0 の検査 s サイト ナビゲーション機能](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)と[サイト ナビゲーション コントロールを使用した](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx)のセクションで、 [ASP.NET 2.0 のクイック スタート](https://quickstarts.asp.net/QuickStartv20/aspnet/)をより詳しく用、ナビゲーション コントロールとサイト システムで ASP.NET 2.0 をマップします。</span><span class="sxs-lookup"><span data-stu-id="f0915-352">See [Examining ASP.NET 2.0 s Site Navigation Features](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx) and the [Using Site Navigation Controls](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/navigation/sitenavcontrols.aspx) section of the [ASP.NET 2.0 QuickStarts](https://quickstarts.asp.net/QuickStartv20/aspnet/) for a more in-depth look at the navigation controls and site map system in ASP.NET 2.0.</span></span>


<span data-ttu-id="f0915-353">[![メニュー コントロールには、各分類と製品の一覧表示します。](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span><span class="sxs-lookup"><span data-stu-id="f0915-353">[![The Menu Control Lists Each of the Categories and Products](building-a-custom-database-driven-site-map-provider-cs/_static/image29.gif)](building-a-custom-database-driven-site-map-provider-cs/_static/image28.gif)</span></span>

<span data-ttu-id="f0915-354">**図 20**:、メニュー コントロールを一覧表示各分類と製品の ([フルサイズのイメージを表示するをクリックして](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span><span class="sxs-lookup"><span data-stu-id="f0915-354">**Figure 20**: The Menu Control Lists Each of the Categories and Products ([Click to view full-size image](building-a-custom-database-driven-site-map-provider-cs/_static/image30.gif))</span></span>


<span data-ttu-id="f0915-355">ようにすると、このチュートリアルで前に、サイト マップ構造体をプログラムでを介してアクセスできます、`SiteMap`クラスです。</span><span class="sxs-lookup"><span data-stu-id="f0915-355">As mentioned earlier in this tutorial, the site map structure can be accessed programmatically through the `SiteMap` class.</span></span> <span data-ttu-id="f0915-356">次のコードは、ルートを返します`SiteMapNode`既定のプロバイダーの。</span><span class="sxs-lookup"><span data-stu-id="f0915-356">The following code returns the root `SiteMapNode` of the default provider:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample8.cs)]

<span data-ttu-id="f0915-357">以降、`AspNetXmlSiteMapProvider`は、既定のプロバイダーのアプリケーションでは、上記のコードで定義されているルート ノードを返します`Web.sitemap`です。</span><span class="sxs-lookup"><span data-stu-id="f0915-357">Since the `AspNetXmlSiteMapProvider` is the default provider for our application, the above code would return the root node defined in `Web.sitemap`.</span></span> <span data-ttu-id="f0915-358">既定以外のサイト マップ プロバイダーを参照するには、使用、`SiteMap`クラス s [ `Providers`プロパティ](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx)次のようにします。</span><span class="sxs-lookup"><span data-stu-id="f0915-358">To reference a site map provider other than the default, use the `SiteMap` class s [`Providers` property](https://msdn.microsoft.com/library/system.web.sitemap.providers.aspx) like so:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample9.cs)]

<span data-ttu-id="f0915-359">ここで*名前*カスタム サイト マップ プロバイダー (Northwind、web アプリケーション) の名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="f0915-359">Where *name* is the name of the custom site map provider ( Northwind, for our web application).</span></span>

<span data-ttu-id="f0915-360">サイト マップ プロバイダーに固有のメンバーにアクセスする`SiteMap.Providers["name"]`プロバイダーのインスタンスを取得し、適切な型にキャストします。</span><span class="sxs-lookup"><span data-stu-id="f0915-360">To access a member specific to a site map provider, use `SiteMap.Providers["name"]` to retrieve the provider instance and then cast it to the appropriate type.</span></span> <span data-ttu-id="f0915-361">例については、表示する、 `NorthwindSiteMapProvider` s `CachedDate` ASP.NET ページ内のプロパティは、次のコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="f0915-361">For example, to display the `NorthwindSiteMapProvider` s `CachedDate` property in an ASP.NET page, use the following code:</span></span>


[!code-csharp[Main](building-a-custom-database-driven-site-map-provider-cs/samples/sample10.cs)]

> [!NOTE]
> <span data-ttu-id="f0915-362">SQL キャッシュ依存関係の機能をテストすることを確認します。</span><span class="sxs-lookup"><span data-stu-id="f0915-362">Be sure to test out the SQL cache dependency feature.</span></span> <span data-ttu-id="f0915-363">アクセスした後、 `Default.aspx`、 `ProductsByCategory.aspx`、および`ProductDetails.aspx`ページが編集、挿入、および削除」セクションのチュートリアルは、のいずれかに移動し、カテゴリまたは製品の名前を編集します。</span><span class="sxs-lookup"><span data-stu-id="f0915-363">After visiting the `Default.aspx`, `ProductsByCategory.aspx`, and `ProductDetails.aspx` pages, go to one of the tutorials in the Editing, Inserting, and Deleting section and edit the name of a category or product.</span></span> <span data-ttu-id="f0915-364">内のページのいずれかに戻ります、`SiteMapProvider`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="f0915-364">Then return to one of the pages in the `SiteMapProvider` folder.</span></span> <span data-ttu-id="f0915-365">ポーリング機構の基になるデータベースに変更を確認するための十分な時間が経過した場合、サイト マップは、新しい製品またはカテゴリの名前を表示を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="f0915-365">Assuming enough time has passed for the polling mechanism to note the change to the underlying database, the site map should be updated to show the new product or category name.</span></span>


## <a name="summary"></a><span data-ttu-id="f0915-366">まとめ</span><span class="sxs-lookup"><span data-stu-id="f0915-366">Summary</span></span>

<span data-ttu-id="f0915-367">ASP.NET 2.0 のサイト マップ機能が含まれています、`SiteMap`クラス、組み込みのナビゲーション Web の数を制御、およびサイト マップ情報が必要ですが、既定サイト マップ プロバイダーが XML ファイルに保存します。</span><span class="sxs-lookup"><span data-stu-id="f0915-367">ASP.NET 2.0 s site map features includes a `SiteMap` class, a number of built-in navigation Web controls, and a default site map provider that expects the site map information persisted to an XML file.</span></span> <span data-ttu-id="f0915-368">データベースからなど、他のソースからサイト マップ情報を使用するために、アプリケーションのアーキテクチャまたはカスタムのサイトを作成する必要があります、リモート Web サービス プロバイダーをマップします。</span><span class="sxs-lookup"><span data-stu-id="f0915-368">In order to use site map information from some other source such as from a database, the application s architecture, or a remote Web service we need to create a custom site map provider.</span></span> <span data-ttu-id="f0915-369">直接的または間接的に派生するクラスを作成する必要がありますから、`SiteMapProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="f0915-369">This involves creating a class that derives, directly or indirectly, from the `SiteMapProvider` class.</span></span>

<span data-ttu-id="f0915-370">このチュートリアルでは、サイト マップをアプリケーションのアーキテクチャの製品と分類の情報に基づくカスタム サイト マップ プロバイダーを作成する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="f0915-370">In this tutorial we saw how to create a custom site map provider that based the site map on the product and category information culled from the application architecture.</span></span> <span data-ttu-id="f0915-371">拡張、プロバイダー、`StaticSiteMapProvider`クラスと作成に含まれる、`BuildSiteMap`データを取得するメソッドがサイト マップの階層を構築し、クラス レベルの変数に結果の構造をキャッシュします。</span><span class="sxs-lookup"><span data-stu-id="f0915-371">Our provider extended the `StaticSiteMapProvider` class and entailed creating a `BuildSiteMap` method that retrieved the data, constructed the site map hierarchy, and cached the resulting structure in a class-level variable.</span></span> <span data-ttu-id="f0915-372">コールバック関数で SQL キャッシュ依存関係を使用して、キャッシュが無効になるに構成するときに、基になる`Categories`または`Products`データが変更されました。</span><span class="sxs-lookup"><span data-stu-id="f0915-372">We used a SQL cache dependency with a callback function to invalidate the cached structure when the underlying `Categories` or `Products` data is modified.</span></span>

<span data-ttu-id="f0915-373">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="f0915-373">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="f0915-374">関連項目</span><span class="sxs-lookup"><span data-stu-id="f0915-374">Further Reading</span></span>

<span data-ttu-id="f0915-375">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="f0915-375">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- <span data-ttu-id="f0915-376">[SQL Server でのサイト マップを格納する](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/)と[SQL サイト マップ プロバイダーしている待機](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span><span class="sxs-lookup"><span data-stu-id="f0915-376">[Storing Site Maps in SQL Server](https://msdn.microsoft.com/msdnmag/issues/05/06/WickedCode/) and [The SQL Site Map Provider You ve Been Waiting For](https://msdn.microsoft.com/msdnmag/issues/06/02/wickedcode/default.aspx)</span></span>
- [<span data-ttu-id="f0915-377">ASP.NET 2.0 を見てのプロバイダー モデルします。</span><span class="sxs-lookup"><span data-stu-id="f0915-377">A Look at ASP.NET 2.0 s Provider Model</span></span>](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)
- [<span data-ttu-id="f0915-378">プロバイダー ツールキット</span><span class="sxs-lookup"><span data-stu-id="f0915-378">The Provider Toolkit</span></span>](https://msdn.microsoft.com/asp.net/aa336558.aspx)
- [<span data-ttu-id="f0915-379">ASP.NET 2.0 を調べて s サイト ナビゲーション機能</span><span class="sxs-lookup"><span data-stu-id="f0915-379">Examining ASP.NET 2.0 s Site Navigation Features</span></span>](http://aspnet.4guysfromrolla.com/articles/111605-1.aspx)

## <a name="about-the-author"></a><span data-ttu-id="f0915-380">作成者について</span><span class="sxs-lookup"><span data-stu-id="f0915-380">About the Author</span></span>

<span data-ttu-id="f0915-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="f0915-381">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f0915-382">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="f0915-382">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f0915-383">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-383">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f0915-384">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="f0915-384">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f0915-385">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="f0915-385">Special Thanks To</span></span>

<span data-ttu-id="f0915-386">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="f0915-386">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f0915-387">このチュートリアルの潜在顧客レビュー担当者は、Dave ガードナー、Zack Jones、Teresa マーフィー、および「社長補佐 Leigh でした。</span><span class="sxs-lookup"><span data-stu-id="f0915-387">Lead reviewers for this tutorial were Dave Gardner, Zack Jones, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="f0915-388">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="f0915-388">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f0915-389">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f0915-389">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="f0915-390">次へ</span><span class="sxs-lookup"><span data-stu-id="f0915-390">Next</span></span>](building-a-custom-database-driven-site-map-provider-vb.md)
