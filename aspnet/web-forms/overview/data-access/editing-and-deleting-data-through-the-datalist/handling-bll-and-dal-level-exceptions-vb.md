---
uid: web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
title: BLL および DAL レベル例外 (VB) の処理 |Microsoft ドキュメント
author: rick-anderson
description: このチュートリアルでは、もらえるように編集可能な DataList の更新ワークフロー内で発生した例外を処理する方法が表示されます。
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/30/2006
ms.topic: article
ms.assetid: ca665073-b379-4239-9404-f597663ca65e
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-and-deleting-data-through-the-datalist/handling-bll-and-dal-level-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: 0ee0eeff08b6ba490b401540de833eecd7122a17
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
---
<a name="handling-bll--and-dal-level-exceptions-vb"></a><span data-ttu-id="5e2fe-103">BLL および DAL レベル例外 (VB) の処理</span><span class="sxs-lookup"><span data-stu-id="5e2fe-103">Handling BLL- and DAL-Level Exceptions (VB)</span></span>
====================
<span data-ttu-id="5e2fe-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="5e2fe-105">[サンプル アプリをダウンロード](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe)または[PDF のダウンロード](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_38_VB.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-vb/_static/datatutorial38vb1.pdf)</span></span>

> <span data-ttu-id="5e2fe-106">このチュートリアルでは、もらえるように編集可能な DataList の更新ワークフロー内で発生した例外を処理する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-106">In this tutorial, we'll see how to tactfully handle exceptions raised during an editable DataList's updating workflow.</span></span>


## <a name="introduction"></a><span data-ttu-id="5e2fe-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="5e2fe-107">Introduction</span></span>

<span data-ttu-id="5e2fe-108">[DataList でのデータの削除と編集の概要](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md)チュートリアルでは、単純な編集と削除機能を提供する DataList を作成しました。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-108">In the [Overview of Editing and Deleting Data in the DataList](an-overview-of-editing-and-deleting-data-in-the-datalist-cs.md) tutorial, we created a DataList that offered simple editing and deleting capabilities.</span></span> <span data-ttu-id="5e2fe-109">完全に機能が、編集するときに発生したエラーとほとんどわかりやすいやプロセスを削除すると、ハンドルされない例外が発生しました。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-109">While fully functional, it was hardly user-friendly, as any error that occurred during the editing or deleting process resulted in an unhandled exception.</span></span> <span data-ttu-id="5e2fe-110">たとえば、s の製品名を省略することや、製品を編集するときは、非常に価格値を入力する手頃な価格!、例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-110">For example, omitting the product s name or, when editing a product, entering a price value of Very affordable!, throws an exception.</span></span> <span data-ttu-id="5e2fe-111">コードでこの例外がキャッチされないので、web ページで、s の例外の詳細を表示する ASP.NET ランタイムまでバブルします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-111">Since this exception is not caught in code, it bubbles up to the ASP.NET runtime, which then displays the exception s details in the web page.</span></span>

<span data-ttu-id="5e2fe-112">説明したとおり、[処理 BLL-DAL レベルでの例外および ASP.NET ページ](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md)チュートリアルでは、ビジネス ロジックまたはデータ アクセス層の深さから例外が発生した場合、例外の詳細が返されます、ObjectDataSource とGridView にし。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-112">As we saw in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs.md) tutorial, if an exception is raised from the depths of the Business Logic or Data Access Layers, the exception details are returned to the ObjectDataSource and then to the GridView.</span></span> <span data-ttu-id="5e2fe-113">これらの例外を作成することで適切に処理する方法を説明しました`Updated`または`RowUpdated`ObjectDataSource、GridView、例外を確認し、例外が処理されたことを示す用のイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-113">We saw how to gracefully handle these exceptions by creating `Updated` or `RowUpdated` event handlers for the ObjectDataSource or GridView, checking for an exception, and then indicating that the exception was handled.</span></span>

<span data-ttu-id="5e2fe-114">DataList チュートリアル、ただし、データ更新および削除による、ObjectDataSource は t です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-114">Our DataList tutorials, however, aren t using the ObjectDataSource for updating and deleting data.</span></span> <span data-ttu-id="5e2fe-115">代わりに、BLL に対して直接動作しています。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-115">Instead, we are working directly against the BLL.</span></span> <span data-ttu-id="5e2fe-116">BLL または DAL から送信された例外を検出するためには、例外処理、ASP.NET ページの分離コード内でコードを実装する必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-116">In order to detect exceptions originating from the BLL or DAL, we need to implement exception handling code within the code-behind of our ASP.NET page.</span></span> <span data-ttu-id="5e2fe-117">このチュートリアルよりもらえるように編集可能な DataList のワークフローを更新中に発生した例外を処理する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-117">In this tutorial, we'll see how to more tactfully handle exceptions raised during an editable DataList s updating workflow.</span></span>

> [!NOTE]
> <span data-ttu-id="5e2fe-118">*編集の概要と、DataList のデータを削除する*を更新するため、ObjectDataSource を使用する必要を編集して、DataList からデータを削除するさまざまな手法を説明したチュートリアルでは、いくつかのテクニックと削除しています。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-118">In the *An Overview of Editing and Deleting Data in the DataList* tutorial we discussed different techniques for editing and deleting data from the DataList, Some techniques involved using an ObjectDataSource for updating and deleting.</span></span> <span data-ttu-id="5e2fe-119">これらの手法を採用する場合は、ObjectDataSource s を通じた BLL または DAL から例外を処理することができます`Updated`または`Deleted`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-119">If you employ these techniques, you can handle exceptions from the BLL or DAL through the ObjectDataSource s `Updated` or `Deleted` event handlers.</span></span>


## <a name="step-1-creating-an-editable-datalist"></a><span data-ttu-id="5e2fe-120">手順 1: 作成、編集可能な DataList</span><span class="sxs-lookup"><span data-stu-id="5e2fe-120">Step 1: Creating an Editable DataList</span></span>

<span data-ttu-id="5e2fe-121">更新のワークフローの中に発生する例外処理と心配、前に、最初に作成、編集可能な DataList s を使用できます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-121">Before we worry about handling exceptions that occur during the updating workflow, let s first create an editable DataList.</span></span> <span data-ttu-id="5e2fe-122">開く、 `ErrorHandling.aspx`  ページで、`EditDeleteDataList`フォルダー セットをデザイナーに DataList を追加、`ID`プロパティを`Products`、という名前の新しい ObjectDataSource を追加および`ProductsDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-122">Open the `ErrorHandling.aspx` page in the `EditDeleteDataList` folder, add a DataList to the Designer, set its `ID` property to `Products`, and add a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="5e2fe-123">構成を使用する ObjectDataSource、`ProductsBLL`クラスの`GetProducts()`を選択するためのメソッドは、記録以外の場合は、insert、UPDATE、ドロップダウン リストを設定し、(なし) にタブを削除します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-123">Configure the ObjectDataSource to use the `ProductsBLL` class s `GetProducts()` method for selecting records; set the drop-down lists in the INSERT, UPDATE, and DELETE tabs to (None).</span></span>


<span data-ttu-id="5e2fe-124">[![GetProducts() メソッドを使用して製品情報を返す](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-124">[![Return the Product Information Using the GetProducts() Method](handling-bll-and-dal-level-exceptions-vb/_static/image2.png)](handling-bll-and-dal-level-exceptions-vb/_static/image1.png)</span></span>

<span data-ttu-id="5e2fe-125">**図 1**: 製品を使用して情報を返す、`GetProducts()`メソッド ([フルサイズのイメージを表示するをクリックして](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="5e2fe-125">**Figure 1**: Return the Product Information Using the `GetProducts()` Method ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image3.png))</span></span>


<span data-ttu-id="5e2fe-126">ObjectDataSource ウィザードを完了すると、Visual Studio が自動的に作成、 `ItemTemplate` DataList のです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-126">After completing the ObjectDataSource wizard, Visual Studio will automatically create an `ItemTemplate` for the DataList.</span></span> <span data-ttu-id="5e2fe-127">これを置き換える、`ItemTemplate`各製品の名前と価格を表示して、[編集] ボタンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-127">Replace this with an `ItemTemplate` that displays each product s name and price and includes an Edit button.</span></span> <span data-ttu-id="5e2fe-128">次に、作成、`EditItemTemplate`と名前と価格および更新し、[キャンセル] ボタンのテキスト ボックスの Web コントロールです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-128">Next, create an `EditItemTemplate` with a TextBox Web control for name and price and Update and Cancel buttons.</span></span> <span data-ttu-id="5e2fe-129">DataList s を最後に、設定`RepeatColumns`プロパティを 2 です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-129">Finally, set the DataList s `RepeatColumns` property to 2.</span></span>

<span data-ttu-id="5e2fe-130">これらの変更後にページ s の宣言型マークアップは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-130">After these changes, your page s declarative markup should look similar to the following.</span></span> <span data-ttu-id="5e2fe-131">とることによって、編集、キャンセル をもう一度確認して更新 ボタン、`CommandName`プロパティを編集、キャンセル、および更新、それぞれに設定します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-131">Double-check to make certain that the Edit, Cancel, and Update buttons have their `CommandName` properties set to Edit, Cancel, and Update, respectively.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample1.aspx)]

> [!NOTE]
> <span data-ttu-id="5e2fe-132">このチュートリアルでは、DataList のビュー ステートを有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-132">For this tutorial the DataList s view state must be enabled.</span></span>


<span data-ttu-id="5e2fe-133">ブラウザーを使って作業の進行状況を表示するのにはしばらく時間かかる (図 2 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-133">Take a moment to view our progress through a browser (see Figure 2).</span></span>


<span data-ttu-id="5e2fe-134">[![各製品には、[編集] ボタンが含まれています。](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-134">[![Each Product Includes an Edit Button](handling-bll-and-dal-level-exceptions-vb/_static/image5.png)](handling-bll-and-dal-level-exceptions-vb/_static/image4.png)</span></span>

<span data-ttu-id="5e2fe-135">**図 2**: 各製品には、[編集] ボタンが含まれています ([フルサイズのイメージを表示するをクリックして](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="5e2fe-135">**Figure 2**: Each Product Includes an Edit Button ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image6.png))</span></span>


<span data-ttu-id="5e2fe-136">現時点では、[編集] ボタンのみポストバックを発生させる、されないまだ製品を編集できるようにします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-136">Currently, the Edit button only causes a postback it doesn t yet make the product editable.</span></span> <span data-ttu-id="5e2fe-137">編集を有効にする必要があります DataList s のイベント ハンドラーを作成する`EditCommand`、 `CancelCommand`、および`UpdateCommand`イベント。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-137">To enable editing, we need to create event handlers for the DataList s `EditCommand`, `CancelCommand`, and `UpdateCommand` events.</span></span> <span data-ttu-id="5e2fe-138">`EditCommand`と`CancelCommand`イベントは、DataList s を単に更新`EditItemIndex`プロパティは、DataList にデータを再バインド。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-138">The `EditCommand` and `CancelCommand` events simply update the DataList s `EditItemIndex` property and rebind the data to the DataList:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="5e2fe-139">`UpdateCommand`イベント ハンドラーは、少し複雑です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-139">The `UpdateCommand` event handler is a bit more involved.</span></span> <span data-ttu-id="5e2fe-140">編集した製品 s を読み取る必要があります`ProductID`から、`DataKeys`および製品の名前と価格のテキスト ボックスからコレクション、 `EditItemTemplate`、まず、`ProductsBLL`クラスの`UpdateProduct`DataList を返す前にメソッド編集済みの状態。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-140">It needs to read in the edited product s `ProductID` from the `DataKeys` collection along with the product s name and price from the TextBoxes in the `EditItemTemplate`, and then call the `ProductsBLL` class s `UpdateProduct` method before returning the DataList to its pre-editing state.</span></span>

<span data-ttu-id="5e2fe-141">ここでは、let s だけ、正確な同じコードを使用して、`UpdateCommand`内のイベント ハンドラー、 *DataList でのデータの削除と編集の概要*チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-141">For now, let s just use the exact same code from the `UpdateCommand` event handler in the *Overview of Editing and Deleting Data in the DataList* tutorial.</span></span> <span data-ttu-id="5e2fe-142">手順 2. で例外を適切に処理するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-142">We'll add the code to gracefully handle exceptions in step 2.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="5e2fe-143">無効な入力発生した場合に、またはフォームで不適切な書式の単価、$5.00 など、無効な単位の価格値、例外が発生する製品の名前の省略できます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-143">In the face of invalid input which can be in the form of an improperly formatted unit price, an illegal unit price value like -$5.00, or the omission of the product s name an exception will be raised.</span></span> <span data-ttu-id="5e2fe-144">以降、`UpdateCommand`処理コードをこの時点ですべての例外を含まないイベント ハンドラー、例外をバブリング ASP.NET ランタイムをエンドユーザーに表示されます (図 3 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-144">Since the `UpdateCommand` event handler does not include any exception handling code at this point, the exception will bubble up to the ASP.NET runtime, where it will be displayed to the end user (see Figure 3).</span></span>


![未処理の例外が発生すると、エンドユーザーのエラー ページ](handling-bll-and-dal-level-exceptions-vb/_static/image7.png)

<span data-ttu-id="5e2fe-146">**図 3**: ハンドルされない例外が発生すると、エンドユーザーのエラー ページ</span><span class="sxs-lookup"><span data-stu-id="5e2fe-146">**Figure 3**: When an Unhandled Exception Occurs, the End User Sees an Error Page</span></span>


## <a name="step-2-gracefully-handling-exceptions-in-the-updatecommand-event-handler"></a><span data-ttu-id="5e2fe-147">手順 2: 正常に UpdateCommand イベント ハンドラーで例外の処理</span><span class="sxs-lookup"><span data-stu-id="5e2fe-147">Step 2: Gracefully Handling Exceptions in the UpdateCommand Event Handler</span></span>

<span data-ttu-id="5e2fe-148">更新のワークフローの例外を実行するために、`UpdateCommand`イベント ハンドラー、BLL、または、DAL です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-148">During the updating workflow, exceptions can occur in the `UpdateCommand` event handler, the BLL, or the DAL.</span></span> <span data-ttu-id="5e2fe-149">たとえば、ユーザーが多すぎますの価格を入力した場合、高価な`Decimal.Parse`内のステートメント、`UpdateCommand`イベント ハンドラーがスローされます、`FormatException`例外。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-149">For example, if a user enters a price of Too expensive, the `Decimal.Parse` statement in the `UpdateCommand` event handler will throw a `FormatException` exception.</span></span> <span data-ttu-id="5e2fe-150">ユーザーが製品の名前を省略した場合、または、価格が負の値を持つ場合は、DAL には、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-150">If the user omits the product s name or if the price has a negative value, the DAL will raise an exception.</span></span>

<span data-ttu-id="5e2fe-151">例外が発生するときに表示するページ自体内で情報メッセージです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-151">When an exception occurs, we want to display an informative message within the page itself.</span></span> <span data-ttu-id="5e2fe-152">ラベルの web コントロールをページの`ID`に設定されている`ExceptionDetails`です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-152">Add a Label Web control to the page whose `ID` is set to `ExceptionDetails`.</span></span> <span data-ttu-id="5e2fe-153">S のラベル テキストを割り当てることで太字と斜体のフォントが非常に大規模な赤で表示する構成、`CssClass`プロパティを`Warning`で定義されている CSS クラス、`Styles.css`ファイル。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-153">Configure the Label s text to display in a red, extra-large, bold and italic font by assigning its `CssClass` property to the `Warning` CSS class, which is defined in the `Styles.css` file.</span></span>

<span data-ttu-id="5e2fe-154">エラーが発生する場合にのみ、表示されるラベルを 1 回が必要です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-154">When an error occurs, we only want the Label to be displayed once.</span></span> <span data-ttu-id="5e2fe-155">つまり、以降のポストバックでラベルの警告メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-155">That is, on subsequent postbacks, the Label s warning message should disappear.</span></span> <span data-ttu-id="5e2fe-156">これには、s のラベルをクリアするか`Text`プロパティや設定、`Visible`プロパティを`False`で、`Page_Load`イベント ハンドラー (で行ったように、[処理 BLL と ASP DAL レベルの例外.NET ページ](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)チュートリアル) または s のラベルの表示状態のサポートを無効にします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-156">This can be accomplished by either clearing out the Label s `Text` property or settings its `Visible` property to `False` in the `Page_Load` event handler (as we did back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial) or by disabling the Label s view state support.</span></span> <span data-ttu-id="5e2fe-157">S、後者のオプションを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-157">Let s use the latter option.</span></span>


[!code-aspx[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample4.aspx)]

<span data-ttu-id="5e2fe-158">例外の詳細を割り当てます例外が発生したときに、`ExceptionDetails`ラベル コントロールの`Text`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-158">When an exception is raised, we'll assign the details of the exception to the `ExceptionDetails` Label control s `Text` property.</span></span> <span data-ttu-id="5e2fe-159">以降のポストバックで、そのビュー ステートが無効になるので、`Text`どうかを示すプロパティ %s、失われます、既定のテキスト (空の文字列)、これにより、警告メッセージを非表示に戻します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-159">Since its view state is disabled, on subsequent postbacks the `Text` property s programmatic changes will be lost, reverting back to the default text (an empty string), thereby hiding the warning message.</span></span>

<span data-ttu-id="5e2fe-160">ページで便利なメッセージを表示するために、エラーが発生したときを特定する必要がありますを追加する、`Try ... Catch`へのブロック、`UpdateCommand`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-160">To determine when an error has been raised in order to display a helpful message on the page, we need to add a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="5e2fe-161">`Try`部分には、例外につながる可能性のあるコードが含まれています。 中に、`Catch`ブロックには、例外発生した場合に実行されるコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-161">The `Try` portion contains code that may lead to an exception, while the `Catch` block contains code that is executed in the face of an exception.</span></span> <span data-ttu-id="5e2fe-162">チェック アウト、[例外処理の基本事項](https://msdn.microsoft.com/library/2w8f0bss.aspx)詳細については、.NET Framework のドキュメントのセクションで、`Try ... Catch`ブロックします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-162">Check out the [Exception Handling Fundamentals](https://msdn.microsoft.com/library/2w8f0bss.aspx) section in the .NET Framework documentation for more information on the `Try ... Catch` block.</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="5e2fe-163">内のコードによって任意の型の例外がスローされたときに、`Try`ブロック、`Catch`ブロックのコードは実行を開始します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-163">When an exception of any type is thrown by code within the `Try` block, the `Catch` block s code will begin executing.</span></span> <span data-ttu-id="5e2fe-164">スローされる例外の種類`DbException`、 `NoNullAllowedException`、`ArgumentException`で異なります、正確に、まず第一に、エラーの原因となったとします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-164">The type of exception that is thrown `DbException`, `NoNullAllowedException`, `ArgumentException`, and so on depends on what, exactly, precipitated the error in the first place.</span></span> <span data-ttu-id="5e2fe-165">場合、データベース レベルで問題があります、`DbException`がスローされます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-165">If there s a problem at the database level, a `DbException` will be thrown.</span></span> <span data-ttu-id="5e2fe-166">場合の無効な値を入力、 `UnitPrice`、 `UnitsInStock`、 `UnitsOnOrder`、または`ReorderLevel`、フィールド、`ArgumentException`でこれらのフィールド値を検証するコードを追加しましたとしてスローされます、`ProductsDataTable`クラス (を参照してください、 [ビジネス ロジック層を作成する](../introduction/creating-a-business-logic-layer-vb.md)チュートリアル)。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-166">If an illegal value is entered for the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` fields, an `ArgumentException` will be thrown, as we added code to validate these field values in the `ProductsDataTable` class (see the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial).</span></span>

<span data-ttu-id="5e2fe-167">キャッチされた例外の種類のメッセージ テキストを基盤としてより役に立つ説明をエンドユーザーに提供できます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-167">We can provide a more helpful explanation to the end user by basing the message text on the type of exception caught.</span></span> <span data-ttu-id="5e2fe-168">次のコードとほぼ同じフォームで使用されていたに戻り、[処理 BLL-DAL レベルでの例外および ASP.NET ページ](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)チュートリアルでは、このレベルの詳細。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-168">The following code which was used in a nearly identical form back in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial provides this level of detail:</span></span>


[!code-vb[Main](handling-bll-and-dal-level-exceptions-vb/samples/sample6.vb)]

<span data-ttu-id="5e2fe-169">このチュートリアルを完了するを呼び出すだけで、`DisplayExceptionDetails`メソッドから、`Catch`ブロックでキャッチされた渡す`Exception`インスタンス (`ex`)。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-169">To complete this tutorial, simply call the `DisplayExceptionDetails` method from the `Catch` block passing in the caught `Exception` instance (`ex`).</span></span>

<span data-ttu-id="5e2fe-170">`Try ... Catch`インプレース ブロックは、図 4 と 5 の表示に関する詳細情報のエラー メッセージをユーザーに提供します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-170">With the `Try ... Catch` block in place, users are presented with a more informative error message, as Figures 4 and 5 show.</span></span> <span data-ttu-id="5e2fe-171">DataList で例外が発生した場合に残っている注は編集モードです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-171">Note that in the face of an exception the DataList remains in edit mode.</span></span> <span data-ttu-id="5e2fe-172">これは、例外が発生した場合、制御フローに直ちにリダイレクトため、`Catch`ブロック、編集済みの状態、DataList を返すコードをバイパスします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-172">This is because once the exception occurs, the control flow is immediately redirected to the `Catch` block, bypassing the code that returns the DataList to its pre-editing state.</span></span>


<span data-ttu-id="5e2fe-173">[![ユーザーが必要なフィールドを省略した場合、エラー メッセージが表示されます。](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-173">[![An Error Message is Displayed if a User Omits a Required Field](handling-bll-and-dal-level-exceptions-vb/_static/image9.png)](handling-bll-and-dal-level-exceptions-vb/_static/image8.png)</span></span>

<span data-ttu-id="5e2fe-174">**図 4**: ユーザーが必要なフィールドを省略した場合、エラー メッセージが表示されます ([フルサイズのイメージを表示するをクリックして](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="5e2fe-174">**Figure 4**: An Error Message is Displayed if a User Omits a Required Field ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image10.png))</span></span>


<span data-ttu-id="5e2fe-175">[![エラー メッセージが表示されるときに入力マイナスの価格](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-175">[![An Error Message is Displayed When Entering a Negative Price](handling-bll-and-dal-level-exceptions-vb/_static/image12.png)](handling-bll-and-dal-level-exceptions-vb/_static/image11.png)</span></span>

<span data-ttu-id="5e2fe-176">**図 5**: のエラー メッセージが表示されるときに入力マイナスの価格 ([フルサイズのイメージを表示するをクリックして](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span><span class="sxs-lookup"><span data-stu-id="5e2fe-176">**Figure 5**: An Error Message is Displayed When Entering a Negative Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-vb/_static/image13.png))</span></span>


## <a name="summary"></a><span data-ttu-id="5e2fe-177">まとめ</span><span class="sxs-lookup"><span data-stu-id="5e2fe-177">Summary</span></span>

<span data-ttu-id="5e2fe-178">ObjectDataSource、GridView、更新と削除のワークフローの間に発生した例外だけでなく、例外がされているかどうかを示すために設定できるプロパティに関する情報を含むレベルの後のイベント ハンドラーを提供します。処理されます。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-178">The GridView and ObjectDataSource provide post-level event handlers that include information about any exceptions that were raised during the updating and deleting workflow, as well as properties that can be set to indicate whether or not the exception has been handled.</span></span> <span data-ttu-id="5e2fe-179">これらの機能では、ただし、利用できない場合に、DataList 操作および BLL を直接使用します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-179">These features, however, are unavailable when working with the DataList and using the BLL directly.</span></span> <span data-ttu-id="5e2fe-180">代わりに、例外処理を実装する責任はします。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-180">Instead, we are responsible for implementing exception handling.</span></span>

<span data-ttu-id="5e2fe-181">このチュートリアルでは、編集可能な DataList s を追加することでワークフローを更新する例外処理を追加する方法を説明しました、`Try ... Catch`へのブロック、`UpdateCommand`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-181">In this tutorial we saw how to add exception handling to an editable DataList s updating workflow by adding a `Try ... Catch` block to the `UpdateCommand` event handler.</span></span> <span data-ttu-id="5e2fe-182">更新のワークフローの中に例外が発生した場合、`Catch`ブロックのコードの実行に役立つ情報を表示する、`ExceptionDetails`ラベル。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-182">If an exception is raised during the updating workflow, the `Catch` block s code executes, displaying helpful information in the `ExceptionDetails` Label.</span></span>

<span data-ttu-id="5e2fe-183">この時点では、DataList は、最初の場所が行われない例外を防ぐために努力を行いません。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-183">At this point, the DataList makes no effort to prevent exceptions from happening in the first place.</span></span> <span data-ttu-id="5e2fe-184">マイナスの価格、例外が発生、だことはわかっている場合でも t はまだ事前にこのような無効な入力できないようにする機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-184">Even though we know that a negative price will result in an exception, we haven t yet added any functionality to proactively prevent a user from entering such invalid input.</span></span> <span data-ttu-id="5e2fe-185">[次へ]、チュートリアルのこれについて扱いますの検証コントロールを追加することで、無効なユーザー入力によって引き起こされる例外を減らすために、`EditItemTemplate`です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-185">In our next tutorial we'll see how to help reduce the exceptions caused by invalid user input by adding validation controls in the `EditItemTemplate`.</span></span>

<span data-ttu-id="5e2fe-186">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="5e2fe-186">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="5e2fe-187">関連項目</span><span class="sxs-lookup"><span data-stu-id="5e2fe-187">Further Reading</span></span>

<span data-ttu-id="5e2fe-188">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-188">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="5e2fe-189">例外のデザインのガイドライン</span><span class="sxs-lookup"><span data-stu-id="5e2fe-189">Design Guidelines for Exceptions</span></span>](https://msdn.microsoft.com/library/ms298399.aspx)
- <span data-ttu-id="5e2fe-190">[エラー ログ モジュールとハンドラー (ELMAH)](http://workspaces.gotdotnet.com/elmah) (エラーのログ記録のオープン ソース ライブラリ)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-190">[Error Logging Modules and Handlers (ELMAH)](http://workspaces.gotdotnet.com/elmah) (an open-source library for logging errors)</span></span>
- <span data-ttu-id="5e2fe-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (例外管理アプリケーション ブロックが含まれています)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-191">[Enterprise Library for .NET Framework 2.0](https://www.microsoft.com/downloads/details.aspx?familyid=5A14E870-406B-4F2A-B723-97BA84AE80B5&amp;displaylang=en) (includes the Exception Management Application Block)</span></span>

## <a name="about-the-author"></a><span data-ttu-id="5e2fe-192">作成者について</span><span class="sxs-lookup"><span data-stu-id="5e2fe-192">About the Author</span></span>

<span data-ttu-id="5e2fe-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-193">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="5e2fe-194">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-194">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="5e2fe-195">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-195">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="5e2fe-196">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-196">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="5e2fe-197">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="5e2fe-197">Special Thanks To</span></span>

<span data-ttu-id="5e2fe-198">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-198">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="5e2fe-199">このチュートリアルのレビュー担当者の潜在顧客は、Ken Pespisa をでした。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-199">Lead reviewer for this tutorial was Ken Pespisa.</span></span> <span data-ttu-id="5e2fe-200">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="5e2fe-200">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="5e2fe-201">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-201">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="5e2fe-202">[前へ](performing-batch-updates-vb.md)
> [次へ](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span><span class="sxs-lookup"><span data-stu-id="5e2fe-202">[Previous](performing-batch-updates-vb.md)
[Next](adding-validation-controls-to-the-datalist-s-editing-interface-vb.md)</span></span>
