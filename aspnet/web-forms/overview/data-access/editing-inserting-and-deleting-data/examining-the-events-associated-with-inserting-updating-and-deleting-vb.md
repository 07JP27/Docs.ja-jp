---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
title: "挿入、更新、および削除 (VB) に関連付けられているイベントを確認する |Microsoft ドキュメント"
author: rick-anderson
description: "について確認する前に、実行時に、および挿入後に発生するイベントを使用してこのチュートリアルでは、更新、または ASP.NET データ Web コントロールの操作を削除します。 W.."
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: c9bd10a7-eff8-4d8c-bec9-963c2aef2d6e
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/examining-the-events-associated-with-inserting-updating-and-deleting-vb
msc.type: authoredcontent
ms.openlocfilehash: 5daa9d1fe63e4ad8ec8c667f84de00fadd77fefa
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="examining-the-events-associated-with-inserting-updating-and-deleting-vb"></a><span data-ttu-id="c70a4-104">挿入、更新、および削除 (VB) に関連付けられたイベントを確認します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-104">Examining the Events Associated with Inserting, Updating, and Deleting (VB)</span></span>
====================
<span data-ttu-id="c70a4-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c70a4-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c70a4-106">[サンプル アプリをダウンロード](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe)または[PDF のダウンロード](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="c70a4-106">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_17_VB.exe) or [Download PDF](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/datatutorial17vb1.pdf)</span></span>

> <span data-ttu-id="c70a4-107">について確認する前に、実行時に、および挿入後に発生するイベントを使用してこのチュートリアルでは、更新、または ASP.NET データ Web コントロールの操作を削除します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-107">In this tutorial we'll examine using the events that occur before, during, and after an insert, update, or delete operation of an ASP.NET data Web control.</span></span> <span data-ttu-id="c70a4-108">製品フィールドのサブセットのみを更新する編集のインターフェイスをカスタマイズする方法を会いしましょう。</span><span class="sxs-lookup"><span data-stu-id="c70a4-108">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>


## <a name="introduction"></a><span data-ttu-id="c70a4-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="c70a4-109">Introduction</span></span>

<span data-ttu-id="c70a4-110">組み込みの挿入、編集、または削除、GridView、DetailsView、またはフォーム ビューのコントロールの機能を使用する場合、エンドユーザーが新しいレコードの追加や更新、または既存のレコードを削除するプロセスを完了すると、さまざまな手順が経過します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-110">When using the built-in inserting, editing, or deleting features of the GridView, DetailsView, or FormView controls, a variety of steps transpire when the end user completes the process of adding a new record or updating or deleting an existing record.</span></span> <span data-ttu-id="c70a4-111">説明したよう、[前のチュートリアル](an-overview-of-inserting-updating-and-deleting-data-vb.md)[編集] ボタンが更新し、[キャンセル] ボタンとテキスト ボックスに BoundFields 有効化置き換え GridView の行を編集する際に、します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-111">As we discussed in the [previous tutorial](an-overview-of-inserting-updating-and-deleting-data-vb.md), when a row is edited in the GridView the Edit button is replaced by Update and Cancel buttons and the BoundFields turn into TextBoxes.</span></span> <span data-ttu-id="c70a4-112">エンドユーザーは、データを更新し、更新プログラムをクリックすると、次の手順は、ポストバック時に実行されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-112">After the end user updates the data and clicks Update, the following steps are performed on postback:</span></span>

1. <span data-ttu-id="c70a4-113">GridView を設定、ObjectDataSource の`UpdateParameters`で編集されたレコードの一意の識別フィールド (を使用して、`DataKeyNames`プロパティ)、ユーザーが入力した値と共に</span><span class="sxs-lookup"><span data-stu-id="c70a4-113">The GridView populates its ObjectDataSource's `UpdateParameters` with the edited record's unique identifying field(s) (via the `DataKeyNames` property) along with the values entered by the user</span></span>
2. <span data-ttu-id="c70a4-114">GridView 呼び出します、ObjectDataSource の`Update()`メソッドで、さらに、基になるオブジェクトに適切なメソッドを呼び出します (`ProductsDAL.UpdateProduct`で、前のチュートリアル)</span><span class="sxs-lookup"><span data-stu-id="c70a4-114">The GridView invokes its ObjectDataSource's `Update()` method, which in turn invokes the appropriate method in the underlying object (`ProductsDAL.UpdateProduct`, in our previous tutorial)</span></span>
3. <span data-ttu-id="c70a4-115">今すぐ更新された変更が含まれている、基になるデータが GridView にバインドし直す</span><span class="sxs-lookup"><span data-stu-id="c70a4-115">The underlying data, which now includes the updated changes, is rebound to the GridView</span></span>

<span data-ttu-id="c70a4-116">この一連の手順では、中に多数のイベントを発生させる、カスタム ロジックを追加するイベント ハンドラーを作成することを有効にするために必要な場所です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-116">During this sequence of steps, a number of events fire, enabling us to create event handlers to add custom logic where needed.</span></span> <span data-ttu-id="c70a4-117">たとえば、手順 1. GridView の前に`RowUpdating`イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-117">For example, prior to Step 1, the GridView's `RowUpdating` event fires.</span></span> <span data-ttu-id="c70a4-118">いくつかの検証エラーがある場合は、この時点では、更新の要求をキャンセルおできます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-118">We can, at this point, cancel the update request if there is some validation error.</span></span> <span data-ttu-id="c70a4-119">ときに、`Update()`メソッドが呼び出され、ObjectDataSource の`Updating`を追加またはのいずれかの値をカスタマイズする機会を提供するイベントの起動、`UpdateParameters`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-119">When the `Update()` method is invoked, the ObjectDataSource's `Updating` event fires, providing an opportunity to add or customize the values of any of the `UpdateParameters`.</span></span> <span data-ttu-id="c70a4-120">オブジェクトのメソッドの実行、ObjectDataSource が完了した後、ObjectDataSource の基になる`Updated`イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-120">After the ObjectDataSource's underlying object's method has completed executing, the ObjectDataSource's `Updated` event is raised.</span></span> <span data-ttu-id="c70a4-121">イベント ハンドラー、`Updated`イベントが影響を受けた行の数と、例外が発生したかどうかなど、更新操作の詳細を調べることができます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-121">An event handler for the `Updated` event can inspect the details about the update operation, such as how many rows were affected and whether or not an exception occurred.</span></span> <span data-ttu-id="c70a4-122">手順 2. GridView の後に最後に、`RowUpdated`イベントの起動; のこのイベントはイベント ハンドラーを実行だけで、更新操作に関する追加情報を確認します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-122">Finally, after Step 2, the GridView's `RowUpdated` event fires; an event handler for this event can examine additional information about the update operation just performed.</span></span>

<span data-ttu-id="c70a4-123">図 1 は、GridView を更新するときに、この一連のイベントと手順を示しています。</span><span class="sxs-lookup"><span data-stu-id="c70a4-123">Figure 1 depicts this series of events and steps when updating a GridView.</span></span> <span data-ttu-id="c70a4-124">図 1 のイベント パターンが GridView で更新に固有ではありません。</span><span class="sxs-lookup"><span data-stu-id="c70a4-124">The event pattern in Figure 1 is not unique to updating with a GridView.</span></span> <span data-ttu-id="c70a4-125">挿入、更新、または GridView からデータを削除すると、DetailsView、またはフォーム ビューには、同じデータ Web コントロールと、ObjectDataSource の両方の前と後のレベルのイベントのシーケンスが precipitates です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-125">Inserting, updating, or deleting data from the GridView, DetailsView, or FormView precipitates the same sequence of pre- and post-level events for both the data Web control and the ObjectDataSource.</span></span>


<span data-ttu-id="c70a4-126">[![一連の前と後のイベント起動 GridView にデータを更新する場合](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-126">[![A Series of Pre- and Post-Events Fire When Updating Data in a GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image2.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image1.png)</span></span>

<span data-ttu-id="c70a4-127">**図 1**: A シリーズの前と後イベントには起動時にデータの更新、GridView ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-127">**Figure 1**: A Series of Pre- and Post-Events Fire When Updating Data in a GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image3.png))</span></span>


<span data-ttu-id="c70a4-128">このチュートリアルでは、これらのイベントを使用して、組み込みの挿入を拡張するについて確認、更新、および ASP.NET データの機能を削除すると Web を制御します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-128">In this tutorial we'll examine using these events to extend the built-in inserting, updating, and deleting capabilities of the ASP.NET data Web controls.</span></span> <span data-ttu-id="c70a4-129">製品フィールドのサブセットのみを更新する編集のインターフェイスをカスタマイズする方法を会いしましょう。</span><span class="sxs-lookup"><span data-stu-id="c70a4-129">We'll also see how to customize the editing interface to only update a subset of the product fields.</span></span>

## <a name="step-1-updating-a-productsproductnameandunitpricefields"></a><span data-ttu-id="c70a4-130">手順 1: 更新、製品の`ProductName`と`UnitPrice`フィールド</span><span class="sxs-lookup"><span data-stu-id="c70a4-130">Step 1: Updating a Product's`ProductName`and`UnitPrice`Fields</span></span>

<span data-ttu-id="c70a4-131">前のチュートリアル編集インターフェイスで*すべて*製品フィールドされなかった読み取り専用を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-131">In the editing interfaces from the previous tutorial *all* product fields that were not read-only had to be included.</span></span> <span data-ttu-id="c70a4-132">-GridView からフィールドを削除する場合と`QuantityPerUnit`データ Web コントロールのデータ更新が設定されていない場合、ObjectDataSource - `QuantityPerUnit` `UpdateParameters`値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-132">If we were to remove a field from the GridView - say `QuantityPerUnit` - when updating the data the data Web control would not set the ObjectDataSource's `QuantityPerUnit` `UpdateParameters` value.</span></span> <span data-ttu-id="c70a4-133">値は、ObjectDataSource を渡しますし`Nothing`に、`UpdateProduct`ビジネス ロジック層 (BLL) のメソッドは、編集済みのデータベース レコードの変更は`QuantityPerUnit`列を`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-133">The ObjectDataSource would then pass in a value of `Nothing` into the `UpdateProduct` Business Logic Layer (BLL) method, which would change the edited database record's `QuantityPerUnit` column to a `NULL` value.</span></span> <span data-ttu-id="c70a4-134">同様に場合の必須フィールドなど`ProductName`が削除、更新プログラムが失敗し、編集のインターフェイスから、"*列 'ProductName' が null を許容しない*"例外。</span><span class="sxs-lookup"><span data-stu-id="c70a4-134">Similarly, if a required field, such as `ProductName`, is removed from the editing interface, the update will fail with a "*Column 'ProductName' does not allow nulls*" exception.</span></span> <span data-ttu-id="c70a4-135">この動作の原因が、ObjectDataSource が呼び出しに構成されていたため、`ProductsBLL`クラスの`UpdateProduct`メソッドの各製品フィールドの入力パラメーターが必要です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-135">The reason for this behavior was because the ObjectDataSource was configured to call the `ProductsBLL` class's `UpdateProduct` method, which expected an input parameter for each of the product fields.</span></span> <span data-ttu-id="c70a4-136">したがって、ObjectDataSource の`UpdateParameters`コレクションにパラメーターが含まれている場合、メソッドのそれぞれのパラメーターを入力します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-136">Therefore, the ObjectDataSource's `UpdateParameters` collection contained a parameter for each of the method's input parameters.</span></span>

<span data-ttu-id="c70a4-137">データ フィールドのサブセットのみを更新するエンド ユーザーを許可する Web コントロールを提供するかどうかは、設定するかプログラムで欠落している必要があります`UpdateParameters`objectdatasource の値`Updating`イベント ハンドラーの作成や、BLL メソッドを呼び出すフィールドのサブセットのみが必要です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-137">If we want to provide a data Web control that allows the end user to only update a subset of fields, then we need to either programmatically set the missing `UpdateParameters` values in the ObjectDataSource's `Updating` event handler or create and call a BLL method that expects only a subset of the fields.</span></span> <span data-ttu-id="c70a4-138">この後者のアプローチを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c70a4-138">Let's explore this latter approach.</span></span>

<span data-ttu-id="c70a4-139">具体的には、表示するページを作成しましょうだけ`ProductName`と`UnitPrice`編集可能な GridView のフィールドです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-139">Specifically, let's create a page that displays just the `ProductName` and `UnitPrice` fields in an editable GridView.</span></span> <span data-ttu-id="c70a4-140">この GridView の編集用のインターフェイスは 2 つの表示されているフィールドを更新するユーザーのみを許可`ProductName`と`UnitPrice`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-140">This GridView's editing interface will only allow the user to update the two displayed fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="c70a4-141">か、既存 BLL を使用する ObjectDataSource を作成する必要がありますので、この編集用のインターフェイスは、製品のフィールドのサブセットのみを提供、`UpdateProduct`メソッドが不足している製品フィールドの値設定にプログラムでその`Updating`イベントハンドラー、またはお GridView で定義されているフィールドのサブセットのみを必要とする新しい BLL メソッドを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-141">Since this editing interface only provides a subset of a product's fields, we either need to create an ObjectDataSource that uses the existing BLL's `UpdateProduct` method and has the missing product field values set programmatically in its `Updating` event handler, or we need to create a new BLL method that expects only the subset of fields defined in the GridView.</span></span> <span data-ttu-id="c70a4-142">このチュートリアルでは、説明、後者のオプションを使用してし、のオーバー ロードを作成、`UpdateProduct`メソッドは、3 つの入力パラメーターは、1: `productName`、 `unitPrice`、および`productID`:</span><span class="sxs-lookup"><span data-stu-id="c70a4-142">For this tutorial, let's use the latter option and create an overload of the `UpdateProduct` method, one that takes in just three input parameters: `productName`, `unitPrice`, and `productID`:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample1.vb)]

<span data-ttu-id="c70a4-143">などの元の`UpdateProduct`メソッド、このオーバー ロードは、指定したデータベースに製品があるかどうかをチェックして開始`ProductID`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-143">Like the original `UpdateProduct` method, this overload starts by checking to see if there is a product in the database with the specified `ProductID`.</span></span> <span data-ttu-id="c70a4-144">返します、場合`False`、製品情報を更新する要求が失敗したことを示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-144">If not, it returns `False`, indicating that the request to update the product information failed.</span></span> <span data-ttu-id="c70a4-145">それ以外の場合、既存の製品レコードの更新`ProductName`と`UnitPrice`適宜フィールドし、TableAdpater を呼び出すことによって、更新をコミット`Update()`に渡して、メソッド、`ProductsRow`インスタンス。</span><span class="sxs-lookup"><span data-stu-id="c70a4-145">Otherwise it updates the existing product record's `ProductName` and `UnitPrice` fields accordingly and commits the update by calling the TableAdpater's `Update()` method, passing in the `ProductsRow` instance.</span></span>

<span data-ttu-id="c70a4-146">この追加すると、`ProductsBLL`簡略化された GridView インターフェイスを作成する準備ができましたクラスです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-146">With this addition to our `ProductsBLL` class, we're ready to create the simplified GridView interface.</span></span> <span data-ttu-id="c70a4-147">開く、`DataModificationEvents.aspx`で、`EditInsertDelete`フォルダー GridView をページに追加します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-147">Open the `DataModificationEvents.aspx` in the `EditInsertDelete` folder and add a GridView to the page.</span></span> <span data-ttu-id="c70a4-148">新しい ObjectDataSource を作成および構成を使用するよう、`ProductsBLL`クラス、`Select()`メソッドのマッピングを`GetProducts`とその`Update()`へのマッピングをメソッド、`UpdateProduct`使用するオーバー ロードでのみ、 `productName`、 `unitPrice`、および`productID`パラメーターを入力します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-148">Create a new ObjectDataSource and configure it to use the `ProductsBLL` class with its `Select()` method mapping to `GetProducts` and its `Update()` method mapping to the `UpdateProduct` overload that takes in only the `productName`, `unitPrice`, and `productID` input parameters.</span></span> <span data-ttu-id="c70a4-149">図 2 は、ObjectDataSource をマップするときに、データ ソースの作成ウィザードを示します`Update()`メソッドを`ProductsBLL`クラスの新しい`UpdateProduct`メソッドのオーバー ロードします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-149">Figure 2 shows the Create Data Source wizard when mapping the ObjectDataSource's `Update()` method to the `ProductsBLL` class's new `UpdateProduct` method overload.</span></span>


<span data-ttu-id="c70a4-150">[![新しい UpdateProduct オーバー ロードに map ObjectDataSource の Update() メソッド](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-150">[![Map the ObjectDataSource's Update() Method to the New UpdateProduct Overload](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image5.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image4.png)</span></span>

<span data-ttu-id="c70a4-151">**図 2**: マップ ObjectDataSource の`Update()`メソッドは、[新規] を`UpdateProduct`オーバー ロード ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-151">**Figure 2**: Map the ObjectDataSource's `Update()` Method to the New `UpdateProduct` Overload ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image6.png))</span></span>


<span data-ttu-id="c70a4-152">この例は、データを編集することはできませんレコード挿入または削除できる必要がありますのみが最初に、のですぐを明示的に示す ObjectDataSource の`Insert()`と`Delete()`メソッドは、のいずれかにマップすることはできません、 `ProductsBLL`クラスのメソッドは挿入と削除のタブに移動し、ドロップダウン リストから選択する ()。</span><span class="sxs-lookup"><span data-stu-id="c70a4-152">Since our example will initially just need the ability to edit data, but not to insert or delete records, take a moment to explicitly indicate that the ObjectDataSource's `Insert()` and `Delete()` methods shouldn't be mapped to any of the `ProductsBLL` class's methods by going to the INSERT and DELETE tabs and choosing (None) from the drop-down list.</span></span>


<span data-ttu-id="c70a4-153">[![挿入および削除のタブのドロップダウン リストから (なし)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-153">[![Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image8.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image7.png)</span></span>

<span data-ttu-id="c70a4-154">**図 3**: (なし) から、ドロップダウン リストを挿入および削除のタブ ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-154">**Figure 3**: Choose (None) From the Drop-Down List for the INSERT and DELETE Tabs ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image9.png))</span></span>


<span data-ttu-id="c70a4-155">このウィザードの完了後、GridView のスマート タグからの編集を有効にするチェック ボックスを確認します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-155">After completing this wizard check the Enable Editing checkbox from the GridView's smart tag.</span></span>

<span data-ttu-id="c70a4-156">データ ソースの作成ウィザードおよび GridView にバインドを完了すると、Visual Studio は、宣言の構文の両方のコントロールを作成しました。</span><span class="sxs-lookup"><span data-stu-id="c70a4-156">With the completion of the Create Data Source wizard and binding that to the GridView, Visual Studio has created the declarative syntax for both controls.</span></span> <span data-ttu-id="c70a4-157">ソース ビューの下に表示される、ObjectDataSource の宣言型マークアップの検査を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c70a4-157">Go to the Source view to inspect the ObjectDataSource's declarative markup, which is shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample2.aspx)]

<span data-ttu-id="c70a4-158">ObjectDataSource のマッピングが存在しないため`Insert()`と`Delete()`メソッドがあるない`InsertParameters`または`DeleteParameters`セクションです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-158">Since there are no mappings for the ObjectDataSource's `Insert()` and `Delete()` methods, there are no `InsertParameters` or `DeleteParameters` sections.</span></span> <span data-ttu-id="c70a4-159">さらに、以降、`Update()`メソッドのマップ先、`UpdateProduct`メソッド オーバー ロードがのみ、次の 3 つの入力パラメーターを受け取り、`UpdateParameters`セクションには 3 つ`Parameter`インスタンス。</span><span class="sxs-lookup"><span data-stu-id="c70a4-159">Furthermore, since the `Update()` method is mapped to the `UpdateProduct` method overload that only accepts three input parameters, the `UpdateParameters` section has just three `Parameter` instances.</span></span>

<span data-ttu-id="c70a4-160">なお、ObjectDataSource`OldValuesParameterFormatString`プロパティに設定されている`original_{0}`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-160">Note that the ObjectDataSource's `OldValuesParameterFormatString` property is set to `original_{0}`.</span></span> <span data-ttu-id="c70a4-161">データ ソースの構成ウィザードを使用してこのプロパティは Visual Studio によって自動的に設定します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-161">This property is set automatically by Visual Studio when using the Configure Data Source wizard.</span></span> <span data-ttu-id="c70a4-162">ただし、BLL メソッドは、元に必要ないので`ProductID`で渡される、ObjectDataSource の宣言構文からこのプロパティの割り当てを完全に削除する値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-162">However, since our BLL methods don't expect the original `ProductID` value to be passed in, remove this property assignment altogether from the ObjectDataSource's declarative syntax.</span></span>

> [!NOTE]
> <span data-ttu-id="c70a4-163">だけオフにした場合、`OldValuesParameterFormatString`プロパティ [デザイン] ビューで [プロパティ] ウィンドウからプロパティ値は、宣言の構文では引き続き存在しますが、空の文字列に設定されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-163">If you simply clear out the `OldValuesParameterFormatString` property value from the Properties window in the Design view, the property will still exist in the declarative syntax, but will be set to an empty string.</span></span> <span data-ttu-id="c70a4-164">削除するか完全宣言構文から、または、[プロパティ] ウィンドウからプロパティ値、既定値と`{0}`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-164">Either remove the property altogether from the declarative syntax or, from the Properties window, set the value to the default, `{0}`.</span></span>


<span data-ttu-id="c70a4-165">あるときに、ObjectDataSource のみ`UpdateParameters`の場合、製品の名前、価格、および ID、Visual Studio が追加 BoundField または CheckBoxField GridView での各製品のフィールドです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-165">While the ObjectDataSource only has `UpdateParameters` for the product's name, price, and ID, Visual Studio has added a BoundField or CheckBoxField in the GridView for each of the product's fields.</span></span>


<span data-ttu-id="c70a4-166">[![GridView の各製品のフィールドの BoundField または CheckBoxField を含む](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-166">[![The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image11.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image10.png)</span></span>

<span data-ttu-id="c70a4-167">**図 4**: GridView の各製品のフィールドの BoundField または CheckBoxField を含む ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-167">**Figure 4**: The GridView Contains a BoundField or CheckBoxField for Each of the Product's Fields ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image12.png))</span></span>


<span data-ttu-id="c70a4-168">エンドユーザーは、製品を編集、その更新ボタンをクリックすると、GridView はされた読み取り専用フィールドを列挙します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-168">When the end user edits a product and clicks its Update button, the GridView enumerates those fields that were not read-only.</span></span> <span data-ttu-id="c70a4-169">Objectdatasource の対応するパラメーターの値を設定し、`UpdateParameters`コレクション、ユーザーが入力した値にします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-169">It then sets the value of the corresponding parameter in the ObjectDataSource's `UpdateParameters` collection to the value entered by the user.</span></span> <span data-ttu-id="c70a4-170">対応するパラメーターがない場合は、GridView は、コレクションに 1 つを追加します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-170">If there is not a corresponding parameter, the GridView adds one to the collection.</span></span> <span data-ttu-id="c70a4-171">そのため、当社 GridView に BoundFields と CheckBoxFields のすべての製品のフィールドが含まれる場合、ObjectDataSource は、最終的に、`UpdateProduct`にもかかわらず、これらのパラメーターのすべてを受け取るオーバー ロードを ObjectDataSource の宣言型マークアップでは、3 つの入力パラメーター (図 5 を参照してください) を指定します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-171">Therefore, if our GridView contains BoundFields and CheckBoxFields for all of the product's fields, the ObjectDataSource will end up invoking the `UpdateProduct` overload that takes in all of these parameters, despite the fact that the ObjectDataSource's declarative markup specifies only three input parameters (see Figure 5).</span></span> <span data-ttu-id="c70a4-172">同様に、一部の読み取り専用ではない組み合わせがある場合製品フィールドの入力パラメーターに対応していない、GridView、`UpdateProduct`過負荷、更新を試みているときに例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-172">Similarly, if there is some combination of non-read-only product fields in the GridView that doesn't correspond to the input parameters for a `UpdateProduct` overload, an exception will be raised when attempting to update.</span></span>


<span data-ttu-id="c70a4-173">[![GridView は ObjectDataSource の UpdateParameters コレクションにパラメーターを追加します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-173">[![The GridView Will Add Parameters to the ObjectDataSource's UpdateParameters Collection](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image14.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image13.png)</span></span>

<span data-ttu-id="c70a4-174">**図 5**: GridView はパラメーターを追加して、ObjectDataSource`UpdateParameters`コレクション ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-174">**Figure 5**: The GridView Will Add Parameters to the ObjectDataSource's `UpdateParameters` Collection ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image15.png))</span></span>


<span data-ttu-id="c70a4-175">ObjectDataSource を呼び出すことを確認する、`UpdateProduct`で製品の名前、価格、および ID に、だけを受け取るオーバー ロードの編集可能なフィールドを持つように、GridView を制限する必要があります、`ProductName`と`UnitPrice`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-175">To ensure that the ObjectDataSource invokes the `UpdateProduct` overload that takes in just the product's name, price, and ID, we need to restrict the GridView to having editable fields for just the `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="c70a4-176">これには、それら他のフィールドを設定して、その他の BoundFields と CheckBoxFields を削除することによって`ReadOnly`プロパティを`True`、または 2 つの組み合わせ。</span><span class="sxs-lookup"><span data-stu-id="c70a4-176">This can be accomplished by removing the other BoundFields and CheckBoxFields, by setting those other fields' `ReadOnly` property to `True`, or by some combination of the two.</span></span> <span data-ttu-id="c70a4-177">このチュートリアルでは単に削除を除くすべての GridView フィールド、`ProductName`と`UnitPrice`BoundFields、その後、GridView の宣言型マークアップのようになります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-177">For this tutorial let's simply remove all GridView fields except the `ProductName` and `UnitPrice` BoundFields, after which the GridView's declarative markup will look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample3.aspx)]

<span data-ttu-id="c70a4-178">場合でも、`UpdateProduct`オーバー ロードには次の 3 つの入力パラメーターが必要ですが、当社 GridView に 2 つの BoundFields があるだけです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-178">Even though the `UpdateProduct` overload expects three input parameters, we only have two BoundFields in our GridView.</span></span> <span data-ttu-id="c70a4-179">これは、ため、`productID`入力パラメーターは、主キーの値との値によって渡された、`DataKeyNames`編集された行のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-179">This is because the `productID` input parameter is a primary key value and passed in through the value of the `DataKeyNames` property for the edited row.</span></span>

<span data-ttu-id="c70a4-180">当社 GridView と共に、`UpdateProduct`過負荷、により、ユーザーは他の製品のフィールドのいずれかを失うことがなく、名前と製品の価格だけを編集します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-180">Our GridView, along with the `UpdateProduct` overload, allows a user to edit just the name and price of a product without losing any of the other product fields.</span></span>


<span data-ttu-id="c70a4-181">[![インターフェイスを使用した製品の名前と価格の編集](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-181">[![The Interface Allows Editing Just the Product's Name and Price](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image17.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image16.png)</span></span>

<span data-ttu-id="c70a4-182">**図 6**: だけ、製品の名前と価格を編集するインターフェイスが ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-182">**Figure 6**: The Interface Allows Editing Just the Product's Name and Price ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image18.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c70a4-183">前のチュートリアルで既に説明した、s ビューステートする GridView に (既定の動作) が有効になっているがきわめて重要です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-183">As discussed in the previous tutorial, it is vitally important that the GridView s view state be enabled (the default behavior).</span></span> <span data-ttu-id="c70a4-184">GridView s を設定した場合`EnableViewState`プロパティを`false`、同時実行ユーザーが誤って削除または編集を記録する危険を実行します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-184">If you set the GridView s `EnableViewState` property to `false`, you run the risk of having concurrent users unintentionally deleting or editing records.</span></span> <span data-ttu-id="c70a4-185">参照してください[警告: 同時実行の問題と ASP.NET 2.0 Gridview/DetailsView/FormViews その編集をサポートするか削除すると、をビュー ステートが無効になっている](http://scottonwriting.net/sowblog/posts/10054.aspx)詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-185">See [WARNING: Concurrency Issue with ASP.NET 2.0 GridViews/DetailsView/FormViews that Support Editing and/or Deleting and Whose View State is Disabled](http://scottonwriting.net/sowblog/posts/10054.aspx) for more information.</span></span>


## <a name="improving-theunitpriceformatting"></a><span data-ttu-id="c70a4-186">向上、`UnitPrice`書式設定</span><span class="sxs-lookup"><span data-stu-id="c70a4-186">Improving the`UnitPrice`Formatting</span></span>

<span data-ttu-id="c70a4-187">図 6 の動作を示す GridView の例の中に、`UnitPrice`フィールドがすべての書式設定されていない、任意の通貨が欠落している価格表示の結果として得られる記号し小数点以下 4 桁がします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-187">While the GridView example shown in Figure 6 works, the `UnitPrice` field is not formatted at all, resulting in a price display that lacks any currency symbols and has four decimal places.</span></span> <span data-ttu-id="c70a4-188">通貨の編集不可能な行の書式設定を適用する設定、 `UnitPrice` BoundField の`DataFormatString`プロパティを`{0:c}`とその`HtmlEncode`プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-188">To apply a currency formatting for the non-editable rows, simply set the `UnitPrice` BoundField's `DataFormatString` property to `{0:c}` and its `HtmlEncode` property to `False`.</span></span>


<span data-ttu-id="c70a4-189">[![UnitPrice の DataFormatString と HtmlEncode プロパティを適宜設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-189">[![Set the UnitPrice's DataFormatString and HtmlEncode Properties Accordingly](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image20.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image19.png)</span></span>

<span data-ttu-id="c70a4-190">**図 7**: 設定、`UnitPrice`の`DataFormatString`と`HtmlEncode`プロパティに応じて ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-190">**Figure 7**: Set the `UnitPrice`'s `DataFormatString` and `HtmlEncode` Properties Accordingly ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image21.png))</span></span>


<span data-ttu-id="c70a4-191">この変更により、編集不可能な行、価格を通貨形式にします。編集した行ただし、まだ表示通貨記号と小数点以下 4 桁の値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-191">With this change, the non-editable rows format the price as a currency; the edited row, however, still displays the value without the currency symbol and with four decimal places.</span></span>


<span data-ttu-id="c70a4-192">[![編集できない行は今すぐ形式の通貨値として](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-192">[![The Non-Editable Rows are Now Formatted as Currency Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image23.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image22.png)</span></span>

<span data-ttu-id="c70a4-193">**図 8**:「編集不可能な行がこれ通貨の値として書式設定 ([フルサイズのイメージを表示するには、をクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-193">**Figure 8**: The Non-Editable Rows are Now Formatted as Currency Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image24.png))</span></span>


<span data-ttu-id="c70a4-194">指定された書式設定の指示、`DataFormatString`プロパティは、BoundField の設定で、編集用のインターフェイスに適用できる`ApplyFormatInEditMode`プロパティを`True`(既定値は`False`)。</span><span class="sxs-lookup"><span data-stu-id="c70a4-194">The formatting instructions specified in the `DataFormatString` property can be applied to the editing interface by setting the BoundField's `ApplyFormatInEditMode` property to `True` (the default is `False`).</span></span> <span data-ttu-id="c70a4-195">このプロパティを設定する`True`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-195">Take a moment to set this property to `True`.</span></span>


<span data-ttu-id="c70a4-196">[![UnitPrice BoundField の ApplyFormatInEditMode プロパティを True に設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-196">[![Set the UnitPrice BoundField's ApplyFormatInEditMode property to True](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image26.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image25.png)</span></span>

<span data-ttu-id="c70a4-197">**図 9**: 設定、 `UnitPrice` BoundField の`ApplyFormatInEditMode`プロパティを`True`([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-197">**Figure 9**: Set the `UnitPrice` BoundField's `ApplyFormatInEditMode` property to `True` ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image27.png))</span></span>


<span data-ttu-id="c70a4-198">この変更によりの値、`UnitPrice`編集後に表示される行が通貨として書式設定もできます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-198">With this change, the value of the `UnitPrice` displayed in the edited row is also formatted as a currency.</span></span>


<span data-ttu-id="c70a4-199">[![編集された行の UnitPrice の値は、これで書式設定の通貨として](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-199">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image29.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image28.png)</span></span>

<span data-ttu-id="c70a4-200">**図 10**:「編集行の`UnitPrice`値これ通貨として書式設定 ([フルサイズ イメージを表示するに、をクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-200">**Figure 10**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image30.png))</span></span>


<span data-ttu-id="c70a4-201">ただし、$19.00 のスローなど、テキスト ボックス内の通貨記号と製品の更新、`FormatException`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-201">However, updating a product with the currency symbol in the textbox such as $19.00 throws a `FormatException`.</span></span> <span data-ttu-id="c70a4-202">GridView が、ObjectDataSource をユーザーが指定した値を代入しようとしたときに`UpdateParameters`コレクションに変換できない、 `UnitPrice` 「ドル 19.00」の文字列を`Decimal`パラメーターに必要な (図 11 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c70a4-202">When the GridView attempts to assign the user-supplied values to the ObjectDataSource's `UpdateParameters` collection it is unable to convert the `UnitPrice` string "$19.00" into the `Decimal` required by the parameter (see Figure 11).</span></span> <span data-ttu-id="c70a4-203">この問題を解決する gridview のイベント ハンドラーを作成できます`RowUpdating`イベントをユーザーが指定したを解析して`UnitPrice`通貨形式として`Decimal`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-203">To remedy this we can create an event handler for the GridView's `RowUpdating` event and have it parse the user-supplied `UnitPrice` as a currency-formatted `Decimal`.</span></span>

<span data-ttu-id="c70a4-204">GridView の`RowUpdating`イベントが、第 2 パラメーターとして型のオブジェクトを受け取ります[GridViewUpdateEventArgs](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx)が含まれている、`NewValues`する準備が完了のユーザーが指定した値を保持するプロパティの 1 つとしてディクショナリObjectDataSource に割り当てられている`UpdateParameters`コレクション。</span><span class="sxs-lookup"><span data-stu-id="c70a4-204">The GridView's `RowUpdating` event accepts as its second parameter an object of type [GridViewUpdateEventArgs](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridviewupdateeventargs(VS.80).aspx), which includes a `NewValues` dictionary as one of its properties that holds the user-supplied values ready to be assigned to the ObjectDataSource's `UpdateParameters` collection.</span></span> <span data-ttu-id="c70a4-205">既存の設定を上書きできるお`UnitPrice`値で、 `NewValues` 10 進値を使用して、コレクションの解析でのコードの次の行を含む、通貨の書式を使用して、`RowUpdating`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c70a4-205">We can overwrite the existing `UnitPrice` value in the `NewValues` collection with a decimal value parsed using the currency format with the following lines of code in the `RowUpdating` event handler:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample4.vb)]

<span data-ttu-id="c70a4-206">ユーザーが指定した場合、`UnitPrice`値 (「ドル 19.00」) などは、この値がによって計算された 10 進値で上書きされます[Decimal.Parse](https://msdn.microsoft.com/en-us/library/system.decimal.parse(VS.80).aspx)、通貨の値を解析します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-206">If the user has supplied a `UnitPrice` value (such as "$19.00"), this value is overwritten with the decimal value computed by [Decimal.Parse](https://msdn.microsoft.com/en-us/library/system.decimal.parse(VS.80).aspx), parsing the value as a currency.</span></span> <span data-ttu-id="c70a4-207">これは正しく、10 進数、通貨記号、コンマ、小数点、およびが発生した場合と解析を使用して、 [NumberStyles 列挙](https://msdn.microsoft.com/en-US/library/system.globalization.numberstyles(VS.80).aspx)で、 [System.Globalization](https://msdn.microsoft.com/en-US/library/abeh092z(VS.80).aspx)名前空間。</span><span class="sxs-lookup"><span data-stu-id="c70a4-207">This will correctly parse the decimal in the event of any currency symbols, commas, decimal points, and so on, and uses the [NumberStyles enumeration](https://msdn.microsoft.com/en-US/library/system.globalization.numberstyles(VS.80).aspx) in the [System.Globalization](https://msdn.microsoft.com/en-US/library/abeh092z(VS.80).aspx) namespace.</span></span>

<span data-ttu-id="c70a4-208">図 11 は、ユーザー指定の通貨記号によって発生する両方の問題を示しています。 `UnitPrice`、方法と共に、GridView の`RowUpdating`イベント ハンドラーを使用して、このような入力を正しく解析します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-208">Figure 11 shows both the problem caused by currency symbols in the user-supplied `UnitPrice`, along with how the GridView's `RowUpdating` event handler can be utilized to correctly parse such input.</span></span>


<span data-ttu-id="c70a4-209">[![編集された行の UnitPrice の値は、これで書式設定の通貨として](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-209">[![The Edited Row's UnitPrice Value is Now Formatted as a Currency](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image32.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image31.png)</span></span>

<span data-ttu-id="c70a4-210">**図 11**:「編集行の`UnitPrice`値これ通貨として書式設定 ([フルサイズ イメージを表示するに、をクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-210">**Figure 11**: The Edited Row's `UnitPrice` Value is Now Formatted as a Currency ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image33.png))</span></span>


## <a name="step-2-prohibitingnull-unitprices"></a><span data-ttu-id="c70a4-211">手順 2: を禁止します。`NULL UnitPrices`</span><span class="sxs-lookup"><span data-stu-id="c70a4-211">Step 2: Prohibiting`NULL UnitPrices`</span></span>

<span data-ttu-id="c70a4-212">データベースが使用できるように構成されているときに`NULL`の値が、`Products`テーブルの`UnitPrice`列、おように必要がありますを指定することから、この特定のページを訪問するユーザー、 `NULL` `UnitPrice`値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-212">While the database is configured to allow `NULL` values in the `Products` table's `UnitPrice` column, we may want to prevent users visiting this particular page from specifying a `NULL` `UnitPrice` value.</span></span> <span data-ttu-id="c70a4-213">つまり、ユーザーが入力に失敗した場合、 `UnitPrice` 、このページで、編集済みの製品が必要となる指定した価格をユーザーに通知するメッセージを表示しデータベースに結果を保存するのではなく、製品の行を編集するときの値します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-213">That is, if a user fails to enter a `UnitPrice` value when editing a product row, rather than save the results to the database we want to display a message informing the user that, through this page, any edited products must have a price specified.</span></span>

<span data-ttu-id="c70a4-214">`GridViewUpdateEventArgs` GridView にオブジェクトが渡された`RowUpdating`イベント ハンドラーに含まれる、`Cancel`プロパティを場合に、設定`True`、更新プロセスを終了します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-214">The `GridViewUpdateEventArgs` object passed into the GridView's `RowUpdating` event handler contains a `Cancel` property that, if set to `True`, terminates the updating process.</span></span> <span data-ttu-id="c70a4-215">拡張してみましょう、`RowUpdating`イベント ハンドラーを設定する`e.Cancel`に`True`場合は、理由を説明するメッセージを表示して、`UnitPrice`値で、`NewValues`コレクションの値には、`Nothing`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-215">Let's extend the `RowUpdating` event handler to set `e.Cancel` to `True` and display a message explaining why if the `UnitPrice` value in the `NewValues` collection has a value of `Nothing`.</span></span>

<span data-ttu-id="c70a4-216">という名前のページに、ラベルの Web コントロールを追加することによって開始`MustProvideUnitPriceMessage`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-216">Start by adding a Label Web control to the page named `MustProvideUnitPriceMessage`.</span></span> <span data-ttu-id="c70a4-217">指定する、ユーザーが失敗した場合、このラベル コントロールが表示されます、`UnitPrice`製品を更新するときの値します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-217">This Label control will be displayed if the user fails to specify a `UnitPrice` value when updating a product.</span></span> <span data-ttu-id="c70a4-218">ラベルの設定`Text`プロパティを「価格は、製品の提供する必要があります」です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-218">Set the Label's `Text` property to "You must provide a price for the product."</span></span> <span data-ttu-id="c70a4-219">新しい CSS クラスを作成しました`Styles.css`という`Warning`を次の定義。</span><span class="sxs-lookup"><span data-stu-id="c70a4-219">I've also created a new CSS class in `Styles.css` named `Warning` with the following definition:</span></span>


[!code-css[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample5.css)]

<span data-ttu-id="c70a4-220">最後に、設定、ラベルの`CssClass`プロパティを`Warning`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-220">Finally, set the Label's `CssClass` property to `Warning`.</span></span> <span data-ttu-id="c70a4-221">この時点で、デザイナーが図 12 に示すように、赤、太字、斜体で警告メッセージ、GridView 上余分な大きなフォント サイズを表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-221">At this point the Designer should show the warning message in a red, bold, italic, extra large font size above the GridView, as shown in Figure 12.</span></span>


<span data-ttu-id="c70a4-222">[![GridView 上のラベルが追加されました](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-222">[![A Label Has Been Added Above the GridView](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image35.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image34.png)</span></span>

<span data-ttu-id="c70a4-223">**図 12**: A ラベルがされて追加上 GridView ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-223">**Figure 12**: A Label Has Been Added Above the GridView ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image36.png))</span></span>


<span data-ttu-id="c70a4-224">既定では、このラベルを非表示、設定によりその`Visible`プロパティを`False`で、`Page_Load`イベントのハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c70a4-224">By default, this Label should be hidden, so set its `Visible` property to `False` in the `Page_Load` event handler:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample6.vb)]

<span data-ttu-id="c70a4-225">ユーザーを指定せず、製品を更新しようとしたかどうか、`UnitPrice`更新をキャンセルし、警告のラベルを表示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-225">If the user attempts to update a product without specifying the `UnitPrice`, we want to cancel the update and display the warning label.</span></span> <span data-ttu-id="c70a4-226">GridView の補強`RowUpdating`次のようにイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c70a4-226">Augment the GridView's `RowUpdating` event handler as follows:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample7.vb)]

<span data-ttu-id="c70a4-227">ユーザーが、料金を指定せず、製品を保存しようとすると場合、は、更新が取り消され、便利なメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-227">If a user attempts to save a product without specifying a price, the update is cancelled and a helpful message is displayed.</span></span> <span data-ttu-id="c70a4-228">データベース (およびのビジネス ロジック) の中では、 `NULL` `UnitPrice` s、この特定の ASP.NET ページはありません。</span><span class="sxs-lookup"><span data-stu-id="c70a4-228">While the database (and business logic) allows for `NULL` `UnitPrice` s, this particular ASP.NET page does not.</span></span>


<span data-ttu-id="c70a4-229">[![ユーザーが UnitPrice 空白から出られません。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-229">[![A User Cannot Leave UnitPrice Blank](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image38.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image37.png)</span></span>

<span data-ttu-id="c70a4-230">**図 13**: ユーザーからから出られません A`UnitPrice`空白 ([フルサイズのイメージを表示するには、をクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))。</span><span class="sxs-lookup"><span data-stu-id="c70a4-230">**Figure 13**: A User Cannot Leave `UnitPrice` Blank ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image39.png))</span></span>


<span data-ttu-id="c70a4-231">GridView を使用する方法を説明しましたこれまで`RowUpdating`をプログラムによって、ObjectDataSource に割り当てられているパラメーター値を変更するイベント`UpdateParameters`コレクションにもを取り消すには完全に処理を更新する方法です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-231">So far we have seen how to use the GridView's `RowUpdating` event to programmatically alter the parameter values assigned to the ObjectDataSource's `UpdateParameters` collection as well as how to cancel the updating process altogether.</span></span> <span data-ttu-id="c70a4-232">これらの概念は DetailsView およびフォームのコントロールに引き継がれると、挿入および削除にも適用されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-232">These concepts carry over to the DetailsView and FormView controls and also apply to inserting and deleting.</span></span>

<span data-ttu-id="c70a4-233">ObjectDataSource レベルのイベント ハンドラーではこれらのタスクを実行することもその`Inserting`、 `Updating`、および`Deleting`イベント。</span><span class="sxs-lookup"><span data-stu-id="c70a4-233">These tasks can also be done at the ObjectDataSource level through event handlers for its `Inserting`, `Updating`, and `Deleting` events.</span></span> <span data-ttu-id="c70a4-234">これらのイベントは、基になるオブジェクトの関連付けられたメソッドが呼び出される前に発生させるし、入力パラメーターのコレクションを変更または完全の操作をキャンセルする最終機会を提供します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-234">These events fire before the associated method of the underlying object is invoked and provide a last-chance opportunity to modify the input parameters collection or cancel the operation outright.</span></span> <span data-ttu-id="c70a4-235">これら 3 つのイベントのイベント ハンドラーの型のオブジェクトが渡される[ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx)関心のある 2 つのプロパティを持ちます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-235">The event handlers for these three events are passed an object of type [ObjectDataSourceMethodEventArgs](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs(VS.80).aspx) that has two properties of interest:</span></span>

- <span data-ttu-id="c70a4-236">[キャンセル](https://msdn.microsoft.com/en-US/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx)、これは場合に設定`True`、実行中の操作を取り消します</span><span class="sxs-lookup"><span data-stu-id="c70a4-236">[Cancel](https://msdn.microsoft.com/en-US/library/system.componentmodel.canceleventargs.cancel(VS.80).aspx), which, if set to `True`, cancels the operation being performed</span></span>
- <span data-ttu-id="c70a4-237">[入力パラメーター](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx)のコレクションである`InsertParameters`、 `UpdateParameters`、または`DeleteParameters`かどうかは、イベント ハンドラーによって、 `Inserting`、 `Updating`、または`Deleting`イベント</span><span class="sxs-lookup"><span data-stu-id="c70a4-237">[InputParameters](https://msdn.microsoft.com/en-US/library/system.web.ui.webcontrols.objectdatasourcemethodeventargs.inputparameters(VS.80).aspx), which is the collection of `InsertParameters`, `UpdateParameters`, or `DeleteParameters`, depending on whether the event handler is for the `Inserting`, `Updating`, or `Deleting` event</span></span>

<span data-ttu-id="c70a4-238">ObjectDataSource レベルでパラメーター値の操作を示すためには、新しい製品を追加することができます、ページで、DetailsView を含めてみましょう。</span><span class="sxs-lookup"><span data-stu-id="c70a4-238">To illustrate working with the parameter values at the ObjectDataSource level, let's include a DetailsView in our page that allows the users to add a new product.</span></span> <span data-ttu-id="c70a4-239">この DetailsView は、データベースに簡単に新しい製品を追加するためのインターフェイスを提供する使用されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-239">This DetailsView will be used to provide an interface for quickly adding a new product to the database.</span></span> <span data-ttu-id="c70a4-240">新しい製品に追加してみましょうのみの値を入力するユーザーを許可するときに、一貫性のあるユーザー インターフェイスを保持する、`ProductName`と`UnitPrice`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-240">To keep a consistent user interface when adding a new product let's allow the user to only enter values for the `ProductName` and `UnitPrice` fields.</span></span> <span data-ttu-id="c70a4-241">既定では、いない DetailsView の挿入のインターフェイスに提供されているこれらの値に設定されます、`NULL`データベースの値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-241">By default, those values that aren't supplied in the DetailsView's inserting interface will be set to a `NULL` database value.</span></span> <span data-ttu-id="c70a4-242">ただし、ObjectDataSource を使用してお`Inserting`間もなくおわかりのように、別の既定値を挿入するイベントです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-242">However, we can use the ObjectDataSource's `Inserting` event to inject different default values, as we'll see shortly.</span></span>

## <a name="step-3-providing-an-interface-to-add-new-products"></a><span data-ttu-id="c70a4-243">手順 3: 新しい製品を追加するインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-243">Step 3: Providing an Interface to Add New Products</span></span>

<span data-ttu-id="c70a4-244">GridView 上のデザイナーには、ツールボックスからクリア DetailsView をドラッグしてその`Height`と`Width`プロパティ、およびバインドのページに、ObjectDataSource に既に存在します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-244">Drag a DetailsView from the Toolbox onto the Designer above the GridView, clear out its `Height` and `Width` properties, and bind it to the ObjectDataSource already present on the page.</span></span> <span data-ttu-id="c70a4-245">各製品のフィールドの BoundField または CheckBoxField が追加されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-245">This will add a BoundField or CheckBoxField for each of the product's fields.</span></span> <span data-ttu-id="c70a4-246">この DetailsView を使用して、新しい製品を追加するので、スマート タグから挿入を有効にするオプションをオンにする必要があります。ただし、オプションはありませんこのようなので、ObjectDataSource`Insert()`メソッドがメソッドにマップされていない、`ProductsBLL`クラス (図 3 を参照するデータ ソースを構成するときに、このマッピングを (なし) を設定おリコール)。</span><span class="sxs-lookup"><span data-stu-id="c70a4-246">Since we want to use this DetailsView to add new products, we need to check the Enable Inserting option from the smart tag; however, there's no such option because the ObjectDataSource's `Insert()` method is not mapped to a method in the `ProductsBLL` class (recall that we set this mapping to (None) when configuring the data source see Figure 3).</span></span>

<span data-ttu-id="c70a4-247">ObjectDataSource を構成するのには、ウィザードの起動のスマート タグからデータ ソースの構成 リンクを選択します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-247">To configure the ObjectDataSource, select the Configure Data Source link from its smart tag, launching the wizard.</span></span> <span data-ttu-id="c70a4-248">最初の画面では、するには、ObjectDataSource がバインドされている基になるオブジェクトを変更できます。ままに`ProductsBLL`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-248">The first screen allows you to change the underlying object the ObjectDataSource is bound to; leave it set to `ProductsBLL`.</span></span> <span data-ttu-id="c70a4-249">次の画面には、ObjectDataSource のメソッドから、基になるオブジェクトへのマッピングが一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-249">The next screen lists the mappings from the ObjectDataSource's methods to the underlying object's.</span></span> <span data-ttu-id="c70a4-250">ここに明示的に指定する場合でも、`Insert()`と`Delete()`メソッドを任意のメソッドにマップする必要はありません、INSERT、および DELETE の各タブに移動する場合、マッピングが存在するが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-250">Even though we explicitly indicated that the `Insert()` and `Delete()` methods should not be mapped to any methods, if you go to the INSERT and DELETE tabs you'll see that a mapping is there.</span></span> <span data-ttu-id="c70a4-251">これは、ため、`ProductsBLL`の`AddProduct`と`DeleteProduct`メソッドを使用して、`DataObjectMethodAttribute`属性の既定のメソッドがあることを示すために`Insert()`と`Delete()`、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-251">This is because the `ProductsBLL`'s `AddProduct` and `DeleteProduct` methods use the `DataObjectMethodAttribute` attribute to indicate that they are the default methods for `Insert()` and `Delete()`, respectively.</span></span> <span data-ttu-id="c70a4-252">そのため、ObjectDataSource ウィザードは、明示的に指定されたその他の値がない限り、ウィザードを実行するこれら各時間を選択します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-252">Hence, the ObjectDataSource wizard selects these each time you run the wizard unless there's some other value explicitly specified.</span></span>

<span data-ttu-id="c70a4-253">ままにして、`Insert()`メソッドを指す、`AddProduct`メソッドが、もう一度 (なし)、削除 タブのドロップダウン リストを設定します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-253">Leave the `Insert()` method pointing to the `AddProduct` method, but again set the DELETE tab's drop-down list to (None).</span></span>


<span data-ttu-id="c70a4-254">[![AddProduct メソッドに、[挿入] タブのドロップダウン リストを設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-254">[![Set the INSERT Tab's Drop-Down List to the AddProduct Method](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image41.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image40.png)</span></span>

<span data-ttu-id="c70a4-255">**図 14**: に挿入 タブのドロップダウン リストを設定、`AddProduct`メソッド ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-255">**Figure 14**: Set the INSERT Tab's Drop-Down List to the `AddProduct` Method ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image42.png))</span></span>


<span data-ttu-id="c70a4-256">[![(なし)、[削除] タブのボックスの一覧を設定します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-256">[![Set the DELETE Tab's Drop-Down List to (None)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image44.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image43.png)</span></span>

<span data-ttu-id="c70a4-257">**図 15**: (None) に、タブの削除のドロップダウン リストの設定 ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-257">**Figure 15**: Set the DELETE Tab's Drop-Down List to (None) ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image45.png))</span></span>


<span data-ttu-id="c70a4-258">これらの変更を加えたら、ObjectDataSource の宣言の構文を含むように拡張されます、`InsertParameters`コレクション、次のようにします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-258">After making these changes, the ObjectDataSource's declarative syntax will be expanded to include an `InsertParameters` collection, as shown below:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample8.aspx)]

<span data-ttu-id="c70a4-259">再び追加ウィザードを再実行する、`OldValuesParameterFormatString`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-259">Rerunning the wizard added back the `OldValuesParameterFormatString` property.</span></span> <span data-ttu-id="c70a4-260">既定値に設定することによってこのプロパティをオフにする (`{0}`) または宣言構文からを完全を削除します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-260">Take a moment to clear this property by setting it to the default value (`{0}`) or removing it altogether from the declarative syntax.</span></span>

<span data-ttu-id="c70a4-261">挿入する機能を提供する ObjectDataSource、DetailsView のスマート タグの表示と表示されます、挿入を有効にする チェック ボックスです。デザイナーに戻り、このオプションをオンにします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-261">With the ObjectDataSource providing inserting capabilities, the DetailsView's smart tag will now include the Enable Inserting checkbox; return to the Designer and check this option.</span></span> <span data-ttu-id="c70a4-262">次に、サイズを縮小 DetailsView の 2 つの BoundFields のみがある表示されるように`ProductName`と`UnitPrice`-、CommandField とします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-262">Next, pare down the DetailsView so that it only has two BoundFields - `ProductName` and `UnitPrice` - and the CommandField.</span></span> <span data-ttu-id="c70a4-263">この時点で DetailsView の宣言の構文は、ようになります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-263">At this point the DetailsView's declarative syntax should look like:</span></span>


[!code-aspx[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample9.aspx)]

<span data-ttu-id="c70a4-264">図 16 では、この時点で、ブラウザーで表示したときに、このページを示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-264">Figure 16 shows this page when viewed through a browser at this point.</span></span> <span data-ttu-id="c70a4-265">ご覧のように、DetailsView には、(Chai) の最初の製品の価格と名前が一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-265">As you can see, the DetailsView lists the name and price of the first product (Chai).</span></span> <span data-ttu-id="c70a4-266">ここで必要なデータが、ユーザー データベースを新しい製品をすばやく追加するための手段を提供する挿入インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-266">What we want, however, is an inserting interface that provides a means for the user to quickly add a new product to the database.</span></span>


<span data-ttu-id="c70a4-267">[![DetailsView は読み取り専用モードで現在レンダリングされています。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-267">[![The DetailsView is Currently Rendered in Read-Only Mode](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image47.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image46.png)</span></span>

<span data-ttu-id="c70a4-268">**図 16**:「DetailsView は読み取り専用モードで現在レンダリングされている ([フルサイズ イメージを表示するに、をクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-268">**Figure 16**: The DetailsView is Currently Rendered in Read-Only Mode ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image48.png))</span></span>


<span data-ttu-id="c70a4-269">挿入モードを設定する必要がありますで DetailsView を表示するのには、`DefaultMode`プロパティを`Inserting`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-269">In order to show the DetailsView in its inserting mode we need to set the `DefaultMode` property to `Inserting`.</span></span> <span data-ttu-id="c70a4-270">これにより、最初にアクセスされるときに、挿入モードで DetailsView をレンダリングされ、新しいレコードを挿入した後に保持することがあります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-270">This renders the DetailsView in insert mode when first visited and keeps it there after inserting a new record.</span></span> <span data-ttu-id="c70a4-271">図 17 では、このような DetailsView は、新しいレコードを追加するため、クイック インターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-271">As Figure 17 shows, such a DetailsView provides a quick interface for adding a new record.</span></span>


<span data-ttu-id="c70a4-272">[![DetailsView に新しい製品を簡単に追加するためのインターフェイスを提供します。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-272">[![The DetailsView Provides an Interface for Quickly Adding a New Product](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image50.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image49.png)</span></span>

<span data-ttu-id="c70a4-273">**図 17**: DetailsView のインターフェイスを提供簡単に追加する新しい製品 ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-273">**Figure 17**: The DetailsView Provides an Interface for Quickly Adding a New Product ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image51.png))</span></span>


<span data-ttu-id="c70a4-274">ユーザーは、製品名と ("Acme Water"図 17 と同様から 1.99 など) の価格を入力し、挿入をクリックすると、ポストバックに陥りますすると、データベースに追加される新しい製品レコードの挿入のワークフローが開始します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-274">When the user enters a product name and price (such as "Acme Water" and 1.99, as in Figure 17) and clicks Insert, a postback ensues and the inserting workflow commences, culminating in a new product record being added to the database.</span></span> <span data-ttu-id="c70a4-275">DetailsView では、その挿入インターフェイスおよび GridView は自動的に再バインドのデータ ソースに、新しい製品を含めるために図 18 に示すようには維持します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-275">The DetailsView maintains its inserting interface and the GridView is automatically rebound to its data source in order to include the new product, as shown in Figure 18.</span></span>


![製品](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image52.png)

<span data-ttu-id="c70a4-277">**図 18**: 製品"Acme Water"がデータベースに追加されました</span><span class="sxs-lookup"><span data-stu-id="c70a4-277">**Figure 18**: The Product "Acme Water" Has Been Added to the Database</span></span>


<span data-ttu-id="c70a4-278">図 18 に GridView しないフィールドを表示し、製品 DetailsView インターフェイスから不足しているときに`CategoryID`、 `SupplierID`、`QuantityPerUnit`に割り当てられた`NULL`データベースの値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-278">While the GridView in Figure 18 doesn't show it, the product fields lacking from the DetailsView interface `CategoryID`, `SupplierID`, `QuantityPerUnit`, and so on are assigned `NULL` database values.</span></span> <span data-ttu-id="c70a4-279">これは、次の手順を実行することによって確認できます。</span><span class="sxs-lookup"><span data-stu-id="c70a4-279">You can see this by performing the following steps:</span></span>

1. <span data-ttu-id="c70a4-280">Visual Studio でのサーバー エクスプ ローラーに移動します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-280">Go to the Server Explorer in Visual Studio</span></span>
2. <span data-ttu-id="c70a4-281">展開する、`NORTHWND.MDF`データベース ノード</span><span class="sxs-lookup"><span data-stu-id="c70a4-281">Expanding the `NORTHWND.MDF` database node</span></span>
3. <span data-ttu-id="c70a4-282">右クリックし、`Products`データベース テーブルのノード</span><span class="sxs-lookup"><span data-stu-id="c70a4-282">Right-click on the `Products` database table node</span></span>
4. <span data-ttu-id="c70a4-283">テーブル データの表示を選択します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-283">Select Show Table Data</span></span>

<span data-ttu-id="c70a4-284">これが一覧表示、すべてのレコードで、`Products`テーブル。</span><span class="sxs-lookup"><span data-stu-id="c70a4-284">This will list all of the records in the `Products` table.</span></span> <span data-ttu-id="c70a4-285">図 19 に示すように、すべての新しい製品の列以外の`ProductID`、 `ProductName`、および`UnitPrice`が`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-285">As Figure 19 shows, all of our new product's columns other than `ProductID`, `ProductName`, and `UnitPrice` have `NULL` values.</span></span>


<span data-ttu-id="c70a4-286">[![NULL 値の割り当てには、製品フィールドに指定されていない DetailsView です。](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-286">[![The Product Fields Not Provided in the DetailsView are Assigned NULL Values](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image54.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image53.png)</span></span>

<span data-ttu-id="c70a4-287">**図 19**: 割り当てられた、製品フィールドに指定されていない DetailsView`NULL`値 ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-287">**Figure 19**: The Product Fields Not Provided in the DetailsView are Assigned `NULL` Values ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image55.png))</span></span>


<span data-ttu-id="c70a4-288">以外の場合、既定値を提供することがあります`NULL`これらの 1 つ以上の列値は、いずれかため`NULL`最適な既定オプションのないデータベース列自体を許可していないので、または`NULL`s。</span><span class="sxs-lookup"><span data-stu-id="c70a4-288">We may want to provide a default value other than `NULL` for one or more of these column values, either because `NULL` isn't the best default option or because the database column itself doesn't allow `NULL` s.</span></span> <span data-ttu-id="c70a4-289">これを実現するプログラムで設定できます。 DetailsView のパラメーターの値`InputParameters`コレクション。</span><span class="sxs-lookup"><span data-stu-id="c70a4-289">To accomplish this we can programmatically set the values of the parameters of the DetailsView's `InputParameters` collection.</span></span> <span data-ttu-id="c70a4-290">この割り当てすることができますか、イベント ハンドラー DetailsView の`ItemInserting`イベントまたは ObjectDataSource の`Inserting`イベント。</span><span class="sxs-lookup"><span data-stu-id="c70a4-290">This assignment can be done either in the event handler for the DetailsView's `ItemInserting` event or the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="c70a4-291">既に説明しましたので前と後のレベルのイベントを使用して、データを Web でレベルを制御、ObjectDataSource のイベントをこの時間を使用してを見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="c70a4-291">Since we've already looked at using the pre- and post-level events at the data Web control level, let's explore using the ObjectDataSource's events this time.</span></span>

## <a name="step-4-assigning-values-to-thecategoryidandsupplieridparameters"></a><span data-ttu-id="c70a4-292">手順 4: の値を割り当て、`CategoryID`と`SupplierID`パラメーター</span><span class="sxs-lookup"><span data-stu-id="c70a4-292">Step 4: Assigning Values to the`CategoryID`and`SupplierID`Parameters</span></span>

<span data-ttu-id="c70a4-293">このチュートリアルと想像してこのインターフェイスを使用して新しい製品を追加するときに、アプリケーションの必要がありますの割り当てを`CategoryID`と`SupplierID`1 の値。</span><span class="sxs-lookup"><span data-stu-id="c70a4-293">For this tutorial let's imagine that for our application when adding a new product through this interface it should be assigned a `CategoryID` and `SupplierID` value of 1.</span></span> <span data-ttu-id="c70a4-294">前述のように、ObjectDataSource が前と後のレベルのイベントのペア発生するデータ変更処理中にします。</span><span class="sxs-lookup"><span data-stu-id="c70a4-294">As mentioned earlier, the ObjectDataSource has a pair of pre- and post-level events that fire during the data modification process.</span></span> <span data-ttu-id="c70a4-295">ときにその`Insert()`メソッドが呼び出され、最初に、ObjectDataSource を発生させますその`Inserting`イベント、メソッドを呼び出しているその`Insert()`メソッドは、マップされてさせ、最後に、`Inserted`イベント。</span><span class="sxs-lookup"><span data-stu-id="c70a4-295">When its `Insert()` method is invoked, the ObjectDataSource first raises its `Inserting` event, then calls the method that its `Insert()` method has been mapped to, and finally raises the `Inserted` event.</span></span> <span data-ttu-id="c70a4-296">`Inserting`イベント ハンドラーにより、私たちは、入力パラメーターを調整または完全の操作をキャンセルする最後の機会を 1 つです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-296">The `Inserting` event handler affords us one last opportunity to tweak the input parameters or cancel the operation outright.</span></span>

> [!NOTE]
> <span data-ttu-id="c70a4-297">可能性がありますするさせるか、実際のアプリケーション ユーザーが、カテゴリと仕入先を指定するかのいくつかの条件に基づいてこの値を選択またはビジネス ロジック (なく盲目的 ID は 1 を選択) します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-297">In a real-world application you would likely want to either let the user specify the category and supplier or would pick this value for them based on some criteria or business logic (rather than blindly selecting an ID of 1).</span></span> <span data-ttu-id="c70a4-298">関係なく、プログラムで ObjectDataSource の事前レベルのイベントからの入力パラメーターの値を設定する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-298">Regardless, the example illustrates how to programmatically set the value of an input parameter from the ObjectDataSource's pre-level event.</span></span>


<span data-ttu-id="c70a4-299">ObjectDataSource のイベント ハンドラーを作成するには、しばらく時間かかる`Inserting`イベント。</span><span class="sxs-lookup"><span data-stu-id="c70a4-299">Take a moment to create an event handler for the ObjectDataSource's `Inserting` event.</span></span> <span data-ttu-id="c70a4-300">イベント ハンドラーの 2 番目の入力パラメーター型のオブジェクトであることに注意してください。 `ObjectDataSourceMethodEventArgs`、パラメーター コレクションにアクセスするプロパティを持つ (`InputParameters`) と、操作を取り消すプロパティ (`Cancel`)。</span><span class="sxs-lookup"><span data-stu-id="c70a4-300">Notice that the event handler's second input parameter is an object of type `ObjectDataSourceMethodEventArgs`, which has a property to access the parameters collection (`InputParameters`) and a property to cancel the operation (`Cancel`).</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample10.vb)]

<span data-ttu-id="c70a4-301">この時点で、`InputParameters`プロパティを含む、ObjectDataSource `InsertParameters` DetailsView から割り当てられた値を持つコレクション。</span><span class="sxs-lookup"><span data-stu-id="c70a4-301">At this point, the `InputParameters` property contains the ObjectDataSource's `InsertParameters` collection with the values assigned from the DetailsView.</span></span> <span data-ttu-id="c70a4-302">これらのパラメーターのいずれかの値を変更するだけで使用:`e.InputParameters("paramName") = value`です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-302">To change the value of one of these parameters, simply use: `e.InputParameters("paramName") = value`.</span></span> <span data-ttu-id="c70a4-303">そのため、設定する、`CategoryID`と`SupplierID`1 の値は、調整、`Inserting`イベント ハンドラーを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c70a4-303">Therefore, to set the `CategoryID` and `SupplierID` to values of 1, adjust the `Inserting` event handler to look like the following:</span></span>


[!code-vb[Main](examining-the-events-associated-with-inserting-updating-and-deleting-vb/samples/sample11.vb)]

<span data-ttu-id="c70a4-304">この時間 (など Acme Soda)、新しい製品を追加するときに、`CategoryID`と`SupplierID`新製品の列が 1 に設定されます (図 20 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c70a4-304">This time when adding a new product (such as Acme Soda), the `CategoryID` and `SupplierID` columns of the new product are set to 1 (see Figure 20).</span></span>


<span data-ttu-id="c70a4-305">[![新しい製品は、CategoryID および SupplierID をある値を 1 に設定](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span><span class="sxs-lookup"><span data-stu-id="c70a4-305">[![New Products Now Have Their CategoryID and SupplierID Values Set to 1](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image57.png)](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image56.png)</span></span>

<span data-ttu-id="c70a4-306">**図 20**: 新しい製品ようになりましたがあるその`CategoryID`と`SupplierID`値 1 に設定 ([フルサイズのイメージを表示するをクリックして](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span><span class="sxs-lookup"><span data-stu-id="c70a4-306">**Figure 20**: New Products Now Have Their `CategoryID` and `SupplierID` Values Set to 1 ([Click to view full-size image](examining-the-events-associated-with-inserting-updating-and-deleting-vb/_static/image58.png))</span></span>


## <a name="summary"></a><span data-ttu-id="c70a4-307">概要</span><span class="sxs-lookup"><span data-stu-id="c70a4-307">Summary</span></span>

<span data-ttu-id="c70a4-308">中に、編集、挿入、およびプロセスを削除すると、データの Web コントロールと、ObjectDataSource の両方が、前と後のレベルのイベントの数を実行します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-308">During the editing, inserting, and deleting process, both the data Web control and the ObjectDataSource proceed through a number of pre- and post-level events.</span></span> <span data-ttu-id="c70a4-309">このチュートリアルは、前のレベルのイベントを調査し、これらを使用して、入力パラメーターをカスタマイズしたり、データ変更操作をキャンセル両方のデータの Web コントロールと ObjectDataSource のイベントから完全する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-309">In this tutorial we examined the pre-level events and saw how to use these to customize the input parameters or cancel the data modification operation altogether both from the data Web control and ObjectDataSource's events.</span></span> <span data-ttu-id="c70a4-310">次のチュートリアルで作成して、後のレベルのイベントのイベント ハンドラーを使用してに紹介します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-310">In the next tutorial we'll look at creating and using event handlers for the post-level events.</span></span>

<span data-ttu-id="c70a4-311">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="c70a4-311">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="c70a4-312">作成者について</span><span class="sxs-lookup"><span data-stu-id="c70a4-312">About the Author</span></span>

<span data-ttu-id="c70a4-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="c70a4-313">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c70a4-314">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c70a4-314">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c70a4-315">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-315">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="c70a4-316">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="c70a4-316">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="c70a4-317">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="c70a4-317">Special Thanks To</span></span>

<span data-ttu-id="c70a4-318">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="c70a4-318">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c70a4-319">このチュートリアルの潜在顧客レビュー担当者は、Jackie Goor および Liz Shulok がいました。</span><span class="sxs-lookup"><span data-stu-id="c70a4-319">Lead reviewers for this tutorial were Jackie Goor and Liz Shulok.</span></span> <span data-ttu-id="c70a4-320">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="c70a4-320">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c70a4-321">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="c70a4-321">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c70a4-322">[前へ](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[次へ](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c70a4-322">[Previous](an-overview-of-inserting-updating-and-deleting-data-vb.md)
[Next](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md)</span></span>
