---
uid: web-forms/overview/data-access/introduction/creating-a-business-logic-layer-vb
title: "ビジネス ロジック層 (VB) を作成 |Microsoft ドキュメント"
author: rick-anderson
description: "このチュートリアルでは、t 間のデータ交換の仲介役として機能するビジネス ロジック層 (BLL) に、ビジネス ルールを集中管理する方法を思いますしています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/31/2010
ms.topic: article
ms.assetid: 142e5181-29ce-4bb9-907b-2a0becf7928b
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/introduction/creating-a-business-logic-layer-vb
msc.type: authoredcontent
ms.openlocfilehash: 7722ed54e333515f641f1c1adf647c4ec08dfb6b
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="creating-a-business-logic-layer-vb"></a><span data-ttu-id="fa873-103">ビジネス ロジック層 (VB) を作成します。</span><span class="sxs-lookup"><span data-stu-id="fa873-103">Creating a Business Logic Layer (VB)</span></span>
====================
<span data-ttu-id="fa873-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fa873-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fa873-105">[サンプル アプリをダウンロード](http://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_2_VB.exe)または[PDF のダウンロード](creating-a-business-logic-layer-vb/_static/datatutorial02vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="fa873-105">[Download Sample App](http://download.microsoft.com/download/5/d/7/5d7571fc-d0b7-4798-ad4a-c976c02363ce/ASPNET_Data_Tutorial_2_VB.exe) or [Download PDF](creating-a-business-logic-layer-vb/_static/datatutorial02vb1.pdf)</span></span>

> <span data-ttu-id="fa873-106">このチュートリアルではプレゼンテーション層と DAL 間のデータ交換の仲介役として機能するビジネス ロジック層 (BLL) に、ビジネス ルールを集中管理する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa873-106">In this tutorial we'll see how to centralize your business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span>


## <a name="introduction"></a><span data-ttu-id="fa873-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="fa873-107">Introduction</span></span>

<span data-ttu-id="fa873-108">データ アクセス レイヤー (DAL) が作成された、[の最初のチュートリアル](creating-a-data-access-layer-vb.md)プレゼンテーション ロジックからクリーンに分離、データ アクセス ロジック。</span><span class="sxs-lookup"><span data-stu-id="fa873-108">The Data Access Layer (DAL) created in the [first tutorial](creating-a-data-access-layer-vb.md) cleanly separates the data access logic from the presentation logic.</span></span> <span data-ttu-id="fa873-109">ただし、DAL は、プレゼンテーション層から、データ アクセスの詳細を明確に区分、中に適用される任意のビジネス ルールは実行されません。</span><span class="sxs-lookup"><span data-stu-id="fa873-109">However, while the DAL cleanly separates the data access details from the presentation layer, it does not enforce any business rules that may apply.</span></span> <span data-ttu-id="fa873-110">たとえば、アプリケーションのすることも許可しないように、`CategoryID`または`SupplierID`のフィールド、`Products`ときに変更するテーブル、`Discontinued`フィールドが 1 に設定されているか、必要になる勤続ルールを適用する場合に、禁止すること、従業員は、それらの後が採用されたすべてのユーザーによって管理されます。</span><span class="sxs-lookup"><span data-stu-id="fa873-110">For example, for our application we may want to disallow the `CategoryID` or `SupplierID` fields of the `Products` table to be modified when the `Discontinued` field is set to 1, or we might want to enforce seniority rules, prohibiting situations in which an employee is managed by someone who was hired after them.</span></span> <span data-ttu-id="fa873-111">もう 1 つの一般的なシナリオは、特定のロールのユーザーが承認おそらくだけが製品を削除できますか、変更できます、`UnitPrice`値。</span><span class="sxs-lookup"><span data-stu-id="fa873-111">Another common scenario is authorization perhaps only users in a particular role can delete products or can change the `UnitPrice` value.</span></span>

<span data-ttu-id="fa873-112">このチュートリアルではプレゼンテーション層と DAL 間のデータ交換の仲介役として機能するビジネス ロジック層 (BLL) にこれらのビジネス ルールを集中管理する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa873-112">In this tutorial we'll see how to centralize these business rules into a Business Logic Layer (BLL) that serves as an intermediary for data exchange between the presentation layer and the DAL.</span></span> <span data-ttu-id="fa873-113">実際のアプリケーションでは、別のクラス ライブラリ プロジェクト; として BLL を実装します。ただし、これらのチュートリアルについてを実装します BLL 一連のクラスとして、`App_Code`プロジェクトの構造を簡略化するためのフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="fa873-113">In a real-world application, the BLL should be implemented as a separate Class Library project; however, for these tutorials we'll implement the BLL as a series of classes in our `App_Code` folder in order to simplify the project structure.</span></span> <span data-ttu-id="fa873-114">図 1 は、プレゼンテーション層、BLL、DAL のアーキテクチャの関係を示します。</span><span class="sxs-lookup"><span data-stu-id="fa873-114">Figure 1 illustrates the architectural relationships among the presentation layer, BLL, and DAL.</span></span>


![BLL がデータ アクセス層とプレゼンテーション層を分離し、ビジネス ルールでは、](creating-a-business-logic-layer-vb/_static/image1.png)

<span data-ttu-id="fa873-116">**図 1**: BLL がデータ アクセス層とプレゼンテーション層を分離し、ビジネス ルールでは、</span><span class="sxs-lookup"><span data-stu-id="fa873-116">**Figure 1**: The BLL Separates the Presentation Layer from the Data Access Layer and Imposes Business Rules</span></span>


<span data-ttu-id="fa873-117">実装する別のクラスを作成するのではなく、[ビジネス ロジック](http://en.wikipedia.org/wiki/Business_logic)、または部分クラスを含む入力データセット内で直接このロジックを配置お可能性があります。</span><span class="sxs-lookup"><span data-stu-id="fa873-117">Rather than creating separate classes to implement our [business logic](http://en.wikipedia.org/wiki/Business_logic), we could alternatively place this logic directly in the Typed DataSet with partial classes.</span></span> <span data-ttu-id="fa873-118">作成して、型指定されたデータセットを拡張の例を参照して戻すの最初のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="fa873-118">For an example of creating and extending a Typed DataSet, refer back to the first tutorial.</span></span>

## <a name="step-1-creating-the-bll-classes"></a><span data-ttu-id="fa873-119">手順 1: BLL クラスの作成</span><span class="sxs-lookup"><span data-stu-id="fa873-119">Step 1: Creating the BLL Classes</span></span>

<span data-ttu-id="fa873-120">BLL がで構成されている各 TableAdapter DAL; 内の 1 つ、4 つのクラスこれらの各 BLL クラスにより、取得、挿入、更新、および適切なビジネス ルールの適用、DAL のそれぞれの TableAdapter から削除するためのメソッドがあります。</span><span class="sxs-lookup"><span data-stu-id="fa873-120">Our BLL will be composed of four classes, one for each TableAdapter in the DAL; each of these BLL classes will have methods for retrieving, inserting, updating, and deleting from the respective TableAdapter in the DAL, applying the appropriate business rules.</span></span>

<span data-ttu-id="fa873-121">明確に分離 DAL および BLL に関連するクラス、内の 2 つのサブフォルダーを作成しましょう、`App_Code`フォルダー、`DAL`と`BLL`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-121">To more cleanly separate the DAL- and BLL-related classes, let's create two subfolders in the `App_Code` folder, `DAL` and `BLL`.</span></span> <span data-ttu-id="fa873-122">右クリック、`App_Code`ソリューション エクスプ ローラーでフォルダーの新しいフォルダーを選択します。</span><span class="sxs-lookup"><span data-stu-id="fa873-122">Simply right-click on the `App_Code` folder in the Solution Explorer and choose New Folder.</span></span> <span data-ttu-id="fa873-123">これら 2 つのフォルダーを作成した後に最初のチュートリアルで作成された入力データセットに移動、`DAL`サブフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="fa873-123">After creating these two folders, move the Typed DataSet created in the first tutorial into the `DAL` subfolder.</span></span>

<span data-ttu-id="fa873-124">次の 4 つの BLL クラス ファイルを作成、`BLL`サブフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="fa873-124">Next, create the four BLL class files in the `BLL` subfolder.</span></span> <span data-ttu-id="fa873-125">これを行うを右クリックし、`BLL`サブフォルダー、追加、新しい項目をクラス テンプレートを選択します。</span><span class="sxs-lookup"><span data-stu-id="fa873-125">To accomplish this, right-click on the `BLL` subfolder, choose Add a New Item, and choose the Class template.</span></span> <span data-ttu-id="fa873-126">4 つのクラスの名前を付けます`ProductsBLL`、 `CategoriesBLL`、 `SuppliersBLL`、および`EmployeesBLL`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-126">Name the four classes `ProductsBLL`, `CategoriesBLL`, `SuppliersBLL`, and `EmployeesBLL`.</span></span>


![4 つの新しいクラスを App_Code フォルダーに追加します。](creating-a-business-logic-layer-vb/_static/image2.png)

<span data-ttu-id="fa873-128">**図 2**: に 4 つの新しいクラスを追加、`App_Code`フォルダー</span><span class="sxs-lookup"><span data-stu-id="fa873-128">**Figure 2**: Add Four New Classes to the `App_Code` Folder</span></span>


<span data-ttu-id="fa873-129">次に、単に最初のチュートリアルから Tableadapter に定義されたメソッドをラップするクラスの各メソッドを追加してみましょう。</span><span class="sxs-lookup"><span data-stu-id="fa873-129">Next, let's add methods to each of the classes to simply wrap the methods defined for the TableAdapters from the first tutorial.</span></span> <span data-ttu-id="fa873-130">ここでは、これらのメソッドがだけ DAL; に直接呼び出す必要なビジネス ロジックを追加する以降を返します。</span><span class="sxs-lookup"><span data-stu-id="fa873-130">For now, these methods will just call directly into the DAL; we'll return later to add any needed business logic.</span></span>

> [!NOTE]
> <span data-ttu-id="fa873-131">Visual Studio Standard Edition を使用しているか (できたら、*いない*Visual Web Developer を使用して)、視覚的に使用するクラスをデザインすることができます必要に応じて、[クラス デザイナー](https://msdn.microsoft.com/library/default.asp?url=/library/en-us/dv_vstechart/html/clssdsgnr.asp)です。</span><span class="sxs-lookup"><span data-stu-id="fa873-131">If you are using Visual Studio Standard Edition or above (that is, you're *not* using Visual Web Developer), you can optionally design your classes visually using the [Class Designer](https://msdn.microsoft.com/library/default.asp?url=/library/en-us/dv_vstechart/html/clssdsgnr.asp).</span></span> <span data-ttu-id="fa873-132">参照してください、[クラス デザイナー ブログ](https://blogs.msdn.com/classdesigner/default.aspx)Visual Studio のこの新機能についての詳細。</span><span class="sxs-lookup"><span data-stu-id="fa873-132">Refer to the [Class Designer Blog](https://blogs.msdn.com/classdesigner/default.aspx) for more information on this new feature in Visual Studio.</span></span>


<span data-ttu-id="fa873-133">`ProductsBLL`クラス 7 つのメソッドの合計を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa873-133">For the `ProductsBLL` class we need to add a total of seven methods:</span></span>

- <span data-ttu-id="fa873-134">`GetProducts()`すべての製品を返します</span><span class="sxs-lookup"><span data-stu-id="fa873-134">`GetProducts()` returns all products</span></span>
- <span data-ttu-id="fa873-135">`GetProductByProductID(productID)`指定された製品 ID の積を返します</span><span class="sxs-lookup"><span data-stu-id="fa873-135">`GetProductByProductID(productID)` returns the product with the specified product ID</span></span>
- <span data-ttu-id="fa873-136">`GetProductsByCategoryID(categoryID)`指定されたカテゴリからすべての製品を返します</span><span class="sxs-lookup"><span data-stu-id="fa873-136">`GetProductsByCategoryID(categoryID)` returns all products from the specified category</span></span>
- <span data-ttu-id="fa873-137">`GetProductsBySupplier(supplierID)`指定された業者からのすべての製品を返します</span><span class="sxs-lookup"><span data-stu-id="fa873-137">`GetProductsBySupplier(supplierID)` returns all products from the specified supplier</span></span>
- <span data-ttu-id="fa873-138">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)`値を使用してデータベースに新しい製品を挿入します。 渡されたのです。返します、`ProductID`新しく挿入したレコードの値</span><span class="sxs-lookup"><span data-stu-id="fa873-138">`AddProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued)` inserts a new product into the database using the values passed-in; returns the `ProductID` value of the newly inserted record</span></span>
- <span data-ttu-id="fa873-139">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)`渡されたの値を使用して、データベースの既存の製品を更新します。返します`True`正確に 1 つの行が更新された場合`False`それ以外の場合</span><span class="sxs-lookup"><span data-stu-id="fa873-139">`UpdateProduct(productName, supplierID, categoryID, quantityPerUnit, unitPrice, unitsInStock, unitsOnOrder, reorderLevel, discontinued, productID)` updates an existing product in the database using the passed-in values; returns `True` if precisely one row was updated, `False` otherwise</span></span>
- <span data-ttu-id="fa873-140">`DeleteProduct(productID)`指定した製品をデータベースから削除します。</span><span class="sxs-lookup"><span data-stu-id="fa873-140">`DeleteProduct(productID)` deletes the specified product from the database</span></span>

<span data-ttu-id="fa873-141">ProductsBLL.vb</span><span class="sxs-lookup"><span data-stu-id="fa873-141">ProductsBLL.vb</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample1.vb)]

<span data-ttu-id="fa873-142">単にデータを返すメソッド`GetProducts`、 `GetProductByProductID`、 `GetProductsByCategoryID`、および`GetProductBySuppliersID`だけを呼び出すことがダウンして、DAL に、非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="fa873-142">The methods that simply return data `GetProducts`, `GetProductByProductID`, `GetProductsByCategoryID`, and `GetProductBySuppliersID` are fairly straightforward as they simply call down into the DAL.</span></span> <span data-ttu-id="fa873-143">一部のシナリオでもありますが実装する必要があるビジネス規則レベルでは、現在ログオンしているユーザーまたはユーザーが属しているロールに基づいて承認規則) など、単にままにこれらのメソッドには。</span><span class="sxs-lookup"><span data-stu-id="fa873-143">While in some scenarios there may be business rules that need to be implemented at this level (such as authorization rules based on the currently logged on user or the role to which the user belongs), we'll simply leave these methods as-is.</span></span> <span data-ttu-id="fa873-144">これらのメソッドでは、次に、BLL 単プロキシとして機能プレゼンテーション層、データ アクセス層から基になるデータにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="fa873-144">For these methods, then, the BLL serves merely as a proxy through which the presentation layer accesses the underlying data from the Data Access Layer.</span></span>

<span data-ttu-id="fa873-145">`AddProduct`と`UpdateProduct`メソッド両方パラメーターとして製品のさまざまなフィールドの値取得し、新しい製品を追加または、既存のものをそれぞれ更新します。</span><span class="sxs-lookup"><span data-stu-id="fa873-145">The `AddProduct` and `UpdateProduct` methods both take in as parameters the values for the various product fields and add a new product or update an existing one, respectively.</span></span> <span data-ttu-id="fa873-146">以降の多く、`Product`テーブルの列を受け入れることができます`NULL`値 (`CategoryID`、 `SupplierID`、および`UnitPrice`、いくつかの例)、入力パラメーターを`AddProduct`と`UpdateProduct`このような列の使用にマップします。[null 許容型](https://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.80).aspx)です。</span><span class="sxs-lookup"><span data-stu-id="fa873-146">Since many of the `Product` table's columns can accept `NULL` values (`CategoryID`, `SupplierID`, and `UnitPrice`, to name a few), those input parameters for `AddProduct` and `UpdateProduct` that map to such columns use [nullable types](https://msdn.microsoft.com/en-us/library/1t3y8s4s(v=vs.80).aspx).</span></span> <span data-ttu-id="fa873-147">Null 許容型は .NET 2.0 に追加された新しいおよび技法を提供するかどうか、値型は、代わりを示す`Nothing`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-147">Nullable types are new to .NET 2.0 and provide a technique for indicating whether a value type should, instead, be `Nothing`.</span></span> <span data-ttu-id="fa873-148">参照してください、 [Paul Vick](http://www.panopticoncentral.net/)のブログ エントリ[null 許容型についての情報源および VB](http://www.panopticoncentral.net/archive/2004/06/04/1180.aspx)およびの技術ドキュメント、 [Nullable](https://msdn.microsoft.com/en-US/library/b3h38hb0%28VS.80%29.aspx)構造での詳細情報。</span><span class="sxs-lookup"><span data-stu-id="fa873-148">Refer to the [Paul Vick](http://www.panopticoncentral.net/)'s blog entry [The Truth About Nullable Types and VB](http://www.panopticoncentral.net/archive/2004/06/04/1180.aspx) and the technical documentation for the [Nullable](https://msdn.microsoft.com/en-US/library/b3h38hb0%28VS.80%29.aspx) structure for more information.</span></span>

<span data-ttu-id="fa873-149">3 つのメソッドは、行の電源が挿入されていること、更新、または操作が影響を受ける行のされないことがあるために、削除かどうかを示すブール値を返します。</span><span class="sxs-lookup"><span data-stu-id="fa873-149">All three methods return a Boolean value indicating whether a row was inserted, updated, or deleted since the operation may not result in an affected row.</span></span> <span data-ttu-id="fa873-150">ページの開発者が呼び出す場合など、`DeleteProduct`で渡すこと、`ProductID`存在しない製品では、 `DELETE` 、データベースへの発行ステートメントには効果がありませんおよび、`DeleteProduct`メソッドが返す`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-150">For example, if the page developer calls `DeleteProduct` passing in a `ProductID` for a non-existent product, the `DELETE` statement issued to the database will have no affect and therefore the `DeleteProduct` method will return `False`.</span></span>

<span data-ttu-id="fa873-151">新しい製品を追加するときに注意してくださいか、既存の更新おのまたは新しいまたは変更された製品のフィールドの値を受け入れるではなくスカラーのリストとして、`ProductsRow`インスタンス。</span><span class="sxs-lookup"><span data-stu-id="fa873-151">Note that when adding a new product or updating an existing one we take in the new or modified product's field values as a list of scalars as opposed to accepting a `ProductsRow` instance.</span></span> <span data-ttu-id="fa873-152">この方法が選択された、 `ProductsRow` ADO.NET クラス`DataRow`クラスで、既定のパラメーターなしのコンス トラクターがありません。</span><span class="sxs-lookup"><span data-stu-id="fa873-152">This approach was chosen because the `ProductsRow` class derives from the ADO.NET `DataRow` class, which doesn't have a default parameterless constructor.</span></span> <span data-ttu-id="fa873-153">新規作成するために`ProductsRow`インスタンスである必要があります最初に作成、`ProductsDataTable`インスタンスを起動し、その`NewProductRow()`メソッド (で行っている`AddProduct`)。</span><span class="sxs-lookup"><span data-stu-id="fa873-153">In order to create a new `ProductsRow` instance, we must first create a `ProductsDataTable` instance and then invoke its `NewProductRow()` method (which we do in `AddProduct`).</span></span> <span data-ttu-id="fa873-154">挿入して、ObjectDataSource を使用して製品の更新に移るときに、この欠点は、ヘッドをこのです。</span><span class="sxs-lookup"><span data-stu-id="fa873-154">This shortcoming rears its head when we turn to inserting and updating products using the ObjectDataSource.</span></span> <span data-ttu-id="fa873-155">つまり、ObjectDataSource しようとした入力パラメーターのインスタンスを作成します。</span><span class="sxs-lookup"><span data-stu-id="fa873-155">In short, the ObjectDataSource will try to create an instance of the input parameters.</span></span> <span data-ttu-id="fa873-156">BLL メソッドが受け取る場合、`ProductsRow`インスタンス、ObjectDataSource は、1 つを作成し、既定のパラメーターなしのコンス トラクターがないのため失敗する可能性が試行されます。</span><span class="sxs-lookup"><span data-stu-id="fa873-156">If the BLL method expects a `ProductsRow` instance, the ObjectDataSource will try to create one, but fail due to the lack of a default parameterless constructor.</span></span> <span data-ttu-id="fa873-157">この問題の詳細については、次の 2 つの ASP.NET フォーラム投稿を参照してください: [Strongly-Typed データセットで更新 ObjectDataSources](https://forums.asp.net/1098630/ShowPost.aspx)、および[ObjectDataSource で問題と Strongly-Typed データセット](https://forums.asp.net/1048212/ShowPost.aspx).</span><span class="sxs-lookup"><span data-stu-id="fa873-157">For more information on this problem, refer to the following two ASP.NET Forums posts: [Updating ObjectDataSources with Strongly-Typed DataSets](https://forums.asp.net/1098630/ShowPost.aspx), and [Problem With ObjectDataSource and Strongly-Typed DataSet](https://forums.asp.net/1048212/ShowPost.aspx).</span></span>

<span data-ttu-id="fa873-158">次に、両方で`AddProduct`と`UpdateProduct`、コードを作成、`ProductsRow`インスタンスし、単に渡された値を設定します。</span><span class="sxs-lookup"><span data-stu-id="fa873-158">Next, in both `AddProduct` and `UpdateProduct`, the code creates a `ProductsRow` instance and populates it with the values just passed in.</span></span> <span data-ttu-id="fa873-159">DataRow の DataColumns に値を割り当てるときにさまざまなフィールド レベルの検証チェックが発生することができます。</span><span class="sxs-lookup"><span data-stu-id="fa873-159">When assigning values to DataColumns of a DataRow various field-level validation checks can occur.</span></span> <span data-ttu-id="fa873-160">そのため、手動で渡された値に戻す DataRow により、BLL メソッドに渡されるデータの妥当性。</span><span class="sxs-lookup"><span data-stu-id="fa873-160">Therefore, manually putting the passed in values back into a DataRow helps ensure the validity of the data being passed to the BLL method.</span></span> <span data-ttu-id="fa873-161">残念ながら Visual Studio によって生成される厳密に型指定された DataRow クラスには、null 許容型は使用しません。</span><span class="sxs-lookup"><span data-stu-id="fa873-161">Unfortunately the strongly-typed DataRow classes generated by Visual Studio do not use nullable types.</span></span> <span data-ttu-id="fa873-162">代わりに、DataRow で特定の DataColumn に対応することを示すために、`NULL`データベースの値を使用する必要があります、`SetColumnNameNull()`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa873-162">Rather, to indicate that a particular DataColumn in a DataRow should correspond to a `NULL` database value we must use the `SetColumnNameNull()` method.</span></span>

<span data-ttu-id="fa873-163">`UpdateProduct`を使用して更新するには、この製品に最初に読み込むこと`GetProductByProductID(productID)`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-163">In `UpdateProduct` we first load in the product to update using `GetProductByProductID(productID)`.</span></span> <span data-ttu-id="fa873-164">このかもしれませんが、データベースへの不要なアクセスと同様に、この追加のトリップが証明されてオプティミスティック同時実行制御を探索するチュートリアルが将来の価値のあるいます。</span><span class="sxs-lookup"><span data-stu-id="fa873-164">While this may seem like an unnecessary trip to the database, this extra trip will prove worthwhile in future tutorials that explore optimistic concurrency.</span></span> <span data-ttu-id="fa873-165">オプティミスティック同時実行制御は、同じデータに対して同時に作業している 2 人のユーザーが 1 つに相互の変更を誤って上書きしないようにする手法です。</span><span class="sxs-lookup"><span data-stu-id="fa873-165">Optimistic concurrency is a technique to ensure that two users who are simultaneously working on the same data don't accidentally overwrite one another's changes.</span></span> <span data-ttu-id="fa873-166">レコード全体をグラブもやすく DataRow の列のサブセットにのみ変更 BLL で update メソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="fa873-166">Grabbing the entire record also makes it easier to create update methods in the BLL that only modify a subset of the DataRow's columns.</span></span> <span data-ttu-id="fa873-167">ナビゲートすると、`SuppliersBLL`クラスのような例を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="fa873-167">When we explore the `SuppliersBLL` class we'll see such an example.</span></span>

<span data-ttu-id="fa873-168">最後に、なお、`ProductsBLL`クラスには、 [DataObject 属性](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectattribute.aspx)、適用される (、`[System.ComponentModel.DataObject]`右ステートメントの前に、クラス ファイルの先頭付近に構文) あり、メソッドを持つ[DataObjectMethodAttribute 属性](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectmethodattribute.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="fa873-168">Finally, note that the `ProductsBLL` class has the [DataObject attribute](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectattribute.aspx) applied to it (the `[System.ComponentModel.DataObject]` syntax right before the class statement near the top of the file) and the methods have [DataObjectMethodAttribute attributes](https://msdn.microsoft.com/en-us/library/system.componentmodel.dataobjectmethodattribute.aspx).</span></span> <span data-ttu-id="fa873-169">`DataObject`属性でマークされているバインディングに適したオブジェクトとクラス、 [ObjectDataSource コントロール](https://msdn.microsoft.com/en-us/library/9a4kyhcx.aspx)であるのに対し、`DataObjectMethodAttribute`メソッドの目的を示します。</span><span class="sxs-lookup"><span data-stu-id="fa873-169">The `DataObject` attribute marks the class as being an object suitable for binding to an [ObjectDataSource control](https://msdn.microsoft.com/en-us/library/9a4kyhcx.aspx), whereas the `DataObjectMethodAttribute` indicates the purpose of the method.</span></span> <span data-ttu-id="fa873-170">思います将来のチュートリアル、ASP.NET 2.0 の ObjectDataSource 簡単に宣言してクラスのデータにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="fa873-170">As we'll see in future tutorials, ASP.NET 2.0's ObjectDataSource makes it easy to declaratively access data from a class.</span></span> <span data-ttu-id="fa873-171">ObjectDataSource のウィザードにバインド可能なクラスのリストをフィルター処理するには、既定では、としてマークされているクラスだけ`DataObjects`ウィザードのドロップダウン リストに表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa873-171">To help filter the list of possible classes to bind to in the ObjectDataSource's wizard, by default only those classes marked as `DataObjects` are shown in the wizard's drop-down list.</span></span> <span data-ttu-id="fa873-172">`ProductsBLL`クラスなしでは機能と同様、これらの属性が、それらを追加すると、ObjectDataSource のウィザードで作業しやすくします。</span><span class="sxs-lookup"><span data-stu-id="fa873-172">The `ProductsBLL` class will work just as well without these attributes, but adding them makes it easier to work with in the ObjectDataSource's wizard.</span></span>

## <a name="adding-the-other-classes"></a><span data-ttu-id="fa873-173">その他のクラスを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa873-173">Adding the Other Classes</span></span>

<span data-ttu-id="fa873-174">`ProductsBLL`クラスが完了したら、必要がありますカテゴリ、供給業者、および従業員を操作するためのクラスを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa873-174">With the `ProductsBLL` class complete, we still need to add the classes for working with categories, suppliers, and employees.</span></span> <span data-ttu-id="fa873-175">次のクラスと上記の例からの概念を使用してメソッドを作成するのにはしばらくを実行します。</span><span class="sxs-lookup"><span data-stu-id="fa873-175">Take a moment to create the following classes and methods using the concepts from the example above:</span></span>

- <span data-ttu-id="fa873-176">**CategoriesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="fa873-176">**CategoriesBLL.cs**</span></span>

    - `GetCategories()`
    - `GetCategoryByCategoryID(categoryID)`
- <span data-ttu-id="fa873-177">**SuppliersBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="fa873-177">**SuppliersBLL.cs**</span></span>

    - `GetSuppliers()`
    - `GetSupplierBySupplierID(supplierID)`
    - `GetSuppliersByCountry(country)`
    - `UpdateSupplierAddress(supplierID, address, city, country)`
- <span data-ttu-id="fa873-178">**EmployeesBLL.cs**</span><span class="sxs-lookup"><span data-stu-id="fa873-178">**EmployeesBLL.cs**</span></span>

    - `GetEmployees()`
    - `GetEmployeeByEmployeeID(employeeID)`
    - `GetEmployeesByManager(managerID)`

<span data-ttu-id="fa873-179">注目すべき 1 つのメソッドは、`SuppliersBLL`クラスの`UpdateSupplierAddress`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa873-179">The one method worth noting is the `SuppliersBLL` class's `UpdateSupplierAddress` method.</span></span> <span data-ttu-id="fa873-180">このメソッドは、仕入先のアドレスの情報だけを更新するためのインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="fa873-180">This method provides an interface for updating just the supplier's address information.</span></span> <span data-ttu-id="fa873-181">このメソッドが内部的には、読み取り、 `SupplierDataRow` 、指定されたオブジェクト`supplierID`(を使用して`GetSupplierBySupplierID`)、そのアドレスに関連するプロパティを設定してからに、`SupplierDataTable`の`Update`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa873-181">Internally, this method reads in the `SupplierDataRow` object for the specified `supplierID` (using `GetSupplierBySupplierID`), sets its address-related properties, and then calls down into the `SupplierDataTable`'s `Update` method.</span></span> <span data-ttu-id="fa873-182">`UpdateSupplierAddress`メソッドに従います。</span><span class="sxs-lookup"><span data-stu-id="fa873-182">The `UpdateSupplierAddress` method follows:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample2.vb)]

<span data-ttu-id="fa873-183">この記事のダウンロード、BLL クラスの完全な実装を参照してください。</span><span class="sxs-lookup"><span data-stu-id="fa873-183">Refer to this article's download for my complete implementation of the BLL classes.</span></span>

## <a name="step-2-accessing-the-typed-datasets-through-the-bll-classes"></a><span data-ttu-id="fa873-184">手順 2: BLL クラスを介して型指定されたデータセットにアクセスします。</span><span class="sxs-lookup"><span data-stu-id="fa873-184">Step 2: Accessing the Typed DataSets Through the BLL Classes</span></span>

<span data-ttu-id="fa873-185">プログラムでは、型指定されたデータセットを直接操作の例の最初のチュートリアルで見た BLL クラスの追加により、プレゼンテーション層使用する必要が BLL に対して代わりにします。</span><span class="sxs-lookup"><span data-stu-id="fa873-185">In the first tutorial we saw examples of working directly with the Typed DataSet programmatically, but with the addition of our BLL classes, the presentation tier should work against the BLL instead.</span></span> <span data-ttu-id="fa873-186">`AllProducts.aspx`から最初のチュートリアルでは、例を`ProductsTableAdapter`次のコードに示すように、製品の一覧を GridView にバインドする使用されました。</span><span class="sxs-lookup"><span data-stu-id="fa873-186">In the `AllProducts.aspx` example from the first tutorial, the `ProductsTableAdapter` was used to bind the list of products to a GridView, as shown in the following code:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample3.vb)]

<span data-ttu-id="fa873-187">使用して新しい BLL するものをすべて変更する必要があるクラスは単純に置き換えます。 最初のコード行、`ProductsTableAdapter`オブジェクトを、`ProductBLL`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="fa873-187">To use the new BLL classes, all that needs to be changed is the first line of code simply replace the `ProductsTableAdapter` object with a `ProductBLL` object:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample4.vb)]

<span data-ttu-id="fa873-188">BLL クラスは、ObjectDataSource を使用して (型指定されたデータセットをできます)、宣言によってアクセスすることもできます。</span><span class="sxs-lookup"><span data-stu-id="fa873-188">The BLL classes can also be accessed declaratively (as can the Typed DataSet) by using the ObjectDataSource.</span></span> <span data-ttu-id="fa873-189">ここで説明するさらに詳しく ObjectDataSource 次のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="fa873-189">We'll be discussing the ObjectDataSource in greater detail in the following tutorials.</span></span>


<span data-ttu-id="fa873-190">[![GridView には、製品の一覧を表示してください。](creating-a-business-logic-layer-vb/_static/image4.png)](creating-a-business-logic-layer-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="fa873-190">[![The List of Products is Displayed in a GridView](creating-a-business-logic-layer-vb/_static/image4.png)](creating-a-business-logic-layer-vb/_static/image3.png)</span></span>

<span data-ttu-id="fa873-191">**図 3**: GridView に、製品の一覧が表示されます ([フルサイズのイメージを表示するをクリックして](creating-a-business-logic-layer-vb/_static/image5.png))</span><span class="sxs-lookup"><span data-stu-id="fa873-191">**Figure 3**: The List of Products is Displayed in a GridView ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image5.png))</span></span>


## <a name="step-3-adding-field-level-validation-to-the-datarow-classes"></a><span data-ttu-id="fa873-192">手順 3: DataRow クラスにフィールド レベルの検証を追加します。</span><span class="sxs-lookup"><span data-stu-id="fa873-192">Step 3: Adding Field-Level Validation to the DataRow Classes</span></span>

<span data-ttu-id="fa873-193">フィールド レベルの検証には、挿入または更新すると、ビジネス オブジェクトのプロパティの値に関連する確認です。</span><span class="sxs-lookup"><span data-stu-id="fa873-193">Field-level validation are checks that pertains to the property values of the business objects when inserting or updating.</span></span> <span data-ttu-id="fa873-194">製品の一部のフィールド レベルの検証ルールは、次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="fa873-194">Some field-level validation rules for products include:</span></span>

- <span data-ttu-id="fa873-195">`ProductName`フィールドは 40 文字の長さ</span><span class="sxs-lookup"><span data-stu-id="fa873-195">The `ProductName` field must be 40 characters or less in length</span></span>
- <span data-ttu-id="fa873-196">`QuantityPerUnit`フィールドが 20 文字またはの長さにする必要があります</span><span class="sxs-lookup"><span data-stu-id="fa873-196">The `QuantityPerUnit` field must be 20 characters or less in length</span></span>
- <span data-ttu-id="fa873-197">`ProductID`、 `ProductName`、および`Discontinued`フィールドが必要ですが、その他のすべてのフィールドは省略可能</span><span class="sxs-lookup"><span data-stu-id="fa873-197">The `ProductID`, `ProductName`, and `Discontinued` fields are required, but all other fields are optional</span></span>
- <span data-ttu-id="fa873-198">`UnitPrice`、 `UnitsInStock`、 `UnitsOnOrder`、および`ReorderLevel`フィールドが 0 以上にする必要があります</span><span class="sxs-lookup"><span data-stu-id="fa873-198">The `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` fields must be greater than or equal to zero</span></span>

<span data-ttu-id="fa873-199">これらの規則は、ことができ、データベース レベルで表す必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa873-199">These rules can and should be expressed at the database level.</span></span> <span data-ttu-id="fa873-200">文字数の制限、`ProductName`と`QuantityPerUnit`フィールドがそれらの列のデータ型によってキャプチャされた、`Products`テーブル (`nvarchar(40)`と`nvarchar(20)`、それぞれ)。</span><span class="sxs-lookup"><span data-stu-id="fa873-200">The character limit on the `ProductName` and `QuantityPerUnit` fields are captured by the data types of those columns in the `Products` table (`nvarchar(40)` and `nvarchar(20)`, respectively).</span></span> <span data-ttu-id="fa873-201">場合により、データベース テーブルの列によって表されますフィールドは必須および省略可能なのかどうか`NULL`s。</span><span class="sxs-lookup"><span data-stu-id="fa873-201">Whether fields are required and optional are expressed by if the database table column allows `NULL` s.</span></span> <span data-ttu-id="fa873-202">次の 4 つ[check 制約](https://msdn.microsoft.com/en-us/library/ms188258.aspx)が存在するは、0 以上の値のみを実行できることを確認してください。、 `UnitPrice`、 `UnitsInStock`、 `UnitsOnOrder`、または`ReorderLevel`列です。</span><span class="sxs-lookup"><span data-stu-id="fa873-202">Four [check constraints](https://msdn.microsoft.com/en-us/library/ms188258.aspx) exist that ensure that only values greater than or equal to zero can make it into the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, or `ReorderLevel` columns.</span></span>

<span data-ttu-id="fa873-203">データベースでこれらの規則を適用するだけでなくする必要がありますも適用できます、データセット レベル。</span><span class="sxs-lookup"><span data-stu-id="fa873-203">In addition to enforcing these rules at the database they should also be enforced at the DataSet level.</span></span> <span data-ttu-id="fa873-204">実際には、フィールド長、および値が必須またはオプション既に DataColumns の各データ テーブルのセットをキャプチャします。</span><span class="sxs-lookup"><span data-stu-id="fa873-204">In fact, the field length and whether a value is required or optional are already captured for each DataTable's set of DataColumns.</span></span> <span data-ttu-id="fa873-205">自動的に提供される既存のフィールド レベルの検証を表示するには、データセット デザイナーに切り替え、データ テーブルのいずれかからフィールドを選択し、[プロパティ] ウィンドウに移動します。</span><span class="sxs-lookup"><span data-stu-id="fa873-205">To see the existing field-level validation automatically provided, go to the DataSet Designer, select a field from one of the DataTables and then go to the Properties window.</span></span> <span data-ttu-id="fa873-206">図 4 に示す、`QuantityPerUnit`に DataColumn、 `ProductsDataTable` 20 文字の最大長であるし、では、`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="fa873-206">As Figure 4 shows, the `QuantityPerUnit` DataColumn in the `ProductsDataTable` has a maximum length of 20 characters and does allow `NULL` values.</span></span> <span data-ttu-id="fa873-207">設定する場合、`ProductsDataRow`の`QuantityPerUnit`プロパティを文字列値が 20 文字以内に、`ArgumentException`がスローされます。</span><span class="sxs-lookup"><span data-stu-id="fa873-207">If we attempt to set the `ProductsDataRow`'s `QuantityPerUnit` property to a string value longer than 20 characters an `ArgumentException` will be thrown.</span></span>


<span data-ttu-id="fa873-208">[![DataColumn は、フィールド レベルの基本的な検証を提供します。](creating-a-business-logic-layer-vb/_static/image7.png)](creating-a-business-logic-layer-vb/_static/image6.png)</span><span class="sxs-lookup"><span data-stu-id="fa873-208">[![The DataColumn Provides Basic Field-Level Validation](creating-a-business-logic-layer-vb/_static/image7.png)](creating-a-business-logic-layer-vb/_static/image6.png)</span></span>

<span data-ttu-id="fa873-209">**図 4**: の DataColumn は、基本的なフィールド レベルの検証 ([フルサイズのイメージを表示するをクリックして](creating-a-business-logic-layer-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="fa873-209">**Figure 4**: The DataColumn Provides Basic Field-Level Validation ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image8.png))</span></span>


<span data-ttu-id="fa873-210">残念ながら、ことを指定できません範囲チェックなど、`UnitPrice`以上のプロパティ ウィンドウからの 0 に等しいを値として使用することがあります。</span><span class="sxs-lookup"><span data-stu-id="fa873-210">Unfortunately, we can't specify bounds checks, such as the `UnitPrice` value must be greater than or equal to zero, through the Properties window.</span></span> <span data-ttu-id="fa873-211">この種類のフィールド レベルの検証を提供するために必要がありますの DataTable のイベント ハンドラーを作成する[ColumnChanging](https://msdn.microsoft.com/en-us/library/system.data.datatable.columnchanging%28VS.80%29.aspx)イベント。</span><span class="sxs-lookup"><span data-stu-id="fa873-211">In order to provide this type of field-level validation we need to create an event handler for the DataTable's [ColumnChanging](https://msdn.microsoft.com/en-us/library/system.data.datatable.columnchanging%28VS.80%29.aspx) event.</span></span> <span data-ttu-id="fa873-212">説明したように、[前のチュートリアル](creating-a-data-access-layer-vb.md)、部分クラスを使用して型指定されたデータセットによって作成された DataSet、Datatable、および DataRow オブジェクトを拡張することができます。</span><span class="sxs-lookup"><span data-stu-id="fa873-212">As mentioned in the [preceding tutorial](creating-a-data-access-layer-vb.md), the DataSet, DataTables, and DataRow objects created by the Typed DataSet can be extended through the use of partial classes.</span></span> <span data-ttu-id="fa873-213">作成できるよう、この手法を使用して、`ColumnChanging`のイベント ハンドラー、`ProductsDataTable`クラスです。</span><span class="sxs-lookup"><span data-stu-id="fa873-213">Using this technique we can create a `ColumnChanging` event handler for the `ProductsDataTable` class.</span></span> <span data-ttu-id="fa873-214">内のクラスを作成することで開始、`App_Code`という名前のフォルダー`ProductsDataTable.ColumnChanging.vb`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-214">Start by creating a class in the `App_Code` folder named `ProductsDataTable.ColumnChanging.vb`.</span></span>


<span data-ttu-id="fa873-215">[![新しいクラスを App_Code フォルダーに追加します。](creating-a-business-logic-layer-vb/_static/image10.png)](creating-a-business-logic-layer-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="fa873-215">[![Add a New Class to the App_Code Folder](creating-a-business-logic-layer-vb/_static/image10.png)](creating-a-business-logic-layer-vb/_static/image9.png)</span></span>

<span data-ttu-id="fa873-216">**図 5**: 新しいクラスを追加、`App_Code`フォルダー ([フルサイズのイメージを表示するをクリックして](creating-a-business-logic-layer-vb/_static/image11.png))</span><span class="sxs-lookup"><span data-stu-id="fa873-216">**Figure 5**: Add a New Class to the `App_Code` Folder ([Click to view full-size image](creating-a-business-logic-layer-vb/_static/image11.png))</span></span>


<span data-ttu-id="fa873-217">イベント ハンドラーを次に、作成、`ColumnChanging`確実にするイベント、 `UnitPrice`、 `UnitsInStock`、 `UnitsOnOrder`、および`ReorderLevel`列の値 (ない場合`NULL`) より大きいか 0 に等しい。</span><span class="sxs-lookup"><span data-stu-id="fa873-217">Next, create an event handler for the `ColumnChanging` event that ensures that the `UnitPrice`, `UnitsInStock`, `UnitsOnOrder`, and `ReorderLevel` column values (if not `NULL`) are greater than or equal to zero.</span></span> <span data-ttu-id="fa873-218">このような任意の列が範囲外にある場合は、スロー、`ArgumentException`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-218">If any such column is out of range, throw an `ArgumentException`.</span></span>

<span data-ttu-id="fa873-219">ProductsDataTable.ColumnChanging.vb</span><span class="sxs-lookup"><span data-stu-id="fa873-219">ProductsDataTable.ColumnChanging.vb</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample5.vb)]

## <a name="step-4-adding-custom-business-rules-to-the-blls-classes"></a><span data-ttu-id="fa873-220">手順 4: BLL のクラスへのカスタム ビジネス ルールの追加</span><span class="sxs-lookup"><span data-stu-id="fa873-220">Step 4: Adding Custom Business Rules to the BLL's Classes</span></span>

<span data-ttu-id="fa873-221">フィールド レベルの検証だけでなくなどさまざまなエンティティまたは 1 つの列レベルでない表現の概念を含むレベルのカスタム ビジネス ルールがあります。</span><span class="sxs-lookup"><span data-stu-id="fa873-221">In addition to field-level validation, there may be high-level custom business rules that involve different entities or concepts not expressible at the single column level, such as:</span></span>

- <span data-ttu-id="fa873-222">場合は、製品が廃止されましたが、その`UnitPrice`を更新できません</span><span class="sxs-lookup"><span data-stu-id="fa873-222">If a product is discontinued, its `UnitPrice` cannot be updated</span></span>
- <span data-ttu-id="fa873-223">お住まいの国の従業員がお住まいの国の上司のと同じにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa873-223">An employee's country of residence must be the same as their manager's country of residence</span></span>
- <span data-ttu-id="fa873-224">供給業者によって提供される唯一の製品である場合、製品を取り消すことはできません。</span><span class="sxs-lookup"><span data-stu-id="fa873-224">A product cannot be discontinued if it is the only product provided by the supplier</span></span>

<span data-ttu-id="fa873-225">BLL クラスには、アプリケーションのビジネス ルールに準拠していることを確認するためのチェックを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa873-225">The BLL classes should contain checks to ensure adherence to the application's business rules.</span></span> <span data-ttu-id="fa873-226">これらのチェックは、適用するメソッドに直接追加することができます。</span><span class="sxs-lookup"><span data-stu-id="fa873-226">These checks can be added directly to the methods to which they apply.</span></span>

<span data-ttu-id="fa873-227">当社のビジネス ルールは、ある製品マークできませんでした提供が中止された場合は、指定された業者からの唯一の製品がディクテーション想像してください。</span><span class="sxs-lookup"><span data-stu-id="fa873-227">Imagine that our business rules dictate that a product could not be marked discontinued if it was the only product from a given supplier.</span></span> <span data-ttu-id="fa873-228">つまり場合、製品*X*が唯一の製品を供給業者から購入したお*Y*、おに設定できませんでした*X*ように提供が中止された; 場合、ただし、業者*Y*3 つの製品に付属しているご*A*、 *B*、および*C*、任意に設定でしたおよびとしてこれらすべての提供が中止されました。</span><span class="sxs-lookup"><span data-stu-id="fa873-228">That is, if product *X* was the only product we purchased from supplier *Y*, we could not mark *X* as discontinued; if, however, supplier *Y* supplied us with three products, *A*, *B*, and *C*, then we could mark any and all of these as discontinued.</span></span> <span data-ttu-id="fa873-229">奇数のビジネス ルールが、ビジネス ルールと一般的な意味が合っていない常に!</span><span class="sxs-lookup"><span data-stu-id="fa873-229">An odd business rule, but business rules and common sense aren't always aligned!</span></span>

<span data-ttu-id="fa873-230">このビジネス ルールを適用する、`UpdateProducts`メソッドを確認する場合は、まず`Discontinued`に設定された`True`と、ため、コールはお`GetProductsBySupplierID`この製品の供給業者から購入おを製品の数を決定します。</span><span class="sxs-lookup"><span data-stu-id="fa873-230">To enforce this business rule in the `UpdateProducts` method we'd start by checking if `Discontinued` was set to `True` and, if so, we'd call `GetProductsBySupplierID` to determine how many products we purchased from this product's supplier.</span></span> <span data-ttu-id="fa873-231">スローこの業者から 1 つの製品を購入すると、専用の場合、`ApplicationException`です。</span><span class="sxs-lookup"><span data-stu-id="fa873-231">If only one product is purchased from this supplier, we throw an `ApplicationException`.</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample6.vb)]

## <a name="responding-to-validation-errors-in-the-presentation-tier"></a><span data-ttu-id="fa873-232">プレゼンテーション層の検証エラーへの応答</span><span class="sxs-lookup"><span data-stu-id="fa873-232">Responding to Validation Errors in the Presentation Tier</span></span>

<span data-ttu-id="fa873-233">プレゼンテーション層から、BLL を呼び出すときに発生する可能性がありますまたは ASP.NET バブリングを知らせる例外を処理しようとするかどうかを判断できます (これが発生、`HttpApplication`の`Error`イベント)。</span><span class="sxs-lookup"><span data-stu-id="fa873-233">When calling the BLL from the presentation tier we can decide whether to attempt to handle any exceptions that might be raised or let them bubble up to ASP.NET (which will raise the `HttpApplication`'s `Error` event).</span></span> <span data-ttu-id="fa873-234">BLL をプログラムで使用する場合は、例外を処理するには、使用、[を再試行してください.キャッチ](https://msdn.microsoft.com/en-us/library/fk6t46tz%28VS.80%29.aspx)ブロックは、次の例を示します。</span><span class="sxs-lookup"><span data-stu-id="fa873-234">To handle an exception when working with the BLL programmatically, we can use a [Try...Catch](https://msdn.microsoft.com/en-us/library/fk6t46tz%28VS.80%29.aspx) block, as the following example shows:</span></span>


[!code-vb[Main](creating-a-business-logic-layer-vb/samples/sample7.vb)]

<span data-ttu-id="fa873-235">後でチュートリアルをお見せデータを使用する場合、BLL からバブルアップ例外の処理 Web コントロールの挿入、更新、または内のコードをラップするのではなく、イベント ハンドラー内で直接処理するデータを削除することができます、`Try...Catch`ブロックします。</span><span class="sxs-lookup"><span data-stu-id="fa873-235">As we'll see in future tutorials, handling exceptions that bubble up from the BLL when using a data Web control for inserting, updating, or deleting data can be handled directly in an event handler as opposed to having to wrap code in `Try...Catch` blocks.</span></span>

## <a name="summary"></a><span data-ttu-id="fa873-236">概要</span><span class="sxs-lookup"><span data-stu-id="fa873-236">Summary</span></span>

<span data-ttu-id="fa873-237">うまく設計されたアプリケーションを作成して、特定のロールをカプセル化の種類のレイヤーにします。</span><span class="sxs-lookup"><span data-stu-id="fa873-237">A well architected application is crafted into distinct layers, each of which encapsulates a particular role.</span></span> <span data-ttu-id="fa873-238">この記事シリーズの最初のチュートリアルで型指定されたデータセット; を使用してデータ アクセス レイヤーを作成しましたこのチュートリアルおが組み込まれているビジネス ロジック層、一連のクラスとして、アプリケーションの`App_Code`DAL 呼び出せるフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="fa873-238">In the first tutorial of this article series we created a Data Access Layer using Typed DataSets; in this tutorial we built a Business Logic Layer as a series of classes in our application's `App_Code` folder that call down into our DAL.</span></span> <span data-ttu-id="fa873-239">BLL では、アプリケーションのフィールド レベルおよびビジネス レベルのロジックを実装します。</span><span class="sxs-lookup"><span data-stu-id="fa873-239">The BLL implements the field-level and business-level logic for our application.</span></span> <span data-ttu-id="fa873-240">加え個別 BLL を作成するには、このチュートリアルで行ったように別のオプションは部分クラスを使用して、Tableadapter のメソッドを拡張します。</span><span class="sxs-lookup"><span data-stu-id="fa873-240">In addition to creating a separate BLL, as we did in this tutorial, another option is to extend the TableAdapters' methods through the use of partial classes.</span></span> <span data-ttu-id="fa873-241">ただし、この手法を使用することはできませんを既存のメソッドをオーバーライドするもはこれとを分離、DAL、BLL この記事の内容を使用しましたアプローチと明確にします。</span><span class="sxs-lookup"><span data-stu-id="fa873-241">However, using this technique does not allow us to override existing methods nor does it separate our DAL and our BLL as cleanly as the approach we've taken in this article.</span></span>

<span data-ttu-id="fa873-242">DAL BLL 完了と、プレゼンテーション層で開始する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="fa873-242">With the DAL and BLL complete, we're ready to start on our presentation layer.</span></span> <span data-ttu-id="fa873-243">[次のチュートリアル](master-pages-and-site-navigation-vb.md)データ アクセスに関するトピックから簡単な迂回を取得し、チュートリアルでは、全体で使用する一貫性のあるページ レイアウトを定義します。</span><span class="sxs-lookup"><span data-stu-id="fa873-243">In the [next tutorial](master-pages-and-site-navigation-vb.md) we'll take a brief detour from data access topics and define a consistent page layout for use throughout the tutorials.</span></span>

<span data-ttu-id="fa873-244">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="fa873-244">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="fa873-245">作成者について</span><span class="sxs-lookup"><span data-stu-id="fa873-245">About the Author</span></span>

<span data-ttu-id="fa873-246">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="fa873-246">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fa873-247">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="fa873-247">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fa873-248">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="fa873-248">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="fa873-249">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="fa873-249">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="fa873-250">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="fa873-250">Special Thanks To</span></span>

<span data-ttu-id="fa873-251">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="fa873-251">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fa873-252">このチュートリアルの潜在顧客レビュー担当者は、Liz Shulok、Dennis Patterson、Carlos Santos および Hilton Giesenow でした。</span><span class="sxs-lookup"><span data-stu-id="fa873-252">Lead reviewers for this tutorial were Liz Shulok, Dennis Patterson, Carlos Santos, and Hilton Giesenow.</span></span> <span data-ttu-id="fa873-253">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="fa873-253">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fa873-254">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fa873-254">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="fa873-255">[前へ](creating-a-data-access-layer-vb.md)
[次へ](master-pages-and-site-navigation-vb.md)</span><span class="sxs-lookup"><span data-stu-id="fa873-255">[Previous](creating-a-data-access-layer-vb.md)
[Next](master-pages-and-site-navigation-vb.md)</span></span>
