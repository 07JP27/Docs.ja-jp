---
uid: web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
title: "(VB) を挿入するバッチ |Microsoft ドキュメント"
author: rick-anderson
description: "単一の操作で複数のデータベース レコードを挿入する方法を説明します。 ユーザー インターフェイス レイヤーは、ユーザーに複数の n の入力を許可する GridView を拡張しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/26/2007
ms.topic: article
ms.assetid: 48e2a4ae-77ca-4208-a204-c38c690ffb59
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-batched-data/batch-inserting-vb
msc.type: authoredcontent
ms.openlocfilehash: e1e77dde4602350b18508bf5d71dbcd953f8961c
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="batch-inserting-vb"></a><span data-ttu-id="fa129-104">バッチ (VB) を挿入します。</span><span class="sxs-lookup"><span data-stu-id="fa129-104">Batch Inserting (VB)</span></span>
====================
<span data-ttu-id="fa129-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="fa129-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="fa129-106">[コードをダウンロードする](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip)または[PDF のダウンロード](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="fa129-106">[Download Code](http://download.microsoft.com/download/3/9/f/39f92b37-e92e-4ab3-909e-b4ef23d01aa3/ASPNET_Data_Tutorial_66_VB.zip) or [Download PDF](batch-inserting-vb/_static/datatutorial66vb1.pdf)</span></span>

> <span data-ttu-id="fa129-107">単一の操作で複数のデータベース レコードを挿入する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="fa129-107">Learn how to insert multiple database records in a single operation.</span></span> <span data-ttu-id="fa129-108">ユーザー インターフェイス レイヤーは、ユーザーに新しいレコードの複数の入力を許可する GridView を拡張します。</span><span class="sxs-lookup"><span data-stu-id="fa129-108">In the User Interface Layer we extend the GridView to allow the user to enter multiple new records.</span></span> <span data-ttu-id="fa129-109">データ アクセス層は、すべての挿入が成功するすべての挿入をロールバックすることを確認するトランザクション内で複数の Insert 操作をラップします。</span><span class="sxs-lookup"><span data-stu-id="fa129-109">In the Data Access Layer we wrap the multiple Insert operations within a transaction to ensure that all insertions succeed or all insertions are rolled back.</span></span>


## <a name="introduction"></a><span data-ttu-id="fa129-110">はじめに</span><span class="sxs-lookup"><span data-stu-id="fa129-110">Introduction</span></span>

<span data-ttu-id="fa129-111">[バッチ更新](batch-updating-vb.md)チュートリアルは複数のレコードが編集可能なインターフェイスを表示する GridView コントロールのカスタマイズについて説明しました。</span><span class="sxs-lookup"><span data-stu-id="fa129-111">In the [Batch Updating](batch-updating-vb.md) tutorial we looked at customizing the GridView control to present an interface where multiple records were editable.</span></span> <span data-ttu-id="fa129-112">ページにアクセスしたユーザーでした一連の変更を行い、1 つのボタンのクリックで、バッチ更新を実行します。</span><span class="sxs-lookup"><span data-stu-id="fa129-112">The user visiting the page could make a series of changes and then, with a single button click, perform a batch update.</span></span> <span data-ttu-id="fa129-113">ユーザーが通常 1 つの go の複数のレコードを更新の場合、このようなインターフェイスが無数のクリックを保存できます既定値と比較した場合、キーボード、マウスのコンテキストの切り替え行ごとに探索された最初の編集機能、 [、。挿入、更新、および削除するデータの概要](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="fa129-113">For situations where users commonly update many records in one go, such an interface can save countless clicks and keyboard-to-mouse context switches when compared to the default per-row editing features that were first explored back in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md) tutorial.</span></span>

<span data-ttu-id="fa129-114">この概念は、レコードを追加するときにも適用できます。</span><span class="sxs-lookup"><span data-stu-id="fa129-114">This concept can also be applied when adding records.</span></span> <span data-ttu-id="fa129-115">想像してみてくださいここで Northwind traders 一般的お客様からの出荷を特定のカテゴリの製品の数を含むサプライヤーからです。</span><span class="sxs-lookup"><span data-stu-id="fa129-115">Imagine that here at Northwind Traders we commonly receive shipments from suppliers that contain a number of products for a particular category.</span></span> <span data-ttu-id="fa129-116">例として、6 つの異なる tea とコーヒー製品の出荷東京 Traders から受け取った場合があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-116">As an example, we might receive a shipment of six different tea and coffee products from Tokyo Traders.</span></span> <span data-ttu-id="fa129-117">DetailsView コントロールを通じて、一度に 1 つの 6 つの製品を入力すると、それらが何度も多くの同じ値を選択する: 同じカテゴリ (飲み物)、同じ製造元 (東京 Traders) を選択する必要があります、同じ値 (が廃止されましたFalse の場合)、および順序の値 (0) で同じ単位です。</span><span class="sxs-lookup"><span data-stu-id="fa129-117">If a user enters the six products one at a time through a DetailsView control, they will have to choose many of the same values over and over again: they will need to choose the same category (Beverages), the same supplier (Tokyo Traders), the same discontinued value (False), and the same units on order value (0).</span></span> <span data-ttu-id="fa129-118">この反復的なデータ エントリだけ時間がかかりはありませんが間違いを犯しにくいです。</span><span class="sxs-lookup"><span data-stu-id="fa129-118">This repetitive data entry is not only time consuming, but is prone to errors.</span></span>

<span data-ttu-id="fa129-119">簡単な作業では、ユーザーが、業者とカテゴリ 1 回、一連の製品名および単位の価格を入力し、データベースに新しい製品を追加するボタンをクリックを選択できるようにするインターフェイスを挿入するバッチを作成できます (図 1 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="fa129-119">With a little work we can create a batch inserting interface that enables the user to choose the supplier and category once, enter a series of product names and unit prices, and then click a button to add the new products to the database (see Figure 1).</span></span> <span data-ttu-id="fa129-120">各製品が追加されるため、その`ProductName`と`UnitPrice`データ フィールドには、テキスト ボックスに入力した値が割り当てられますときにその`CategoryID`と`SupplierID`値には上位 fo フォームで DropDownLists から値が割り当てられます。</span><span class="sxs-lookup"><span data-stu-id="fa129-120">As each product is added, its `ProductName` and `UnitPrice` data fields are assigned the values entered in the TextBoxes, while its `CategoryID` and `SupplierID` values are assigned the values from the DropDownLists at the top fo the form.</span></span> <span data-ttu-id="fa129-121">`Discontinued`と`UnitsOnOrder`値のハードコード値に設定されます`False`と 0、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="fa129-121">The `Discontinued` and `UnitsOnOrder` values are set to the hard-coded values of `False` and 0, respectively.</span></span>


<span data-ttu-id="fa129-122">[![バッチ挿入インターフェイス](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-122">[![The Batch Inserting Interface](batch-inserting-vb/_static/image2.png)](batch-inserting-vb/_static/image1.png)</span></span>

<span data-ttu-id="fa129-123">**図 1**:、バッチ挿入インターフェイス ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-123">**Figure 1**: The Batch Inserting Interface ([Click to view full-size image](batch-inserting-vb/_static/image3.png))</span></span>


<span data-ttu-id="fa129-124">このチュートリアルでは図 1 に示すインターフェイスを挿入するバッチを実装するページを作成します。</span><span class="sxs-lookup"><span data-stu-id="fa129-124">In this tutorial we will create a page that implements the batch inserting interface shown in Figure 1.</span></span> <span data-ttu-id="fa129-125">として前の 2 つのチュートリアルでは、ラップ、挿入原子性が確保するトランザクションのスコープ内でします。</span><span class="sxs-lookup"><span data-stu-id="fa129-125">As with the previous two tutorials, we will wrap the insertions within the scope of a transaction to ensure atomicity.</span></span> <span data-ttu-id="fa129-126">開始 s を let!</span><span class="sxs-lookup"><span data-stu-id="fa129-126">Let s get started!</span></span>

## <a name="step-1-creating-the-display-interface"></a><span data-ttu-id="fa129-127">手順 1: 作成、表示インターフェイス</span><span class="sxs-lookup"><span data-stu-id="fa129-127">Step 1: Creating the Display Interface</span></span>

<span data-ttu-id="fa129-128">このチュートリアルは 2 つの領域に分割された 1 つのページで構成されます。 表示領域および挿入する領域です。</span><span class="sxs-lookup"><span data-stu-id="fa129-128">This tutorial will consist of a single page that is divided into two regions: a display region and an inserting region.</span></span> <span data-ttu-id="fa129-129">このステップを作成、表示インターフェイスの製品 GridView で示し製品の出荷を処理するというタイトルのボタンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="fa129-129">The display interface, which we'll create in this step, shows the products in a GridView and includes a button titled Process Product Shipment.</span></span> <span data-ttu-id="fa129-130">このボタンがクリックされたときに表示インターフェイスは図 1 に示されている挿入のインターフェイスに置き換えられます。</span><span class="sxs-lookup"><span data-stu-id="fa129-130">When this button is clicked, the display interface is replaced with the inserting interface, which is shown in Figure 1.</span></span> <span data-ttu-id="fa129-131">[キャンセル] ボタンをクリックするか、または表示インターフェイスが出荷から商品の追加後に返します。</span><span class="sxs-lookup"><span data-stu-id="fa129-131">The display interface returns after the Add Products from Shipment or Cancel buttons are clicked.</span></span> <span data-ttu-id="fa129-132">手順 2. で挿入するインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="fa129-132">We'll create the inserting interface in Step 2.</span></span>

<span data-ttu-id="fa129-133">これの 1 つのみが表示されている、一度に 2 つのインターフェイスを持つページを作成する場合の各インターフェイス通常内に配置されて、[パネル Web コントロール](http://www.w3schools.com/aspnet/control_panel.asp)の他のコントロールのコンテナーとして機能します。</span><span class="sxs-lookup"><span data-stu-id="fa129-133">When creating a page that has two interfaces, only one of which is visible at a time, each interface typically is placed within a [Panel Web control](http://www.w3schools.com/aspnet/control_panel.asp), which serves as a container for other controls.</span></span> <span data-ttu-id="fa129-134">そのため、当社のページには、インターフェイスごとに 2 つのパネル コントロール 1 つがあります。</span><span class="sxs-lookup"><span data-stu-id="fa129-134">Therefore, our page will have two Panel controls one for each interface.</span></span>

<span data-ttu-id="fa129-135">開いて開始、 `BatchInsert.aspx`  ページで、`BatchData`フォルダーと、ツールボックスからデザイナーにドラッグするパネル (図 2 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="fa129-135">Start by opening the `BatchInsert.aspx` page in the `BatchData` folder and drag a Panel from the Toolbox onto the Designer (see Figure 2).</span></span> <span data-ttu-id="fa129-136">パネル s 設定`ID`プロパティを`DisplayInterface`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-136">Set the Panel s `ID` property to `DisplayInterface`.</span></span> <span data-ttu-id="fa129-137">デザイナーにパネルを追加するときにその`Height`と`Width`プロパティがそれぞれの「50 px」と 125px、に設定されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-137">When adding the Panel to the Designer, its `Height` and `Width` properties are set to 50px and 125px, respectively.</span></span> <span data-ttu-id="fa129-138">[プロパティ] ウィンドウからこれらのプロパティ値をクリアします。</span><span class="sxs-lookup"><span data-stu-id="fa129-138">Clear out these property values from the Properties window.</span></span>


<span data-ttu-id="fa129-139">[![ツールボックスからデザイナーに表示するパネルをドラッグします。](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-139">[![Drag a Panel from the Toolbox onto the Designer](batch-inserting-vb/_static/image5.png)](batch-inserting-vb/_static/image4.png)</span></span>

<span data-ttu-id="fa129-140">**図 2**: ツールボックスからデザイナーに表示するパネルをドラッグして ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-140">**Figure 2**: Drag a Panel from the Toolbox onto the Designer ([Click to view full-size image](batch-inserting-vb/_static/image6.png))</span></span>


<span data-ttu-id="fa129-141">次に、ボタンと GridView コントロールをパネルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="fa129-141">Next, drag a Button and GridView control into the Panel.</span></span> <span data-ttu-id="fa129-142">ボタン s 設定`ID`プロパティを`ProcessShipment`とその`Text`製品の出荷を処理するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="fa129-142">Set the Button s `ID` property to `ProcessShipment` and its `Text` property to Process Product Shipment.</span></span> <span data-ttu-id="fa129-143">集合 GridView s`ID`プロパティを`ProductsGrid`と、という名前の新しい ObjectDataSource へのバインドのスマート タグから`ProductsDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-143">Set the GridView s `ID` property to `ProductsGrid` and, from its smart tag, bind it to a new ObjectDataSource named `ProductsDataSource`.</span></span> <span data-ttu-id="fa129-144">構成からそのデータをプルする ObjectDataSource、`ProductsBLL`クラスの`GetProducts`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa129-144">Configure the ObjectDataSource to pull its data from the `ProductsBLL` class s `GetProducts` method.</span></span> <span data-ttu-id="fa129-145">この GridView はデータ表示のみに使用されるため、更新、挿入でドロップダウン リストを設定し、(なし) タブを削除します。</span><span class="sxs-lookup"><span data-stu-id="fa129-145">Since this GridView is used only to display data, set the drop-down lists in the UPDATE, INSERT, and DELETE tabs to (None).</span></span> <span data-ttu-id="fa129-146">データ ソース構成ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa129-146">Click Finish to complete the Configure Data Source wizard.</span></span>


<span data-ttu-id="fa129-147">[![ProductsBLL クラスの GetProducts メソッドから返されるデータを表示します。](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-147">[![Display the Data Returned from the ProductsBLL Class s GetProducts Method](batch-inserting-vb/_static/image8.png)](batch-inserting-vb/_static/image7.png)</span></span>

<span data-ttu-id="fa129-148">**図 3**: から返されたデータを表示、`ProductsBLL`クラス s`GetProducts`メソッド ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-148">**Figure 3**: Display the Data Returned from the `ProductsBLL` Class s `GetProducts` Method ([Click to view full-size image](batch-inserting-vb/_static/image9.png))</span></span>


<span data-ttu-id="fa129-149">[![UPDATE、INSERT のドロップダウン リストを設定し、(なし) タブを削除します。](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-149">[![Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None)](batch-inserting-vb/_static/image11.png)](batch-inserting-vb/_static/image10.png)</span></span>

<span data-ttu-id="fa129-150">**図 4**: (なし) に、UPDATE、INSERT、および削除のタブで、ドロップダウン リストを設定 ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-150">**Figure 4**: Set the Drop-Down Lists in the UPDATE, INSERT, and DELETE Tabs to (None) ([Click to view full-size image](batch-inserting-vb/_static/image12.png))</span></span>


<span data-ttu-id="fa129-151">ObjectDataSource ウィザードの完了後は、Visual Studio は BoundFields と製品データ フィールドの CheckBoxField を追加します。</span><span class="sxs-lookup"><span data-stu-id="fa129-151">After completing the ObjectDataSource wizard, Visual Studio will add BoundFields and a CheckBoxField for the product data fields.</span></span> <span data-ttu-id="fa129-152">削除以外のすべての`ProductName`、 `CategoryName`、 `SupplierName`、 `UnitPrice`、および`Discontinued`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="fa129-152">Remove all but the `ProductName`, `CategoryName`, `SupplierName`, `UnitPrice`, and `Discontinued` fields.</span></span> <span data-ttu-id="fa129-153">自由見た目をカスタマイズしてください。</span><span class="sxs-lookup"><span data-stu-id="fa129-153">Feel free to make any aesthetic customizations.</span></span> <span data-ttu-id="fa129-154">書式を設定することにしました、`UnitPrice`を通貨値としてのフィールド、フィールドの順序を変更し、フィールドのいくつかの名前を変更`HeaderText`値。</span><span class="sxs-lookup"><span data-stu-id="fa129-154">I decided to format the `UnitPrice` field as a currency value, reordered the fields, and renamed several of the fields `HeaderText` values.</span></span> <span data-ttu-id="fa129-155">ページング サポートを GridView s のスマート タグのページングを有効にして並べ替えを有効にするチェック ボックスをチェックして並べ替えなど、GridView 構成もできます。</span><span class="sxs-lookup"><span data-stu-id="fa129-155">Also configure the GridView to include paging and sorting support by checking the Enable Paging and Enable Sorting checkboxes in the GridView s smart tag.</span></span>

<span data-ttu-id="fa129-156">パネル、ボタン、GridView、ObjectDataSource コントロールを追加して GridView のフィールドのカスタマイズした後、ページの宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="fa129-156">After adding the Panel, Button, GridView, and ObjectDataSource controls and customizing the GridView s fields, your page s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](batch-inserting-vb/samples/sample1.aspx)]

<span data-ttu-id="fa129-157">開始タグと終了内のボタンと GridView マークアップに表示されるメモ`<asp:Panel>`タグ。</span><span class="sxs-lookup"><span data-stu-id="fa129-157">Note that the markup for the Button and GridView appear within the opening and closing `<asp:Panel>` tags.</span></span> <span data-ttu-id="fa129-158">これらのコントロール内にあるため、`DisplayInterface`パネルで非表示にできますパネル s を設定するだけで`Visible`プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-158">Since these controls are within the `DisplayInterface` Panel, we can hide them by simply setting the Panel s `Visible` property to `False`.</span></span> <span data-ttu-id="fa129-159">手順 3 をプログラムで、s パネルを変更する見ます`Visible`ボタンへの応答のプロパティを非表示にする他の中に 1 つのインターフェイスを表示する をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa129-159">Step 3 looks at programmatically changing the Panel s `Visible` property in response to a button click to show one interface while hiding the other.</span></span>

<span data-ttu-id="fa129-160">ブラウザーを使って作業の進行状況を表示するのにはしばらくを実行します。</span><span class="sxs-lookup"><span data-stu-id="fa129-160">Take a moment to view our progress through a browser.</span></span> <span data-ttu-id="fa129-161">図 5 では、一度に 10 個の製品を一覧表示する GridView 上の製品の出荷を処理するボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-161">As Figure 5 shows, you should see a Process Product Shipment button above a GridView that lists the products ten at a time.</span></span>


<span data-ttu-id="fa129-162">[![GridView は、製品を一覧表示し、並べ替えとページング機能を提供しています](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-162">[![The GridView Lists the Products and Offers Sorting and Paging Capabilities](batch-inserting-vb/_static/image14.png)](batch-inserting-vb/_static/image13.png)</span></span>

<span data-ttu-id="fa129-163">**図 5**: GridView、製品と一覧表示し、並べ替え、ページング機能 ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-163">**Figure 5**: The GridView Lists the Products and Offers Sorting and Paging Capabilities ([Click to view full-size image](batch-inserting-vb/_static/image15.png))</span></span>


## <a name="step-2-creating-the-inserting-interface"></a><span data-ttu-id="fa129-164">手順 2: 挿入インターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="fa129-164">Step 2: Creating the Inserting Interface</span></span>

<span data-ttu-id="fa129-165">表示インターフェイスと完了すると、挿入のインターフェイスを作成する準備ができたらします。</span><span class="sxs-lookup"><span data-stu-id="fa129-165">With the display interface complete, we re ready to create the inserting interface.</span></span> <span data-ttu-id="fa129-166">このチュートリアルでは、業者とカテゴリの 1 つの値の入力を要求し、最大 5 つの製品の名前と価格の単位の値を入力するユーザーを挿入するインターフェイスを作成する s を使用できます。</span><span class="sxs-lookup"><span data-stu-id="fa129-166">For this tutorial, let s create an inserting interface that prompts for a single supplier and category value and then allows the user to enter up to five product names and unit price values.</span></span> <span data-ttu-id="fa129-167">このインターフェイスを持つユーザーは 1 ~ 5 の新製品の同じカテゴリと供給業者、すべてを共有しますが、一意の製品の名前と価格を追加できます。</span><span class="sxs-lookup"><span data-stu-id="fa129-167">With this interface, the user can add one to five new products that all share the same category and supplier, but have unique product names and prices.</span></span>

<span data-ttu-id="fa129-168">ツールボックスから、デザイナーの既存の下に配置することにパネルをドラッグして開始`DisplayInterface`パネルです。</span><span class="sxs-lookup"><span data-stu-id="fa129-168">Start by dragging a Panel from the Toolbox onto the Designer, placing it beneath the existing `DisplayInterface` Panel.</span></span> <span data-ttu-id="fa129-169">設定、`ID`このプロパティは、パネルを新しく追加された`InsertingInterface`設定とその`Visible`プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-169">Set the `ID` property of this newly added Panel to `InsertingInterface` and set its `Visible` property to `False`.</span></span> <span data-ttu-id="fa129-170">設定するコードを追加して、`InsertingInterface`パネル s`Visible`プロパティを`True`手順 3. でします。</span><span class="sxs-lookup"><span data-stu-id="fa129-170">We'll add code that sets the `InsertingInterface` Panel s `Visible` property to `True` in Step 3.</span></span> <span data-ttu-id="fa129-171">パネル s もクリア`Height`と`Width`プロパティの値。</span><span class="sxs-lookup"><span data-stu-id="fa129-171">Also clear out the Panel s `Height` and `Width` property values.</span></span>

<span data-ttu-id="fa129-172">次に、図 1 に示す挿入インターフェイスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-172">Next, we need to create the inserting interface that was shown back in Figure 1.</span></span> <span data-ttu-id="fa129-173">このインターフェイスは、さまざまな HTML 技法で作成できますが、非常に簡単な 1 つを使用します。 4 列、7 つの行のテーブルです。</span><span class="sxs-lookup"><span data-stu-id="fa129-173">This interface can be created through a variety of HTML techniques, but we will use a fairly straightforward one: a four-column, seven-row table.</span></span>

> [!NOTE]
> <span data-ttu-id="fa129-174">HTML マークアップを入力するときに`<table>`要素 (_n)、ソース ビューを使用します。</span><span class="sxs-lookup"><span data-stu-id="fa129-174">When entering markup for HTML `<table>` elements, I prefer to use the Source view.</span></span> <span data-ttu-id="fa129-175">Visual Studio に追加するためのツールは、 `<table>` 、デザイナー内の要素、デザイナーを組み込むすべてすぎる許容を排除そらせる`style`マークアップに設定します。</span><span class="sxs-lookup"><span data-stu-id="fa129-175">While Visual Studio does have tools for adding `<table>` elements through the Designer, the Designer seems all too willing to inject unasked for `style` settings into the markup.</span></span> <span data-ttu-id="fa129-176">作成したところ、`<table>`マークアップ、通常に返す Web コントロールを追加し、それらのプロパティを設定するデザイナー。</span><span class="sxs-lookup"><span data-stu-id="fa129-176">Once I have created the `<table>` markup, I usually return to the Designer to add the Web controls and set their properties.</span></span> <span data-ttu-id="fa129-177">静的な HTML を使用する (_n) であらかじめ決められた列と行のテーブルを作成するときではなく、 [Table Web コントロール](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.table.aspx)テーブル Web コントロール内にある Web コントロールにアクセスできるだけを使用しているため、`FindControl("controlID")`パターン。</span><span class="sxs-lookup"><span data-stu-id="fa129-177">When creating tables with pre-determined columns and rows I prefer using static HTML rather than the [Table Web control](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.table.aspx) because any Web controls placed within a Table Web control can only be accessed using the `FindControl("controlID")` pattern.</span></span> <span data-ttu-id="fa129-178">コントロールをプログラムで構築するテーブル Web から動的にサイズ変更テーブル (行または列を持つがいくつかのデータベースまたはユーザー指定の条件に基づくもの) に対してテーブル Web コントロールを使用には、ただし、します。</span><span class="sxs-lookup"><span data-stu-id="fa129-178">I do, however, use Table Web controls for dynamically-sized tables (ones whose rows or columns are based on some database or user-specified criteria), since the Table Web control can be constructed programmatically.</span></span>


<span data-ttu-id="fa129-179">次のマークアップ内の入力、`<asp:Panel>`のタグ、`InsertingInterface`パネル。</span><span class="sxs-lookup"><span data-stu-id="fa129-179">Enter the following markup within the `<asp:Panel>` tags of the `InsertingInterface` Panel:</span></span>


[!code-html[Main](batch-inserting-vb/samples/sample2.html)]

<span data-ttu-id="fa129-180">これは、`<table>`マークアップでは、すべての Web コントロールは含まれませんまだ、それらを一時的に追加します。</span><span class="sxs-lookup"><span data-stu-id="fa129-180">This `<table>` markup does not include any Web controls yet, we'll add those momentarily.</span></span> <span data-ttu-id="fa129-181">`<tr>`要素には、特定の CSS クラス設定が含まれています:`BatchInsertHeaderRow`業者とカテゴリ DropDownLists はどこで; ヘッダー行に`BatchInsertFooterRow`出荷とキャンセル ボタンから追加の製品がどこで; フッター行と交互`BatchInsertRow`と`BatchInsertAlternatingRow`TextBox コントロールの価格の製品と単位を格納する行の値。</span><span class="sxs-lookup"><span data-stu-id="fa129-181">Note that each `<tr>` element contains a particular CSS class setting: `BatchInsertHeaderRow` for the header row where the supplier and category DropDownLists will go; `BatchInsertFooterRow` for the footer row where the Add Products from Shipment and Cancel Buttons will go; and alternating `BatchInsertRow` and `BatchInsertAlternatingRow` values for the rows that will contain the product and unit price TextBox controls.</span></span> <span data-ttu-id="fa129-182">I の対応する CSS クラスを作成したら、 `Styles.css` ƒošâ、GridView と DetailsView 挿入のインターフェイスを提供するファイルで制御はこれらのチュートリアル全体で使用します。</span><span class="sxs-lookup"><span data-stu-id="fa129-182">I ve created corresponding CSS classes in the `Styles.css` file to give the inserting interface an appearance similar to the GridView and DetailsView controls we ve used throughout these tutorials.</span></span> <span data-ttu-id="fa129-183">これらの CSS クラスは、以下に示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-183">These CSS classes are shown below.</span></span>


[!code-css[Main](batch-inserting-vb/samples/sample3.css)]

<span data-ttu-id="fa129-184">このマークアップを入力すると、デザイン ビューに戻ります。</span><span class="sxs-lookup"><span data-stu-id="fa129-184">With this markup entered, return to the Design view.</span></span> <span data-ttu-id="fa129-185">これは、`<table>`図 6 に示すように、デザイナーで、4 列、7 つの行のテーブルとして表示する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-185">This `<table>` should show as a four-column, seven-row table in the Designer, as Figure 6 illustrates.</span></span>


<span data-ttu-id="fa129-186">[![挿入するインターフェイスがあり、4 つの列、7 つの行のテーブルの](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-186">[![The Inserting Interface is Composed of a Four-Column, Seven-Row Table](batch-inserting-vb/_static/image17.png)](batch-inserting-vb/_static/image16.png)</span></span>

<span data-ttu-id="fa129-187">**図 6**:、挿入するインターフェイスがあり、4 つの列、7 つの行のテーブルの ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-187">**Figure 6**: The Inserting Interface is Composed of a Four-Column, Seven-Row Table ([Click to view full-size image](batch-inserting-vb/_static/image18.png))</span></span>


<span data-ttu-id="fa129-188">今すぐ再おの Web コントロールを挿入するインターフェイスに追加する準備はできました。</span><span class="sxs-lookup"><span data-stu-id="fa129-188">We re now ready to add the Web controls to the inserting interface.</span></span> <span data-ttu-id="fa129-189">2 つの DropDownLists をツールボックスから、供給業者およびカテゴリのいずれかのいずれかのテーブルに該当するセルにドラッグします。</span><span class="sxs-lookup"><span data-stu-id="fa129-189">Drag two DropDownLists from the Toolbox into the appropriate cells in the table one for the supplier and one for the category.</span></span>

<span data-ttu-id="fa129-190">業者の DropDownList の s を設定`ID`プロパティを`Suppliers`という名前の新しい ObjectDataSource にバインド`SuppliersDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-190">Set the supplier DropDownList s `ID` property to `Suppliers` and bind it to a new ObjectDataSource named `SuppliersDataSource`.</span></span> <span data-ttu-id="fa129-191">構成からそのデータを取得する新しい ObjectDataSource、`SuppliersBLL`クラスの`GetSuppliers` タブ (なし) をドロップダウン リストのメソッドと、更新プログラムを設定します。</span><span class="sxs-lookup"><span data-stu-id="fa129-191">Configure the new ObjectDataSource to retrieve its data from the `SuppliersBLL` class s `GetSuppliers` method and set the UPDATE tab s drop-down list to (None).</span></span> <span data-ttu-id="fa129-192">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa129-192">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="fa129-193">[![ObjectDataSource SuppliersBLL クラスの GetSuppliers メソッドを使用して構成します。](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-193">[![Configure the ObjectDataSource to Use the SuppliersBLL Class s GetSuppliers Method](batch-inserting-vb/_static/image20.png)](batch-inserting-vb/_static/image19.png)</span></span>

<span data-ttu-id="fa129-194">**図 7**: 構成を使用する ObjectDataSource、`SuppliersBLL`クラス s`GetSuppliers`メソッド ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-194">**Figure 7**: Configure the ObjectDataSource to Use the `SuppliersBLL` Class s `GetSuppliers` Method ([Click to view full-size image](batch-inserting-vb/_static/image21.png))</span></span>


<span data-ttu-id="fa129-195">`Suppliers` DropDownList の表示、`CompanyName`データ フィールドと使用、`SupplierID`データがフィールドとしてその`ListItem`の値。</span><span class="sxs-lookup"><span data-stu-id="fa129-195">Have the `Suppliers` DropDownList display the `CompanyName` data field and use the `SupplierID` data field as its `ListItem` s values.</span></span>


<span data-ttu-id="fa129-196">[![CompanyName データ フィールドが表示され、値としての SupplierID の使用](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-196">[![Display the CompanyName Data Field and Use SupplierID as the Value](batch-inserting-vb/_static/image23.png)](batch-inserting-vb/_static/image22.png)</span></span>

<span data-ttu-id="fa129-197">**図 8**: 表示、`CompanyName`データ フィールドと使用`SupplierID`値として ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-197">**Figure 8**: Display the `CompanyName` Data Field and Use `SupplierID` as the Value ([Click to view full-size image](batch-inserting-vb/_static/image24.png))</span></span>


<span data-ttu-id="fa129-198">2 番目の DropDownList の名前を付けます`Categories`という名前の新しい ObjectDataSource にバインド`CategoriesDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-198">Name the second DropDownList `Categories` and bind it to a new ObjectDataSource named `CategoriesDataSource`.</span></span> <span data-ttu-id="fa129-199">構成、 `CategoriesDataSource` ObjectDataSource を使用する、`CategoriesBLL`クラスの`GetCategories`メソッド以外の設定を (なし)、UPDATE および DELETE のタブで、ドロップダウン リストを一覧表示が完了ウィザードを完了します。</span><span class="sxs-lookup"><span data-stu-id="fa129-199">Configure the `CategoriesDataSource` ObjectDataSource to use the `CategoriesBLL` class s `GetCategories` method; set the drop-down lists in the UPDATE and DELETE tabs to (None) and click Finish to complete the wizard.</span></span> <span data-ttu-id="fa129-200">最後に、DropDownList 表示がある、`CategoryName`データ フィールドと使用、`CategoryID`値として。</span><span class="sxs-lookup"><span data-stu-id="fa129-200">Finally, have the DropDownList display the `CategoryName` data field and use the `CategoryID` as the value.</span></span>

<span data-ttu-id="fa129-201">これら 2 つの DropDownLists を追加し、適切に構成された ObjectDataSources にバインドした後、画面はよう図 9 になります。</span><span class="sxs-lookup"><span data-stu-id="fa129-201">After these two DropDownLists have been added and bound to appropriately configured ObjectDataSources, your screen should look similar to Figure 9.</span></span>


<span data-ttu-id="fa129-202">[![ヘッダー行が含まれています、サプライヤーとカテゴリ DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-202">[![The Header Row Now Contains the Suppliers and Categories DropDownLists](batch-inserting-vb/_static/image26.png)](batch-inserting-vb/_static/image25.png)</span></span>

<span data-ttu-id="fa129-203">**図 9**:、ヘッダーには行が含まれています、`Suppliers`と`Categories`DropDownLists ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-203">**Figure 9**: The Header Row Now Contains the `Suppliers` and `Categories` DropDownLists ([Click to view full-size image](batch-inserting-vb/_static/image27.png))</span></span>


<span data-ttu-id="fa129-204">これで、名前と各新製品の価格を収集するためのテキスト ボックスを作成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-204">We now need to create the TextBoxes to collect the name and price for each new product.</span></span> <span data-ttu-id="fa129-205">ツールボックスからデザイナーに 5 つの製品の名前と価格の行の各テキスト ボックス コントロールをドラッグします。</span><span class="sxs-lookup"><span data-stu-id="fa129-205">Drag a TextBox control from the Toolbox onto the Designer for each of the five product name and price rows.</span></span> <span data-ttu-id="fa129-206">設定、`ID`にテキスト ボックスのプロパティ`ProductName1`、 `UnitPrice1`、 `ProductName2`、 `UnitPrice2`、 `ProductName3`、`UnitPrice3`のようにします。</span><span class="sxs-lookup"><span data-stu-id="fa129-206">Set the `ID` properties of the TextBoxes to `ProductName1`, `UnitPrice1`, `ProductName2`, `UnitPrice2`, `ProductName3`, `UnitPrice3`, and so on.</span></span>

<span data-ttu-id="fa129-207">単位の価格設定、テキスト ボックスの後に、CompareValidator を追加、`ControlToValidate`プロパティを適切な`ID`します。</span><span class="sxs-lookup"><span data-stu-id="fa129-207">Add a CompareValidator after each of the unit price TextBoxes, setting the `ControlToValidate` property to the appropriate `ID`.</span></span> <span data-ttu-id="fa129-208">設定も、`Operator`プロパティを`GreaterThanEqual`、 `ValueToCompare` 0、および`Type`に`Currency`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-208">Also set the `Operator` property to `GreaterThanEqual`, `ValueToCompare` to 0, and `Type` to `Currency`.</span></span> <span data-ttu-id="fa129-209">これらの設定では、CompareValidator、価格を入力した場合、有効な通貨値である 0 以上であることを確認するように指示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-209">These settings instruct the CompareValidator to ensure that the price, if entered, is a valid currency value that is greater than or equal to zero.</span></span> <span data-ttu-id="fa129-210">設定、`Text`プロパティを\*、および`ErrorMessage`価格にする必要がありますより大きいまたは 0 に等しい。</span><span class="sxs-lookup"><span data-stu-id="fa129-210">Set the `Text` property to \*, and `ErrorMessage` to The price must be greater than or equal to zero.</span></span> <span data-ttu-id="fa129-211">また、通貨記号を省略してください。</span><span class="sxs-lookup"><span data-stu-id="fa129-211">Also, please omit any currency symbols.</span></span>

> [!NOTE]
> <span data-ttu-id="fa129-212">挿入のインターフェイスには含まれません、RequiredFieldValidator コントロールも、`ProductName`フィールドで、`Products`データベース テーブルが許可しない`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="fa129-212">The inserting interface does not include any RequiredFieldValidator controls, even though the `ProductName` field in the `Products` database table does not allow `NULL` values.</span></span> <span data-ttu-id="fa129-213">これは、ユーザーが最大 5 つの製品を入力できるようにする必要があるためです。</span><span class="sxs-lookup"><span data-stu-id="fa129-213">This is because we want to let the user enter up to five products.</span></span> <span data-ttu-id="fa129-214">たとえば、ユーザーの最初の 3 つの行の製品名および単価を提供する場合は、最後の 2 つの行を空白 d だけ新しい 3 つの製品に追加システム。</span><span class="sxs-lookup"><span data-stu-id="fa129-214">For example, if the user were to provide the product name and unit price for the first three rows, leaving the last two rows blank, we d just add three new products to the system.</span></span> <span data-ttu-id="fa129-215">`ProductName`は必要に応じて、ただし、する必要がプログラムで確認している場合、単価が入力された対応する製品名の値が指定されています。</span><span class="sxs-lookup"><span data-stu-id="fa129-215">Since `ProductName` is required, however, we will need to programmatically check to ensure that if a unit price is entered that a corresponding product name value is provided.</span></span> <span data-ttu-id="fa129-216">手順 4 で、この確認を取り上げるです。</span><span class="sxs-lookup"><span data-stu-id="fa129-216">We'll tackle this check in Step 4.</span></span>


<span data-ttu-id="fa129-217">ユーザー入力を検証するには、値には、通貨記号が含まれている場合に、CompareValidator が無効なデータを報告します。</span><span class="sxs-lookup"><span data-stu-id="fa129-217">When validating the user s input, the CompareValidator reports invalid data if the value contains a currency symbol.</span></span> <span data-ttu-id="fa129-218">各単価の価格を入力するときに、通貨記号を省略する場合、ユーザーに指示する視覚上の手掛かりとして機能するテキスト ボックスの前に、$ を追加します。</span><span class="sxs-lookup"><span data-stu-id="fa129-218">Add a $ in front of each of the unit price TextBoxes to serve as a visual cue that instructs the user to omit the currency symbol when entering the price.</span></span>

<span data-ttu-id="fa129-219">最後に、内の ValidationSummary コントロールを追加、`InsertingInterface`パネルで、設定、`ShowMessageBox`プロパティを`True`とその`ShowSummary`プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-219">Lastly, add a ValidationSummary control within the `InsertingInterface` Panel, settings its `ShowMessageBox` property to `True` and its `ShowSummary` property to `False`.</span></span> <span data-ttu-id="fa129-220">これらの設定で害のある TextBox コントロールの横にアスタリスクが表示場合は、ユーザーは、無効な単位の価格値を入力、および、ValidationSummary 以前指定したエラー メッセージを表示するクライアント側のメッセージ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-220">With these settings, if the user enters an invalid unit price value, an asterisk will appear next to the offending TextBox controls and the ValidationSummary will display a client-side messagebox that shows the error message we specified earlier.</span></span>

<span data-ttu-id="fa129-221">この時点では、画面は図 10 のようになります。</span><span class="sxs-lookup"><span data-stu-id="fa129-221">At this point, your screen should look similar to Figure 10.</span></span>


<span data-ttu-id="fa129-222">[![挿入インターフェイス製品のテキスト ボックスは、名前と価格](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-222">[![The Inserting Interface Now Includes TextBoxes for the Products Names and Prices](batch-inserting-vb/_static/image29.png)](batch-inserting-vb/_static/image28.png)</span></span>

<span data-ttu-id="fa129-223">**図 10**:、挿入インターフェイスようになりましたが含まれていますテキスト ボックスの製品の名前と価格 ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-223">**Figure 10**: The Inserting Interface Now Includes TextBoxes for the Products Names and Prices ([Click to view full-size image](batch-inserting-vb/_static/image30.png))</span></span>


<span data-ttu-id="fa129-224">次に、製品の追加を出荷し、[キャンセル] ボタンからフッター行に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-224">Next we need to add the Add Products from Shipment and Cancel buttons to the footer row.</span></span> <span data-ttu-id="fa129-225">ドラッグ 2 ボタン コントロールをツールボックスから、挿入するインターフェイスのフッターにボタンを設定`ID`プロパティ`AddProducts`と`CancelButton`と`Text`出荷し、[キャンセル] から製品をそれぞれ追加するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="fa129-225">Drag two Button controls from the Toolbox into the footer of the inserting interface, setting the Buttons `ID` properties to `AddProducts` and `CancelButton` and `Text` properties to Add Products from Shipment and Cancel, respectively.</span></span> <span data-ttu-id="fa129-226">さらに、設定、`CancelButton`コントロール s`CausesValidation`プロパティを`false`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-226">In addition, set the `CancelButton` control s `CausesValidation` property to `false`.</span></span>

<span data-ttu-id="fa129-227">最後に、2 つのインターフェイスのステータス メッセージを表示するラベル Web コントロールを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-227">Finally, we need to add a Label Web control that will display status messages for the two interfaces.</span></span> <span data-ttu-id="fa129-228">たとえば、ユーザーでは、新しい製品の出荷が正常に追加、たい表示インターフェイスを取得して、確認メッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-228">For example, when a user successfully adds a new shipment of products, we want to return to the display interface and display a confirmation message.</span></span> <span data-ttu-id="fa129-229">ただし、ユーザーは、新しい製品では、製品名をオフのままの価格を提供する場合は、以降の警告メッセージを表示する必要があります、`ProductName`フィールドは必須です。</span><span class="sxs-lookup"><span data-stu-id="fa129-229">If, however, the user provides a price for a new product but leaves off the product name, we need to display a warning message since the `ProductName` field is required.</span></span> <span data-ttu-id="fa129-230">このメッセージの両方のインターフェイスを表示する必要があります、ため、パネルの外部でページの上部に配置します。</span><span class="sxs-lookup"><span data-stu-id="fa129-230">Since we need this message to display for both interfaces, place it at the top of the page outside of the Panels.</span></span>

<span data-ttu-id="fa129-231">Label Web コントロールをツールボックスからデザイナー内のページのトップへドラッグします。</span><span class="sxs-lookup"><span data-stu-id="fa129-231">Drag a Label Web control from the Toolbox to the top of the page in the Designer.</span></span> <span data-ttu-id="fa129-232">設定、`ID`プロパティを`StatusLabel`を out オフ、`Text`プロパティ、およびセット、`Visible`と`EnableViewState`プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-232">Set the `ID` property to `StatusLabel`, clear out the `Text` property, and set the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="fa129-233">前のチュートリアルでこれまで見てきたようを設定、`EnableViewState`プロパティを`False`をプログラムで s のラベルのプロパティ値を変更し、それ以降のポストバック時に、既定値に自動的に元に戻すことができます。</span><span class="sxs-lookup"><span data-stu-id="fa129-233">As we have seen in previous tutorials, setting the `EnableViewState` property to `False` allows us to programmatically change the Label s property values and have them automatically revert back to their defaults on the subsequent postback.</span></span> <span data-ttu-id="fa129-234">これには、それ以降のポストバック時に表示されなくなります何らかのユーザー アクションへの応答で、ステータス メッセージを表示するためのコードが簡略化します。</span><span class="sxs-lookup"><span data-stu-id="fa129-234">This simplifies the code for showing a status message in response to some user action that disappears on the subsequent postback.</span></span> <span data-ttu-id="fa129-235">最後に、設定、`StatusLabel`コントロール s`CssClass`で警告で、CSS クラスの名前を指定するプロパティが定義されている`Styles.css`大きな、斜体、太字、赤いフォントでテキストを表示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-235">Finally, set the `StatusLabel` control s `CssClass` property to Warning, which is the name of a CSS class defined in `Styles.css` that displays text in a large, italic, bold, red font.</span></span>

<span data-ttu-id="fa129-236">図 11 は、ラベルを追加し、構成した後、Visual Studio デザイナーを示しています。</span><span class="sxs-lookup"><span data-stu-id="fa129-236">Figure 11 shows the Visual Studio Designer after the Label has been added and configured.</span></span>


<span data-ttu-id="fa129-237">[![2 つのパネル コントロール上 StatusLabel コントロールを配置します。](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-237">[![Place the StatusLabel Control Above the Two Panel Controls](batch-inserting-vb/_static/image32.png)](batch-inserting-vb/_static/image31.png)</span></span>

<span data-ttu-id="fa129-238">**図 11**: の場所、`StatusLabel`コントロール上の 2 つパネル コントロール ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-238">**Figure 11**: Place the `StatusLabel` Control Above the Two Panel Controls ([Click to view full-size image](batch-inserting-vb/_static/image33.png))</span></span>


## <a name="step-3-switching-between-the-display-and-inserting-interfaces"></a><span data-ttu-id="fa129-239">手順 3: 表示の切り替えとインターフェイスを挿入します。</span><span class="sxs-lookup"><span data-stu-id="fa129-239">Step 3: Switching Between the Display and Inserting Interfaces</span></span>

<span data-ttu-id="fa129-240">この時点で、表示と 2 つのタスクとままインターフェイス、ですが再挿入するマークアップを完了しました。</span><span class="sxs-lookup"><span data-stu-id="fa129-240">At this point we have completed the markup for our display and inserting interfaces, but we re still left with two tasks:</span></span>

- <span data-ttu-id="fa129-241">表示の切り替えとインターフェイスを挿入します。</span><span class="sxs-lookup"><span data-stu-id="fa129-241">Switching between the display and inserting interfaces</span></span>
- <span data-ttu-id="fa129-242">データベースに配送中、製品の追加</span><span class="sxs-lookup"><span data-stu-id="fa129-242">Adding the products in the shipment to the database</span></span>

<span data-ttu-id="fa129-243">現時点では、表示インターフェイスは表示が、挿入のインターフェイスが非表示にします。</span><span class="sxs-lookup"><span data-stu-id="fa129-243">Currently, the display interface is visible but the inserting interface is hidden.</span></span> <span data-ttu-id="fa129-244">これは、ため、`DisplayInterface`パネル s`Visible`プロパティに設定されている`True`(既定値) の場合は、中に、`InsertingInterface`パネル s`Visible`プロパティに設定されている`False`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-244">This is because the `DisplayInterface` Panel s `Visible` property is set to `True` (the default value), while the `InsertingInterface` Panel s `Visible` property is set to `False`.</span></span> <span data-ttu-id="fa129-245">単に秒の各コントロールを切り替える必要があります、2 つのインターフェイス間で切り替える`Visible`プロパティの値。</span><span class="sxs-lookup"><span data-stu-id="fa129-245">To switch between the two interfaces we simply need to toggle each control s `Visible` property value.</span></span>

<span data-ttu-id="fa129-246">製品の出荷を処理するボタンがクリックされたときに、表示インターフェイスから挿入インターフェイスに移動することができます。</span><span class="sxs-lookup"><span data-stu-id="fa129-246">We want to move from the display interface to the inserting interface when the Process Product Shipment button is clicked.</span></span> <span data-ttu-id="fa129-247">そのため、このボタンのイベント ハンドラーを作成`Click`を次のコードを含むイベント。</span><span class="sxs-lookup"><span data-stu-id="fa129-247">Therefore, create an event handler for this Button s `Click` event that contains the following code:</span></span>


[!code-vb[Main](batch-inserting-vb/samples/sample4.vb)]

<span data-ttu-id="fa129-248">このコードは単に非表示に、`DisplayInterface`パネルを表示して、`InsertingInterface`パネルです。</span><span class="sxs-lookup"><span data-stu-id="fa129-248">This code simply hides the `DisplayInterface` Panel and shows the `InsertingInterface` Panel.</span></span>

<span data-ttu-id="fa129-249">次に、製品を出荷し、[キャンセル] ボタンの挿入インターフェイス コントロールからの追加のイベント ハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="fa129-249">Next, create event handlers for the Add Products from Shipment and Cancel Button controls in the inserting interface.</span></span> <span data-ttu-id="fa129-250">これらのボタンのいずれかをクリックすると表示インターフェイスに戻す必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-250">When either of these Buttons is clicked, we need to revert back to the display interface.</span></span> <span data-ttu-id="fa129-251">作成`Click`両方のイベント ハンドラー ボタン コントロールを呼び出すことができるように`ReturnToDisplayInterface`メソッドはすぐに追加します。</span><span class="sxs-lookup"><span data-stu-id="fa129-251">Create `Click` event handlers for both Button controls so that they call `ReturnToDisplayInterface`, a method we will add momentarily.</span></span> <span data-ttu-id="fa129-252">非表示にするだけでなく、`InsertingInterface`パネルとを示す、`DisplayInterface`パネル、`ReturnToDisplayInterface`メソッドは、編集済みの状態の Web コントロールを返す必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-252">In addition to hiding the `InsertingInterface` Panel and showing the `DisplayInterface` Panel, the `ReturnToDisplayInterface` method needs to return the Web controls to their pre-editing state.</span></span> <span data-ttu-id="fa129-253">DropDownLists を設定する必要があります`SelectedIndex`0 およびを消去するプロパティを`Text`の TextBox コントロールのプロパティです。</span><span class="sxs-lookup"><span data-stu-id="fa129-253">This involves setting the DropDownLists `SelectedIndex` properties to 0 and clearing out the `Text` properties of the TextBox controls.</span></span>

> [!NOTE]
> <span data-ttu-id="fa129-254">何が起こるかを検討場合おでした t は、表示インターフェイスに戻る前に編集済みの状態にコントロールを返します。</span><span class="sxs-lookup"><span data-stu-id="fa129-254">Consider what might happen if we didn t return the controls to their pre-editing state before returning to the display interface.</span></span> <span data-ttu-id="fa129-255">ユーザーが製品の出荷を処理する をクリックします。 可能性があります、出荷から製品を入力および出荷から商品の追加 をクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa129-255">A user might click the Process Product Shipment button, enter the products from the shipment, and then click Add Products from Shipment.</span></span> <span data-ttu-id="fa129-256">これは、製品に追加. ユーザー表示インターフェイスを返す</span><span class="sxs-lookup"><span data-stu-id="fa129-256">This would add the products and return the user to the display interface.</span></span> <span data-ttu-id="fa129-257">この時点で、ユーザーは別の出荷を追加する場合があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-257">At this point the user might want to add another shipment.</span></span> <span data-ttu-id="fa129-258">挿入のインターフェイスが DropDownList に戻り、[製品の出荷を処理する] ボタンをクリックすると選択やテキスト ボックスの値がまだ設定して以前の値。</span><span class="sxs-lookup"><span data-stu-id="fa129-258">Upon clicking the Process Product Shipment button they would return to the inserting interface but the DropDownList selections and TextBox values would still be populated with their previous values.</span></span>


[!code-vb[Main](batch-inserting-vb/samples/sample5.vb)]

<span data-ttu-id="fa129-259">両方`Click`イベント ハンドラーを呼び出すだけ、`ReturnToDisplayInterface`メソッド、出荷から商品の追加を返しますが`Click`内のイベント ハンドラーは、手順 4 と、製品を保存するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="fa129-259">Both `Click` event handlers simply call the `ReturnToDisplayInterface` method, although we'll return to the Add Products from Shipment `Click` event handler in Step 4 and add code to save the products.</span></span> <span data-ttu-id="fa129-260">`ReturnToDisplayInterface`返すことによって開始、`Suppliers`と`Categories`DropDownLists の最初のオプションにします。</span><span class="sxs-lookup"><span data-stu-id="fa129-260">`ReturnToDisplayInterface` starts by returning the `Suppliers` and `Categories` DropDownLists to their first options.</span></span> <span data-ttu-id="fa129-261">2 つの定数`firstControlID`と`lastControlID`、開始、製品名および単価、挿入するテキスト ボックスのインターフェイスし、の境界内で使用される名前付けで使用されるコントロールのインデックス値と終了をマーク、`For`設定、ループ`Text`の TextBox コントロールのプロパティが空の文字列をバックアップします。</span><span class="sxs-lookup"><span data-stu-id="fa129-261">The two constants `firstControlID` and `lastControlID` mark the starting and ending control index values used in naming the product name and unit price TextBoxes in the inserting interface and are used in the bounds of the `For` loop that sets the `Text` properties of the TextBox controls back to an empty string.</span></span> <span data-ttu-id="fa129-262">最後に、パネル`Visible`挿入インターフェイスが表示されないようにし、示されている表示インターフェイスのプロパティはリセットされます。</span><span class="sxs-lookup"><span data-stu-id="fa129-262">Finally, the Panels `Visible` properties are reset so that the inserting interface is hidden and the display interface shown.</span></span>

<span data-ttu-id="fa129-263">すぐをブラウザーでこのページをテストします。</span><span class="sxs-lookup"><span data-stu-id="fa129-263">Take a moment to test out this page in a browser.</span></span> <span data-ttu-id="fa129-264">最初のページにアクセスすると、図 5 のように、表示インターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-264">When first visiting the page you should see the display interface as was shown in Figure 5.</span></span> <span data-ttu-id="fa129-265">製品の出荷を処理する ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="fa129-265">Click the Process Product Shipment button.</span></span> <span data-ttu-id="fa129-266">ページがポストバックと図 12 に示すように、挿入インターフェイス表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-266">The page will postback and you should now see the inserting interface as shown in Figure 12.</span></span> <span data-ttu-id="fa129-267">いずれかの追加から製品出荷または [キャンセル] ボタンをクリックすると、表示インターフェイスを返します。</span><span class="sxs-lookup"><span data-stu-id="fa129-267">Clicking either the Add Products from Shipment or Cancel buttons returns you to the display interface.</span></span>

> [!NOTE]
> <span data-ttu-id="fa129-268">挿入のインターフェイスを表示するには、中にすぐを単価のテキスト ボックスに CompareValidators をテストします。</span><span class="sxs-lookup"><span data-stu-id="fa129-268">While viewing the inserting interface, take a moment to test out the CompareValidators on the unit price TextBoxes.</span></span> <span data-ttu-id="fa129-269">クライアント側のメッセージ ボックスから無効な通貨値と共に出荷ボタンまたは 0 より小さい値での価格の製品の追加をクリックしたときに警告が表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-269">You should see a client-side messagebox warning when clicking the Add Products from Shipment button with invalid currency values or prices with a value less than zero.</span></span>


<span data-ttu-id="fa129-270">[![プロセスの製品の出荷ボタンをクリックした後、挿入するインターフェイスが表示されます。](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-270">[![The Inserting Interface is Displayed After Clicking the Process Product Shipment Button](batch-inserting-vb/_static/image35.png)](batch-inserting-vb/_static/image34.png)</span></span>

<span data-ttu-id="fa129-271">**図 12**: プロセスの製品の出荷ボタンをクリックすると、挿入するインターフェイスが表示されます ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-271">**Figure 12**: The Inserting Interface is Displayed After Clicking the Process Product Shipment Button ([Click to view full-size image](batch-inserting-vb/_static/image36.png))</span></span>


## <a name="step-4-adding-the-products"></a><span data-ttu-id="fa129-272">手順 4: 製品の追加</span><span class="sxs-lookup"><span data-stu-id="fa129-272">Step 4: Adding the Products</span></span>

<span data-ttu-id="fa129-273">このチュートリアルは、出荷ボタン s から商品の追加データベースに製品を保存するために残っているすべて`Click`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="fa129-273">All that remains for this tutorial is to save the products to the database in the Add Products from Shipment Button s `Click` event handler.</span></span> <span data-ttu-id="fa129-274">これには、作成することで、`ProductsDataTable`を追加して、`ProductsRow`指定された製品名のそれぞれのインスタンス。</span><span class="sxs-lookup"><span data-stu-id="fa129-274">This can be accomplished by creating a `ProductsDataTable` and adding a `ProductsRow` instance for each of the product names supplied.</span></span> <span data-ttu-id="fa129-275">1 回これら`ProductsRow`への呼び出しを行う場合、s が追加されて、`ProductsBLL`クラス s`UpdateWithTransaction`メソッドに渡す、`ProductsDataTable`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-275">Once these `ProductsRow` s have been added we will make a call to the `ProductsBLL` class s `UpdateWithTransaction` method passing in the `ProductsDataTable`.</span></span> <span data-ttu-id="fa129-276">注意してください、`UpdateWithTransaction`メソッドで、バックアップで作成された、[トランザクション内でデータベースの変更をラッピング](wrapping-database-modifications-within-a-transaction-vb.md)チュートリアル、パス、`ProductsDataTable`を`ProductsTableAdapter`s`UpdateWithTransaction`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa129-276">Recall that the `UpdateWithTransaction` method, which was created back in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial, passes the `ProductsDataTable` to the `ProductsTableAdapter` s `UpdateWithTransaction` method.</span></span> <span data-ttu-id="fa129-277">ADO.NET トランザクションが開始されてから、および TableAdatper 問題点、`INSERT`ステートメントに追加された各データベースに`ProductsRow`DataTable にします。</span><span class="sxs-lookup"><span data-stu-id="fa129-277">From there, an ADO.NET transaction is started and the TableAdatper issues an `INSERT` statement to the database for each added `ProductsRow` in the DataTable.</span></span> <span data-ttu-id="fa129-278">すべての製品が追加、エラーが発生せず、トランザクションがコミットされたと仮定すると、それ以外の場合はロールバックされます。</span><span class="sxs-lookup"><span data-stu-id="fa129-278">Assuming all products are added without error, the transaction is committed, otherwise it is rolled back.</span></span>

<span data-ttu-id="fa129-279">出荷ボタン s から商品の追加のコード`Click`イベント ハンドラーも少しエラー チェックを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-279">The code for the Add Products from Shipment Button s `Click` event handler also needs to perform a bit of error checking.</span></span> <span data-ttu-id="fa129-280">挿入のインターフェイスで使用される RequiredFieldValidators がないので、ユーザーでした価格の製品のときに入力の名前を省略すること。</span><span class="sxs-lookup"><span data-stu-id="fa129-280">Since there are no RequiredFieldValidators used in the inserting interface, a user could enter a price for a product while omitting its name.</span></span> <span data-ttu-id="fa129-281">S の製品名が必要ですが、ためユーザーに通知して、挿入を続行する必要がある場合は、このような条件の展開します。</span><span class="sxs-lookup"><span data-stu-id="fa129-281">Since the product s name is required, if such a condition unfolds we need to alert the user and not proceed with the inserts.</span></span> <span data-ttu-id="fa129-282">完全な`Click`イベント ハンドラーのコードに依存します。</span><span class="sxs-lookup"><span data-stu-id="fa129-282">The complete `Click` event handler code follows:</span></span>


[!code-vb[Main](batch-inserting-vb/samples/sample6.vb)]

<span data-ttu-id="fa129-283">確認して、イベント ハンドラーを起動、`Page.IsValid`プロパティの値を返します`True`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-283">The event handler starts by ensuring that the `Page.IsValid` property returns a value of `True`.</span></span> <span data-ttu-id="fa129-284">返された場合`False`、し、つまり、1 つ、CompareValidators の詳細が無効なデータをレポート以外の場合はこのようなケースでたくない、入力した製品を挿入しようとするまたはお、最終的には、例外、ユーザーが入力した単価を割り当てようとするときに値を`ProductsRow`s`UnitPrice`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="fa129-284">If it returns `False`, then that means one or more of the CompareValidators are reporting invalid data; in such a case we do not want to attempt to insert the entered products or we'll end up with an exception when attempting to assign the user-entered unit price value to the `ProductsRow` s `UnitPrice` property.</span></span>

<span data-ttu-id="fa129-285">次に、新しい`ProductsDataTable`インスタンスが作成された (`products`)。</span><span class="sxs-lookup"><span data-stu-id="fa129-285">Next, a new `ProductsDataTable` instance is created (`products`).</span></span> <span data-ttu-id="fa129-286">A`For`製品名および単価のテキスト ボックスを反復処理するループを使用し、`Text`プロパティはローカル変数に格納する読み取り`productName`と`unitPrice`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-286">A `For` loop is used to iterate through the product name and unit price TextBoxes and the `Text` properties are read into the local variables `productName` and `unitPrice`.</span></span> <span data-ttu-id="fa129-287">単価のではなく、対応する製品名、ユーザーの値が入力する場合、`StatusLabel`製品の名前をインクルードする単位の価格を提供する場合、メッセージにもする必要がありますを表示し、イベント ハンドラーが終了しました。</span><span class="sxs-lookup"><span data-stu-id="fa129-287">If the user has entered a value for the unit price but not for the corresponding product name, the `StatusLabel` displays the message If you provide a unit price you must also include the name of the product and the event handler is exited.</span></span>

<span data-ttu-id="fa129-288">製品名が指定された、新しい場合`ProductsRow`を使用してインスタンスを作成、 `ProductsDataTable` s`NewProductsRow`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="fa129-288">If a product name has been provided, a new `ProductsRow` instance is created using the `ProductsDataTable` s `NewProductsRow` method.</span></span> <span data-ttu-id="fa129-289">この新しい`ProductsRow`インスタンス s`ProductName`プロパティが、現在の製品に設定中にテキスト ボックスの名前、`SupplierID`と`CategoryID`に割り当てられているプロパティ、`SelectedValue`挿入インターフェイスのヘッダーで DropDownLists のプロパティです。</span><span class="sxs-lookup"><span data-stu-id="fa129-289">This new `ProductsRow` instance s `ProductName` property is set to the current product name TextBox while the `SupplierID` and `CategoryID` properties are assigned to the `SelectedValue` properties of the DropDownLists in the inserting interface s header.</span></span> <span data-ttu-id="fa129-290">割り当てられている場合は、ユーザーが製品の価格の値を入力、`ProductsRow`インスタンス s`UnitPrice`プロパティです。 プロパティは、それ以外の場合、原因となる、割り当てられていない左側、`NULL`値を`UnitPrice`データベースにします。</span><span class="sxs-lookup"><span data-stu-id="fa129-290">If the user entered a value for the product s price, it is assigned to the `ProductsRow` instance s `UnitPrice` property; otherwise, the property is left unassigned, which will result in a `NULL` value for `UnitPrice` in the database.</span></span> <span data-ttu-id="fa129-291">最後に、`Discontinued`と`UnitsOnOrder`プロパティは、ハード コーディングされた値に割り当てられている`False`と 0、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="fa129-291">Finally, the `Discontinued` and `UnitsOnOrder` properties are assigned to the hard-coded values `False` and 0, respectively.</span></span>

<span data-ttu-id="fa129-292">プロパティに割り当てられた後、`ProductsRow`インスタンスに追加されて、`ProductsDataTable`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-292">After the properties have been assigned to the `ProductsRow` instance it is added to the `ProductsDataTable`.</span></span>

<span data-ttu-id="fa129-293">完了時に、`For`すべての製品が追加されているかどうかを確認おループします。</span><span class="sxs-lookup"><span data-stu-id="fa129-293">At the completion of the `For` loop, we check whether any products have been added.</span></span> <span data-ttu-id="fa129-294">ユーザーは、結局のところ、任意の製品名や価格を入力する前に出荷から追加の製品をクリックしている可能性があります、します。</span><span class="sxs-lookup"><span data-stu-id="fa129-294">The user may, after all, have clicked the Add Products from Shipment before entering any product names or prices.</span></span> <span data-ttu-id="fa129-295">少なくとも 1 つの製品がある場合、 `ProductsDataTable`、`ProductsBLL`クラスの`UpdateWithTransaction`メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-295">If there is at least one product in the `ProductsDataTable`, the `ProductsBLL` class s `UpdateWithTransaction` method is called.</span></span> <span data-ttu-id="fa129-296">データが次に、再バインド、 `ProductsGrid` GridView 表示インターフェイスで新しく追加された製品が表示されるようにします。</span><span class="sxs-lookup"><span data-stu-id="fa129-296">Next, the data is rebound to the `ProductsGrid` GridView so that the newly added products will appear in the display interface.</span></span> <span data-ttu-id="fa129-297">`StatusLabel`が更新され、確認メッセージを表示し、`ReturnToDisplayInterface`呼び出されると、非表示、インターフェイスを挿入して表示のインターフェイスを表示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-297">The `StatusLabel` is updated to display a confirmation message and the `ReturnToDisplayInterface` is invoked, hiding the inserting interface and showing the display interface.</span></span>

<span data-ttu-id="fa129-298">製品が入力されていません、挿入するインターフェイスが追加された製品がメッセージが表示されているは保持されません。</span><span class="sxs-lookup"><span data-stu-id="fa129-298">If no products were entered, the inserting interface remains displayed but the message No products were added.</span></span> <span data-ttu-id="fa129-299">製品名を入力してください、テキスト ボックス内の単位の価格が表示されます。</span><span class="sxs-lookup"><span data-stu-id="fa129-299">Please enter the product names and unit prices in the textboxes is displayed.</span></span>

<span data-ttu-id="fa129-300">図の 13、14、15、挿入して表示のインターフェイスの動作します。</span><span class="sxs-lookup"><span data-stu-id="fa129-300">Figure s 13, 14, and 15 show the inserting and display interfaces in action.</span></span> <span data-ttu-id="fa129-301">図 13 に、ユーザーが、対応する製品名のない単位の価格値を入力します。</span><span class="sxs-lookup"><span data-stu-id="fa129-301">In Figure 13, the user has entered a unit price value without a corresponding product name.</span></span> <span data-ttu-id="fa129-302">図 14 インターフェイスを示します表示後に 3 つの新しい製品が追加または正常に、(3 番目、1 つは、前のページでは) GridView で新しく追加された製品の 2 つの図 15 を示します。</span><span class="sxs-lookup"><span data-stu-id="fa129-302">Figure 14 shows the display interface after three new products have been added successfully, while Figure 15 shows two of the newly added products in the GridView (the third one is on the previous page).</span></span>


<span data-ttu-id="fa129-303">[![製品名が必要なときに入力 Unit Price です。](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-303">[![A Product Name is Required When Entering a Unit Price](batch-inserting-vb/_static/image38.png)](batch-inserting-vb/_static/image37.png)</span></span>

<span data-ttu-id="fa129-304">**図 13**: A 製品名が必要なときに入力 Unit Price ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-304">**Figure 13**: A Product Name is Required When Entering a Unit Price ([Click to view full-size image](batch-inserting-vb/_static/image39.png))</span></span>


<span data-ttu-id="fa129-305">[![仕入先の追加された 3 つの新しい Veggies Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-305">[![Three New Veggies Have Been Added for the Supplier Mayumi s](batch-inserting-vb/_static/image41.png)](batch-inserting-vb/_static/image40.png)</span></span>

<span data-ttu-id="fa129-306">**図 14**: 次の 3 つ新しい Veggies が追加されました業者 Mayumi s ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-306">**Figure 14**: Three New Veggies Have Been Added for the Supplier Mayumi s ([Click to view full-size image](batch-inserting-vb/_static/image42.png))</span></span>


<span data-ttu-id="fa129-307">[![GridView の最後のページで、新しい製品が見つかりません](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="fa129-307">[![The New Products Can Be Found in the Last Page of the GridView](batch-inserting-vb/_static/image44.png)](batch-inserting-vb/_static/image43.png)</span></span>

<span data-ttu-id="fa129-308">**図 15**: 新しい製品で見つかります GridView の最後のページ ([フルサイズのイメージを表示するをクリックして](batch-inserting-vb/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="fa129-308">**Figure 15**: The New Products Can Be Found in the Last Page of the GridView ([Click to view full-size image](batch-inserting-vb/_static/image45.png))</span></span>


> [!NOTE]
> <span data-ttu-id="fa129-309">このチュートリアルで使用されるロジックを挿入するバッチは、トランザクションのスコープ内で、挿入をラップします。</span><span class="sxs-lookup"><span data-stu-id="fa129-309">The batch inserting logic used in this tutorial wraps the inserts within the scope of transaction.</span></span> <span data-ttu-id="fa129-310">これを確認するには、データベース レベルのエラーを意図的に紹介します。</span><span class="sxs-lookup"><span data-stu-id="fa129-310">To verify this, purposefully introduce a database-level error.</span></span> <span data-ttu-id="fa129-311">新しいを割り当てるのではなく、たとえば、`ProductsRow`インスタンス s`CategoryID`プロパティで選択した値を`Categories`DropDownList などの値を割り当てる`i * 5`です。</span><span class="sxs-lookup"><span data-stu-id="fa129-311">For example, rather than assigning the new `ProductsRow` instance s `CategoryID` property to the selected value in the `Categories` DropDownList, assign it to a value like `i * 5`.</span></span> <span data-ttu-id="fa129-312">ここで`i`ループ インデクサーは、1 から 5 までの値があります。</span><span class="sxs-lookup"><span data-stu-id="fa129-312">Here `i` is the loop indexer and has values ranging from 1 to 5.</span></span> <span data-ttu-id="fa129-313">したがって、ときにバッチ内の 2 つまたは複数の製品が最初の製品を挿入を追加する必要が有効な`CategoryID`値 (5) が、それ以降の製品が`CategoryID`までと一致しない値`CategoryID`の値が、`Categories`テーブル。</span><span class="sxs-lookup"><span data-stu-id="fa129-313">Therefore, when adding two or more products in batch insert the first product will have a valid `CategoryID` value (5), but subsequent products will have `CategoryID` values that do not match up to `CategoryID` values in the `Categories` table.</span></span> <span data-ttu-id="fa129-314">最終的な結果は、最初の中に`INSERT`成功すると、以降は、外部キー制約違反で失敗します。</span><span class="sxs-lookup"><span data-stu-id="fa129-314">The net effect is that while the first `INSERT` will succeed, subsequent ones will fail with a foreign key constraint violation.</span></span> <span data-ttu-id="fa129-315">一括挿入は、アトミックなので最初`INSERT`はロールバックされます、状態、バッチ処理を挿入する前に、データベースの開始を取得します。</span><span class="sxs-lookup"><span data-stu-id="fa129-315">Since the batch insert is atomic, the first `INSERT` will be rolled back, returning the database to its state before the batch insert process began.</span></span>


## <a name="summary"></a><span data-ttu-id="fa129-316">概要</span><span class="sxs-lookup"><span data-stu-id="fa129-316">Summary</span></span>

<span data-ttu-id="fa129-317">これと前の 2 つのチュートリアルを用意しておりますできるインターフェイスの更新、削除、およびのデータ アクセス層に追加したトランザクションのサポートを使用するすべてのデータのバッチを挿入するには、[ラッピング データベースの変更トランザクション内で](wrapping-database-modifications-within-a-transaction-vb.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="fa129-317">Over this and the previous two tutorials we have created interfaces that allow for updating, deleting, and inserting batches of data, all of which used the transaction support we added to the Data Access Layer in the [Wrapping Database Modifications within a Transaction](wrapping-database-modifications-within-a-transaction-vb.md) tutorial.</span></span> <span data-ttu-id="fa129-318">特定のシナリオでは、このようなバッチ処理のユーザー インターフェイスが大幅に効率を向上エンドユーザーを削減してクリック、ポストバック、およびキーボード、マウスのコンテキストの切り替えの数も、基になるデータの整合性を維持しながら。</span><span class="sxs-lookup"><span data-stu-id="fa129-318">For certain scenarios, such batch processing user interfaces greatly improve end user efficiency by cutting down on the number of clicks, postbacks, and keyboard-to-mouse context switches, while also maintaining the integrity of the underlying data.</span></span>

<span data-ttu-id="fa129-319">このチュートリアルでは、バッチ化されたデータの操作で、外観を完了します。</span><span class="sxs-lookup"><span data-stu-id="fa129-319">This tutorial completes our look at working with batched data.</span></span> <span data-ttu-id="fa129-320">チュートリアルの次のセットでは、さまざまなメソッドでは、TableAdapter s、DAL、暗号化の接続文字列で接続し、コマンド レベルの設定を構成するストアド プロシージャの使用など、データ アクセス層の高度なシナリオについて説明します。</span><span class="sxs-lookup"><span data-stu-id="fa129-320">The next set of tutorials explores a variety of advanced Data Access Layer scenarios, including using stored procedures in the TableAdapter s methods, configuring connection- and command-level settings in the DAL, encrypting connection strings, and more!</span></span>

<span data-ttu-id="fa129-321">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="fa129-321">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="fa129-322">作成者について</span><span class="sxs-lookup"><span data-stu-id="fa129-322">About the Author</span></span>

<span data-ttu-id="fa129-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="fa129-323">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="fa129-324">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="fa129-324">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="fa129-325">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="fa129-325">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="fa129-326">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="fa129-326">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="fa129-327">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="fa129-327">Special Thanks To</span></span>

<span data-ttu-id="fa129-328">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="fa129-328">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="fa129-329">Hilton Giesenow と S ren 一 Lauritsen されたこのチュートリアルのレビュー担当者が生じる。</span><span class="sxs-lookup"><span data-stu-id="fa129-329">Lead reviewers for this tutorial were Hilton Giesenow and S ren Jacob Lauritsen.</span></span> <span data-ttu-id="fa129-330">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="fa129-330">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="fa129-331">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="fa129-331">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="fa129-332">前へ</span><span class="sxs-lookup"><span data-stu-id="fa129-332">Previous</span></span>](batch-deleting-vb.md)
