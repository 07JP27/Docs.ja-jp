---
uid: web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
title: ファイル (c#) をアップロードする |Microsoft ドキュメント
author: rick-anderson
description: サーバーのファイル システムで格納は、Web サイトにユーザー (Word、PDF ドキュメント) などのバイナリ ファイルをアップロードできるようにする方法を説明してください.
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: b381b1da-feb3-4776-bc1b-75db53eb90ab
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/uploading-files-cs
msc.type: authoredcontent
ms.openlocfilehash: 3c758e94311817d01b17d27083733f805caf600f
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/10/2018
ms.locfileid: "30889200"
---
<a name="uploading-files-c"></a><span data-ttu-id="2b947-103">ファイルのアップロード (c#)</span><span class="sxs-lookup"><span data-stu-id="2b947-103">Uploading Files (C#)</span></span>
====================
<span data-ttu-id="2b947-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2b947-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2b947-105">[サンプル アプリをダウンロード](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe)または[PDF のダウンロード](uploading-files-cs/_static/datatutorial54cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="2b947-105">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_54_CS.exe) or [Download PDF](uploading-files-cs/_static/datatutorial54cs1.pdf)</span></span>

> <span data-ttu-id="2b947-106">サーバーのファイル システムまたはデータベースのいずれかに格納は、Web サイトにユーザー (Word、PDF ドキュメント) などのバイナリ ファイルをアップロードできるようにする方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="2b947-106">Learn how to allow users to upload binary files (such as Word or PDF documents) to your Web site where they may be stored in either the server's file system or the database.</span></span>


## <a name="introduction"></a><span data-ttu-id="2b947-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="2b947-107">Introduction</span></span>

<span data-ttu-id="2b947-108">すべてのチュートリアルでは、おテキスト データだけを解析してきた ve 操作していた。</span><span class="sxs-lookup"><span data-stu-id="2b947-108">All of the tutorials we ve examined so far have worked exclusively with text data.</span></span> <span data-ttu-id="2b947-109">ただし、多くのアプリケーションでは、テキストとバイナリ データの両方をキャプチャするデータ モデルがあります。</span><span class="sxs-lookup"><span data-stu-id="2b947-109">However, many applications have data models that capture both text and binary data.</span></span> <span data-ttu-id="2b947-110">オンライン dating サイト、ユーザーは自分のプロファイルに関連付ける画像をアップロードします。</span><span class="sxs-lookup"><span data-stu-id="2b947-110">An online dating site might allow users to upload a picture to associate with their profile.</span></span> <span data-ttu-id="2b947-111">採用の web サイトができます。 Microsoft Word や PDF ドキュメントとしてその復帰をアップロードできます。</span><span class="sxs-lookup"><span data-stu-id="2b947-111">A recruiting website might let users upload their resume as a Microsoft Word or PDF document.</span></span>

<span data-ttu-id="2b947-112">バイナリ データの操作は、新しい課題のセットを追加します。</span><span class="sxs-lookup"><span data-stu-id="2b947-112">Working with binary data adds a new set of challenges.</span></span> <span data-ttu-id="2b947-113">アプリケーションのバイナリ データを格納する方法を決定お必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-113">We must decide how the binary data is stored in the application.</span></span> <span data-ttu-id="2b947-114">新しいレコードを挿入するために使用されるインターフェイスが各自のコンピューターからファイルをアップロードするアクセス許可を更新する必要があり、表示または関連付けられているバイナリ データをレコード s をダウンロードするための手段を提供する追加手順を実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-114">The interface used for inserting new records has to be updated to allow the user to upload a file from their computer and extra steps must be taken to display or provide a means for downloading a record s associated binary data.</span></span> <span data-ttu-id="2b947-115">このチュートリアルで、次の 3 つが、これらの課題を hurdle する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="2b947-115">In this tutorial and the next three we'll explore how to hurdle these challenges.</span></span> <span data-ttu-id="2b947-116">これらのチュートリアルの最後を作成した画像と PDF ドキュメントをカテゴリごとに関連付けます完全に機能するアプリケーション。</span><span class="sxs-lookup"><span data-stu-id="2b947-116">At the end of these tutorials we'll have built a fully functional application that associates a picture and PDF brochure with each category.</span></span> <span data-ttu-id="2b947-117">この特定のチュートリアルではおをバイナリ データを格納するためのさまざまな手法を見て各自のコンピューターからファイルをアップロードするユーザーを有効にする方法を調査および web サーバーのファイル システム上に保存しました。</span><span class="sxs-lookup"><span data-stu-id="2b947-117">In this particular tutorial we'll look at different techniques for storing binary data and explore how to enable users to upload a file from their computer and have it saved on the web server s file system.</span></span>

> [!NOTE]
> <span data-ttu-id="2b947-118">アプリケーションのデータ モデルの一部であるバイナリ データとも呼ば、 [BLOB](http://en.wikipedia.org/wiki/Binary_large_object)、バイナリ ラージ オブジェクトの頭字語です。</span><span class="sxs-lookup"><span data-stu-id="2b947-118">Binary data that is part of an application s data model is sometimes referred to as a [BLOB](http://en.wikipedia.org/wiki/Binary_large_object), an acronym for Binary Large OBject.</span></span> <span data-ttu-id="2b947-119">これらのチュートリアルでことにしました用語のバイナリ データを使用するという用語は、BLOB は同じ意味です。</span><span class="sxs-lookup"><span data-stu-id="2b947-119">In these tutorials I have chosen to use the terminology binary data, although the term BLOB is synonymous.</span></span>


## <a name="step-1-creating-the-working-with-binary-data-web-pages"></a><span data-ttu-id="2b947-120">手順 1: Web ページのバイナリ データで作業を作成します。</span><span class="sxs-lookup"><span data-stu-id="2b947-120">Step 1: Creating the Working with Binary Data Web Pages</span></span>

<span data-ttu-id="2b947-121">バイナリ データのサポートの追加に関連する課題の調査を始める前に、まず、このチュートリアルと、次の 3 つの必要がありますを web サイト プロジェクトに、ASP.NET ページを作成するのにはしばらく s を使用できます。</span><span class="sxs-lookup"><span data-stu-id="2b947-121">Before we begin to explore the challenges associated with adding support for binary data, let s first take a moment to create the ASP.NET pages in our website project that we'll need for this tutorial and the next three.</span></span> <span data-ttu-id="2b947-122">という名前の新しいフォルダーを追加することによって開始`BinaryData`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-122">Start by adding a new folder named `BinaryData`.</span></span> <span data-ttu-id="2b947-123">次に、各ページに関連付けるように、そのフォルダーに次の ASP.NET ページを追加、`Site.master`マスター ページ。</span><span class="sxs-lookup"><span data-stu-id="2b947-123">Next, add the following ASP.NET pages to that folder, making sure to associate each page with the `Site.master` master page:</span></span>

- `Default.aspx`
- `FileUpload.aspx`
- `DisplayOrDownloadData.aspx`
- `UploadInDetailsView.aspx`
- `UpdatingAndDeleting.aspx`


![バイナリ データに関連するチュートリアルについては、ASP.NET ページを追加します。](uploading-files-cs/_static/image1.gif)

<span data-ttu-id="2b947-125">**図 1**: バイナリ データに関連するチュートリアルについては、ASP.NET ページを追加します。</span><span class="sxs-lookup"><span data-stu-id="2b947-125">**Figure 1**: Add the ASP.NET Pages for the Binary Data-Related Tutorials</span></span>


<span data-ttu-id="2b947-126">などの他のフォルダーで`Default.aspx`で、`BinaryData`フォルダーは、チュートリアルのセクションに一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="2b947-126">Like in the other folders, `Default.aspx` in the `BinaryData` folder will list the tutorials in its section.</span></span> <span data-ttu-id="2b947-127">注意してください、`SectionLevelTutorialListing.ascx`ユーザー コントロールは、この機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="2b947-127">Recall that the `SectionLevelTutorialListing.ascx` User Control provides this functionality.</span></span> <span data-ttu-id="2b947-128">そのため、このユーザー コントロールを追加`Default.aspx`をページのデザイン ビューに、ソリューション エクスプ ローラーからドラッグしています。</span><span class="sxs-lookup"><span data-stu-id="2b947-128">Therefore, add this User Control to `Default.aspx` by dragging it from the Solution Explorer onto the page s Design view.</span></span>


<span data-ttu-id="2b947-129">[![Default.aspx に SectionLevelTutorialListing.ascx ユーザー コントロールを追加します。](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-129">[![Add the SectionLevelTutorialListing.ascx User Control to Default.aspx](uploading-files-cs/_static/image2.gif)](uploading-files-cs/_static/image1.png)</span></span>

<span data-ttu-id="2b947-130">**図 2**: 追加、`SectionLevelTutorialListing.ascx`ユーザー コントロールを`Default.aspx`([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-130">**Figure 2**: Add the `SectionLevelTutorialListing.ascx` User Control to `Default.aspx` ([Click to view full-size image](uploading-files-cs/_static/image2.png))</span></span>


<span data-ttu-id="2b947-131">最後に、これらのページを追加するエントリとして、`Web.sitemap`ファイル。</span><span class="sxs-lookup"><span data-stu-id="2b947-131">Lastly, add these pages as entries to the `Web.sitemap` file.</span></span> <span data-ttu-id="2b947-132">具体的には、次のマークアップを追加、向上した後、GridView `<siteMapNode>`:</span><span class="sxs-lookup"><span data-stu-id="2b947-132">Specifically, add the following markup after the Enhancing the GridView `<siteMapNode>`:</span></span>


[!code-xml[Main](uploading-files-cs/samples/sample1.xml)]

<span data-ttu-id="2b947-133">更新した後に`Web.sitemap`ブラウザーを使って、チュートリアルの web サイトを表示します。</span><span class="sxs-lookup"><span data-stu-id="2b947-133">After updating `Web.sitemap`, take a moment to view the tutorials website through a browser.</span></span> <span data-ttu-id="2b947-134">左側のメニューには、バイナリ データのチュートリアルを使用した作業の項目が含まれています。</span><span class="sxs-lookup"><span data-stu-id="2b947-134">The menu on the left now includes items for the Working with Binary Data tutorials.</span></span>


![サイト マップではバイナリ データのチュートリアルを使用した作業のエントリが含まれるようになりました](uploading-files-cs/_static/image3.gif)

<span data-ttu-id="2b947-136">**図 3**: サイト マップではバイナリ データのチュートリアルを使用した作業のエントリが含まれるようになりました</span><span class="sxs-lookup"><span data-stu-id="2b947-136">**Figure 3**: The Site Map Now Includes Entries for the Working with Binary Data Tutorials</span></span>


## <a name="step-2-deciding-where-to-store-the-binary-data"></a><span data-ttu-id="2b947-137">手順 2: バイナリ データを格納する場所を決定します。</span><span class="sxs-lookup"><span data-stu-id="2b947-137">Step 2: Deciding Where to Store the Binary Data</span></span>

<span data-ttu-id="2b947-138">アプリケーションのデータ モデルに関連付けられているバイナリ データは、2 つの場所に格納できますデータベースに格納されているファイルへの参照で web サーバーのファイル システム上。または、データベース自体内に直接 (図 4 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="2b947-138">Binary data that is associated with the application s data model can be stored in one of two places: on the web server s file system with a reference to the file stored in the database; or directly within the database itself (see Figure 4).</span></span> <span data-ttu-id="2b947-139">それぞれのアプローチには長所と短所の独自セットがあり、最もメリットのある詳細な説明。</span><span class="sxs-lookup"><span data-stu-id="2b947-139">Each approach has its own set of pros and cons and merits a more detailed discussion.</span></span>


<span data-ttu-id="2b947-140">[![ファイル システム上またはデータベース内で直接、バイナリ データを格納することができます。](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-140">[![Binary Data Can Be Stored On the File System or Directly in the Database](uploading-files-cs/_static/image4.gif)](uploading-files-cs/_static/image3.png)</span></span>

<span data-ttu-id="2b947-141">**図 4**: ファイル システム上またはデータベース内で直接、バイナリ データを格納することができます ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-141">**Figure 4**: Binary Data Can Be Stored On the File System or Directly in the Database ([Click to view full-size image](uploading-files-cs/_static/image4.png))</span></span>


<span data-ttu-id="2b947-142">想像に各 product に画像を関連付けるには、Northwind データベースを拡張します。</span><span class="sxs-lookup"><span data-stu-id="2b947-142">Imagine that we wanted to extend the Northwind database to associate a picture with each product.</span></span> <span data-ttu-id="2b947-143">1 つのオプションは web サーバーのファイル システムにこれらのイメージ ファイルを格納およびパスを記録すること、`Products`テーブル。</span><span class="sxs-lookup"><span data-stu-id="2b947-143">One option would be to store these image files on the web server s file system and record the path in the `Products` table.</span></span> <span data-ttu-id="2b947-144">この方法で d を追加、`ImagePath`列を`Products`型のテーブル`varchar(200)`、おそらくです。</span><span class="sxs-lookup"><span data-stu-id="2b947-144">With this approach, we d add an `ImagePath` column to the `Products` table of type `varchar(200)`, perhaps.</span></span> <span data-ttu-id="2b947-145">Web サーバーのファイル システムにその画像を格納する可能性がありますユーザーは、Chai の画像をアップロード、`~/Images/Tea.jpg`ここで、`~`アプリケーション s の物理パスを表します。</span><span class="sxs-lookup"><span data-stu-id="2b947-145">When a user uploaded a picture for Chai, that picture might be stored on the web server s file system at `~/Images/Tea.jpg`, where `~` represents the application s physical path.</span></span> <span data-ttu-id="2b947-146">つまり、物理パスにある web サイトがルート化されている場合`C:\Websites\Northwind\`、`~/Images/Tea.jpg`と同じ`C:\Websites\Northwind\Images\Tea.jpg`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-146">That is, if the web site is rooted at the physical path `C:\Websites\Northwind\`, `~/Images/Tea.jpg` would be equivalent to `C:\Websites\Northwind\Images\Tea.jpg`.</span></span> <span data-ttu-id="2b947-147">Chai レコードの更新 d イメージ ファイルをアップロードした後、`Products`テーブルようにその`ImagePath`列は、新しいイメージのパスを参照します。</span><span class="sxs-lookup"><span data-stu-id="2b947-147">After uploading the image file, we d update the Chai record in the `Products` table so that its `ImagePath` column referenced the path of the new image.</span></span> <span data-ttu-id="2b947-148">使用して`~/Images/Tea.jpg`または`Tea.jpg`場合は、すべての製品の画像はアプリケーション s 内に配置することをにしました`Images`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="2b947-148">We could use `~/Images/Tea.jpg` or just `Tea.jpg` if we decided that all product images would be placed in the application s `Images` folder.</span></span>

<span data-ttu-id="2b947-149">バイナリ データを格納するファイル システム上の主な利点は次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="2b947-149">The main advantages of storing the binary data on the file system are:</span></span>

- <span data-ttu-id="2b947-150">**実装の容易性**を格納して、データベース内に直接格納されるバイナリ データを取得するときに、ファイル システムを介してデータを扱うビット以上のコードと思います間もなく、します。</span><span class="sxs-lookup"><span data-stu-id="2b947-150">**Ease of implementation** as we'll see shortly, storing and retrieving binary data stored directly within the database involves a bit more code than when working with data through the file system.</span></span> <span data-ttu-id="2b947-151">さらに、ユーザーを表示またはバイナリ データをダウンロードするために、必要がありますが表示されたデータへの URL。</span><span class="sxs-lookup"><span data-stu-id="2b947-151">Additionally, in order for a user to view or download binary data they must be presented with a URL to that data.</span></span> <span data-ttu-id="2b947-152">Web サーバーのファイル システムにデータがある場合、URL は単純です。</span><span class="sxs-lookup"><span data-stu-id="2b947-152">If the data resides on the web server s file system, the URL is straightforward.</span></span> <span data-ttu-id="2b947-153">データがデータベースに格納されている場合、web ページを取得し、データベースからデータを返すを作成する必要します。</span><span class="sxs-lookup"><span data-stu-id="2b947-153">If the data is stored in the database, however, a web page needs to be created that will retrieve and return the data from the database.</span></span>
- <span data-ttu-id="2b947-154">**バイナリ データへのアクセスをより広い**バイナリ データは、その他のサービスまたはアプリケーションでは、データベースからデータをプルできませんしたものにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-154">**Wider access to the binary data** the binary data may need to be accessible to other services or applications, ones that cannot pull the data from the database.</span></span> <span data-ttu-id="2b947-155">たとえば、各 product に関連付けられているイメージを使用してユーザーに使用する必要がありますも[FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol)、後者 d するファイル システムにバイナリ データを格納します。</span><span class="sxs-lookup"><span data-stu-id="2b947-155">For example, the images associated with each product might also need to be available to users through [FTP](http://en.wikipedia.org/wiki/File_Transfer_Protocol), in which case we d want to store the binary data on the file system.</span></span>
- <span data-ttu-id="2b947-156">**パフォーマンス**バイナリ データがファイル システムに格納されている場合、データベース サーバーと web サーバー間の要求とネットワークの輻輳よりも少なくなります、データベース内で直接、バイナリ データが格納されている場合。</span><span class="sxs-lookup"><span data-stu-id="2b947-156">**Performance** if the binary data is stored on the file system, the demand and network congestion between the database server and web server will be less than if the binary data is stored directly within the database.</span></span>

<span data-ttu-id="2b947-157">バイナリ データを格納するファイル システム上の主な欠点は、データベースからデータを分離ことです。</span><span class="sxs-lookup"><span data-stu-id="2b947-157">The main disadvantage of storing binary data on the file system is that it decouples the data from the database.</span></span> <span data-ttu-id="2b947-158">レコードが削除された場合、`Products`テーブル、web サーバーのファイル システムに関連付けられているファイルが自動的に削除されません。</span><span class="sxs-lookup"><span data-stu-id="2b947-158">If a record is deleted from the `Products` table, the associated file on the web server s file system is not automatically deleted.</span></span> <span data-ttu-id="2b947-159">ファイルまたはファイル システムを削除する追加のコードが散在し、使用されていない、孤立したファイルを記述する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-159">We must write extra code to delete the file or the file system will become cluttered with unused, orphaned files.</span></span> <span data-ttu-id="2b947-160">さらに、データベースをバックアップする場合もファイル システムに関連付けられているバイナリ データのバックアップを作成することを確認してようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-160">Furthermore, when backing up the database, we must make sure to make backups of the associated binary data on the file system, as well.</span></span> <span data-ttu-id="2b947-161">別のサイトまたはサーバーの問題のような課題にデータベースを移動します。</span><span class="sxs-lookup"><span data-stu-id="2b947-161">Moving the database to another site or server poses similar challenges.</span></span>

<span data-ttu-id="2b947-162">型の列を作成することでバイナリ データを Microsoft SQL Server 2005 データベースに直接保存する代わりに、`varbinary`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-162">Alternatively, binary data can be stored directly in a Microsoft SQL Server 2005 database by creating a column of type `varbinary`.</span></span> <span data-ttu-id="2b947-163">ほかの可変長データ型と同様にこの列でのバイナリ データを保持できる最大長を指定できます。</span><span class="sxs-lookup"><span data-stu-id="2b947-163">Like with other variable length data types, you can specify a maximum length of the binary data that can be held in this column.</span></span> <span data-ttu-id="2b947-164">たとえば、多くてを予約する 5,000 バイト使用`varbinary(5000)`です。`varbinary(MAX)`では、ストレージの最大サイズを約 2 GB です。</span><span class="sxs-lookup"><span data-stu-id="2b947-164">For example, to reserve at most 5,000 bytes use `varbinary(5000)`; `varbinary(MAX)` allows for the maximum storage size, about 2 GB.</span></span>

<span data-ttu-id="2b947-165">データベース内で直接バイナリ データを格納する主な利点は、バイナリ データおよびデータベースのレコード間の密結合です。</span><span class="sxs-lookup"><span data-stu-id="2b947-165">The main advantage of storing binary data directly in the database is the tight coupling between the binary data and the database record.</span></span> <span data-ttu-id="2b947-166">これには、バックアップまたは別のサイトまたはサーバーにデータベースの移動など、データベース管理タスクが大幅に簡略化します。</span><span class="sxs-lookup"><span data-stu-id="2b947-166">This greatly simplifies database administration tasks, like backups or moving the database to a different site or server.</span></span> <span data-ttu-id="2b947-167">また、レコードを自動的に削除すると、対応するバイナリ データが削除されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-167">Also, deleting a record automatically deletes the corresponding binary data.</span></span> <span data-ttu-id="2b947-168">バイナリ データを格納するデータベース内の複数の微妙な利点もあります。</span><span class="sxs-lookup"><span data-stu-id="2b947-168">There are also more subtle benefits of storing the binary data in the database.</span></span> <span data-ttu-id="2b947-169">参照してください[を格納するバイナリ ファイルを直接データベースを使用して ASP.NET 2.0 の](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx)の詳細情報についてはします。</span><span class="sxs-lookup"><span data-stu-id="2b947-169">See [Storing Binary Files Directly in the Database Using ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/120606-1.aspx) for a more in-depth discussion.</span></span>

> [!NOTE]
> <span data-ttu-id="2b947-170">Microsoft SQL Server 2000 以前のバージョンでのみで、`varbinary`データ型が 8,000 バイトの最大数。</span><span class="sxs-lookup"><span data-stu-id="2b947-170">In Microsoft SQL Server 2000 and earlier versions, the `varbinary` data type had a maximum limit of 8,000 bytes.</span></span> <span data-ttu-id="2b947-171">最大 2 GB のバイナリ データを格納する、 [ `image`データ型](https://msdn.microsoft.com/library/ms187993.aspx)代わりに使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-171">To store up to 2 GB of binary data the [`image` data type](https://msdn.microsoft.com/library/ms187993.aspx) needs to be used instead.</span></span> <span data-ttu-id="2b947-172">追加すると、 `MAX` SQL Server 2005、ただしで、`image`データ型は廃止されました。</span><span class="sxs-lookup"><span data-stu-id="2b947-172">With the addition of `MAX` in SQL Server 2005, however, the `image` data type has been deprecated.</span></span> <span data-ttu-id="2b947-173">これは、s ために引き続きサポート後方互換性のためが、Microsoft はことを発表しましたが、`image`データ型は、SQL Server の将来のバージョンで削除される予定です。</span><span class="sxs-lookup"><span data-stu-id="2b947-173">It s still supported for backwards compatibility, but Microsoft has announced that the `image` data type will be removed in a future version of SQL Server.</span></span>


<span data-ttu-id="2b947-174">表示古いデータ モデルを使用して作業している場合、`image`データ型。</span><span class="sxs-lookup"><span data-stu-id="2b947-174">If you are working with an older data model you may see the `image` data type.</span></span> <span data-ttu-id="2b947-175">Northwind データベース s`Categories`テーブルには、`Picture`カテゴリのイメージ ファイルのバイナリ データの格納に使用できる列です。</span><span class="sxs-lookup"><span data-stu-id="2b947-175">The Northwind database s `Categories` table has a `Picture` column that can be used to store the binary data of an image file for the category.</span></span> <span data-ttu-id="2b947-176">型のこの列は、Northwind データベースには、Microsoft Access や SQL Server の以前のバージョンでは、そのルートがあるので`image`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-176">Since the Northwind database has its roots in Microsoft Access and earlier versions of SQL Server, this column is of type `image`.</span></span>

<span data-ttu-id="2b947-177">このチュートリアルと、次の 3 つの場合は、どちらの方法でもを使用されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-177">For this tutorial and the next three, we'll use both approaches.</span></span> <span data-ttu-id="2b947-178">`Categories`テーブルが既に、`Picture`カテゴリの画像のバイナリ コンテンツを格納するための列です。</span><span class="sxs-lookup"><span data-stu-id="2b947-178">The `Categories` table already has a `Picture` column for storing the binary content of an image for the category.</span></span> <span data-ttu-id="2b947-179">追加の列の追加`BrochurePath`、印刷品質、洗練されたカテゴリの概要を提供するために使用する web サーバーのファイル システムに PDF へのパスを格納します。</span><span class="sxs-lookup"><span data-stu-id="2b947-179">We'll add an additional column, `BrochurePath`, to store a path to a PDF on the web server s file system that can be used to provide a print-quality, polished overview of the category.</span></span>

## <a name="step-3-adding-thebrochurepathcolumn-to-thecategoriestable"></a><span data-ttu-id="2b947-180">手順 3: 追加、`BrochurePath`列を`Categories`テーブル</span><span class="sxs-lookup"><span data-stu-id="2b947-180">Step 3: Adding the`BrochurePath`Column to the`Categories`Table</span></span>

<span data-ttu-id="2b947-181">現在、Categories テーブルが 4 つだけの列: `CategoryID`、 `CategoryName`、 `Description`、および`Picture`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-181">Currently the Categories table has only four columns: `CategoryID`, `CategoryName`, `Description`, and `Picture`.</span></span> <span data-ttu-id="2b947-182">これらのフィールドだけでなく (存在する場合は、カテゴリのパンフレットをポイントするか、新しいを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-182">In addition to these fields, we need to add a new one that will point to the category s brochure (if one exists).</span></span> <span data-ttu-id="2b947-183">この列を追加するには、サーバー エクスプ ローラーにドリル ダウンするにはテーブルを右クリックを参照してください、`Categories`テーブルし、テーブル定義を開く (図 5 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="2b947-183">To add this column, go to the Server Explorer, drill down into the Tables, right-click on the `Categories` table and choose Open Table Definition (see Figure 5).</span></span> <span data-ttu-id="2b947-184">サーバー エクスプ ローラーが表示されない場合は、[表示] メニューからサーバー エクスプ ローラーのオプションを選択して表示または Ctrl + Alt + S をヒットします。</span><span class="sxs-lookup"><span data-stu-id="2b947-184">If you do not see the Server Explorer, bring it up by selecting the Server Explorer option from the View menu, or hit Ctrl+Alt+S.</span></span>

<span data-ttu-id="2b947-185">新しい`varchar(200)`列を`Categories`という名前のテーブル`BrochurePath`でき、 `NULL` s と保存] アイコンをクリックして (または Ctrl キーを押しながら S キーを押して)。</span><span class="sxs-lookup"><span data-stu-id="2b947-185">Add a new `varchar(200)` column to the `Categories` table that is named `BrochurePath` and allows `NULL` s and click the Save icon (or hit Ctrl+S).</span></span>


<span data-ttu-id="2b947-186">[![Categories テーブルに BrochurePath 列を追加します。](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-186">[![Add a BrochurePath Column to the Categories Table](uploading-files-cs/_static/image5.gif)](uploading-files-cs/_static/image5.png)</span></span>

<span data-ttu-id="2b947-187">**図 5**: 追加、`BrochurePath`列を`Categories`テーブル ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-187">**Figure 5**: Add a `BrochurePath` Column to the `Categories` Table ([Click to view full-size image](uploading-files-cs/_static/image6.png))</span></span>


## <a name="step-4-updating-the-architecture-to-use-thepictureandbrochurepathcolumns"></a><span data-ttu-id="2b947-188">手順 4: 使用するアーキテクチャを更新する、`Picture`と`BrochurePath`列</span><span class="sxs-lookup"><span data-stu-id="2b947-188">Step 4: Updating the Architecture to Use the`Picture`and`BrochurePath`Columns</span></span>

<span data-ttu-id="2b947-189">`CategoriesDataTable`データ アクセス層 (DAL) では現在は 4 つ`DataColumn`定義 s: `CategoryID`、 `CategoryName`、 `Description`、および`NumberOfProducts`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-189">The `CategoriesDataTable` in the Data Access Layer (DAL) currently has four `DataColumn` s defined: `CategoryID`, `CategoryName`, `Description`, and `NumberOfProducts`.</span></span> <span data-ttu-id="2b947-190">おもともと設計されている場合にこの DataTable、[データ アクセス レイヤーを作成する](../introduction/creating-a-data-access-layer-cs.md)チュートリアルでは、`CategoriesDataTable`だけが最初の 3 つの列以外の場合は、`NumberOfProducts`列が追加されました、[マスター/詳細、箇条書きを使用します。マスター詳細 DataList レコードの一覧](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="2b947-190">When we originally designed this DataTable in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-cs.md) tutorial, the `CategoriesDataTable` only had the first three columns; the `NumberOfProducts` column was added in the [Master/Detail Using a Bulleted List of Master Records with a Details DataList](../filtering-scenarios-with-the-datalist-and-repeater/master-detail-using-a-bulleted-list-of-master-records-with-a-details-datalist-cs.md) tutorial.</span></span>

<span data-ttu-id="2b947-191">説明したよう*データ アクセス レイヤーを作成する*、型指定されたデータセットのデータ テーブルは、ビジネス オブジェクトを構成します。</span><span class="sxs-lookup"><span data-stu-id="2b947-191">As discussed in *Creating a Data Access Layer*, the DataTables in the Typed DataSet make up the business objects.</span></span> <span data-ttu-id="2b947-192">Tableadapter は、データベースとの通信をクエリ結果と共にビジネス オブジェクトを設定するためです。</span><span class="sxs-lookup"><span data-stu-id="2b947-192">The TableAdapters are responsible for communicating with the database and populating the business objects with the query results.</span></span> <span data-ttu-id="2b947-193">`CategoriesDataTable`によって設定されますが、 `CategoriesTableAdapter`、3 つのデータ取得方法は。</span><span class="sxs-lookup"><span data-stu-id="2b947-193">The `CategoriesDataTable` is populated by the `CategoriesTableAdapter`, which has three data retrieval methods:</span></span>

- <span data-ttu-id="2b947-194">`GetCategories()` TableAdapter のメインのクエリを実行し、返します、 `CategoryID`、 `CategoryName`、および`Description`内のすべてのレコードのフィールド、`Categories`テーブル。</span><span class="sxs-lookup"><span data-stu-id="2b947-194">`GetCategories()` executes the TableAdapter s main query and returns the `CategoryID`, `CategoryName`, and `Description` fields of all records in the `Categories` table.</span></span> <span data-ttu-id="2b947-195">メインのクエリが自動生成されたによって使用されるもの`Insert`と`Update`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-195">The main query is what is used by the auto-generated `Insert` and `Update` methods.</span></span>
- <span data-ttu-id="2b947-196">`GetCategoryByCategoryID(categoryID)` 返します、 `CategoryID`、 `CategoryName`、および`Description`カテゴリのフィールドが`CategoryID`equals *categoryID*です。</span><span class="sxs-lookup"><span data-stu-id="2b947-196">`GetCategoryByCategoryID(categoryID)` returns the `CategoryID`, `CategoryName`, and `Description` fields of the category whose `CategoryID` equals *categoryID*.</span></span>
- <span data-ttu-id="2b947-197">`GetCategoriesAndNumberOfProducts()` -を返します、 `CategoryID`、 `CategoryName`、および`Description`内のすべてのレコードのフィールドを`Categories`テーブル。</span><span class="sxs-lookup"><span data-stu-id="2b947-197">`GetCategoriesAndNumberOfProducts()` - returns the `CategoryID`, `CategoryName`, and `Description` fields for all records in the `Categories` table.</span></span> <span data-ttu-id="2b947-198">また、サブクエリを使用して、各カテゴリに関連付けられている製品の数を返します。</span><span class="sxs-lookup"><span data-stu-id="2b947-198">Also uses a subquery to return the number of products associated with each category.</span></span>

<span data-ttu-id="2b947-199">これらのクエリの戻り値はする通知、`Categories`表 s`Picture`または`BrochurePath`列もできません、`CategoriesDataTable`提供`DataColumn`秒であり、これらのフィールドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-199">Notice that none of these queries return the `Categories` table s `Picture` or `BrochurePath` columns; nor does the `CategoriesDataTable` provide `DataColumn` s for these fields.</span></span> <span data-ttu-id="2b947-200">画像を操作するためと`BrochurePath`プロパティ、最初に追加する必要があります、`CategoriesDataTable`し、更新、`CategoriesTableAdapter`これらの列を返すためにします。</span><span class="sxs-lookup"><span data-stu-id="2b947-200">In order to work with the Picture and `BrochurePath` properties, we need to first add them to the `CategoriesDataTable` and then update the `CategoriesTableAdapter` class to return these columns.</span></span>

## <a name="adding-thepictureandbrochurepathdatacolumn-s"></a><span data-ttu-id="2b947-201">追加する、`Picture`と`BrochurePath``DataColumn`s</span><span class="sxs-lookup"><span data-stu-id="2b947-201">Adding the`Picture`and`BrochurePath``DataColumn` s</span></span>

<span data-ttu-id="2b947-202">これら 2 つの列を追加して、開始、`CategoriesDataTable`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-202">Start by adding these two columns to the `CategoriesDataTable`.</span></span> <span data-ttu-id="2b947-203">右クリックし、`CategoriesDataTable`のヘッダーのコンテキスト メニューの [追加と Column オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b947-203">Right-click on the `CategoriesDataTable` s header, select Add from the context menu and then choose the Column option.</span></span> <span data-ttu-id="2b947-204">これは、新しい作成`DataColumn`という名前の DataTable に`Column1`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-204">This will create a new `DataColumn` in the DataTable named `Column1`.</span></span> <span data-ttu-id="2b947-205">この列の名前を変更`Picture`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-205">Rename this column to `Picture`.</span></span> <span data-ttu-id="2b947-206">[プロパティ] ウィンドウから次のように設定します。、 `DataColumn` s`DataType`プロパティを`System.Byte[]`(これは、ドロップダウン リストのオプションではありません; に入力する必要があります)。</span><span class="sxs-lookup"><span data-stu-id="2b947-206">From the Properties window, set the `DataColumn` s `DataType` property to `System.Byte[]` (this is not an option in the drop-down list; you need to type it in).</span></span>


<span data-ttu-id="2b947-207">[![データ型を持つは system.byte[] DataColumn という名前の画像を作成します。](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-207">[![Create a DataColumn Named Picture whose DataType is System.Byte[]](uploading-files-cs/_static/image6.gif)](uploading-files-cs/_static/image7.png)</span></span>

<span data-ttu-id="2b947-208">**図 6**: 作成、`DataColumn`名前付き`Picture`が`DataType`は`System.Byte[]`([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-208">**Figure 6**: Create a `DataColumn` Named `Picture` whose `DataType` is `System.Byte[]` ([Click to view full-size image](uploading-files-cs/_static/image8.png))</span></span>


<span data-ttu-id="2b947-209">もう 1 つ追加`DataColumn`命名、DataTable に`BrochurePath`既定値を使用して`DataType`値 (`System.String`)。</span><span class="sxs-lookup"><span data-stu-id="2b947-209">Add another `DataColumn` to the DataTable, naming it `BrochurePath` using the default `DataType` value (`System.String`).</span></span>

## <a name="returning-thepictureandbrochurepathvalues-from-the-tableadapter"></a><span data-ttu-id="2b947-210">返す、`Picture`と`BrochurePath`TableAdapter の値</span><span class="sxs-lookup"><span data-stu-id="2b947-210">Returning the`Picture`and`BrochurePath`Values from the TableAdapter</span></span>

<span data-ttu-id="2b947-211">これらの 2 つの`DataColumn`に追加される、 `CategoriesDataTable`、私たちを更新する準備ができたら、`CategoriesTableAdapter`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-211">With these two `DataColumn` s added to the `CategoriesDataTable`, we re ready to update the `CategoriesTableAdapter`.</span></span> <span data-ttu-id="2b947-212">両方のメインの TableAdapter クエリで返される列値があるが、これは元に戻す、バイナリ データたびに、`GetCategories()`メソッドが呼び出されました。</span><span class="sxs-lookup"><span data-stu-id="2b947-212">We could have both of these column values returned in the main TableAdapter query, but this would bring back the binary data every time the `GetCategories()` method was invoked.</span></span> <span data-ttu-id="2b947-213">Let s が元に戻すにメインの TableAdapter クエリを更新する代わりに、 `BrochurePath` s 特定のカテゴリを表す追加のデータの取得メソッドを作成および`Picture`列です。</span><span class="sxs-lookup"><span data-stu-id="2b947-213">Instead, let s update the main TableAdapter query to bring back `BrochurePath` and create an additional data retrieval method that returns a particular category s `Picture` column.</span></span>

<span data-ttu-id="2b947-214">TableAdapter のメインのクエリを更新するを右クリックし、`CategoriesTableAdapter`のヘッダーし、コンテキスト メニューから構成オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b947-214">To update the main TableAdapter query, right-click on the `CategoriesTableAdapter` s header and choose the Configure option from the context menu.</span></span> <span data-ttu-id="2b947-215">私たちテーブル アダプターの構成ウィザードが表示にはさまざまな過去のチュートリアルを見てきました。</span><span class="sxs-lookup"><span data-stu-id="2b947-215">This brings up the Table Adapter Configuration Wizard, which we ve seen in a number of past tutorials.</span></span> <span data-ttu-id="2b947-216">元に戻すにクエリを更新、 `BrochurePath` [完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-216">Update the query to bring back the `BrochurePath` and click Finish.</span></span>


<span data-ttu-id="2b947-217">[![更新プログラムも BrochurePath を返す SELECT ステートメントで列の一覧](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-217">[![Update the Column List in the SELECT Statement to Also Return BrochurePath](uploading-files-cs/_static/image7.gif)](uploading-files-cs/_static/image9.png)</span></span>

<span data-ttu-id="2b947-218">**図 7**: で列リストを更新、`SELECT`ステートメントを返すことも`BrochurePath`([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-218">**Figure 7**: Update the Column List in the `SELECT` Statement to Also Return `BrochurePath` ([Click to view full-size image](uploading-files-cs/_static/image10.png))</span></span>


<span data-ttu-id="2b947-219">Tableadapter をアドホック SQL ステートメントを使用する場合は、すべての列リストを更新、メインのクエリで列リストを更新、`SELECT`クエリは TableAdapter のメソッドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-219">When using ad-hoc SQL statements for the TableAdapter, updating the column list in the main query updates the column list for all of the `SELECT` query methods in the TableAdapter.</span></span> <span data-ttu-id="2b947-220">つまり、`GetCategoryByCategoryID(categoryID)`を返すメソッドが更新されて、`BrochurePath`列で、意図したと場合があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-220">That means the `GetCategoryByCategoryID(categoryID)` method has been updated to return the `BrochurePath` column, which might be what we intended.</span></span> <span data-ttu-id="2b947-221">ただし、これも更新で列リスト、`GetCategoriesAndNumberOfProducts()`を各カテゴリの製品の数を返すサブクエリを削除するメソッドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-221">However, it also updated the column list in the `GetCategoriesAndNumberOfProducts()` method, removing the subquery that returns the number of products for each category!</span></span> <span data-ttu-id="2b947-222">そのため、このメソッドを更新する必要があります`SELECT`クエリ。</span><span class="sxs-lookup"><span data-stu-id="2b947-222">Therefore, we need to update this method s `SELECT` query.</span></span> <span data-ttu-id="2b947-223">右クリックし、`GetCategoriesAndNumberOfProducts()`メソッドを構成] を選択し、元に戻す、`SELECT`元の値に戻すクエリ。</span><span class="sxs-lookup"><span data-stu-id="2b947-223">Right-click on the `GetCategoriesAndNumberOfProducts()` method, choose Configure, and revert the `SELECT` query back to its original value:</span></span>


[!code-sql[Main](uploading-files-cs/samples/sample2.sql)]

<span data-ttu-id="2b947-224">特定のカテゴリ s を返す新しい TableAdapter メソッドを次に、作成`Picture`列の値。</span><span class="sxs-lookup"><span data-stu-id="2b947-224">Next, create a new TableAdapter method that returns a particular category s `Picture` column value.</span></span> <span data-ttu-id="2b947-225">右クリックし、`CategoriesTableAdapter`のヘッダー TableAdapter クエリの構成ウィザードを起動するクエリの追加オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="2b947-225">Right-click on the `CategoriesTableAdapter` s header and choose the Add Query option to launch the TableAdapter Query Configuration Wizard.</span></span> <span data-ttu-id="2b947-226">このウィザードの最初の手順は、アドホック SQL ステートメントを使用してデータをクエリする場合、新しいストアド プロシージャ、または既存 us を要求します。</span><span class="sxs-lookup"><span data-stu-id="2b947-226">The first step of this wizard asks us if we want to query data using an ad-hoc SQL statement, a new stored procedure, or an existing one.</span></span> <span data-ttu-id="2b947-227">SQL ステートメントを使用を選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-227">Select Use SQL statements and click Next.</span></span> <span data-ttu-id="2b947-228">行を返すおのでを 2 番目のステップからの行のオプションを返す SELECT を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b947-228">Since we will be returning a row, choose the SELECT which returns rows option from the second step.</span></span>


<span data-ttu-id="2b947-229">[![使用する SQL ステートメント オプションを選択します。](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-229">[![Select the Use SQL statements Option](uploading-files-cs/_static/image8.gif)](uploading-files-cs/_static/image11.png)</span></span>

<span data-ttu-id="2b947-230">**図 8**: 使用する SQL ステートメント オプションを選択 ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-230">**Figure 8**: Select the Use SQL statements Option ([Click to view full-size image](uploading-files-cs/_static/image12.png))</span></span>


<span data-ttu-id="2b947-231">[![複数行を返すため、クエリでは、Categories テーブルからレコードを返しますの選択が選択します。](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-231">[![Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows](uploading-files-cs/_static/image9.gif)](uploading-files-cs/_static/image13.png)</span></span>

<span data-ttu-id="2b947-232">**図 9**: クエリが、選択をオンに行が返されます、Categories テーブルからレコードを返すため ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-232">**Figure 9**: Since the Query Will Return a Record from the Categories Table, Choose SELECT which returns rows ([Click to view full-size image](uploading-files-cs/_static/image14.png))</span></span>


<span data-ttu-id="2b947-233">3 番目の手順で次の SQL クエリを入力し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-233">In the third step, enter the following SQL query and click Next:</span></span>


[!code-sql[Main](uploading-files-cs/samples/sample3.sql)]

<span data-ttu-id="2b947-234">最後の手順では、新しいメソッドの名前を選択します。</span><span class="sxs-lookup"><span data-stu-id="2b947-234">The last step is to choose the name for the new method.</span></span> <span data-ttu-id="2b947-235">使用して`FillCategoryWithBinaryDataByCategoryID`と`GetCategoryWithBinaryDataByCategoryID`塗りつぶしの DataTable と戻り値、データ テーブルのパターンをそれぞれします。</span><span class="sxs-lookup"><span data-stu-id="2b947-235">Use `FillCategoryWithBinaryDataByCategoryID` and `GetCategoryWithBinaryDataByCategoryID` for the Fill a DataTable and Return a DataTable patterns, respectively.</span></span> <span data-ttu-id="2b947-236">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-236">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="2b947-237">[![TableAdapter のメソッドの名前を選択します。](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-237">[![Choose the Names for the TableAdapter s Methods](uploading-files-cs/_static/image10.gif)](uploading-files-cs/_static/image15.png)</span></span>

<span data-ttu-id="2b947-238">**図 10**: tableadapter のメソッドの名前を選択 ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-238">**Figure 10**: Choose the Names for the TableAdapter s Methods ([Click to view full-size image](uploading-files-cs/_static/image16.png))</span></span>


> [!NOTE]
> <span data-ttu-id="2b947-239">テーブル アダプター クエリの構成ウィザードを完了した後は、新しいコマンド テキストを返すことでデータをメイン クエリのスキーマと異なることを通知するダイアログ ボックスを参照してください可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-239">After completing the Table Adapter Query Configuration Wizard you may see a dialog box informing you that the new command text returns data with schema different from the schema of the main query.</span></span> <span data-ttu-id="2b947-240">つまり、ウィザードは、注意してくださいを TableAdapter のメイン クエリ`GetCategories()`先ほど作成したものとは異なるスキーマを返します。</span><span class="sxs-lookup"><span data-stu-id="2b947-240">In short, the wizard is noting that the TableAdapter s main query `GetCategories()` returns a different schema than the one we just created.</span></span> <span data-ttu-id="2b947-241">これは、ここで必要なため、このメッセージを無視することができます。</span><span class="sxs-lookup"><span data-stu-id="2b947-241">But this is what we want, so you can disregard this message.</span></span>


<span data-ttu-id="2b947-242">また、注意してくださいこと、アドホック SQL ステートメントを使用して、使用して、ウィザードに後で TableAdapter のメインのクエリを変更する場合は変更されること、`GetCategoryWithBinaryDataByCategoryID`メソッドの`SELECT`ステートメント列リストからそれらの列を含める、メインのクエリ (つまり、削除は、`Picture`クエリから列)。</span><span class="sxs-lookup"><span data-stu-id="2b947-242">Also, keep in mind that if you are using ad-hoc SQL statements and use the wizard to change the TableAdapter s main query at some later point in time, it will modify the `GetCategoryWithBinaryDataByCategoryID` method s `SELECT` statement s column list to include just those columns from the main query (that is, it will remove the `Picture` column from the query).</span></span> <span data-ttu-id="2b947-243">返される列のリストを手動で更新する必要が、`Picture`で行ったのような列、`GetCategoriesAndNumberOfProducts()`この手順の前半のメソッドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-243">You will have to manually update the column list to return the `Picture` column, similar to what we did with the `GetCategoriesAndNumberOfProducts()` method earlier in this step.</span></span>

<span data-ttu-id="2b947-244">2 つの追加後に`DataColumn`s、`CategoriesDataTable`と`GetCategoryWithBinaryDataByCategoryID`メソッドを`CategoriesTableAdapter`、型指定されたデータセット デザイナーでこれらのクラス図 11 にスクリーン ショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="2b947-244">After adding the two `DataColumn` s to the `CategoriesDataTable` and the `GetCategoryWithBinaryDataByCategoryID` method to the `CategoriesTableAdapter`, these classes in the Typed DataSet Designer should look like the screenshot in Figure 11.</span></span>


![データセット デザイナーには、新しい列とメソッドが含まれています](uploading-files-cs/_static/image11.gif)

<span data-ttu-id="2b947-246">**図 11**: データセット デザイナーには、新しい列とメソッドが含まれています</span><span class="sxs-lookup"><span data-stu-id="2b947-246">**Figure 11**: The DataSet Designer Includes the New Columns and Method</span></span>


## <a name="updating-the-business-logic-layer-bll"></a><span data-ttu-id="2b947-247">ビジネス ロジック層 (BLL) の更新</span><span class="sxs-lookup"><span data-stu-id="2b947-247">Updating the Business Logic Layer (BLL)</span></span>

<span data-ttu-id="2b947-248">更新、DAL では、新しいメソッドを追加するビジネス ロジック層 (BLL) を拡張するために`CategoriesTableAdapter`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="2b947-248">With the DAL updated, all that remains is to augment the Business Logic Layer (BLL) to include a method for the new `CategoriesTableAdapter` method.</span></span> <span data-ttu-id="2b947-249">次のメソッドを追加、`CategoriesBLL`クラス。</span><span class="sxs-lookup"><span data-stu-id="2b947-249">Add the following method to the `CategoriesBLL` class:</span></span>


[!code-csharp[Main](uploading-files-cs/samples/sample4.cs)]

## <a name="step-5-uploading-a-file-from-the-client-to-the-web-server"></a><span data-ttu-id="2b947-250">手順 5: クライアントから Web サーバーへのファイルをアップロードします。</span><span class="sxs-lookup"><span data-stu-id="2b947-250">Step 5: Uploading a File From the Client to the Web Server</span></span>

<span data-ttu-id="2b947-251">バイナリ データを収集するときに多くの場合このデータは、エンドユーザーが提供されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-251">When collecting binary data, oftentimes this data is supplied by an end user.</span></span> <span data-ttu-id="2b947-252">この情報をキャプチャするには、ユーザーを自分のコンピューターから web サーバーへのファイルをアップロードできる必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-252">To capture this information, the user needs to be able to upload a file from their computer to the web server.</span></span> <span data-ttu-id="2b947-253">アップロードされたデータは、web サーバーのファイル システムと、データベース内のファイルへのパスの追加またはデータベースに直接バイナリの内容の書き込みにファイルの保存を意味する可能性がありますデータ モデルと統合する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-253">The uploaded data then needs to be integrated with the data model, which may mean saving the file to the web server s file system and adding a path to the file in the database, or writing the binary contents directly into the database.</span></span> <span data-ttu-id="2b947-254">このステップでは、ユーザーが各自のコンピューターからサーバーへのファイルをアップロードできるようにする方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="2b947-254">In this step we'll look at how to allow a user to upload files from their computer to the server.</span></span> <span data-ttu-id="2b947-255">次のチュートリアルでアップロードされたファイルをデータ モデルと統合することに注目有効にします。</span><span class="sxs-lookup"><span data-stu-id="2b947-255">In the next tutorial we'll turn our attention to integrating the uploaded file with data model.</span></span>

<span data-ttu-id="2b947-256">ASP.NET 2.0 s 新しい[ファイルアップロード Web コントロール](https://msdn.microsoft.com/library/ms227677(VS.80).aspx)ユーザーは各自のコンピューターから web サーバーにファイルを送信するためのメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="2b947-256">ASP.NET 2.0 s new [FileUpload Web control](https://msdn.microsoft.com/library/ms227677(VS.80).aspx) provides a mechanism for users to send a file from their computer to the web server.</span></span> <span data-ttu-id="2b947-257">ファイルアップロード コントロールとして表示、`<input>`要素が`type`ファイルで、ブラウザーの [参照] ボタンとテキスト ボックスとして表示する属性を設定します。</span><span class="sxs-lookup"><span data-stu-id="2b947-257">The FileUpload control renders as an `<input>` element whose `type` attribute is set to file, which browsers display as a textbox with a Browse button.</span></span> <span data-ttu-id="2b947-258">[参照] ボタンをクリックすると、ユーザーがファイルを選択] ダイアログ ボックスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-258">Clicking the Browse button brings up a dialog box from which the user can select a file.</span></span> <span data-ttu-id="2b947-259">フォームがポストバック時に、選択したファイルの内容がポストバックと共に送信されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-259">When the form is posted back, the selected file s contents are sent along with the postback.</span></span> <span data-ttu-id="2b947-260">サーバー側でアップロードされたファイルに関する情報はファイルアップロード コントロールのプロパティを使用してアクセスします。</span><span class="sxs-lookup"><span data-stu-id="2b947-260">On the server-side, information about the uploaded file is accessible through the FileUpload control s properties.</span></span>

<span data-ttu-id="2b947-261">ファイルのアップロードを示すためには、開く、 `FileUpload.aspx` ] ページで、`BinaryData`フォルダーがファイルアップロード コントロールをツールボックスからデザイナーにドラッグし、制御 s を設定`ID`プロパティを`UploadTest`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-261">To demonstrate uploading files, open the `FileUpload.aspx` page in the `BinaryData` folder, drag a FileUpload control from the Toolbox onto the Designer, and set the control s `ID` property to `UploadTest`.</span></span> <span data-ttu-id="2b947-262">Button Web コントロールの設定を次に、追加の`ID`と`Text`プロパティ`UploadButton`とそれぞれに選択されたファイルをアップロードします。</span><span class="sxs-lookup"><span data-stu-id="2b947-262">Next, add a Button Web control setting its `ID` and `Text` properties to `UploadButton` and Upload Selected File, respectively.</span></span> <span data-ttu-id="2b947-263">最後に、クリア、ボタンの下にラベル Web コントロールを配置、`Text`プロパティとその`ID`プロパティを`UploadDetails`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-263">Finally, place a Label Web control beneath the Button, clear out its `Text` property and set its `ID` property to `UploadDetails`.</span></span>


<span data-ttu-id="2b947-264">[![ASP.NET ページにファイルアップロード コントロールを追加します。](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-264">[![Add a FileUpload Control to the ASP.NET Page](uploading-files-cs/_static/image12.gif)](uploading-files-cs/_static/image17.png)</span></span>

<span data-ttu-id="2b947-265">**図 12**: ファイルアップロード コントロール、ASP.NET ページを追加 ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-265">**Figure 12**: Add a FileUpload Control to the ASP.NET Page ([Click to view full-size image](uploading-files-cs/_static/image18.png))</span></span>


<span data-ttu-id="2b947-266">図 13 では、ブラウザーで表示したときに、このページを示します。</span><span class="sxs-lookup"><span data-stu-id="2b947-266">Figure 13 shows this page when viewed through a browser.</span></span> <span data-ttu-id="2b947-267">ファイルの選択] ダイアログ ボックスを表示、参照ボタンをクリックすると、ユーザーが各自のコンピューターからファイルを選択できるようにするに注意してください。</span><span class="sxs-lookup"><span data-stu-id="2b947-267">Note that clicking the Browse button brings up a file selection dialog box, allowing the user to pick a file from their computer.</span></span> <span data-ttu-id="2b947-268">ファイルを選択するは、web サーバーに、選択したファイル %s のバイナリ コンテンツを送信するポストバックを発生させる、選択したファイルのアップロード] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-268">Once a file has been selected, clicking the Upload Selected File button causes a postback that sends the selected file s binary content to the web server.</span></span>


<span data-ttu-id="2b947-269">[![ユーザーが自分のコンピューターからサーバーにアップロードするファイルを選択できます。](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-269">[![The User Can Select a File to Upload from their Computer to the Server](uploading-files-cs/_static/image13.gif)](uploading-files-cs/_static/image19.png)</span></span>

<span data-ttu-id="2b947-270">**図 13**: ユーザーは自分のコンピューターをサーバーからアップロードするファイルを選択することができます ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-270">**Figure 13**: The User Can Select a File to Upload from their Computer to the Server ([Click to view full-size image](uploading-files-cs/_static/image20.png))</span></span>


<span data-ttu-id="2b947-271">ポストバックでアップロードされたファイルは、ファイル システムに保存できます。 またはストリームを使用して直接、バイナリ データで使用できます。</span><span class="sxs-lookup"><span data-stu-id="2b947-271">On postback, the uploaded file can be saved to the file system or its binary data can be worked with directly through a Stream.</span></span> <span data-ttu-id="2b947-272">この例では、%s を作成できるように、`~/Brochures`フォルダーし、アップロードされたファイルを保存します。</span><span class="sxs-lookup"><span data-stu-id="2b947-272">For this example, let s create a `~/Brochures` folder and save the uploaded file there.</span></span> <span data-ttu-id="2b947-273">追加することで開始、`Brochures`フォルダーのルート ディレクトリのサブフォルダーとしてサイトをします。</span><span class="sxs-lookup"><span data-stu-id="2b947-273">Start by adding the `Brochures` folder to the site as a subfolder of the root directory.</span></span> <span data-ttu-id="2b947-274">イベント ハンドラーを次に、作成、 `UploadButton` s`Click`イベントし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="2b947-274">Next, create an event handler for the `UploadButton` s `Click` event and add the following code:</span></span>


[!code-csharp[Main](uploading-files-cs/samples/sample5.cs)]

<span data-ttu-id="2b947-275">ファイルアップロード コントロールでは、さまざまなアップロードされたデータを操作するためのプロパティを提供します。</span><span class="sxs-lookup"><span data-stu-id="2b947-275">The FileUpload control provides a variety of properties for working with the uploaded data.</span></span> <span data-ttu-id="2b947-276">インスタンス、 [ `HasFile`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx)ファイルが、ユーザーによってアップロードされたかどうかを示すときに、 [ `FileBytes`プロパティ](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx)バイトの配列としてアップロードされたバイナリ データへのアクセスを提供します。</span><span class="sxs-lookup"><span data-stu-id="2b947-276">For instance, the [`HasFile` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.hasfile.aspx) indicates whether a file was uploaded by the user, while the [`FileBytes` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.fileupload.filebytes.aspx) provides access to the uploaded binary data as an array of bytes.</span></span> <span data-ttu-id="2b947-277">`Click`ファイルがアップロードされていることを確認してイベント ハンドラーを起動します。</span><span class="sxs-lookup"><span data-stu-id="2b947-277">The `Click` event handler starts by ensuring that a file has been uploaded.</span></span> <span data-ttu-id="2b947-278">ファイルがアップロードされた場合、ラベルがアップロードされたファイルのサイズ (バイト単位)、そのコンテンツの種類の名前を表示します。</span><span class="sxs-lookup"><span data-stu-id="2b947-278">If a file has been uploaded, the Label shows the name of the uploaded file, its size in bytes, and its content-type.</span></span>

> [!NOTE]
> <span data-ttu-id="2b947-279">ユーザーが確認できますファイルをアップロードすることを確認する、`HasFile`プロパティ場合に警告を表示、s `false`、または使用することは、 [RequiredFieldValidator コントロール](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx)代わりにします。</span><span class="sxs-lookup"><span data-stu-id="2b947-279">To ensure that the user uploads a file you can check the `HasFile` property and display a warning if it s `false`, or you may use the [RequiredFieldValidator control](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/validation/default.aspx) instead.</span></span>


<span data-ttu-id="2b947-280">ファイルアップロード s`SaveAs(filePath)`を指定されたアップロードされたファイルを保存*filePath*です。</span><span class="sxs-lookup"><span data-stu-id="2b947-280">The FileUpload s `SaveAs(filePath)` saves the uploaded file to the specified *filePath*.</span></span> <span data-ttu-id="2b947-281">*filePath*する必要があります、*物理パス*(`C:\Websites\Brochures\SomeFile.pdf`) ではなく、*仮想**パス*(`/Brochures/SomeFile.pdf`)。</span><span class="sxs-lookup"><span data-stu-id="2b947-281">*filePath* must be a *physical path* (`C:\Websites\Brochures\SomeFile.pdf`) rather than a *virtual* *path* (`/Brochures/SomeFile.pdf`).</span></span> <span data-ttu-id="2b947-282">[ `Server.MapPath(virtPath)`メソッド](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx)仮想パスを受け取り、対応する物理パスを返します。</span><span class="sxs-lookup"><span data-stu-id="2b947-282">The [`Server.MapPath(virtPath)` method](https://msdn.microsoft.com/library/system.web.httpserverutility.mappath.aspx) takes a virtual path and returns its corresponding physical path.</span></span> <span data-ttu-id="2b947-283">仮想パスは、ここでは、`~/Brochures/fileName`ここで、 *fileName*アップロードされたファイルの名前を指定します。</span><span class="sxs-lookup"><span data-stu-id="2b947-283">Here, the virtual path is `~/Brochures/fileName`, where *fileName* is the name of the uploaded file.</span></span> <span data-ttu-id="2b947-284">参照してください[を使用して Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml)仮想および物理パスと使用に関する詳細について`Server.MapPath`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-284">See [Using Server.MapPath](http://www.4guysfromrolla.com/webtech/121799-1.shtml) for more information on virtual and physical paths and using `Server.MapPath`.</span></span>

<span data-ttu-id="2b947-285">完了した後、`Click`イベント ハンドラーでは、ブラウザーでページをテストします。</span><span class="sxs-lookup"><span data-stu-id="2b947-285">After completing the `Click` event handler, take a moment to test out the page in a browser.</span></span> <span data-ttu-id="2b947-286">[参照] ボタンをクリックして、ハード ドライブからファイルを選択し、選択したファイルのアップロード] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-286">Click the Browse button and select a file from your hard drive and then click the Upload Selected File button.</span></span> <span data-ttu-id="2b947-287">ポストバックは、web サーバーに保存する前に、ファイルの情報が表示されますを選択したファイルの内容を送信、`~/Brochures`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="2b947-287">The postback will send the contents of the selected file to the web server, which will then display information about the file before saving it to the `~/Brochures` folder.</span></span> <span data-ttu-id="2b947-288">アップロードした後、ファイル、Visual Studio に戻り、およびソリューション エクスプ ローラーで [更新] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="2b947-288">After uploading the file, return to Visual Studio and click the Refresh button in the Solution Explorer.</span></span> <span data-ttu-id="2b947-289">~/Brochures フォルダーにアップロードしたファイルを参照してください!</span><span class="sxs-lookup"><span data-stu-id="2b947-289">You should see the file you just uploaded in the ~/Brochures folder!</span></span>


<span data-ttu-id="2b947-290">[![Web サーバーにアップロードされたファイル EvolutionValley.jpg](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="2b947-290">[![The File EvolutionValley.jpg Has Been Uploaded to the Web Server](uploading-files-cs/_static/image14.gif)](uploading-files-cs/_static/image21.png)</span></span>

<span data-ttu-id="2b947-291">**図 14**: ファイル`EvolutionValley.jpg`Web サーバーにアップロードされている ([フルサイズのイメージを表示するをクリックして](uploading-files-cs/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="2b947-291">**Figure 14**: The File `EvolutionValley.jpg` Has Been Uploaded to the Web Server ([Click to view full-size image](uploading-files-cs/_static/image22.png))</span></span>


![EvolutionValley.jpg が ~/Brochures フォルダーに保存されました](uploading-files-cs/_static/image15.gif)

<span data-ttu-id="2b947-293">**図 15**:`EvolutionValley.jpg`に保存された、`~/Brochures`フォルダー</span><span class="sxs-lookup"><span data-stu-id="2b947-293">**Figure 15**: `EvolutionValley.jpg` Was Saved to the `~/Brochures` Folder</span></span>


## <a name="subtleties-with-saving-uploaded-files-to-the-file-system"></a><span data-ttu-id="2b947-294">ファイル システムにアップロードされたファイルを保存する際に微妙な</span><span class="sxs-lookup"><span data-stu-id="2b947-294">Subtleties with Saving Uploaded Files to the File System</span></span>

<span data-ttu-id="2b947-295">いくつかの微妙な web サーバーのファイル システムにファイルをアップロードして保存するときに対処が必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-295">There are several subtleties that must be addressed when saving uploading files to the web server s file system.</span></span> <span data-ttu-id="2b947-296">最初に、セキュリティのないの問題です。</span><span class="sxs-lookup"><span data-stu-id="2b947-296">First, there s the issue of security.</span></span> <span data-ttu-id="2b947-297">ファイル システムにファイルを保存するには、書き込みのアクセス許可が ASP.NET ページを実行しているセキュリティ コンテキストに必要です。</span><span class="sxs-lookup"><span data-stu-id="2b947-297">To save a file to the file system, the security context under which the ASP.NET page is executing must have Write permissions.</span></span> <span data-ttu-id="2b947-298">ASP.NET 開発 Web サーバーは、現在のユーザー アカウントのコンテキストで実行されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-298">The ASP.NET Development Web Server runs under the context of your current user account.</span></span> <span data-ttu-id="2b947-299">マイクロソフトのインターネット インフォメーション サービス (IIS) は、web サーバーとして使用されている場合に、セキュリティ コンテキストは、IIS とその構成のバージョンによって異なります。</span><span class="sxs-lookup"><span data-stu-id="2b947-299">If you are using Microsoft s Internet Information Services (IIS) as the web server, the security context depends on the version of IIS and its configuration.</span></span>

<span data-ttu-id="2b947-300">ファイル システムに保存する場合の課題の 1 つのファイルの名前付け中心にします。</span><span class="sxs-lookup"><span data-stu-id="2b947-300">Another challenge of saving files to the file system revolves around naming the files.</span></span> <span data-ttu-id="2b947-301">現時点では、すべてのアップロードされたファイルを保存、ページ、`~/Brochures`ディレクトリ クライアント コンピューター上のファイルと同じ名前を使用します。</span><span class="sxs-lookup"><span data-stu-id="2b947-301">Currently, our page saves all of the uploaded files to the `~/Brochures` directory using the same name as the file on the client s computer.</span></span> <span data-ttu-id="2b947-302">ユーザー A はアップロード名前を持つパンフレット場合`Brochure.pdf`、ファイルとして保存されます`~/Brochure/Brochure.pdf`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-302">If User A uploads a brochure with the name `Brochure.pdf`, the file will be saved as `~/Brochure/Brochure.pdf`.</span></span> <span data-ttu-id="2b947-303">しばらく後ユーザー B が同じファイル名が含まれている異なるパンフレット ファイルをアップロードする場合は (`Brochure.pdf`)?</span><span class="sxs-lookup"><span data-stu-id="2b947-303">But what if sometime later User B uploads a different brochure file that happens to have the same filename (`Brochure.pdf`)?</span></span> <span data-ttu-id="2b947-304">コードでおユーザーがあるようになりましたが、ユーザー B のアップロードで s ファイルが上書きされます。</span><span class="sxs-lookup"><span data-stu-id="2b947-304">With the code we have now, User A s file will be overwritten with User B s upload.</span></span>

<span data-ttu-id="2b947-305">ファイル名の競合を解決する方法の数があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-305">There are a number of techniques for resolving file name conflicts.</span></span> <span data-ttu-id="2b947-306">1 つは、同じ名前のいずれかが既に存在する場合、ファイルのアップロードを禁止します。</span><span class="sxs-lookup"><span data-stu-id="2b947-306">One option is to prohibit uploading a file if there already exists one with the same name.</span></span> <span data-ttu-id="2b947-307">ユーザー B がという名前のファイルをアップロードしようとしたときに、この方法で`Brochure.pdf`システムはそのファイルを保存されず、代わりに、ファイルの名前を変更し、もう一度やり直してくださいユーザー B を知らせるメッセージを表示します。</span><span class="sxs-lookup"><span data-stu-id="2b947-307">With this approach, when User B attempts to upload a file named `Brochure.pdf`, the system would not save their file and instead display a message informing User B to rename the file and try again.</span></span> <span data-ttu-id="2b947-308">別のアプローチが生じる可能性がある一意のファイル名を使用してファイルを保存するには、[グローバル一意識別子 (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier)またはレコードの主キー列をデータベースから、対応する値 (アップロードに関連付けられていると仮定すると、特定の行のデータ モデル)。</span><span class="sxs-lookup"><span data-stu-id="2b947-308">Another approach is to save the file using a unique file name, which could be a [globally unique identifier (GUID)](http://en.wikipedia.org/wiki/Globally_Unique_Identifier) or the value from the corresponding database record s primary key column(s) (assuming that the upload is associated with a particular row in the data model).</span></span> <span data-ttu-id="2b947-309">次のチュートリアルではこれらのオプションの詳細についてをについて説明します。</span><span class="sxs-lookup"><span data-stu-id="2b947-309">In the next tutorial we'll explore these options in more detail.</span></span>

## <a name="challenges-involved-with-very-large-amounts-of-binary-data"></a><span data-ttu-id="2b947-310">非常に大量のバイナリ データに関連する課題</span><span class="sxs-lookup"><span data-stu-id="2b947-310">Challenges Involved with Very Large Amounts of Binary Data</span></span>

<span data-ttu-id="2b947-311">これらのチュートリアルでは、キャプチャされたバイナリ データがサイズで適切なであると仮定します。</span><span class="sxs-lookup"><span data-stu-id="2b947-311">These tutorials assume that the binary data captured is modest in size.</span></span> <span data-ttu-id="2b947-312">いくつかのメガバイト数であるバイナリ データ ファイルの量が非常に大きい場合に動作しているか大きいはこれらのチュートリアルの範囲を超える新しい問題が発生します。</span><span class="sxs-lookup"><span data-stu-id="2b947-312">Working with very large amounts of binary data files that are several megabytes or larger introduces new challenges that are beyond the scope of these tutorials.</span></span> <span data-ttu-id="2b947-313">たとえば、既定では ASP.NET は拒否 4 MB を超えるのアップロードでこれを構成することができます、 [ `<httpRuntime>`要素](https://msdn.microsoft.com/library/e1f13641.aspx)で`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="2b947-313">For example, by default ASP.NET will reject uploads of more than 4 MB, although this can be configured through the [`<httpRuntime>` element](https://msdn.microsoft.com/library/e1f13641.aspx) in `Web.config`.</span></span> <span data-ttu-id="2b947-314">IIS では、独自のファイル アップロード サイズの制限はすぎますが適用されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-314">IIS imposes its own file upload size limitations, too.</span></span> <span data-ttu-id="2b947-315">参照してください[ファイル アップロード サイズを IIS](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html)詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="2b947-315">See [IIS Upload File Size](http://vandamme.typepad.com/development/2005/09/iis_upload_file.html) for more information.</span></span> <span data-ttu-id="2b947-316">さらに、サイズの大きなファイルのアップロードにかかる時間超える可能性がある既定の ASP.NET が要求の待機 110 秒です。</span><span class="sxs-lookup"><span data-stu-id="2b947-316">Furthermore, the time taken to upload large files might exceed the default 110 seconds ASP.NET will wait for a request.</span></span> <span data-ttu-id="2b947-317">大きなファイルを操作するときに発生するメモリとパフォーマンスの問題もあります。</span><span class="sxs-lookup"><span data-stu-id="2b947-317">There are also memory and performance issues that arise when working with large files.</span></span>

<span data-ttu-id="2b947-318">ファイルアップロード コントロールは大きなファイルのアップロードの実用的ではありません。</span><span class="sxs-lookup"><span data-stu-id="2b947-318">The FileUpload control is impractical for large file uploads.</span></span> <span data-ttu-id="2b947-319">ように、ファイル コンテンツがサーバーにポストされて、エンドユーザーは、アップロードの進行状況を確認する必要があります待機します。</span><span class="sxs-lookup"><span data-stu-id="2b947-319">As the file s contents are being posted to the server, the end user must patiently wait without any confirmation that their upload is progressing.</span></span> <span data-ttu-id="2b947-320">これより小さい、数秒でアップロードすることができますが、ファイルをアップロードする分かかる場合がありますよりも大きなファイルを処理する場合、問題になることができますを処理する場合ほど問題ではありません。</span><span class="sxs-lookup"><span data-stu-id="2b947-320">This is not so much an issue when dealing with smaller files that can be uploaded in a few seconds, but can be an issue when dealing with larger files that may take minutes to upload.</span></span> <span data-ttu-id="2b947-321">さまざまなサード パーティ製のファイル アップロード コントロールを大規模なアップロードを処理するが適してし、これらのベンダーの多くは、進捗状況と ActiveX アップロードより光沢のあるユーザー エクスペリエンスを提供するマネージャーを提供します。</span><span class="sxs-lookup"><span data-stu-id="2b947-321">There are a variety of third-party file upload controls that are better suited for handling large uploads and many of these vendors provide progress indicators and ActiveX upload managers that present a much more polished user experience.</span></span>

<span data-ttu-id="2b947-322">アプリケーションは、大きなファイルを処理する必要がある場合、は、慎重に問題を調査し、特定のニーズに適した解決策を検索する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2b947-322">If your application needs to handle large files, you'll need to carefully investigate the challenges and find suitable solutions for your particular needs.</span></span>

## <a name="summary"></a><span data-ttu-id="2b947-323">まとめ</span><span class="sxs-lookup"><span data-stu-id="2b947-323">Summary</span></span>

<span data-ttu-id="2b947-324">バイナリ データをキャプチャする必要があるアプリケーションを構築すると、さまざまな課題が導入されています。</span><span class="sxs-lookup"><span data-stu-id="2b947-324">Building an application that needs to capture binary data introduces a number of challenges.</span></span> <span data-ttu-id="2b947-325">このチュートリアルでは最初の 2 つに調査お: バイナリ データを格納する場所を決定する、ユーザーが web ページによってバイナリ コンテンツをアップロードするを許可します。</span><span class="sxs-lookup"><span data-stu-id="2b947-325">In this tutorial we explored the first two: deciding where to store the binary data and allowing a user to upload binary content through a web page.</span></span> <span data-ttu-id="2b947-326">次の 3 つのチュートリアルでは、経由では、データベース内のレコードにアップロードされたデータを関連付ける方法と、データのフィールドをテキストと共にバイナリ データを表示する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="2b947-326">Over the next three tutorials, we'll see how to associate the uploaded data with a record in the database as well as how to display the binary data alongside its text data fields.</span></span>

<span data-ttu-id="2b947-327">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="2b947-327">Happy Programming!</span></span>

## <a name="further-reading"></a><span data-ttu-id="2b947-328">関連項目</span><span class="sxs-lookup"><span data-stu-id="2b947-328">Further Reading</span></span>

<span data-ttu-id="2b947-329">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2b947-329">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2b947-330">大きな値データ型の使用</span><span class="sxs-lookup"><span data-stu-id="2b947-330">Using Large-Value Data Types</span></span>](https://msdn.microsoft.com/library/ms178158.aspx)
- [<span data-ttu-id="2b947-331">ファイルアップロード コントロールのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="2b947-331">FileUpload Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/standard/fileupload.aspx)
- [<span data-ttu-id="2b947-332">ASP.NET 2.0 ファイルアップロード サーバー コントロール</span><span class="sxs-lookup"><span data-stu-id="2b947-332">The ASP.NET 2.0 FileUpload Server Control</span></span>](http://www.wrox.com/WileyCDA/Section/id-292158.html)
- [<span data-ttu-id="2b947-333">ファイルをアップロードします。</span><span class="sxs-lookup"><span data-stu-id="2b947-333">The Dark Side of File Uploads</span></span>](http://www.aspnetresources.com/articles/dark_side_of_file_uploads.aspx)

## <a name="about-the-author"></a><span data-ttu-id="2b947-334">作成者について</span><span class="sxs-lookup"><span data-stu-id="2b947-334">About the Author</span></span>

<span data-ttu-id="2b947-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml)、7 つ受け取りますブックとの創設者の作成者[4GuysFromRolla.com](http://www.4guysfromrolla.com)、1998 年からマイクロソフトの Web テクノロジで取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="2b947-335">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2b947-336">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="2b947-336">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2b947-337">最新の著書[ *Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)です。</span><span class="sxs-lookup"><span data-stu-id="2b947-337">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="2b947-338">彼に到達できる[ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)彼のブログを使用して含まれているのか[ http://ScottOnWriting.NET](http://ScottOnWriting.NET)です。</span><span class="sxs-lookup"><span data-stu-id="2b947-338">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="2b947-339">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="2b947-339">Special Thanks To</span></span>

<span data-ttu-id="2b947-340">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="2b947-340">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2b947-341">このチュートリアルの潜在顧客レビュー担当者は、Teresa マーフィーおよび「社長補佐 Leigh がいました。</span><span class="sxs-lookup"><span data-stu-id="2b947-341">Lead reviewers for this tutorial were Teresa Murphy and Bernadette Leigh.</span></span> <span data-ttu-id="2b947-342">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="2b947-342">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2b947-343">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.comです。](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="2b947-343">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="2b947-344">次へ</span><span class="sxs-lookup"><span data-stu-id="2b947-344">Next</span></span>](displaying-binary-data-in-the-data-web-controls-cs.md)
