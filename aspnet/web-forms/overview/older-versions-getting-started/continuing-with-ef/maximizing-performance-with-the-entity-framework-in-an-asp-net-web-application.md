---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
title: ASP.NET 4 Web アプリケーションに Entity Framework 4.0 とパフォーマンスを最大化 |Microsoft ドキュメント
author: tdykstra
description: この一連のチュートリアルについては、Entity Framework 4.0 チュートリアル シリーズの概要を作成した Contoso 大学 web アプリケーションに基づいています。 I...
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 4e43455e-dfa1-42db-83cb-c987703f04b5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application
msc.type: authoredcontent
ms.openlocfilehash: b85645eebf2822b33df944692736ea9d9b69b9aa
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30891413"
---
<a name="maximizing-performance-with-the-entity-framework-40-in-an-aspnet-4-web-application"></a><span data-ttu-id="db02d-104">ASP.NET 4 Web アプリケーションに Entity Framework 4.0 とパフォーマンスを最大化</span><span class="sxs-lookup"><span data-stu-id="db02d-104">Maximizing Performance with the Entity Framework 4.0 in an ASP.NET 4 Web Application</span></span>
====================
<span data-ttu-id="db02d-105">によって[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="db02d-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="db02d-106">このチュートリアル シリーズのビルドによって作成される Contoso 大学 web アプリケーションで、 [Entity Framework 4.0 の概要](https://asp.net/entity-framework/tutorials#Getting%20Started)一連のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="db02d-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](https://asp.net/entity-framework/tutorials#Getting%20Started) tutorial series.</span></span> <span data-ttu-id="db02d-107">前のチュートリアルを完了していない場合このチュートリアルの開始点とすることができます[アプリケーションをダウンロードして](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)作成したとします。</span><span class="sxs-lookup"><span data-stu-id="db02d-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="db02d-108">こともできます[アプリケーションをダウンロードして](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)一連の完全なチュートリアルで作成します。</span><span class="sxs-lookup"><span data-stu-id="db02d-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span> <span data-ttu-id="db02d-109">チュートリアルについて質問がある場合を投稿、 [ASP.NET Entity Framework フォーラム](https://forums.asp.net/1227.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-109">If you have questions about the tutorials, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx).</span></span>


<span data-ttu-id="db02d-110">前のチュートリアルでは、同時実行の競合を処理する方法を説明します。</span><span class="sxs-lookup"><span data-stu-id="db02d-110">In the previous tutorial, you saw how to handle concurrency conflicts.</span></span> <span data-ttu-id="db02d-111">このチュートリアルでは、Entity Framework を使用する ASP.NET web アプリケーションのパフォーマンスを向上させるためのオプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="db02d-111">This tutorial shows options for improving the performance of an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="db02d-112">パフォーマンスを最大化するため、またはパフォーマンスの問題を診断するためのいくつかの方法を学習します。</span><span class="sxs-lookup"><span data-stu-id="db02d-112">You'll learn several methods for maximizing performance or for diagnosing performance problems.</span></span>

<span data-ttu-id="db02d-113">次のセクションに表示される情報をさまざまなシナリオで役に立つ可能性があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-113">Information presented in the following sections is likely to be useful in a broad variety of scenarios:</span></span>

- <span data-ttu-id="db02d-114">関連するデータを効率的に読み込みます。</span><span class="sxs-lookup"><span data-stu-id="db02d-114">Efficiently load related data.</span></span>
- <span data-ttu-id="db02d-115">ビュー ステートを管理します。</span><span class="sxs-lookup"><span data-stu-id="db02d-115">Manage view state.</span></span>

<span data-ttu-id="db02d-116">次のセクションに表示される情報は、個々 のクエリを現在のパフォーマンス問題がある場合に役立ちます。 可能性があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-116">Information presented in the following sections might be useful if you have individual queries that present performance problems:</span></span>

- <span data-ttu-id="db02d-117">使用して、`NoTracking`マージ オプションです。</span><span class="sxs-lookup"><span data-stu-id="db02d-117">Use the `NoTracking` merge option.</span></span>
- <span data-ttu-id="db02d-118">LINQ クエリを事前にコンパイルします。</span><span class="sxs-lookup"><span data-stu-id="db02d-118">Pre-compile LINQ queries.</span></span>
- <span data-ttu-id="db02d-119">データベースに送信されるクエリ コマンドを確認します。</span><span class="sxs-lookup"><span data-stu-id="db02d-119">Examine query commands sent to the database.</span></span>

<span data-ttu-id="db02d-120">次のセクションに表示される情報は非常に大きなデータ モデルを持つアプリケーションに役立つ可能性のあります。</span><span class="sxs-lookup"><span data-stu-id="db02d-120">Information presented in the following section is potentially useful for applications that have extremely large data models:</span></span>

- <span data-ttu-id="db02d-121">ビューを事前に生成します。</span><span class="sxs-lookup"><span data-stu-id="db02d-121">Pre-generate views.</span></span>

> [!NOTE]
> <span data-ttu-id="db02d-122">Web アプリケーションのパフォーマンスは、要求と応答のデータのサイズ、データベース クエリ、キューできるように、サーバー要求の数、および任意の効率もをサービスにどの程度の速度の速度などを含む、さまざまな要因の影響を受けたクライアント スクリプト ライブラリが使用する場合があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-122">Web application performance is affected by many factors, including things like the size of request and response data, the speed of database queries, how many requests the server can queue and how quickly it can service them, and even the efficiency of any client-script libraries you might be using.</span></span> <span data-ttu-id="db02d-123">パフォーマンスは、アプリケーションで重要なテストまたは経験は、アプリケーションのパフォーマンスが十分ではないことを示す場合や、パフォーマンス チューニングの通常のプロトコルに従ってください。</span><span class="sxs-lookup"><span data-stu-id="db02d-123">If performance is critical in your application, or if testing or experience shows that application performance isn't satisfactory, you should follow normal protocol for performance tuning.</span></span> <span data-ttu-id="db02d-124">パフォーマンスのボトルネックの発生場所を確認するを測定し、アプリケーション全体のパフォーマンスに大きな影響を与える領域をアドレスします。</span><span class="sxs-lookup"><span data-stu-id="db02d-124">Measure to determine where performance bottlenecks are occurring, and then address the areas that will have the greatest impact on overall application performance.</span></span>
> 
> <span data-ttu-id="db02d-125">このトピックを具体的には ASP.NET では、Entity Framework のパフォーマンスを向上することができます可能性のある方法で主に焦点を当てています。</span><span class="sxs-lookup"><span data-stu-id="db02d-125">This topic focuses mainly on ways in which you can potentially improve the performance specifically of the Entity Framework in ASP.NET.</span></span> <span data-ttu-id="db02d-126">修正候補をここでは、データ アクセスでは、アプリケーションでパフォーマンスのボトルネックのいずれかの判断した場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="db02d-126">The suggestions here are useful if you determine that data access is one of the performance bottlenecks in your application.</span></span> <span data-ttu-id="db02d-127">ここで説明したメソッドと見なすべき述べたように、点を除いて&quot;ベスト プラクティス&quot;一般-これらの多くは例外的な状況でのみ、またはアドレス非常に特定の種類のパフォーマンスのボトルネックを適切な。</span><span class="sxs-lookup"><span data-stu-id="db02d-127">Except as noted, the methods explained here shouldn't be considered &quot;best practices&quot; in general — many of them are appropriate only in exceptional situations or to address very specific kinds of performance bottlenecks.</span></span>


<span data-ttu-id="db02d-128">チュートリアルを開始するには、Visual Studio を起動し、前のチュートリアルで作業していた Contoso 大学 web アプリケーションを開きます。</span><span class="sxs-lookup"><span data-stu-id="db02d-128">To start the tutorial, start Visual Studio and open the Contoso University web application that you were working with in the previous tutorial.</span></span>

## <a name="efficiently-loading-related-data"></a><span data-ttu-id="db02d-129">効率的に関連するデータの読み込み</span><span class="sxs-lookup"><span data-stu-id="db02d-129">Efficiently Loading Related Data</span></span>

<span data-ttu-id="db02d-130">いくつかの方法が、Entity Framework が、エンティティのナビゲーション プロパティに関連するデータを読み込むことができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-130">There are several ways that the Entity Framework can load related data into the navigation properties of an entity:</span></span>

- <span data-ttu-id="db02d-131">*遅延読み込み*。</span><span class="sxs-lookup"><span data-stu-id="db02d-131">*Lazy loading*.</span></span> <span data-ttu-id="db02d-132">エンティティが最初に読み込まれるときに、関連データは取得されません。</span><span class="sxs-lookup"><span data-stu-id="db02d-132">When the entity is first read, related data isn't retrieved.</span></span> <span data-ttu-id="db02d-133">ただし、ナビゲーション プロパティに初めてアクセスしようとすると、そのナビゲーション プロパティに必要なデータが自動的に取得されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-133">However, the first time you attempt to access a navigation property, the data required for that navigation property is automatically retrieved.</span></span> <span data-ttu-id="db02d-134">これは、結果、データベースに送信される複数のクエリで — と 1 つ、エンティティ自体に関連したエンティティのデータを毎回を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-134">This results in multiple queries sent to the database — one for the entity itself and one each time that related data for the entity must be retrieved.</span></span> 

    <span data-ttu-id="db02d-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-135">[![Image05](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image2.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image1.png)</span></span>

<span data-ttu-id="db02d-136">*一括読み込み*。</span><span class="sxs-lookup"><span data-stu-id="db02d-136">*Eager loading*.</span></span> <span data-ttu-id="db02d-137">エンティティが読み取られるときに、関連データがエンティティと共に取得されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-137">When the entity is read, related data is retrieved along with it.</span></span> <span data-ttu-id="db02d-138">これは通常、必要なデータをすべて取得する 1 つの結合クエリになります。</span><span class="sxs-lookup"><span data-stu-id="db02d-138">This typically results in a single join query that retrieves all of the data that's needed.</span></span> <span data-ttu-id="db02d-139">一括読み込みを使用して指定する、`Include`メソッドも、既に確認したこれらのチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="db02d-139">You specify eager loading by using the `Include` method, as you've seen already in these tutorials.</span></span>

<span data-ttu-id="db02d-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-140">[![Image07](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image4.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image3.png)</span></span>

- <span data-ttu-id="db02d-141">*明示的読み込み*。</span><span class="sxs-lookup"><span data-stu-id="db02d-141">*Explicit loading*.</span></span> <span data-ttu-id="db02d-142">これは、似ていますが、遅延読み込みを明示的にデータを取得する、関連するコードです。ナビゲーション プロパティにアクセスするときに自動的に発生しません。</span><span class="sxs-lookup"><span data-stu-id="db02d-142">This is similar to lazy loading, except that you explicitly retrieve the related data in code; it doesn't happen automatically when you access a navigation property.</span></span> <span data-ttu-id="db02d-143">使用して手動で関連するデータを読み込む、`Load`のコレクション、またはするナビゲーション プロパティのメソッドを使用して、 `Load` reference プロパティの 1 つのオブジェクトを保持するプロパティのメソッドです。</span><span class="sxs-lookup"><span data-stu-id="db02d-143">You load related data manually using the `Load` method of the navigation property for collections, or you use the `Load` method of the reference property for properties that hold a single object.</span></span> <span data-ttu-id="db02d-144">(たとえばを呼び出す、`PersonReference.Load`を読み込む方法、`Person`のナビゲーション プロパティ、`Department`エンティティです)。</span><span class="sxs-lookup"><span data-stu-id="db02d-144">(For example, you call the `PersonReference.Load` method to load the `Person` navigation property of a `Department` entity.)</span></span>

    <span data-ttu-id="db02d-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-145">[![Image06](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image6.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image5.png)</span></span>

<span data-ttu-id="db02d-146">すぐに、プロパティの値を取得する、ので遅延読み込みと明示的な読み込みは両方とも呼ばれます*遅延読み込み*です。</span><span class="sxs-lookup"><span data-stu-id="db02d-146">Because they don't immediately retrieve the property values, lazy loading and explicit loading are also both known as *deferred loading*.</span></span>

<span data-ttu-id="db02d-147">遅延読み込みは、デザイナーによって生成されたオブジェクト コンテキストの既定の動作です。</span><span class="sxs-lookup"><span data-stu-id="db02d-147">Lazy loading is the default behavior for an object context that has been generated by the designer.</span></span> <span data-ttu-id="db02d-148">開く場合、 *SchoolModel.Designer.cs*ファイルは、オブジェクト コンテキスト クラスを定義する、できたら、次の 3 つのコンス トラクター メソッドおよびそれらの各に次のステートメントが含まれています。</span><span class="sxs-lookup"><span data-stu-id="db02d-148">If you open the *SchoolModel.Designer.cs* file that defines the object context class, you'll find three constructor methods, and each of them includes the following statement:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample1.cs)]

<span data-ttu-id="db02d-149">一般に、わかっている場合必要関連データのすべてのエンティティを取得した、一括読み込みでは、最高のパフォーマンスをデータベースに送信する 1 つのクエリが通常エンティティごとに取得される個別のクエリよりも効率的であるためです。</span><span class="sxs-lookup"><span data-stu-id="db02d-149">In general, if you know you need related data for every entity retrieved, eager loading offers the best performance, because a single query sent to the database is typically more efficient than separate queries for each entity retrieved.</span></span> <span data-ttu-id="db02d-150">一方で、頻度、エンティティのナビゲーション プロパティにアクセスする必要がある場合、または小さなに対してのみ一連のエンティティ、遅延読み込みまたは明示的な読み込み可能性がありますより効率的な一括読み込みする必要がありますよりも多くのデータを取得します。</span><span class="sxs-lookup"><span data-stu-id="db02d-150">On the other hand, if you need to access an entity's navigation properties only infrequently or only for a small set of the entities, lazy loading or explicit loading may be more efficient, because eager loading would retrieve more data than you need.</span></span>

<span data-ttu-id="db02d-151">Web アプリケーションで遅延読み込み可能性があります比較的小さな値のまま、ページのレンダリングをオブジェクト コンテキストに接続がないと、ブラウザーで関連するデータの必要性に影響を与えるユーザーのアクションが実行します。</span><span class="sxs-lookup"><span data-stu-id="db02d-151">In a web application, lazy loading may be of relatively little value anyway, because user actions that affect the need for related data take place in the browser, which has no connection to the object context that rendered the page.</span></span> <span data-ttu-id="db02d-152">その一方で、わかっている場合に、データ バインド コントロールを通常データ一般的には、最高の一括読み込みまたはに基づいて遅延読み込みを選択して、必要とする各シナリオで適切なは新機能です。</span><span class="sxs-lookup"><span data-stu-id="db02d-152">On the other hand, when you databind a control, you typically know what data you need, and so it's generally best to choose eager loading or deferred loading based on what's appropriate in each scenario.</span></span>

<span data-ttu-id="db02d-153">さらに、データ バインドされたコントロールは、オブジェクト コンテキストが破棄された後に、エンティティ オブジェクトを使用できます。</span><span class="sxs-lookup"><span data-stu-id="db02d-153">In addition, a databound control might use an entity object after the object context is disposed.</span></span> <span data-ttu-id="db02d-154">その場合は、遅延読み込みナビゲーション プロパティには失敗します。</span><span class="sxs-lookup"><span data-stu-id="db02d-154">In that case, an attempt to lazy-load a navigation property would fail.</span></span> <span data-ttu-id="db02d-155">表示されるエラー メッセージは明らかです。 &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span><span class="sxs-lookup"><span data-stu-id="db02d-155">The error message you receive is clear: &quot;`The ObjectContext instance has been disposed and can no longer be used for operations that require a connection.`&quot;</span></span>

<span data-ttu-id="db02d-156">`EntityDataSource`コントロールは、既定では遅延読み込みを無効になります。</span><span class="sxs-lookup"><span data-stu-id="db02d-156">The `EntityDataSource` control disables lazy loading by default.</span></span> <span data-ttu-id="db02d-157">`ObjectDataSource`コントロールの現在のチュートリアルを使用している (またはページのコードから、オブジェクト コンテキストにアクセスするかどうか)、いくつかの方法を遅延することができますが読み込みを既定で無効にします。</span><span class="sxs-lookup"><span data-stu-id="db02d-157">For the `ObjectDataSource` control that you're using for the current tutorial (or if you access the object context from page code), there are several ways you can make lazy loading disabled by default.</span></span> <span data-ttu-id="db02d-158">オブジェクト コンテキストをインスタンス化するときに、それが無効にできます。</span><span class="sxs-lookup"><span data-stu-id="db02d-158">You can disable it when you instantiate an object context.</span></span> <span data-ttu-id="db02d-159">たとえばのコンス トラクター メソッドに次の行を追加することができます、`SchoolRepository`クラス。</span><span class="sxs-lookup"><span data-stu-id="db02d-159">For example, you can add the following line to the constructor method of the `SchoolRepository` class:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample2.cs)]

<span data-ttu-id="db02d-160">Contoso 大学アプリケーションにすれば、オブジェクト コンテキストに自動的にこのプロパティは、コンテキストがインスタンス化されるたびに設定する必要があるないように、遅延読み込みを無効にします。</span><span class="sxs-lookup"><span data-stu-id="db02d-160">For the Contoso University application, you'll make the object context automatically disable lazy loading so that this property doesn't have to be set whenever a context is instantiated.</span></span>

<span data-ttu-id="db02d-161">開く、 *SchoolModel.edmx*データ モデル、デザイン画面をクリックして設定して、プロパティ ペインで、**遅延読み込み有効になっている**プロパティを`False`です。</span><span class="sxs-lookup"><span data-stu-id="db02d-161">Open the *SchoolModel.edmx* data model, click the design surface, and then in the properties pane set the **Lazy Loading Enabled** property to `False`.</span></span> <span data-ttu-id="db02d-162">保存して、データ モデルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="db02d-162">Save and close the data model.</span></span>

<span data-ttu-id="db02d-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-163">[![Image04](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image8.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image7.png)</span></span>

## <a name="managing-view-state"></a><span data-ttu-id="db02d-164">ビュー ステートを管理します。</span><span class="sxs-lookup"><span data-stu-id="db02d-164">Managing View State</span></span>

<span data-ttu-id="db02d-165">更新機能を提供するためにページが表示されるときに、ASP.NET web ページは、エンティティの元のプロパティ値を格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-165">In order to provide update functionality, an ASP.NET web page must store the original property values of an entity when a page is rendered.</span></span> <span data-ttu-id="db02d-166">ポストバック コントロールを処理中に、エンティティの元の状態を再作成でき、エンティティを呼び出す`Attach`変更を適用して、呼び出しの前にメソッド、`SaveChanges`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="db02d-166">During postback processing the control can re-create the original state of the entity and call the entity's `Attach` method before applying changes and calling the `SaveChanges` method.</span></span> <span data-ttu-id="db02d-167">既定では、ASP.NET Web フォーム データ コントロールは、元の値を格納するのにビュー ステートを使用します。</span><span class="sxs-lookup"><span data-stu-id="db02d-167">By default, ASP.NET Web Forms data controls use view state to store the original values.</span></span> <span data-ttu-id="db02d-168">ただし、ビュー状態に影響する可能性、パフォーマンス ブラウザーとの間に送信されるページのサイズを大幅に増加することが非表示のフィールドに格納されているためです。</span><span class="sxs-lookup"><span data-stu-id="db02d-168">However, view state can affect performance, because it's stored in hidden fields that can substantially increase the size of the page that's sent to and from the browser.</span></span>

<span data-ttu-id="db02d-169">このチュートリアルが詳しくは、このトピックに移動しないようにビュー状態、またはセッション状態などの選択肢を管理するための手法は対象の Entity Framework がありません。</span><span class="sxs-lookup"><span data-stu-id="db02d-169">Techniques for managing view state, or alternatives such as session state, aren't unique to the Entity Framework, so this tutorial doesn't go into this topic in detail.</span></span> <span data-ttu-id="db02d-170">詳細については、チュートリアルの最後に、リンクを参照してください。</span><span class="sxs-lookup"><span data-stu-id="db02d-170">For more information see the links at the end of the tutorial.</span></span>

<span data-ttu-id="db02d-171">ただし、バージョン 4 の ASP.NET により、新しい Web フォーム アプリケーションのすべての ASP.NET 開発者が注意する必要があるビュー ステートに作業を行う:`ViewStateMode`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="db02d-171">However, version 4 of ASP.NET provides a new way of working with view state that every ASP.NET developer of Web Forms applications should be aware of: the `ViewStateMode` property.</span></span> <span data-ttu-id="db02d-172">ページまたはコントロールのレベルでこの新しいプロパティを設定することができ、既定では、ページのビュー ステートを無効にし、必要なコントロールに対してのみ有効にすることができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-172">This new property can be set at the page or control level, and it enables you to disable view state by default for a page and enable it only for controls that need it.</span></span>

<span data-ttu-id="db02d-173">アプリケーションのパフォーマンスが重要な場合をお勧めを常に、ページ レベルでのビュー ステートを無効にし、それが必要なコントロールに対してのみ有効にします。</span><span class="sxs-lookup"><span data-stu-id="db02d-173">For applications where performance is critical, a good practice is to always disable view state at the page level and enable it only for controls that require it.</span></span> <span data-ttu-id="db02d-174">Contoso 大学ページでの表示状態のサイズは、このメソッドにより大幅に低下はありませんが、動作を理解すること、行うこと*Instructors.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="db02d-174">The size of view state in the Contoso University pages wouldn't be substantially decreased by this method, but to see how it works, you'll do it for the *Instructors.aspx* page.</span></span> <span data-ttu-id="db02d-175">そのページには含む、多くのコントロールが含まれています、`Label`ビューステートが無効になっているコントロール。</span><span class="sxs-lookup"><span data-stu-id="db02d-175">That page contains many controls, including a `Label` control that has view state disabled.</span></span> <span data-ttu-id="db02d-176">このページ上のコントロールのいずれも実際には、ビュー状態が有効にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-176">None of the controls on this page actually need to have view state enabled.</span></span> <span data-ttu-id="db02d-177">(、`DataKeyNames`のプロパティ、`GridView`コントロールがポストバック間で維持する必要がありますの状態を指定しますが、これらの値がコントロールの状態は、影響を与えませんに保持される、`ViewStateMode`プロパティです)。</span><span class="sxs-lookup"><span data-stu-id="db02d-177">(The `DataKeyNames` property of the `GridView` control specifies state that must be maintained between postbacks, but these values are kept in control state, which isn't affected by the `ViewStateMode` property.)</span></span>

<span data-ttu-id="db02d-178">`Page`ディレクティブと`Label`コントロール マークアップ現在次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="db02d-178">The `Page` directive and `Label` control markup currently resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample3.aspx)]

<span data-ttu-id="db02d-179">次の変更を行います。</span><span class="sxs-lookup"><span data-stu-id="db02d-179">Make the following changes:</span></span>

- <span data-ttu-id="db02d-180">追加`ViewStateMode="Disabled"`を`Page`ディレクティブです。</span><span class="sxs-lookup"><span data-stu-id="db02d-180">Add `ViewStateMode="Disabled"` to the `Page` directive.</span></span>
- <span data-ttu-id="db02d-181">削除`ViewStateMode="Disabled"`から、`Label`コントロール。</span><span class="sxs-lookup"><span data-stu-id="db02d-181">Remove `ViewStateMode="Disabled"` from the `Label` control.</span></span>

<span data-ttu-id="db02d-182">マークアップでは、次の例がようになります。</span><span class="sxs-lookup"><span data-stu-id="db02d-182">The markup now resembles the following example:</span></span>

[!code-aspx[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample4.aspx)]

<span data-ttu-id="db02d-183">すべてのコントロール ビュー ステートが無効になります。</span><span class="sxs-lookup"><span data-stu-id="db02d-183">View state is now disabled for all controls.</span></span> <span data-ttu-id="db02d-184">行うには必要なのは、後では、ビュー ステートを使用する必要があるコントロールを追加する場合、`ViewStateMode="Enabled"`そのコントロールの属性です。</span><span class="sxs-lookup"><span data-stu-id="db02d-184">If you later add a control that does need to use view state, all you need to do is include the `ViewStateMode="Enabled"` attribute for that control.</span></span>

## <a name="using-the-notracking-merge-option"></a><span data-ttu-id="db02d-185">NoTracking マージ オプションを使用します。</span><span class="sxs-lookup"><span data-stu-id="db02d-185">Using The NoTracking Merge Option</span></span>

<span data-ttu-id="db02d-186">オブジェクト コンテキストでは、データベースの行を取得し、それらを表すエンティティ オブジェクトを作成、ときに既定の追跡もそのオブジェクトの状態マネージャーを使用してこれらのエンティティ オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="db02d-186">When an object context retrieves database rows and creates entity objects that represent them, by default it also tracks those entity objects using its object state manager.</span></span> <span data-ttu-id="db02d-187">この追跡データはキャッシュとして機能し、エンティティを更新するときに使用します。</span><span class="sxs-lookup"><span data-stu-id="db02d-187">This tracking data acts as a cache and is used when you update an entity.</span></span> <span data-ttu-id="db02d-188">Web アプリケーションには、通常はコンテキストの有効期間が短いオブジェクト インスタンスがあるためクエリは多くの場合、そこにエンティティのいずれかが再度使用する前に、オブジェクト コンテキストを読み取ることが破棄されるため、追跡する必要があるデータを返すか、更新します。</span><span class="sxs-lookup"><span data-stu-id="db02d-188">Because a web application typically has short-lived object context instances, queries often return data that doesn't need to be tracked, because the object context that reads them will be disposed before any of the entities it reads are used again or updated.</span></span>

<span data-ttu-id="db02d-189">Entity Framework ではコンテキストによってオブジェクトが設定してエンティティ オブジェクトを追跡するかどうかを指定できます、*マージ オプション*です。</span><span class="sxs-lookup"><span data-stu-id="db02d-189">In the Entity Framework, you can specify whether the object context tracks entity objects by setting a *merge option*.</span></span> <span data-ttu-id="db02d-190">エンティティ セットまたは個々 のクエリのマージ オプションを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-190">You can set the merge option for individual queries or for entity sets.</span></span> <span data-ttu-id="db02d-191">エンティティ セットに対して設定すると場合、は、そのエンティティ セットに対して作成されるすべてのクエリの既定のマージ オプションを設定することを意味します。</span><span class="sxs-lookup"><span data-stu-id="db02d-191">If you set it for an entity set, that means that you're setting the default merge option for all queries that are created for that entity set.</span></span>

<span data-ttu-id="db02d-192">追跡されていないためマージ オプションを設定することができます、リポジトリからアクセスするエンティティ セットのいずれかの必要となる Contoso 大学アプリケーション`NoTracking`のリポジトリ クラスのオブジェクト コンテキストのインスタンスを作成するときにそれらのエンティティ セット。</span><span class="sxs-lookup"><span data-stu-id="db02d-192">For the Contoso University application, tracking isn't needed for any of the entity sets that you access from the repository, so you can set the merge option to `NoTracking` for those entity sets when you instantiate the object context in the repository class.</span></span> <span data-ttu-id="db02d-193">(このチュートリアルではマージ オプションを設定しませんあるアプリケーションのパフォーマンスに大きな影響が及ぶに注意してください。</span><span class="sxs-lookup"><span data-stu-id="db02d-193">(Note that in this tutorial, setting the merge option won't have a noticeable effect on the application's performance.</span></span> <span data-ttu-id="db02d-194">`NoTracking`オプションは、特定のデータ量の多いシナリオでのみ、監視可能なパフォーマンスが向上する可能性があります)。</span><span class="sxs-lookup"><span data-stu-id="db02d-194">The `NoTracking` option is likely to make an observable performance improvement only in certain high-data-volume scenarios.)</span></span>

<span data-ttu-id="db02d-195">DAL フォルダーで開く、 *SchoolRepository.cs*ファイルし、エンティティ セット、リポジトリにアクセスするにはマージ オプションを設定するコンス トラクター メソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="db02d-195">In the DAL folder, open the *SchoolRepository.cs* file and add a constructor method that sets the merge option for the entity sets that the repository accesses:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample5.cs)]

## <a name="pre-compiling-linq-queries"></a><span data-ttu-id="db02d-196">コンパイル済み LINQ クエリ</span><span class="sxs-lookup"><span data-stu-id="db02d-196">Pre-Compiling LINQ Queries</span></span>

<span data-ttu-id="db02d-197">初めて、Entity Framework の有効期間内の Entity SQL クエリを実行するとき、指定された`ObjectContext`インスタンス、しばらくの間にかかるクエリをコンパイルします。</span><span class="sxs-lookup"><span data-stu-id="db02d-197">The first time that the Entity Framework executes an Entity SQL query within the life of a given `ObjectContext` instance, it takes some time to compile the query.</span></span> <span data-ttu-id="db02d-198">以降のクエリの実行が大幅に短縮されるので、コンパイルの結果がキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="db02d-198">The result of compilation is cached, which means that subsequent executions of the query are much quicker.</span></span> <span data-ttu-id="db02d-199">LINQ クエリは、クエリが実行されるたびに、クエリのコンパイルに必要な作業の一部を行うことを除き、同様のパターンに従います。</span><span class="sxs-lookup"><span data-stu-id="db02d-199">LINQ queries follow a similar pattern, except that some of the work required to compile the query is done every time the query is executed.</span></span> <span data-ttu-id="db02d-200">つまり、LINQ クエリの既定ですべてのコンパイルの結果はキャッシュされます。</span><span class="sxs-lookup"><span data-stu-id="db02d-200">In other words, for LINQ queries, by default not all of the results of compilation are cached.</span></span>

<span data-ttu-id="db02d-201">オブジェクト コンテキストの有効期間で繰り返し実行すると予想される LINQ クエリを使っている場合は、すべての結果を初めての LINQ クエリの実行がキャッシュに保存するコンパイルの原因となったコードを記述できます。</span><span class="sxs-lookup"><span data-stu-id="db02d-201">If you have a LINQ query that you expect to run repeatedly in the life of an object context, you can write code that causes all of the results of compilation to be cached the first time the LINQ query is run.</span></span>

<span data-ttu-id="db02d-202">具体的なとしてがこれを行うという 2 つの`Get`内のメソッド、`SchoolRepository`うちの 1 つは、すべてのパラメーターを受け取らないクラス (、`GetInstructorNames`メソッド)、いずれかのパラメーターを必要として (、`GetDepartmentsByAdministrator`メソッド)。</span><span class="sxs-lookup"><span data-stu-id="db02d-202">As an illustration, you'll do this for two `Get` methods in the `SchoolRepository` class, one of which doesn't take any parameters (the `GetInstructorNames` method), and one that does require a parameter (the `GetDepartmentsByAdministrator` method).</span></span> <span data-ttu-id="db02d-203">これらのメソッド目立つようになりました実際にする必要はありません LINQ クエリではありませんので、コンパイルします。</span><span class="sxs-lookup"><span data-stu-id="db02d-203">These methods as they stand now actually don't need to be compiled because they aren't LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample6.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample7.cs)]

<span data-ttu-id="db02d-204">ただし、コンパイル済みクエリを試すことができます、ように、これらを次の LINQ クエリとして記述されていた場合とを続行します。</span><span class="sxs-lookup"><span data-stu-id="db02d-204">However, so that you can try out compiled queries, you'll proceed as if these had been written as the following LINQ queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample8.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample9.cs)]

<span data-ttu-id="db02d-205">これらのメソッドでコードを変更すると、何上に示したがあり、続行する前に動作することを確認するアプリケーションを実行する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="db02d-205">You could change the code in these methods to what's shown above and run the application to verify that it works before continuing.</span></span> <span data-ttu-id="db02d-206">それらのコンパイル済みのバージョンの作成時に、次の手順のすぐです。</span><span class="sxs-lookup"><span data-stu-id="db02d-206">But the following instructions jump right into creating pre-compiled versions of them.</span></span>

<span data-ttu-id="db02d-207">クラス ファイルを作成、 *DAL*フォルダーで、名前を付けます*SchoolEntities.cs*、し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="db02d-207">Create a class file in the *DAL* folder, name it *SchoolEntities.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample10.cs)]

<span data-ttu-id="db02d-208">このコードでは、自動的に生成されたオブジェクト コンテキスト クラスを拡張する部分クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="db02d-208">This code creates a partial class that extends the automatically generated object context class.</span></span> <span data-ttu-id="db02d-209">部分クラスには使用して 2 つのコンパイル済み LINQ クエリが含まれています、`Compile`のメソッド、`CompiledQuery`クラスです。</span><span class="sxs-lookup"><span data-stu-id="db02d-209">The partial class includes two compiled LINQ queries using the `Compile` method of the `CompiledQuery` class.</span></span> <span data-ttu-id="db02d-210">クエリの呼び出しに使用できるメソッドも作成されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-210">It also creates methods that you can use to call the queries.</span></span> <span data-ttu-id="db02d-211">保存して、このファイルを閉じます。</span><span class="sxs-lookup"><span data-stu-id="db02d-211">Save and close this file.</span></span>

<span data-ttu-id="db02d-212">次に、 *SchoolRepository.cs*、既存を変更する`GetInstructorNames`と`GetDepartmentsByAdministrator`リポジトリ内のメソッドはクラス、コンパイル済みクエリを呼び出すことができるようにします。</span><span class="sxs-lookup"><span data-stu-id="db02d-212">Next, in *SchoolRepository.cs*, change the existing `GetInstructorNames` and `GetDepartmentsByAdministrator` methods in the repository class so that they call the compiled queries:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample11.cs)]

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample12.cs)]

<span data-ttu-id="db02d-213">実行、 *Departments.aspx*以前と同じように動作することを確認します。</span><span class="sxs-lookup"><span data-stu-id="db02d-213">Run the *Departments.aspx* page to verify that it works as it did before.</span></span> <span data-ttu-id="db02d-214">`GetInstructorNames`メソッドは、管理者のドロップダウン リストに表示するために呼び出されますと`GetDepartmentsByAdministrator`をクリックすると、メソッドが呼び出されます**更新**インストラクターに 1 つ以上の管理者がないことを確認するのには部門。</span><span class="sxs-lookup"><span data-stu-id="db02d-214">The `GetInstructorNames` method is called in order to populate the administrator drop-down list, and the `GetDepartmentsByAdministrator` method is called when you click **Update** in order to verify that no instructor is an administrator of more than one department.</span></span>

<span data-ttu-id="db02d-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-215">[![Image03](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image10.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image9.png)</span></span>

<span data-ttu-id="db02d-216">パフォーマンスが多少向上ため、これを行う方法を表示するには、のみ Contoso 大学アプリケーションでは、事前にコンパイルされたクエリをしています。</span><span class="sxs-lookup"><span data-stu-id="db02d-216">You've pre-compiled queries in the Contoso University application only to see how to do it, not because it would measurably improve performance.</span></span> <span data-ttu-id="db02d-217">LINQ クエリをプリコンパイルするはコードの複雑さのレベルに追加してください。 を実際には、アプリケーションでパフォーマンスのボトルネックを表すクエリに対してのみ実行することを確認します。</span><span class="sxs-lookup"><span data-stu-id="db02d-217">Pre-compiling LINQ queries does add a level of complexity to your code, so make sure you do it only for queries that actually represent performance bottlenecks in your application.</span></span>

## <a name="examining-queries-sent-to-the-database"></a><span data-ttu-id="db02d-218">データベースに送信されるクエリを確認します。</span><span class="sxs-lookup"><span data-stu-id="db02d-218">Examining Queries Sent to the Database</span></span>

<span data-ttu-id="db02d-219">パフォーマンスの問題を調査している場合は、場合によっては、Entity Framework をデータベースに送信する正確な SQL コマンドを知っておくと便利です。</span><span class="sxs-lookup"><span data-stu-id="db02d-219">When you're investigating performance issues, sometimes it's helpful to know the exact SQL commands that the Entity Framework is sending to the database.</span></span> <span data-ttu-id="db02d-220">作業している場合、`IQueryable`オブジェクト、これを行う方法の 1 つを使用して、`ToTraceString`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="db02d-220">If you're working with an `IQueryable` object, one way to do this is to use the `ToTraceString` method.</span></span>

<span data-ttu-id="db02d-221">*SchoolRepository.cs*、内のコードを変更、`GetDepartmentsByName`メソッドを次の例。</span><span class="sxs-lookup"><span data-stu-id="db02d-221">In *SchoolRepository.cs*, change the code in the `GetDepartmentsByName` method to match the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample13.cs)]

<span data-ttu-id="db02d-222">`departments`に変数をキャストする必要があります、`ObjectQuery`のみため、型、`Where`メソッド、前の行の最後に作成、`IQueryable`オブジェクト; せず、`Where`メソッド、キャストする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="db02d-222">The `departments` variable must be cast to an `ObjectQuery` type only because the `Where` method at the end of the preceding line creates an `IQueryable` object; without the `Where` method, the cast would not be necessary.</span></span>

<span data-ttu-id="db02d-223">ブレークポイントを設定、`return`行、および実行し、 *Departments.aspx*デバッガー内のページです。</span><span class="sxs-lookup"><span data-stu-id="db02d-223">Set a breakpoint on the `return` line, and then run the *Departments.aspx* page in the debugger.</span></span> <span data-ttu-id="db02d-224">ブレークポイントをヒットしたときに確認、`commandText`に変数が、**ローカル**ウィンドウとテキスト ビジュアライザーを使用する (で虫眼鏡、**値**列)、にその値を表示する**テキスト ビジュアライザー**ウィンドウです。</span><span class="sxs-lookup"><span data-stu-id="db02d-224">When you hit the breakpoint, examine the `commandText` variable in the **Locals** window and use the text visualizer (the magnifying glass in the **Value** column) to display its value in the **Text Visualizer** window.</span></span> <span data-ttu-id="db02d-225">このコードによって生成されるすべての SQL コマンドを確認できます。</span><span class="sxs-lookup"><span data-stu-id="db02d-225">You can see the entire SQL command that results from this code:</span></span>

<span data-ttu-id="db02d-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-226">[![Image08](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image12.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image11.png)</span></span>

<span data-ttu-id="db02d-227">代わりに、Visual Studio Ultimate の IntelliTrace の機能は、コードを変更またはもブレークポイントを設定する必要がない Entity Framework によって生成された SQL コマンドを表示する方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="db02d-227">As an alternative, the IntelliTrace feature in Visual Studio Ultimate provides a way to view SQL commands generated by the Entity Framework that doesn't require you to change your code or even set a breakpoint.</span></span>

> [!NOTE]
> <span data-ttu-id="db02d-228">Visual Studio Ultimate がある場合にのみ、次の手順を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-228">You can perform the following procedures only if you have Visual Studio Ultimate.</span></span>


<span data-ttu-id="db02d-229">復元元のコードに、`GetDepartmentsByName`メソッド、および実行し、 *Departments.aspx*デバッガー内のページです。</span><span class="sxs-lookup"><span data-stu-id="db02d-229">Restore the original code in the `GetDepartmentsByName` method, and then run the *Departments.aspx* page in the debugger.</span></span>

<span data-ttu-id="db02d-230">Visual Studio で、選択、**デバッグ**メニュー、 **IntelliTrace**、し**IntelliTrace イベント**です。</span><span class="sxs-lookup"><span data-stu-id="db02d-230">In Visual Studio, select the **Debug** menu, then **IntelliTrace**, and then **IntelliTrace Events**.</span></span>

<span data-ttu-id="db02d-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-231">[![Image11](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image14.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image13.png)</span></span>

<span data-ttu-id="db02d-232">**IntelliTrace**ウィンドウで、をクリックして**すべて中断**です。</span><span class="sxs-lookup"><span data-stu-id="db02d-232">In the **IntelliTrace** window, click **Break All**.</span></span>

<span data-ttu-id="db02d-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-233">[![Image12](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image16.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image15.png)</span></span>

<span data-ttu-id="db02d-234">**IntelliTrace**ウィンドウには、最近のイベントの一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-234">The **IntelliTrace** window displays a list of recent events:</span></span>

<span data-ttu-id="db02d-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-235">[![Image09](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image18.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image17.png)</span></span>

<span data-ttu-id="db02d-236">クリックして、 **ADO.NET**行です。</span><span class="sxs-lookup"><span data-stu-id="db02d-236">Click the **ADO.NET** line.</span></span> <span data-ttu-id="db02d-237">これは、コマンド テキストを表示するに展開されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-237">It expands to show you the command text:</span></span>

<span data-ttu-id="db02d-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-238">[![Image10](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image20.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image19.png)</span></span>

<span data-ttu-id="db02d-239">コマンド テキスト文字列全体をからクリップボードにコピーすることができます、**ローカル**ウィンドウです。</span><span class="sxs-lookup"><span data-stu-id="db02d-239">You can copy the entire command text string to the clipboard from the **Locals** window.</span></span>

<span data-ttu-id="db02d-240">データベースが複数のテーブル、リレーションシップ、およびより単純な列が使用するいると仮定`School`データベース。</span><span class="sxs-lookup"><span data-stu-id="db02d-240">Suppose you were working with a database with more tables, relationships, and columns than the simple `School` database.</span></span> <span data-ttu-id="db02d-241">すべての情報を収集するクエリに必要な 1 つあります`Select`ステートメントが複数含まれている`Join`句が複雑すぎるため、作業を効率的になります。</span><span class="sxs-lookup"><span data-stu-id="db02d-241">You might find that a query that gathers all the information you need in a single `Select` statement containing multiple `Join` clauses becomes too complex to work efficiently.</span></span> <span data-ttu-id="db02d-242">その場合は、クエリを簡潔に明示的な読み込みへの読み込み eager から切り替えることができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-242">In that case you can switch from eager loading to explicit loading to simplify the query.</span></span>

<span data-ttu-id="db02d-243">たとえば、内のコードを変更してみてください、`GetDepartmentsByName`メソッド*SchoolRepository.cs*です。</span><span class="sxs-lookup"><span data-stu-id="db02d-243">For example, try changing the code in the `GetDepartmentsByName` method in *SchoolRepository.cs*.</span></span> <span data-ttu-id="db02d-244">現在することでメソッドを持つオブジェクト クエリ`Include`ためのメソッド、`Person`と`Courses`ナビゲーション プロパティ。</span><span class="sxs-lookup"><span data-stu-id="db02d-244">Currently in that method you have an object query that has `Include` methods for the `Person` and `Courses` navigation properties.</span></span> <span data-ttu-id="db02d-245">置換、`return`次の例のように、明示的な読み込みを実行するコードを使用してステートメント。</span><span class="sxs-lookup"><span data-stu-id="db02d-245">Replace the `return` statement with code that performs explicit loading, as shown in the following example:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample14.cs)]

<span data-ttu-id="db02d-246">実行、 *Departments.aspx*デバッガーでページを確認、 **IntelliTrace**する前にウィンドウをもう一度がでした。</span><span class="sxs-lookup"><span data-stu-id="db02d-246">Run the *Departments.aspx* page in the debugger and check the **IntelliTrace** window again as you did before.</span></span> <span data-ttu-id="db02d-247">ここで、前に 1 つのクエリがあった場合は、それらの長いシーケンス参照してください。</span><span class="sxs-lookup"><span data-stu-id="db02d-247">Now, where there was a single query before, you see a long sequence of them.</span></span>

<span data-ttu-id="db02d-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-248">[![Image13](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image22.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image21.png)</span></span>

<span data-ttu-id="db02d-249">1 つ目のクリックして**ADO.NET**起こった複雑なクエリを表示する行が前に表示します。</span><span class="sxs-lookup"><span data-stu-id="db02d-249">Click the first **ADO.NET** line to see what has happened to the complex query you viewed earlier.</span></span>

<span data-ttu-id="db02d-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-250">[![Image14](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image24.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image23.png)</span></span>

<span data-ttu-id="db02d-251">部門からのクエリは、単純なになった`Select`のないクエリ`Join`元によって返される各部門の 2 つのクエリのセットを使用して、句が、これは、関連 courses に、管理者を取得する個別のクエリに続く、クエリ。</span><span class="sxs-lookup"><span data-stu-id="db02d-251">The query from Departments has become a simple `Select` query with no `Join` clause, but it's followed by separate queries that retrieve related courses and an administrator, using a set of two queries for each department returned by the original query.</span></span>

> [!NOTE]
> <span data-ttu-id="db02d-252">遅延のままにする場合の遅延読み込みを読み込みを有効にすると、ここに表示される、繰り返される多くの場合、同じクエリを使用して、パターンがあります。</span><span class="sxs-lookup"><span data-stu-id="db02d-252">If you leave lazy loading enabled, the pattern you see here, with the same query repeated many times, might result from lazy loading.</span></span> <span data-ttu-id="db02d-253">回避する通常されるパターンでは、主テーブルのすべての行に関連するデータを遅延読み込みです。</span><span class="sxs-lookup"><span data-stu-id="db02d-253">A pattern that you typically want to avoid is lazy-loading related data for every row of the primary table.</span></span> <span data-ttu-id="db02d-254">1 つの結合クエリが複雑すぎて効率的ことを確認できたので、しない限り、通常ことができますを一括読み込みを使用するプライマリのクエリを変更することでこのような場合にパフォーマンスを向上させるためにします。</span><span class="sxs-lookup"><span data-stu-id="db02d-254">Unless you've verified that a single join query is too complex to be efficient, you'd typically be able to improve performance in such cases by changing the primary query to use eager loading.</span></span>


## <a name="pre-generating-views"></a><span data-ttu-id="db02d-255">ビューを事前に生成します。</span><span class="sxs-lookup"><span data-stu-id="db02d-255">Pre-Generating Views</span></span>

<span data-ttu-id="db02d-256">ときに、`ObjectContext`オブジェクトが、新しいアプリケーション ドメインで最初に作成、Entity Framework には、一連のデータベースへのアクセスに使用されるクラスが生成されます。</span><span class="sxs-lookup"><span data-stu-id="db02d-256">When an `ObjectContext` object is first created in a new application domain, the Entity Framework generates a set of classes that it uses to access the database.</span></span> <span data-ttu-id="db02d-257">これらのクラスと呼ばれます*ビュー*、非常に大きなデータ モデルがあれば、これらのビューを生成するが遅れる原因、web サイトのページの最初の要求に応えて、新しいアプリケーション ドメインが初期化されるとします。</span><span class="sxs-lookup"><span data-stu-id="db02d-257">These classes are called *views*, and if you have a very large data model, generating these views can delay the web site's response to the first request for a page after a new application domain is initialized.</span></span> <span data-ttu-id="db02d-258">実行時ではなく、コンパイル時にビューを作成することでこの初回要求の遅延時間を減らすことができます。</span><span class="sxs-lookup"><span data-stu-id="db02d-258">You can reduce this first-request delay by creating the views at compile time rather than at run time.</span></span>

> [!NOTE]
> <span data-ttu-id="db02d-259">アプリケーションは、極端に大きなデータ モデルを持っていない場合、または大きなデータ モデルには、IIS のリサイクル後に最初のページ要求のみに影響するパフォーマンスの問題に関する問題がない場合は、このセクションを省略できます。</span><span class="sxs-lookup"><span data-stu-id="db02d-259">If your application doesn't have an extremely large data model, or if it does have a large data model but you aren't concerned about a performance problem that affects only the very first page request after IIS is recycled, you can skip this section.</span></span> <span data-ttu-id="db02d-260">ビューをインスタンス化するたびに、作成は行われない、`ObjectContext`オブジェクト、ビューは、アプリケーション ドメインでキャッシュされるためです。</span><span class="sxs-lookup"><span data-stu-id="db02d-260">View creation doesn't happen every time you instantiate an `ObjectContext` object, because the views are cached in the application domain.</span></span> <span data-ttu-id="db02d-261">そのため、頻繁に IIS でアプリケーションをリサイクルしている場合を除き、少数のページ要求が事前に生成したビューからも有効。</span><span class="sxs-lookup"><span data-stu-id="db02d-261">Therefore, unless you're frequently recycling your application in IIS, very few page requests would benefit from pre-generated views.</span></span>


<span data-ttu-id="db02d-262">使用してビューを事前に生成することができます、 *EdmGen.exe*コマンド ライン ツールまたはを使用して、*テキスト テンプレート変換ツールキット*(T4) テンプレートです。</span><span class="sxs-lookup"><span data-stu-id="db02d-262">You can pre-generate views using the *EdmGen.exe* command-line tool or by using a *Text Template Transformation Toolkit* (T4) template.</span></span> <span data-ttu-id="db02d-263">このチュートリアルでは、T4 テンプレートを使用します。</span><span class="sxs-lookup"><span data-stu-id="db02d-263">In this tutorial you'll use a T4 template.</span></span>

<span data-ttu-id="db02d-264">*DAL*フォルダーを使用してファイルを追加、**テキスト テンプレート**テンプレート (下では、**全般**内のノード、**インストールされたテンプレート**一覧)、名前を付けます*SchoolModel.Views.tt*です。</span><span class="sxs-lookup"><span data-stu-id="db02d-264">In the *DAL* folder, add a file using the **Text Template** template (it's under the **General** node in the **Installed Templates** list), and name it *SchoolModel.Views.tt*.</span></span> <span data-ttu-id="db02d-265">ファイル内の既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="db02d-265">Replace the existing code in the file with the following code:</span></span>

[!code-csharp[Main](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/samples/sample15.cs)]

<span data-ttu-id="db02d-266">このコード生成のビュー、 *.edmx*は、テンプレートと同じフォルダー内にあるテンプレート ファイルとして同じ名前を持つファイルです。</span><span class="sxs-lookup"><span data-stu-id="db02d-266">This code generates views for an *.edmx* file that's located in the same folder as the template and that has the same name as the template file.</span></span> <span data-ttu-id="db02d-267">たとえば、次のテンプレートは、ファイルの名前は*SchoolModel.Views.tt*、という名前のデータ モデル ファイルが検索されます*SchoolModel.edmx*です。</span><span class="sxs-lookup"><span data-stu-id="db02d-267">For example, if your template file is named *SchoolModel.Views.tt*, it will look for a data model file named *SchoolModel.edmx*.</span></span>

<span data-ttu-id="db02d-268">内のファイルを右クリックし、ファイルを保存**ソリューション エクスプ ローラー**選択**カスタム ツールの実行**です。</span><span class="sxs-lookup"><span data-stu-id="db02d-268">Save the file, then right-click the file in **Solution Explorer** and select **Run Custom Tool**.</span></span>

<span data-ttu-id="db02d-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-269">[![Image02](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image26.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image25.png)</span></span>

<span data-ttu-id="db02d-270">Visual Studio の名前は、ビューを作成するコード ファイルを生成する*SchoolModel.Views.cs*テンプレートに基づきます。</span><span class="sxs-lookup"><span data-stu-id="db02d-270">Visual Studio generates a code file that creates the views, which is named *SchoolModel.Views.cs* based on the template.</span></span> <span data-ttu-id="db02d-271">(お気付きかもしれませんを選択する前に、コード ファイルの生成**カスタム ツールの実行**テンプレート ファイルを保存するとすぐに、します)。</span><span class="sxs-lookup"><span data-stu-id="db02d-271">(You might have noticed that the code file is generated even before you select **Run Custom Tool**, as soon as you save the template file.)</span></span>

<span data-ttu-id="db02d-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="db02d-272">[![Image01](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image28.png)](maximizing-performance-with-the-entity-framework-in-an-asp-net-web-application/_static/image27.png)</span></span>

<span data-ttu-id="db02d-273">ここで、アプリケーションを実行し、以前と同じように動作することを確認できます。</span><span class="sxs-lookup"><span data-stu-id="db02d-273">You can now run the application and verify that it works as it did before.</span></span>

<span data-ttu-id="db02d-274">事前に生成されたビューの詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="db02d-274">For more information about pre-generated views, see the following resources:</span></span>

- <span data-ttu-id="db02d-275">[方法: 事前生成クエリ パフォーマンスを向上させるビュー](https://msdn.microsoft.com/library/bb896240.aspx) MSDN web サイトのです。</span><span class="sxs-lookup"><span data-stu-id="db02d-275">[How to: Pre-Generate Views to Improve Query Performance](https://msdn.microsoft.com/library/bb896240.aspx) on the MSDN web site.</span></span> <span data-ttu-id="db02d-276">使用する方法について説明します、`EdmGen.exe`ビューを事前に生成するコマンド ライン ツールです。</span><span class="sxs-lookup"><span data-stu-id="db02d-276">Explains how to use the `EdmGen.exe` command-line tool to pre-generate views.</span></span>
- <span data-ttu-id="db02d-277">[プリコンパイル済み/前 generated ビューと、Entity Framework 4 のパフォーマンスの分離](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx)on Windows Server AppFabric の Customer Advisory Team ブログ。</span><span class="sxs-lookup"><span data-stu-id="db02d-277">[Isolating Performance with Precompiled/Pre-generated Views in the Entity Framework 4](https://blogs.msdn.com/b/appfabriccat/archive/2010/08/06/isolating-performance-with-precompiled-pre-generated-views-in-the-entity-framework-4.aspx) on the Windows Server AppFabric Customer Advisory Team blog.</span></span>

<span data-ttu-id="db02d-278">これは、Entity Framework を使用する ASP.NET web アプリケーションのパフォーマンス向上の概要を完了します。</span><span class="sxs-lookup"><span data-stu-id="db02d-278">This completes the introduction to improving performance in an ASP.NET web application that uses the Entity Framework.</span></span> <span data-ttu-id="db02d-279">詳細については、次のリソースを参照してください。</span><span class="sxs-lookup"><span data-stu-id="db02d-279">For more information, see the following resources:</span></span>

- <span data-ttu-id="db02d-280">[パフォーマンスに関する考慮事項 (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) MSDN web サイトです。</span><span class="sxs-lookup"><span data-stu-id="db02d-280">[Performance Considerations (Entity Framework)](https://msdn.microsoft.com/library/cc853327.aspx) on the MSDN web site.</span></span>
- <span data-ttu-id="db02d-281">[Entity Framework チームのブログの投稿のパフォーマンスに関連する](https://blogs.msdn.com/b/adonet/archive/tags/performance/)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-281">[Performance-related posts on the Entity Framework Team blog](https://blogs.msdn.com/b/adonet/archive/tags/performance/).</span></span>
- <span data-ttu-id="db02d-282">[EF マージ オプションおよびコンパイル済みクエリ](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-282">[EF Merge Options and Compiled Queries](https://blogs.msdn.com/b/dsimmons/archive/2010/01/12/ef-merge-options-and-compiled-queries.aspx).</span></span> <span data-ttu-id="db02d-283">コンパイル済みクエリとマージの予期しない動作を説明するブログの投稿などのオプション`NoTracking`です。</span><span class="sxs-lookup"><span data-stu-id="db02d-283">Blog post that explains unexpected behaviors of compiled queries and merge options such as `NoTracking`.</span></span> <span data-ttu-id="db02d-284">コンパイル済みクエリを使用するか、アプリケーションでのマージ オプションの設定を操作する場合は、この最初の読み取り。</span><span class="sxs-lookup"><span data-stu-id="db02d-284">If you plan to use compiled queries or manipulate merge option settings in your application, read this first.</span></span>
- <span data-ttu-id="db02d-285">[フレームワークに関連するエンティティが、データとモデリングの Customer Advisory Team ブログの投稿](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-285">[Entity Framework-related posts in the Data and Modeling Customer Advisory Team blog](https://blogs.msdn.com/b/dmcat/archive/tags/entity+framework/).</span></span> <span data-ttu-id="db02d-286">コンパイル済みクエリを使用して Visual Studio 2010 のプロファイラーをパフォーマンスの問題の検出の投稿が含まれます。</span><span class="sxs-lookup"><span data-stu-id="db02d-286">Includes posts on compiled queries and using the Visual Studio 2010 Profiler to discover performance issues.</span></span>
- <span data-ttu-id="db02d-287">[非常に複雑なクエリのパフォーマンスの向上に関するアドバイスを entity Framework フォーラムのスレッド](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-287">[Entity Framework forum thread with advice on improving performance of highly complex queries](https://social.msdn.microsoft.com/Forums/adodotnetentityframework/thread/ffe8b2ab-c5b5-4331-8988-33a872d0b5f6).</span></span>
- <span data-ttu-id="db02d-288">[ASP.NET 状態管理に関する推奨事項](https://msdn.microsoft.com/library/z1hkazw7.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-288">[ASP.NET State Management Recommendations](https://msdn.microsoft.com/library/z1hkazw7.aspx).</span></span>
- <span data-ttu-id="db02d-289">[Entity Framework と、ObjectDataSource を使用: カスタム ページング](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="db02d-289">[Using the Entity Framework and the ObjectDataSource: Custom Paging](http://geekswithblogs.net/Frez/articles/using-the-entity-framework-and-the-objectdatasource-custom-paging.aspx).</span></span> <span data-ttu-id="db02d-290">ブログの投稿でページングを実装する方法を説明するこれらのチュートリアルで作成した ContosoUniversity アプリケーション上に構築される、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="db02d-290">Blog post that builds on the ContosoUniversity application created in these tutorials to explain how to implement paging in the *Departments.aspx* page.</span></span>

<span data-ttu-id="db02d-291">次のチュートリアルでは、バージョン 4 で導入された Entity Framework に重要な拡張機能のいくつかは確認します。</span><span class="sxs-lookup"><span data-stu-id="db02d-291">The next tutorial reviews some of the important enhancements to the Entity Framework that are new in version 4.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="db02d-292">[前へ](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
> [次へ](what-s-new-in-the-entity-framework-4.md)</span><span class="sxs-lookup"><span data-stu-id="db02d-292">[Previous](handling-concurrency-with-the-entity-framework-in-an-asp-net-web-application.md)
[Next](what-s-new-in-the-entity-framework-4.md)</span></span>
