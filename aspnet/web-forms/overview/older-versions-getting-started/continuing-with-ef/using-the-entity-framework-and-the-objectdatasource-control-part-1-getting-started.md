---
uid: web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
title: "Entity Framework 4.0 ObjectDataSource コントロールを使用して、パート 1: 作業の開始 |Microsoft ドキュメント"
author: tdykstra
description: "この一連のチュートリアルについては、Entity Framework チュートリアル シリーズの概要を作成した Contoso 大学 web アプリケーションに基づいています。 場合 yo しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/26/2011
ms.topic: article
ms.assetid: 244278c1-fec8-4255-8a8a-13bde491c4f5
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/continuing-with-ef/using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started
msc.type: authoredcontent
ms.openlocfilehash: 6f93d6033b68773507d624125936f0a69777e2b7
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="using-the-entity-framework-40-and-the-objectdatasource-control-part-1-getting-started"></a><span data-ttu-id="94a44-104">Entity Framework 4.0 ObjectDataSource コントロールを使用して、パート 1: 作業の開始</span><span class="sxs-lookup"><span data-stu-id="94a44-104">Using the Entity Framework 4.0 and the ObjectDataSource Control, Part 1: Getting Started</span></span>
====================
<span data-ttu-id="94a44-105">によって[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="94a44-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="94a44-106">このチュートリアル シリーズのビルドによって作成される Contoso 大学 web アプリケーションで、 [Entity Framework 4.0 の概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)一連のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="94a44-106">This tutorial series builds on the Contoso University web application that is created by the [Getting Started with the Entity Framework 4.0](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series.</span></span> <span data-ttu-id="94a44-107">前のチュートリアルを完了していない場合このチュートリアルの開始点とすることができます[アプリケーションをダウンロードして](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a)作成したとします。</span><span class="sxs-lookup"><span data-stu-id="94a44-107">If you didn't complete the earlier tutorials, as a starting point for this tutorial you can [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-97f8ee9a) that you would have created.</span></span> <span data-ttu-id="94a44-108">こともできます[アプリケーションをダウンロードして](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)一連の完全なチュートリアルで作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-108">You can also [download the application](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) that is created by the complete tutorial series.</span></span>
> 
> <span data-ttu-id="94a44-109">Contoso 大学でサンプル web アプリケーションでは、Entity Framework 4.0 および Visual Studio 2010 を使用して ASP.NET Web フォーム アプリケーションを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="94a44-109">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="94a44-110">サンプル アプリケーションは、架空の Contoso 大学の web サイトです。</span><span class="sxs-lookup"><span data-stu-id="94a44-110">The sample application is a website for a fictional Contoso University.</span></span> <span data-ttu-id="94a44-111">学生受付、コースの作成、およびインストラクター割り当てなどの機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="94a44-111">It includes functionality such as student admission, course creation, and instructor assignments.</span></span>
> 
> <span data-ttu-id="94a44-112">チュートリアルでは、c# の例を示します。</span><span class="sxs-lookup"><span data-stu-id="94a44-112">The tutorial shows examples in C#.</span></span> <span data-ttu-id="94a44-113">[ダウンロード可能なサンプル](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa)c# および Visual Basic の両方でコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="94a44-113">The [downloadable sample](https://code.msdn.microsoft.com/ASPNET-Web-Forms-6c7197aa) contains code in both C# and Visual Basic.</span></span>
> 
> ## <a name="database-first"></a><span data-ttu-id="94a44-114">データベースの最初</span><span class="sxs-lookup"><span data-stu-id="94a44-114">Database First</span></span>
> 
> <span data-ttu-id="94a44-115">Entity Framework でデータを操作できる 3 つの方法があります: *Database First*、 *Model First*、および*Code First*です。</span><span class="sxs-lookup"><span data-stu-id="94a44-115">There are three ways you can work with data in the Entity Framework: *Database First*, *Model First*, and *Code First*.</span></span> <span data-ttu-id="94a44-116">このチュートリアルでは、データベースの最初のです。</span><span class="sxs-lookup"><span data-stu-id="94a44-116">This tutorial is for Database First.</span></span> <span data-ttu-id="94a44-117">シナリオに合った最適なものを選択する方法でこれらのワークフローとガイダンスの違いの詳細については、次を参照してください。 [Entity Framework 開発ワークフロー](https://msdn.microsoft.com/en-us/library/ms178359.aspx#dbfmfcf)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-117">For information about the differences between these workflows and guidance on how to choose the best one for your scenario, see [Entity Framework Development Workflows](https://msdn.microsoft.com/en-us/library/ms178359.aspx#dbfmfcf).</span></span>
> 
> ## <a name="web-forms"></a><span data-ttu-id="94a44-118">Web フォーム</span><span class="sxs-lookup"><span data-stu-id="94a44-118">Web Forms</span></span>
> 
> <span data-ttu-id="94a44-119">同様に、作業の開始シリーズ、このチュートリアルのシリーズ ASP.NET Web フォーム モデルを使用して Visual Studio での ASP.NET Web フォームを操作する方法を把握するという前提で。</span><span class="sxs-lookup"><span data-stu-id="94a44-119">Like the Getting Started series, this tutorial series uses the ASP.NET Web Forms model and assumes you know how to work with ASP.NET Web Forms in Visual Studio.</span></span> <span data-ttu-id="94a44-120">表示されない場合、 [ASP.NET 4.5 Web フォームの概要](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-120">If you don't, see [Getting Started with ASP.NET 4.5 Web Forms](../../getting-started/getting-started-with-aspnet-45-web-forms/introduction-and-overview.md).</span></span> <span data-ttu-id="94a44-121">ASP.NET MVC フレームワークを使用する場合を参照してください。 [ASP.NET MVC を使用して Entity Framework の概要](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-121">If you prefer to work with the ASP.NET MVC framework, see [Getting Started with the Entity Framework using ASP.NET MVC](../../../../mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>
> 
> ## <a name="software-versions"></a><span data-ttu-id="94a44-122">ソフトウェアのバージョン</span><span class="sxs-lookup"><span data-stu-id="94a44-122">Software versions</span></span>
> 
> | <span data-ttu-id="94a44-123">**このチュートリアルで示す**</span><span class="sxs-lookup"><span data-stu-id="94a44-123">**Shown in the tutorial**</span></span> | <span data-ttu-id="94a44-124">**でも動作します。**</span><span class="sxs-lookup"><span data-stu-id="94a44-124">**Also works with**</span></span> |
> | --- | --- |
> | <span data-ttu-id="94a44-125">Windows 7</span><span class="sxs-lookup"><span data-stu-id="94a44-125">Windows 7</span></span> | <span data-ttu-id="94a44-126">Windows 8</span><span class="sxs-lookup"><span data-stu-id="94a44-126">Windows 8</span></span> |
> | <span data-ttu-id="94a44-127">Visual Studio 2010</span><span class="sxs-lookup"><span data-stu-id="94a44-127">Visual Studio 2010</span></span> | <span data-ttu-id="94a44-128">Visual Studio 2010 Express for Web です。</span><span class="sxs-lookup"><span data-stu-id="94a44-128">Visual Studio 2010 Express for Web.</span></span> <span data-ttu-id="94a44-129">このチュートリアルは以降のバージョンの Visual Studio でテストされていません。</span><span class="sxs-lookup"><span data-stu-id="94a44-129">The tutorial has not been tested with later versions of Visual Studio.</span></span> <span data-ttu-id="94a44-130">メニューのダイアログ ボックス、およびテンプレートの多くの違いがあります。</span><span class="sxs-lookup"><span data-stu-id="94a44-130">There are many differences in menu selections, dialog boxes, and templates.</span></span> |
> | <span data-ttu-id="94a44-131">.NET 4</span><span class="sxs-lookup"><span data-stu-id="94a44-131">.NET 4</span></span> | <span data-ttu-id="94a44-132">.NET 4.5 は .NET 4 との下位互換性ですが、このチュートリアルは .NET 4.5 でテストされていません。</span><span class="sxs-lookup"><span data-stu-id="94a44-132">.NET 4.5 is backward compatible with .NET 4, but the tutorial has not been tested with .NET 4.5.</span></span> |
> | <span data-ttu-id="94a44-133">Entity Framework 4</span><span class="sxs-lookup"><span data-stu-id="94a44-133">Entity Framework 4</span></span> | <span data-ttu-id="94a44-134">このチュートリアルは Entity Framework のバージョンでテストされていません。</span><span class="sxs-lookup"><span data-stu-id="94a44-134">The tutorial has not been tested with later versions of Entity Framework.</span></span> <span data-ttu-id="94a44-135">EF は Entity Framework 5 以降では、既定では使用して、 `DbContext API` EF 4.1 で導入されたことです。</span><span class="sxs-lookup"><span data-stu-id="94a44-135">Starting with Entity Framework 5, EF uses by default the `DbContext API` that was introduced with EF 4.1.</span></span> <span data-ttu-id="94a44-136">EntityDataSource コントロールを使用するように設計されました、 `ObjectContext` API です。</span><span class="sxs-lookup"><span data-stu-id="94a44-136">The EntityDataSource control was designed to use the `ObjectContext` API.</span></span> <span data-ttu-id="94a44-137">EntityDataSource を使用する方法については、コントロールを`DbContext`API を参照してください[このブログの投稿](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-137">For information about how to use the EntityDataSource control with the `DbContext` API, see [this blog post](https://blogs.msdn.com/b/webdev/archive/2012/09/13/how-to-use-the-entitydatasource-control-with-entity-framework-code-first.aspx).</span></span> |
> 
> ## <a name="questions"></a><span data-ttu-id="94a44-138">質問</span><span class="sxs-lookup"><span data-stu-id="94a44-138">Questions</span></span>
> 
> <span data-ttu-id="94a44-139">チュートリアルに直接関連付けられていない質問がある場合を投稿、 [ASP.NET Entity Framework フォーラム](https://forums.asp.net/1227.aspx)、 [Entity Framework でも LINQ to Entities フォーラム](https://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/threads/)、または[StackOverflow.com](http://stackoverflow.com/)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-139">If you have questions that are not directly related to the tutorial, you can post them to the [ASP.NET Entity Framework forum](https://forums.asp.net/1227.aspx), the [Entity Framework and LINQ to Entities forum](https://social.msdn.microsoft.com/forums/en-US/adodotnetentityframework/threads/), or [StackOverflow.com](http://stackoverflow.com/).</span></span>


<span data-ttu-id="94a44-140">`EntityDataSource`コントロールでは、非常に短時間は、アプリケーションを作成することができますが、通常必要な膨大量のビジネス ロジックとデータ アクセス ロジックを保持すること、 *.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-140">The `EntityDataSource` control enables you to create an application very quickly, but it typically requires you to keep a significant amount of business logic and data-access logic in your *.aspx* pages.</span></span> <span data-ttu-id="94a44-141">作成するために開発時間が増加が前もって投資できます複雑化し、継続的なメンテナンスを必要とするアプリケーションの場合、 *n 層*または*層*アプリケーション構造保守が簡単です。</span><span class="sxs-lookup"><span data-stu-id="94a44-141">If you expect your application to grow in complexity and to require ongoing maintenance, you can invest more development time up front in order to create an *n-tier* or *layered* application structure that's more maintainable.</span></span> <span data-ttu-id="94a44-142">このアーキテクチャを実装するのには、ビジネス ロジック層 (BLL) およびデータ アクセス層 (DAL) からプレゼンテーション層を分離します。</span><span class="sxs-lookup"><span data-stu-id="94a44-142">To implement this architecture, you separate the presentation layer from the business logic layer (BLL) and the data access layer (DAL).</span></span> <span data-ttu-id="94a44-143">この構造体を実装する方法の 1 つを使用して、`ObjectDataSource`制御の代わりに、`EntityDataSource`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-143">One way to implement this structure is to use the `ObjectDataSource` control instead of the `EntityDataSource` control.</span></span> <span data-ttu-id="94a44-144">使用すると、`ObjectDataSource`コントロール、データ アクセス コードを実装して、呼び出すことで*.aspx*ページが多くの同じコントロールを使用して他のデータ ソース コントロールの機能です。</span><span class="sxs-lookup"><span data-stu-id="94a44-144">When you use the `ObjectDataSource` control, you implement your own data-access code and then invoke it in *.aspx* pages using a control that has many of the same features as other data-source controls.</span></span> <span data-ttu-id="94a44-145">これにより、n 層のアプローチの利点をデータにアクセスする Web フォーム コントロールを使用する利点と組み合わせるできます。</span><span class="sxs-lookup"><span data-stu-id="94a44-145">This lets you combine the advantages of an n-tier approach with the benefits of using a Web Forms control for data access.</span></span>

<span data-ttu-id="94a44-146">`ObjectDataSource`制御することをより柔軟での他の方法でも同様です。</span><span class="sxs-lookup"><span data-stu-id="94a44-146">The `ObjectDataSource` control gives you more flexibility in other ways as well.</span></span> <span data-ttu-id="94a44-147">独自のデータ アクセス コードを記述するためが容易になりますは単読み取り、挿入、更新、または特定のエンティティの種類を削除、タスクは、これを`EntityDataSource`コントロールを実行するように設計されています。</span><span class="sxs-lookup"><span data-stu-id="94a44-147">Because you write your own data-access code, it's easier to do more than just read, insert, update, or delete a specific entity type, which are the tasks that the `EntityDataSource` control is designed to perform.</span></span> <span data-ttu-id="94a44-148">たとえば、エンティティが更新されるたびにログ記録を実行、エンティティを削除すると、または自動的に確認および更新に関連するデータ外部キーの値を持つ行を挿入するときに必要なときにデータをアーカイブできます。</span><span class="sxs-lookup"><span data-stu-id="94a44-148">For example, you can perform logging every time an entity is updated, archive data whenever an entity is deleted, or automatically check and update related data as needed when inserting a row with a foreign key value.</span></span>

## <a name="business-logic-and-repository-classes"></a><span data-ttu-id="94a44-149">ビジネス ロジック、およびリポジトリ クラス</span><span class="sxs-lookup"><span data-stu-id="94a44-149">Business Logic and Repository Classes</span></span>

<span data-ttu-id="94a44-150">`ObjectDataSource`を作成するクラスを呼び出すことによって動作を制御します。</span><span class="sxs-lookup"><span data-stu-id="94a44-150">An `ObjectDataSource` control works by invoking a class that you create.</span></span> <span data-ttu-id="94a44-151">クラスには、取得、データを更新するメソッドが含まれます。 および、これらのメソッドの名前を指定する、`ObjectDataSource`コントロールをマークアップします。</span><span class="sxs-lookup"><span data-stu-id="94a44-151">The class includes methods that retrieve and update data, and you provide the names of those methods to the `ObjectDataSource` control in markup.</span></span> <span data-ttu-id="94a44-152">レンダリングまたはポストバックの処理中に、`ObjectDataSource`指定したメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="94a44-152">During rendering or postback processing, the `ObjectDataSource` calls the methods that you've specified.</span></span>

<span data-ttu-id="94a44-153">基本的な CRUD 操作で使用するために作成するクラスだけでなく、`ObjectDataSource`コントロールは、ビジネス ロジックを実行する必要があるときに、`ObjectDataSource`の読み取りやデータを更新します。</span><span class="sxs-lookup"><span data-stu-id="94a44-153">Besides basic CRUD operations, the class that you create to use with the `ObjectDataSource` control might need to execute business logic when the `ObjectDataSource` reads or updates data.</span></span> <span data-ttu-id="94a44-154">たとえば、部門を更新するときに、他の部署があるない同じ管理者 1 人のユーザーが 1 つ以上の部門の管理者にすることはできませんのでを検証する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94a44-154">For example, when you update a department, you might need to validate that no other departments have the same administrator because one person cannot be administrator of more than one department.</span></span>

<span data-ttu-id="94a44-155">一部の`ObjectDataSource`ドキュメントについてなど、 [ObjectDataSource クラスの概要](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.aspx)と呼ばれるクラスを呼び出し、コントロール、*ビジネス オブジェクト*ビジネス ロジックとデータ アクセス ロジックの両方が含まれています.</span><span class="sxs-lookup"><span data-stu-id="94a44-155">In some `ObjectDataSource` documentation, such as the [ObjectDataSource Class overview](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.objectdatasource.aspx), the control calls a class referred to as a *business object* that includes both business logic and data-access logic.</span></span> <span data-ttu-id="94a44-156">このチュートリアルでは、ビジネス ロジックとデータ アクセス ロジックの別々 のクラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-156">In this tutorial you will create separate classes for business logic and for data-access logic.</span></span> <span data-ttu-id="94a44-157">データ アクセス ロジックをカプセル化するクラスが呼び出されます、*リポジトリ*です。</span><span class="sxs-lookup"><span data-stu-id="94a44-157">The class that encapsulates data-access logic is called a *repository*.</span></span> <span data-ttu-id="94a44-158">ビジネス ロジックのクラスには、ビジネス ロジックのメソッドとデータ アクセス メソッドの両方が含まれていますが、データ アクセス メソッドを呼び出すデータ アクセス タスクを実行するリポジトリです。</span><span class="sxs-lookup"><span data-stu-id="94a44-158">The business logic class includes both business-logic methods and data-access methods, but the data-access methods call the repository to perform data-access tasks.</span></span>

<span data-ttu-id="94a44-159">BLL と容易に自動化された単体 DAL の間で抽象化レイヤーを作成することも、BLL をテストします。</span><span class="sxs-lookup"><span data-stu-id="94a44-159">You will also create an abstraction layer between your BLL and DAL that facilitates automated unit testing of the BLL.</span></span> <span data-ttu-id="94a44-160">この抽象化レイヤーは、インターフェイスを作成して、ビジネス ロジックのクラスでリポジトリをインスタンス化するときに、インターフェイスを使用して実装されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-160">This abstraction layer is implemented by creating an interface and using the interface when you instantiate the repository in the business-logic class.</span></span> <span data-ttu-id="94a44-161">これによりリポジトリ インターフェイスを実装する任意のオブジェクトへの参照でビジネス ロジックのクラスを提供しています。</span><span class="sxs-lookup"><span data-stu-id="94a44-161">This makes it possible for you to provide the business-logic class with a reference to any object that implements the repository interface.</span></span> <span data-ttu-id="94a44-162">通常の操作に対しては、Entity Framework で動作するリポジトリ オブジェクトを提供します。</span><span class="sxs-lookup"><span data-stu-id="94a44-162">For normal operation, you provide a repository object that works with the Entity Framework.</span></span> <span data-ttu-id="94a44-163">テストでは、に対しては、簡単に操作できる、コレクションとして定義されているクラス変数などの方法で格納されているデータで動作するリポジトリ オブジェクトを提供します。</span><span class="sxs-lookup"><span data-stu-id="94a44-163">For testing, you provide a repository object that works with data stored in a way that you can easily manipulate, such as class variables defined as collections.</span></span>

<span data-ttu-id="94a44-164">次の図は、リポジトリなしのデータ アクセス ロジックを含んでいるビジネス ロジック クラスとリポジトリを使用する 1 つの違いを示します。</span><span class="sxs-lookup"><span data-stu-id="94a44-164">The following illustration shows the difference between a business-logic class that includes data-access logic without a repository and one that uses a repository.</span></span>

<span data-ttu-id="94a44-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-165">[![Image05](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image2.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image1.png)</span></span>

<span data-ttu-id="94a44-166">Web ページを作成するのには、まず、`ObjectDataSource`基本的なデータ アクセス タスクのみが実行するために、リポジトリに直接コントロールがバインドされています。</span><span class="sxs-lookup"><span data-stu-id="94a44-166">You will begin by creating web pages in which the `ObjectDataSource` control is bound directly to a repository because it only performs basic data-access tasks.</span></span> <span data-ttu-id="94a44-167">次のチュートリアルでは、検証ロジックとビジネス ロジックのクラスを作成し、バインド、`ObjectDataSource`リポジトリ クラスの代わりにそのクラスへのコントロールです。</span><span class="sxs-lookup"><span data-stu-id="94a44-167">In the next tutorial you will create a business logic class with validation logic and bind the `ObjectDataSource` control to that class instead of to the repository class.</span></span> <span data-ttu-id="94a44-168">検証ロジックの単体テストを作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-168">You will also create unit tests for the validation logic.</span></span> <span data-ttu-id="94a44-169">このシリーズの第 3 のチュートリアルでは、並べ替えおよびフィルター処理をアプリケーションに機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="94a44-169">In the third tutorial in this series you will add sorting and filtering functionality to the application.</span></span>

<span data-ttu-id="94a44-170">このチュートリアルで作成するページを使用、`Departments`で作成したデータ モデルのエンティティ セット、[チュートリアル シリーズの作業の開始](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-170">The pages you create in this tutorial work with the `Departments` entity set of the data model that you created in the [Getting Started tutorial series](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md).</span></span>

<span data-ttu-id="94a44-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-171">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image4.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image3.png)</span></span>

<span data-ttu-id="94a44-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-172">[![Image02](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image6.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image5.png)</span></span>

## <a name="updating-the-database-and-the-data-model"></a><span data-ttu-id="94a44-173">データベースとデータ モデルの更新</span><span class="sxs-lookup"><span data-stu-id="94a44-173">Updating the Database and the Data Model</span></span>

<span data-ttu-id="94a44-174">まずこのチュートリアルで作成したデータ モデルに対応する変更を必要とする、データベースに 2 つの変更を加える、 [Entity Framework と Web フォームの概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="94a44-174">You will begin this tutorial by making two changes to the database, both of which require corresponding changes to the data model that you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorials.</span></span> <span data-ttu-id="94a44-175">これらのチュートリアルの 1 つは、データベースの変更後に、データベースとデータ モデルを同期するために手動で、デザイナーで変更を加えた。</span><span class="sxs-lookup"><span data-stu-id="94a44-175">In one of those tutorials, you made changes in the designer manually to synchronize the data model with the database after a database change.</span></span> <span data-ttu-id="94a44-176">このチュートリアルでは、デザイナーを使用して**モデルをデータベースから更新**データ モデルを自動的に更新するツールです。</span><span class="sxs-lookup"><span data-stu-id="94a44-176">In this tutorial, you will use the designer's **Update Model From Database** tool to update the data model automatically.</span></span>

### <a name="adding-a-relationship-to-the-database"></a><span data-ttu-id="94a44-177">データベースへのリレーションシップの追加</span><span class="sxs-lookup"><span data-stu-id="94a44-177">Adding a Relationship to the Database</span></span>

<span data-ttu-id="94a44-178">Visual studio で作成した Contoso 大学 web アプリケーションを開きます、 [Entity Framework と Web フォームの概要](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md)チュートリアル シリーズを開き、`SchoolDiagram`データベース ダイアグラム。</span><span class="sxs-lookup"><span data-stu-id="94a44-178">In Visual Studio, open the Contoso University web application you created in the [Getting Started with the Entity Framework and Web Forms](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-1.md) tutorial series, and then open the `SchoolDiagram` database diagram.</span></span>

<span data-ttu-id="94a44-179">確認する場合、`Department`テーブル データベース ダイアグラムで表示されますがある、`Administrator`列です。</span><span class="sxs-lookup"><span data-stu-id="94a44-179">If you look at the `Department` table in the database diagram, you will see that it has an `Administrator` column.</span></span> <span data-ttu-id="94a44-180">この列は外部キーを`Person`テーブルがない外部キー リレーションシップがデータベースで定義されています。</span><span class="sxs-lookup"><span data-stu-id="94a44-180">This column is a foreign key to the `Person` table, but no foreign key relationship is defined in the database.</span></span> <span data-ttu-id="94a44-181">リレーションシップを作成して、Entity Framework はこのリレーションシップを自動的に処理できるように、データ モデルを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94a44-181">You need to create the relationship and update the data model so that the Entity Framework can automatically handle this relationship.</span></span>

<span data-ttu-id="94a44-182">データベース ダイアグラムを右クリックし、 `Department` 、テーブルを選択して**リレーションシップ**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-182">In the database diagram, right-click the `Department` table, and select **Relationships**.</span></span>

<span data-ttu-id="94a44-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-183">[![Image80](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image8.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image7.png)</span></span>

<span data-ttu-id="94a44-184">**Foreign Key Relationships**ボックス**追加**、... ボタンをクリックして**テーブルと列の指定**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-184">In the **Foreign Key Relationships** box click **Add**, then click the ellipsis for **Tables and Columns Specification**.</span></span>

<span data-ttu-id="94a44-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-185">[![Image81](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image10.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image9.png)</span></span>

<span data-ttu-id="94a44-186">**テーブルと列** ダイアログ ボックスで、主キー テーブルを設定し、フィールドを`Person`と`PersonID`、および外部キー テーブルを設定し、フィールドを`Department`と`Administrator`です。</span><span class="sxs-lookup"><span data-stu-id="94a44-186">In the **Tables and Columns** dialog box, set the primary key table and field to `Person` and `PersonID`, and set the foreign key table and field to `Department` and `Administrator`.</span></span> <span data-ttu-id="94a44-187">(これを行うと、リレーションシップの名前がから変更`FK_Department_Department`に`FK_Department_Person`)。</span><span class="sxs-lookup"><span data-stu-id="94a44-187">(When you do this, the relationship name will change from `FK_Department_Department` to `FK_Department_Person`.)</span></span>

<span data-ttu-id="94a44-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-188">[![Image82](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image12.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image11.png)</span></span>

<span data-ttu-id="94a44-189">をクリックして**OK**で、**テーブルと列**ボックスで、をクリックして**閉じる**で、 **Foreign Key Relationships**ボックス、および変更を保存します。</span><span class="sxs-lookup"><span data-stu-id="94a44-189">Click **OK** in the **Tables and Columns** box, click **Close** in the **Foreign Key Relationships** box, and save the changes.</span></span> <span data-ttu-id="94a44-190">保存するかどうかを要求している場合、`Person`と`Department`テーブルをクリックして**はい**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-190">If you're asked if you want to save the `Person` and `Department` tables, click **Yes**.</span></span>

> [!NOTE]
> <span data-ttu-id="94a44-191">削除した場合は`Person`は既にデータに対応する行、`Administrator`列で、この変更を保存できません。</span><span class="sxs-lookup"><span data-stu-id="94a44-191">If you've deleted `Person` rows that correspond to data that's already in the `Administrator` column, you will not be able to save this change.</span></span> <span data-ttu-id="94a44-192">その場合は、エディターを使用して、テーブルで**サーバー エクスプ ローラー**ことを確認する、`Administrator`内の値すべて`Department`行にはで実際に存在するレコードの ID が含まれています、`Person`テーブル。</span><span class="sxs-lookup"><span data-stu-id="94a44-192">In that case, use the table editor in **Server Explorer** to make sure that the `Administrator` value in every `Department` row contains the ID of a record that actually exists in the `Person` table.</span></span>
> 
> <span data-ttu-id="94a44-193">行を削除できませんする変更を保存した後、`Person`表にその人が部門の管理者である場合。</span><span class="sxs-lookup"><span data-stu-id="94a44-193">After you save the change, you will not be able to delete a row from the `Person` table if that person is a department administrator.</span></span> <span data-ttu-id="94a44-194">データベースの制約により、削除、またはカスケード delete を指定する場合、実稼働アプリケーションで特定のエラー メッセージが提供します。</span><span class="sxs-lookup"><span data-stu-id="94a44-194">In a production application, you would provide a specific error message when a database constraint prevents a deletion, or you would specify a cascading delete.</span></span> <span data-ttu-id="94a44-195">連鎖削除を指定する方法の例は、次を参照してください。 [Entity Framework と ASP.NET – の取得開始第 2 部](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-195">For an example of how to specify a cascading delete, see [The Entity Framework and ASP.NET – Getting Started Part 2](../getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-2.md).</span></span>


### <a name="adding-a-view-to-the-database"></a><span data-ttu-id="94a44-196">データベースにビューの追加</span><span class="sxs-lookup"><span data-stu-id="94a44-196">Adding a View to the Database</span></span>

<span data-ttu-id="94a44-197">新しい*Departments.aspx*部門の管理者をユーザーが選択できるように、「姓、名」の形式で名前を持つ講習においてインストラクターのドロップダウン リストを指定する場合を作成する ページで、します。</span><span class="sxs-lookup"><span data-stu-id="94a44-197">In the new *Departments.aspx* page that you will be creating, you want to provide a drop-down list of instructors, with names in "last, first" format so that users can select department administrators.</span></span> <span data-ttu-id="94a44-198">やすくを行うには、データベースのビューが作成されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-198">To make it easier to do that, you will create a view in the database.</span></span> <span data-ttu-id="94a44-199">ビューは、ドロップダウン リストで必要なデータだけで構成されます。 (適切な形式)、完全な名前と、レコードのキー。</span><span class="sxs-lookup"><span data-stu-id="94a44-199">The view will consist of just the data needed by the drop-down list: the full name (properly formatted) and the record key.</span></span>

<span data-ttu-id="94a44-200">**サーバー エクスプ ローラー**、展開*School.mdf*を右クリックし、**ビュー**フォルダー、および選択**新しいビューの追加**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-200">In **Server Explorer**, expand *School.mdf*, right-click the **Views** folder, and select **Add New View**.</span></span>

<span data-ttu-id="94a44-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-201">[![Image06](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image14.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image13.png)</span></span>

<span data-ttu-id="94a44-202">をクリックして**閉じる**ときに、**テーブルの追加** ダイアログ ボックスが表示され、SQL ペインに次の SQL ステートメントを貼り付けます。</span><span class="sxs-lookup"><span data-stu-id="94a44-202">Click **Close** when the **Add Table** dialog box appears, and paste the following SQL statement into the SQL pane:</span></span>

[!code-sql[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample1.sql)]

<span data-ttu-id="94a44-203">してビューを保存`vInstructorName`です。</span><span class="sxs-lookup"><span data-stu-id="94a44-203">Save the view as `vInstructorName`.</span></span>

### <a name="updating-the-data-model"></a><span data-ttu-id="94a44-204">データ モデルを更新します。</span><span class="sxs-lookup"><span data-stu-id="94a44-204">Updating the Data Model</span></span>

<span data-ttu-id="94a44-205">*DAL*フォルダーを開き、 *SchoolModel.edmx*ファイル、デザイン サーフェイスを右クリックし **データベースからモデルを更新**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-205">In the *DAL* folder, open the *SchoolModel.edmx* file, right-click the design surface, and select **Update Model from Database**.</span></span>

<span data-ttu-id="94a44-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-206">[![Image07](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image16.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image15.png)</span></span>

<span data-ttu-id="94a44-207">**データベース オブジェクトの選択**ダイアログ ボックスで、**追加** タブを作成したビューを選択します。</span><span class="sxs-lookup"><span data-stu-id="94a44-207">In the **Choose Your Database Objects** dialog box, select the **Add** tab and select the view you just created.</span></span>

<span data-ttu-id="94a44-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-208">[![Image08](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image18.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image17.png)</span></span>

<span data-ttu-id="94a44-209">**[完了]**をクリックします。</span><span class="sxs-lookup"><span data-stu-id="94a44-209">Click **Finish**.</span></span>

<span data-ttu-id="94a44-210">ツールが作成されたことが表示されて、デザイナーで、`vInstructorName`エンティティとの関連付けを新しく、`Department`と`Person`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="94a44-210">In the designer, you see that the tool created a `vInstructorName` entity and a new association between the `Department` and `Person` entities.</span></span>

<span data-ttu-id="94a44-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-211">[![Image13](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image20.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image19.png)</span></span>

> [!NOTE]
> <span data-ttu-id="94a44-212">**出力**と**エラー一覧**ツールが、プライマリを自動的に作成されたことを通知する警告メッセージが表示される windows の新しいキーの`vInstructorName`ビュー。</span><span class="sxs-lookup"><span data-stu-id="94a44-212">In the **Output** and **Error List** windows you might see a warning message informing you that the tool automatically created a primary key for the new `vInstructorName` view.</span></span> <span data-ttu-id="94a44-213">これは通常の動作です。</span><span class="sxs-lookup"><span data-stu-id="94a44-213">This is expected behavior.</span></span>


<span data-ttu-id="94a44-214">新しいを参照するとき`vInstructorName`コードのエンティティ、たくないに小文字"v"を付けることのデータベースの規則を使用します。</span><span class="sxs-lookup"><span data-stu-id="94a44-214">When you refer to the new `vInstructorName` entity in code, you don't want to use the database convention of prefixing a lower-case "v" to it.</span></span> <span data-ttu-id="94a44-215">そのため、エンティティと、モデル内のエンティティ セットを変更するされます。</span><span class="sxs-lookup"><span data-stu-id="94a44-215">Therefore, you will rename the entity and entity set in the model.</span></span>

<span data-ttu-id="94a44-216">開く、**モデル ブラウザー**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-216">Open the **Model Browser**.</span></span> <span data-ttu-id="94a44-217">表示`vInstructorName`エンティティ型と、ビューとして一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="94a44-217">You see `vInstructorName` listed as an entity type and a view.</span></span>

<span data-ttu-id="94a44-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-218">[![Image14](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image22.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image21.png)</span></span>

<span data-ttu-id="94a44-219">下にある**SchoolModel** (いない**SchoolModel.Store**) を右クリックして**vInstructorName**選択と**プロパティ**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-219">Under **SchoolModel** (not **SchoolModel.Store**), right-click **vInstructorName** and select **Properties**.</span></span> <span data-ttu-id="94a44-220">**プロパティ**ウィンドウで、変更、**名前**"InstructorName"および変更するプロパティ、**エンティティ セット名**プロパティを"InstructorNames"です。</span><span class="sxs-lookup"><span data-stu-id="94a44-220">In the **Properties** window, change the **Name** property to "InstructorName" and change the **Entity Set Name** property to "InstructorNames".</span></span>

<span data-ttu-id="94a44-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-221">[![Image15](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image24.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image23.png)</span></span>

<span data-ttu-id="94a44-222">保存と、データ モデルを終了し、プロジェクトをリビルドします。</span><span class="sxs-lookup"><span data-stu-id="94a44-222">Save and close the data model, and then rebuild the project.</span></span>

## <a name="using-a-repository-class-and-an-objectdatasource-control"></a><span data-ttu-id="94a44-223">リポジトリのクラスと、ObjectDataSource コントロールを使用してください。</span><span class="sxs-lookup"><span data-stu-id="94a44-223">Using a Repository Class and an ObjectDataSource Control</span></span>

<span data-ttu-id="94a44-224">新しいクラス ファイルを作成、 *DAL*フォルダーで、名前を付けます*SchoolRepository.cs*、し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="94a44-224">Create a new class file in the *DAL* folder, name it *SchoolRepository.cs*, and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample2.cs)]

<span data-ttu-id="94a44-225">このコードは、1 つ`GetDepartments`内のエンティティのすべてを返すメソッド、`Departments`エンティティ セット。</span><span class="sxs-lookup"><span data-stu-id="94a44-225">This code provides a single `GetDepartments` method that returns all of the entities in the `Departments` entity set.</span></span> <span data-ttu-id="94a44-226">アクセスすることがわかっているため、`Person`行ごとにナビゲーション プロパティが返されますを指定する一括を使用してそのプロパティの読み込み、`Include`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-226">Because you know that you will be accessing the `Person` navigation property for every row returned, you specify eager loading for that property by using the `Include` method.</span></span> <span data-ttu-id="94a44-227">クラスを実装しても、`IDisposable`インターフェイスをオブジェクトが破棄されるときに、データベース接続が解放されることを確認します。</span><span class="sxs-lookup"><span data-stu-id="94a44-227">The class also implements the `IDisposable` interface to ensure that the database connection is released when the object is disposed.</span></span>

> [!NOTE]
> <span data-ttu-id="94a44-228">一般的では、各エンティティ タイプのリポジトリ クラスを作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-228">A common practice is to create a repository class for each entity type.</span></span> <span data-ttu-id="94a44-229">このチュートリアルでは、複数のエンティティ型の 1 つのリポジトリ クラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="94a44-229">In this tutorial, one repository class for multiple entity types is used.</span></span> <span data-ttu-id="94a44-230">リポジトリ パターンの詳細については、内の投稿を参照してください。 [Entity Framework チームのブログ](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx)と[Julie Lerman ブログ](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/)です。</span><span class="sxs-lookup"><span data-stu-id="94a44-230">For more information about the repository pattern, see the posts in [the Entity Framework team's blog](https://blogs.msdn.com/b/adonet/archive/2009/06/16/using-repository-and-unit-of-work-patterns-with-entity-framework-4-0.aspx) and [Julie Lerman's blog](http://thedatafarm.com/blog/data-access/agile-ef4-repository-part-3-fine-tuning-the-repository/).</span></span>


<span data-ttu-id="94a44-231">`GetDepartments`メソッドを返します、`IEnumerable`オブジェクトではなく、`IQueryable`リポジトリ オブジェクト自体が破棄された後でも、返されるコレクションが使用可能なことを確認するためにオブジェクト。</span><span class="sxs-lookup"><span data-stu-id="94a44-231">The `GetDepartments` method returns an `IEnumerable` object rather than an `IQueryable` object in order to ensure that the returned collection is usable even after the repository object itself is disposed.</span></span> <span data-ttu-id="94a44-232">`IQueryable`オブジェクトが、アクセスされるときに、データ バインディング コントロールのデータをレンダリングしようとしました。 時間によって、リポジトリ オブジェクトを破棄する場合がありますにデータベースへのアクセス可能性があります。</span><span class="sxs-lookup"><span data-stu-id="94a44-232">An `IQueryable` object can cause database access whenever it's accessed, but the repository object might be disposed by the time a databound control attempts to render the data.</span></span> <span data-ttu-id="94a44-233">などの他のコレクション型を返す可能性があります、`IList`オブジェクトの代わりに、`IEnumerable`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="94a44-233">You could return another collection type, such as an `IList` object instead of an `IEnumerable` object.</span></span> <span data-ttu-id="94a44-234">ただしを返す、`IEnumerable`オブジェクトにより、処理タスクの標準的な読み取り専用のリストをなど、実行できる`foreach`ループと LINQ クエリことはできません追加または削除するアイテム、コレクションは、このような変更であることを示唆内データベースに保存されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-234">However, returning an `IEnumerable` object ensures that you can perform typical read-only list processing tasks such as `foreach` loops and LINQ queries, but you cannot add to or remove items in the collection, which might imply that such changes would be persisted to the database.</span></span>

<span data-ttu-id="94a44-235">作成、 *Departments.aspx*を使用するページ、 *Site.Master*マスター ページとでは、次のマークアップを追加、`Content`という名前のコントロール`Content2`:</span><span class="sxs-lookup"><span data-stu-id="94a44-235">Create a *Departments.aspx* page that uses the *Site.Master* master page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample3.aspx)]

<span data-ttu-id="94a44-236">このマークアップを作成、 `ObjectDataSource` 、作成したリポジトリ クラスを使用するコントロールと`GridView`コントロールにデータを表示します。</span><span class="sxs-lookup"><span data-stu-id="94a44-236">This markup creates an `ObjectDataSource` control that uses the repository class you just created, and a `GridView` control to display the data.</span></span> <span data-ttu-id="94a44-237">`GridView`コントロールを指定**編集**と**削除**コマンドですが、まだそれらをサポートするためのコードが追加されていません。</span><span class="sxs-lookup"><span data-stu-id="94a44-237">The `GridView` control specifies **Edit** and **Delete** commands, but you haven't added code to support them yet.</span></span>

<span data-ttu-id="94a44-238">複数の列を使用して`DynamicField`自動のデータの書式設定と検証の機能の利用を制御します。</span><span class="sxs-lookup"><span data-stu-id="94a44-238">Several columns use `DynamicField` controls so that you can take advantage of automatic data formatting and validation functionality.</span></span> <span data-ttu-id="94a44-239">呼び出す必要があるこれらの場合、`EnableDynamicData`メソッドで、`Page_Init`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="94a44-239">For these to work, you will have to call the `EnableDynamicData` method in the `Page_Init` event handler.</span></span> <span data-ttu-id="94a44-240">(`DynamicControl`でコントロールが使用されていない、`Administrator`ナビゲーションのプロパティを使用しないためにのフィールドです)。</span><span class="sxs-lookup"><span data-stu-id="94a44-240">(`DynamicControl` controls are not used in the `Administrator` field because they don't work with navigation properties.)</span></span>

<span data-ttu-id="94a44-241">`Vertical-Align="Top"`属性重要になる後では、入れ子になった列を追加するときに`GridView`コントロールはグリッドにします。</span><span class="sxs-lookup"><span data-stu-id="94a44-241">The `Vertical-Align="Top"` attributes will become important later when you add a column that has a nested `GridView` control to the grid.</span></span>

<span data-ttu-id="94a44-242">開く、 *Departments.aspx.cs*ファイルし、次の追加`using`ステートメント。</span><span class="sxs-lookup"><span data-stu-id="94a44-242">Open the *Departments.aspx.cs* file and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample4.cs)]

<span data-ttu-id="94a44-243">次のハンドラーを追加、ページの`Init`イベント。</span><span class="sxs-lookup"><span data-stu-id="94a44-243">Then add the following handler for the page's `Init` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample5.cs)]

<span data-ttu-id="94a44-244">*DAL*フォルダー、という名前の新しいクラス ファイルを作成する*Department.cs*し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="94a44-244">In the *DAL* folder, create a new class file named *Department.cs* and replace the existing code with the following code:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample6.cs)]

<span data-ttu-id="94a44-245">このコードは、データ モデルにメタデータを追加します。</span><span class="sxs-lookup"><span data-stu-id="94a44-245">This code adds metadata to the data model.</span></span> <span data-ttu-id="94a44-246">指定する、`Budget`のプロパティ、`Department`エンティティは、そのデータ型が実際には通貨を表す`Decimal`であり、値は 0 ~ $1,000,000.00 間ありますを指定します。</span><span class="sxs-lookup"><span data-stu-id="94a44-246">It specifies that the `Budget` property of the `Department` entity actually represents currency although its data type is `Decimal`, and it specifies that the value must be between 0 and $1,000,000.00.</span></span> <span data-ttu-id="94a44-247">指定する、`StartDate`プロパティ形式年/月/日の日付として書式設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="94a44-247">It also specifies that the `StartDate` property should be formatted as a date in the format mm/dd/yyyy.</span></span>

<span data-ttu-id="94a44-248">実行、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-248">Run the *Departments.aspx* page.</span></span>

<span data-ttu-id="94a44-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-249">[![Image01](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image26.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image25.png)</span></span>

<span data-ttu-id="94a44-250">書式指定文字列を指定しなかったことに注意して、 *Departments.aspx*ページ マークアップを**予算**または**Start Date**列、既定の通貨、日付書式設定が適用されたことによって、`DynamicField`をコントロールに提供されているメタデータを使用して、 *Department.cs*ファイル。</span><span class="sxs-lookup"><span data-stu-id="94a44-250">Notice that although you did not specify a format string in the *Departments.aspx* page markup for the **Budget** or **Start Date** columns, default currency and date formatting has been applied to them by the `DynamicField` controls, using the metadata that you supplied in the *Department.cs* file.</span></span>

## <a name="adding-insert-and-delete-functionality"></a><span data-ttu-id="94a44-251">追加の Insert と Delete の機能</span><span class="sxs-lookup"><span data-stu-id="94a44-251">Adding Insert and Delete Functionality</span></span>

<span data-ttu-id="94a44-252">開いている*SchoolRepository.cs*、作成するために次のコードを追加、`Insert`メソッドおよび`Delete`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-252">Open *SchoolRepository.cs*, add the following code in order to create an `Insert` method and a `Delete` method.</span></span> <span data-ttu-id="94a44-253">コードは、という名前のメソッドも含まれています。`GenerateDepartmentID`で使用するための次の使用可能なレコード キー値を計算する、`Insert`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-253">The code also includes a method named `GenerateDepartmentID` that calculates the next available record key value for use by the `Insert` method.</span></span> <span data-ttu-id="94a44-254">これは、これを自動的に計算する、データベースが構成されていないために必要な`Department`テーブル。</span><span class="sxs-lookup"><span data-stu-id="94a44-254">This is required because the database is not configured to calculate this automatically for the `Department` table.</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample7.cs)]

### <a name="the-attach-method"></a><span data-ttu-id="94a44-255">アタッチする方法</span><span class="sxs-lookup"><span data-stu-id="94a44-255">The Attach Method</span></span>

<span data-ttu-id="94a44-256">`DeleteDepartment`メソッドの呼び出し、`Attach`メソッド、オブジェクト コンテキストのオブジェクト状態マネージャー メモリ内のエンティティとデータベース間で保持されているリンクを再確立するために、行を表します。</span><span class="sxs-lookup"><span data-stu-id="94a44-256">The `DeleteDepartment` method calls the `Attach` method in order to re-establish the link that's maintained in the object context's object state manager between the entity in memory and the database row it represents.</span></span> <span data-ttu-id="94a44-257">これは、メソッドの呼び出しの前に発生する必要があります、`SaveChanges`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-257">This must occur before the method calls the `SaveChanges` method.</span></span>

<span data-ttu-id="94a44-258">用語*オブジェクト コンテキスト*から派生した Entity Framework クラスを参照、`ObjectContext`エンティティ セットおよびエンティティへのアクセスに使用するクラスです。</span><span class="sxs-lookup"><span data-stu-id="94a44-258">The term *object context* refers to the Entity Framework class that derives from the `ObjectContext` class that you use to access your entity sets and entities.</span></span> <span data-ttu-id="94a44-259">クラスの名前は、このプロジェクトのコードで`SchoolEntities`でそのインスタンスの名前が常に`context`です。</span><span class="sxs-lookup"><span data-stu-id="94a44-259">In the code for this project, the class is named `SchoolEntities`, and an instance of it is always named `context`.</span></span> <span data-ttu-id="94a44-260">オブジェクト コンテキストの*オブジェクト状態マネージャー*から派生したクラスには、`ObjectStateManager`クラスです。</span><span class="sxs-lookup"><span data-stu-id="94a44-260">The object context's *object state manager* is a class that derives from the `ObjectStateManager` class.</span></span> <span data-ttu-id="94a44-261">オブジェクトの連絡先は、エンティティ オブジェクトを格納して、それぞれが、対応するテーブルの行またはデータベース内の行と同期するかどうかを追跡するオブジェクト状態マネージャーを使用します。</span><span class="sxs-lookup"><span data-stu-id="94a44-261">The object contact uses the object state manager to store entity objects and to keep track of whether each one is in sync with its corresponding table row or rows in the database.</span></span>

<span data-ttu-id="94a44-262">エンティティを読み取るときにオブジェクト コンテキストはオブジェクト状態マネージャーに格納し、そのオブジェクトの表現は、データベースと同期されているかどうかの追跡します。</span><span class="sxs-lookup"><span data-stu-id="94a44-262">When you read an entity, the object context stores it in the object state manager and keeps track of whether that representation of the object is in sync with the database.</span></span> <span data-ttu-id="94a44-263">たとえば、プロパティ値を変更する場合はフラグがプロパティを変更するが、データベースとの同期が不要になったことを示す設定します。</span><span class="sxs-lookup"><span data-stu-id="94a44-263">For example, if you change a property value, a flag is set to indicate that the property you changed is no longer in sync with the database.</span></span> <span data-ttu-id="94a44-264">その後呼び出す、`SaveChanges`メソッド、オブジェクト コンテキストでは、オブジェクトの状態マネージャーは、エンティティの現在の状態と、データベースの状態の間で相違点は正確に認識しているため、データベースを認識しています。</span><span class="sxs-lookup"><span data-stu-id="94a44-264">Then when you call the `SaveChanges` method, the object context knows what to do in the database because the object state manager knows exactly what's different between the current state of the entity and the state of the database.</span></span>

<span data-ttu-id="94a44-265">ただし、このプロセス通常機能しません、web アプリケーションで、ページが表示されたら、と共にそのオブジェクトの状態マネージャー内のすべてのエンティティの読み取りオブジェクト コンテキストのインスタンスが破棄されるためです。</span><span class="sxs-lookup"><span data-stu-id="94a44-265">However, this process typically does not work in a web application, because the object context instance that reads an entity, along with everything in its object state manager, is disposed after a page is rendered.</span></span> <span data-ttu-id="94a44-266">変更を適用する必要がありますオブジェクト コンテキストのインスタンスは、新しいポストバック処理のためにインスタンス化されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-266">The object context instance that must apply changes is a new one that's instantiated for postback processing.</span></span> <span data-ttu-id="94a44-267">場合、 `DeleteDepartment` 、メソッド、`ObjectDataSource`コントロール再する自動的に作成されたエンティティの元のバージョンをビュー ステートの値からが再作成これ`Department`オブジェクト状態マネージャーにエンティティが存在しません。</span><span class="sxs-lookup"><span data-stu-id="94a44-267">In the case of the `DeleteDepartment` method, the `ObjectDataSource` control re-creates the original version of the entity for you from values in view state, but this re-created `Department` entity does not exist in the object state manager.</span></span> <span data-ttu-id="94a44-268">呼び出した場合、`DeleteObject`再作成このエンティティに対するメソッドの呼び出しは失敗オブジェクト コンテキストは、エンティティがデータベースと同期するかどうかを把握していないためです。</span><span class="sxs-lookup"><span data-stu-id="94a44-268">If you called the `DeleteObject` method on this re-created entity, the call would fail because the object context does not know whether the entity is in sync with the database.</span></span> <span data-ttu-id="94a44-269">ただし、呼び出し、`Attach`メソッドでは、データベース エンティティがオブジェクト コンテキストの以前のインスタンスで読み取られたときに自動的に行われた最初に、再作成されたエンティティと値の間で同じトラッキングを再確立します。</span><span class="sxs-lookup"><span data-stu-id="94a44-269">However, calling the `Attach` method re-establishes the same tracking between the re-created entity and the values in the database that was originally done automatically when the entity was read in an earlier instance of the object context.</span></span>

<span data-ttu-id="94a44-270">オブジェクトの状態マネージャー内のエンティティを追跡するためにオブジェクト コンテキストをしたくないし、これを行うようにするためのフラグを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="94a44-270">There are times when you don't want the object context to track entities in the object state manager, and you can set flags to prevent it from doing that.</span></span> <span data-ttu-id="94a44-271">この例は、このシリーズの後のチュートリアルに表示されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-271">Examples of this are shown in later tutorials in this series.</span></span>

### <a name="the-savechanges-method"></a><span data-ttu-id="94a44-272">SaveChanges メソッド</span><span class="sxs-lookup"><span data-stu-id="94a44-272">The SaveChanges Method</span></span>

<span data-ttu-id="94a44-273">この単純なリポジトリ クラスは、CRUD 操作を実行する方法の基本原則を示しています。</span><span class="sxs-lookup"><span data-stu-id="94a44-273">This simple repository class illustrates basic principles of how to perform CRUD operations.</span></span> <span data-ttu-id="94a44-274">この例では、`SaveChanges`メソッドは、各更新プログラムの直後に呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-274">In this example, the `SaveChanges` method is called immediately after each update.</span></span> <span data-ttu-id="94a44-275">実稼働アプリケーションでを呼び出したい場合があります、`SaveChanges`データベースが更新されたときより詳細に制御することを別個のメソッドからのメソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-275">In a production application you might want to call the `SaveChanges` method from a separate method to give you more control over when the database is updated.</span></span> <span data-ttu-id="94a44-276">(次のチュートリアルの最後に関連する更新プログラムを調整する方法の 1 つである作業パターンの単位に記載されているホワイト ペーパーへのリンクが検索されます)。注意しても、例では、`DeleteDepartment`メソッドに同時実行の競合を処理するためのコードが含まれていない; このシリーズの後のチュートリアルを行うにはコードは追加されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-276">(At the end of the next tutorial you will find a link to a white paper that discusses the unit of work pattern which is one approach to coordinating related updates.) Notice also that in the example, the `DeleteDepartment` method does not include code for handling concurrency conflicts; code to do that will be added in a later tutorial in this series.</span></span>

### <a name="retrieving-instructor-names-to-select-when-inserting"></a><span data-ttu-id="94a44-277">挿入するときに選択するインストラクターの名前を取得します。</span><span class="sxs-lookup"><span data-stu-id="94a44-277">Retrieving Instructor Names to Select When Inserting</span></span>

<span data-ttu-id="94a44-278">ユーザーは、新しい部門を作成するときに、講習においてインストラクターにドロップダウン リストの一覧から管理者を選択できる必要があります。</span><span class="sxs-lookup"><span data-stu-id="94a44-278">Users must be able to select an administrator from a list of instructors in a drop-down list when creating new departments.</span></span> <span data-ttu-id="94a44-279">したがって、次のコードを追加*SchoolRepository.cs*講習においてインストラクター先ほど作成したビューを使用しての一覧を取得するメソッドを作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-279">Therefore, add the following code to *SchoolRepository.cs* to create a method to retrieve the list of instructors using the view that you created earlier:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample8.cs)]

### <a name="creating-a-page-for-inserting-departments"></a><span data-ttu-id="94a44-280">部門を挿入するためページを作成します。</span><span class="sxs-lookup"><span data-stu-id="94a44-280">Creating a Page for Inserting Departments</span></span>

<span data-ttu-id="94a44-281">作成、 *DepartmentsAdd.aspx*を使用するページ、 *Site.Master*ページとでは、次のマークアップを追加、`Content`という名前のコントロール`Content2`:</span><span class="sxs-lookup"><span data-stu-id="94a44-281">Create a *DepartmentsAdd.aspx* page that uses the *Site.Master* page, and add the following markup in the `Content` control named `Content2`:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample9.aspx)]

<span data-ttu-id="94a44-282">このマークアップでは、2 つ作成されます`ObjectDataSource`には、新しいを挿入するための 1`Department`エンティティとインストラクター名を取得する 1 つずつ、`DropDownList`部門の管理者を選択するために使用されるコントロールです。</span><span class="sxs-lookup"><span data-stu-id="94a44-282">This markup creates two `ObjectDataSource` controls, one for inserting new `Department` entities and one for retrieving instructor names for the `DropDownList` control that's used for selecting department administrators.</span></span> <span data-ttu-id="94a44-283">マークアップは、作成、`DetailsView`コントロールのハンドラーを指定する新しい部門を入力用の変更`ItemInserting`イベントを設定できるように、`Administrator`外部キーの値。</span><span class="sxs-lookup"><span data-stu-id="94a44-283">The markup creates a `DetailsView` control for entering new departments, and it specifies a handler for the control's `ItemInserting` event so that you can set the `Administrator` foreign key value.</span></span> <span data-ttu-id="94a44-284">最後には、`ValidationSummary`エラー メッセージを表示するコントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-284">At the end is a `ValidationSummary` control to display error messages.</span></span>

<span data-ttu-id="94a44-285">開いている*DepartmentsAdd.aspx.cs*し、以下の追加`using`ステートメント。</span><span class="sxs-lookup"><span data-stu-id="94a44-285">Open *DepartmentsAdd.aspx.cs* and add the following `using` statement:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample10.cs)]

<span data-ttu-id="94a44-286">次のクラスの変数とメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="94a44-286">Add the following class variable and methods:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample11.cs)]

<span data-ttu-id="94a44-287">`Page_Init`メソッド Dynamic Data 機能を有効にします。</span><span class="sxs-lookup"><span data-stu-id="94a44-287">The `Page_Init` method enables Dynamic Data functionality.</span></span> <span data-ttu-id="94a44-288">ハンドラーを`DropDownList`コントロールの`Init`イベントのハンドラーは、コントロールへの参照を保存する、`DetailsView`コントロールの`Inserting`イベントでは、その参照を使用して、取得、`PersonID`選択した講師と更新プログラムの値`Administrator`の外部キーのプロパティ、`Department`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="94a44-288">The handler for the `DropDownList` control's `Init` event saves a reference to the control, and the handler for the `DetailsView` control's `Inserting` event uses that reference to get the `PersonID` value of the selected instructor and update the `Administrator` foreign key property of the `Department` entity.</span></span>

<span data-ttu-id="94a44-289">ページの実行、新しい部門の情報を追加し、クリックして、**挿入**リンクします。</span><span class="sxs-lookup"><span data-stu-id="94a44-289">Run the page, add information for a new department, and then click the **Insert** link.</span></span>

<span data-ttu-id="94a44-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-290">[![Image04](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image28.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image27.png)</span></span>

<span data-ttu-id="94a44-291">別の新しい部門の値を入力します。</span><span class="sxs-lookup"><span data-stu-id="94a44-291">Enter values for another new department.</span></span> <span data-ttu-id="94a44-292">1,000,000.00 より大きい数値を入力、**予算**フィールドとタブでは、次のフィールドをします。</span><span class="sxs-lookup"><span data-stu-id="94a44-292">Enter a number greater than 1,000,000.00 in the **Budget** field and tab to the next field.</span></span> <span data-ttu-id="94a44-293">フィールドに、アスタリスクが表示され、上にマウス ポインターを保持する場合は、そのフィールドのメタデータで指定したエラー メッセージを表示できます。</span><span class="sxs-lookup"><span data-stu-id="94a44-293">An asterisk appears in the field, and if you hold the mouse pointer over it, you can see the error message that you entered in the metadata for that field.</span></span>

<span data-ttu-id="94a44-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-294">[![Image03](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image30.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image29.png)</span></span>

<span data-ttu-id="94a44-295">をクリックして**挿入**、によって表示されるエラー メッセージを表示して、`ValidationSummary`ページの下部にあるコントロールです。</span><span class="sxs-lookup"><span data-stu-id="94a44-295">Click **Insert**, and you see the error message displayed by the `ValidationSummary` control at the bottom of the page.</span></span>

<span data-ttu-id="94a44-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-296">[![Image12](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image32.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image31.png)</span></span>

<span data-ttu-id="94a44-297">次に、ブラウザーを閉じてから開き、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-297">Next, close the browser and open the *Departments.aspx* page.</span></span> <span data-ttu-id="94a44-298">削除機能を追加、 *Departments.aspx*ページを追加することによって、`DeleteMethod`属性を`ObjectDataSource`コントロール、および`DataKeyNames`属性を`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-298">Add delete capability to the *Departments.aspx* page by adding a `DeleteMethod` attribute to the `ObjectDataSource` control, and a `DataKeyNames` attribute to the `GridView` control.</span></span> <span data-ttu-id="94a44-299">これらのコントロールの開始タグは、次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="94a44-299">The opening tags for these controls will now resemble the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample12.aspx)]

<span data-ttu-id="94a44-300">ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="94a44-300">Run the page.</span></span>

<span data-ttu-id="94a44-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-301">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image34.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image33.png)</span></span>

<span data-ttu-id="94a44-302">削除を実行したときに追加した、部門、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-302">Delete the department you added when you ran the *DepartmentsAdd.aspx* page.</span></span>

## <a name="adding-update-functionality"></a><span data-ttu-id="94a44-303">更新機能を追加します。</span><span class="sxs-lookup"><span data-stu-id="94a44-303">Adding Update Functionality</span></span>

<span data-ttu-id="94a44-304">開いている*SchoolRepository.cs*し、以下の追加`Update`メソッド。</span><span class="sxs-lookup"><span data-stu-id="94a44-304">Open *SchoolRepository.cs* and add the following `Update` method:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample13.cs)]

<span data-ttu-id="94a44-305">クリックすると**更新**で、 *Departments.aspx*  ページで、`ObjectDataSource`コントロールでは、2 つ作成されます`Department`エンティティに渡す、`UpdateDepartment`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-305">When you click **Update** in the *Departments.aspx* page, the `ObjectDataSource` control creates two `Department` entities to pass to the `UpdateDepartment` method.</span></span> <span data-ttu-id="94a44-306">ビュー ステートに格納されている元の値を含む 1 つと、入力した新しい値を含む、他の`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-306">One contains the original values that have been stored in view state, and the other contains the new values that were entered in the `GridView` control.</span></span> <span data-ttu-id="94a44-307">内のコード、`UpdateDepartment`メソッドは、`Department`に元の値を持つエンティティ、`Attach`エンティティと、データベースの間の追跡を確立するためのメソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-307">The code in the `UpdateDepartment` method passes the `Department` entity that has the original values to the `Attach` method in order to establish the tracking between the entity and what's in the database.</span></span> <span data-ttu-id="94a44-308">コードに渡す、`Department`に新しい値を持つエンティティ、`ApplyCurrentValues`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-308">Then the code passes the `Department` entity that has the new values to the `ApplyCurrentValues` method.</span></span> <span data-ttu-id="94a44-309">オブジェクト コンテキストでは、新旧の値を比較します。</span><span class="sxs-lookup"><span data-stu-id="94a44-309">The object context compares the old and new values.</span></span> <span data-ttu-id="94a44-310">新しい値が古い値と異なる場合は、オブジェクト コンテキストは、プロパティ値を変更します。</span><span class="sxs-lookup"><span data-stu-id="94a44-310">If a new value is different from an old value, the object context changes the property value.</span></span> <span data-ttu-id="94a44-311">`SaveChanges`メソッドは、データベースで変更された列のみを更新します。</span><span class="sxs-lookup"><span data-stu-id="94a44-311">The `SaveChanges` method then updates only the changed columns in the database.</span></span> <span data-ttu-id="94a44-312">(ただし、このエンティティの update 関数は、ストアド プロシージャにマップされた場合、行全体が更新されますに関係なく列が変更された。)</span><span class="sxs-lookup"><span data-stu-id="94a44-312">(However, if the update function for this entity were mapped to a stored procedure, the entire row would be updated regardless of which columns were changed.)</span></span>

<span data-ttu-id="94a44-313">開く、 *Departments.aspx*ファイルし、次の属性を追加、`DepartmentsObjectDataSource`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-313">Open the *Departments.aspx* file and add the following attributes to the `DepartmentsObjectDataSource` control:</span></span>

- `UpdateMethod="UpdateDepartment"`
- `ConflictDetection="CompareAllValues"`   
 <span data-ttu-id="94a44-314">この原因が古い値を格納されているビュー内の状態の新しい値を比較できるように、`Update`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="94a44-314">This causes old values to be stored in view state so that they can be compared with the new values in the `Update` method.</span></span>
- `OldValuesParameterFormatString="orig{0}"`   
 <span data-ttu-id="94a44-315">これを元の値パラメーターの名前はコントロールに知らせます`origDepartment`です。</span><span class="sxs-lookup"><span data-stu-id="94a44-315">This informs the control that the name of the original values parameter is `origDepartment` .</span></span>

<span data-ttu-id="94a44-316">開始タグのマークアップ、`ObjectDataSource`コントロール次の例のようになります。</span><span class="sxs-lookup"><span data-stu-id="94a44-316">The markup for the opening tag of the `ObjectDataSource` control now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample14.aspx)]

<span data-ttu-id="94a44-317">追加、`OnRowUpdating="DepartmentsGridView_RowUpdating"`属性を`GridView`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-317">Add an `OnRowUpdating="DepartmentsGridView_RowUpdating"` attribute to the `GridView` control.</span></span> <span data-ttu-id="94a44-318">この設定に使用する、`Administrator`プロパティの値は、ユーザーがドロップダウン リストで選択行に基づきます。</span><span class="sxs-lookup"><span data-stu-id="94a44-318">You will use this to set the `Administrator` property value based on the row the user selects in a drop-down list.</span></span> <span data-ttu-id="94a44-319">`GridView`開始タグを今すぐには、次の例と似ています。</span><span class="sxs-lookup"><span data-stu-id="94a44-319">The `GridView` opening tag now resembles the following example:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample15.aspx)]

<span data-ttu-id="94a44-320">追加、`EditItemTemplate`の制御、`Administrator`列を`GridView`制御直後、`ItemTemplate`その列の制御。</span><span class="sxs-lookup"><span data-stu-id="94a44-320">Add an `EditItemTemplate` control for the `Administrator` column to the `GridView` control, immediately after the `ItemTemplate` control for that column:</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample16.aspx)]

<span data-ttu-id="94a44-321">これは、`EditItemTemplate`コントロールに似ていますが、`InsertItemTemplate`内の制御、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-321">This `EditItemTemplate` control is similar to the `InsertItemTemplate` control in the *DepartmentsAdd.aspx* page.</span></span> <span data-ttu-id="94a44-322">違いを使用して、コントロールの初期値を設定すること、`SelectedValue`属性。</span><span class="sxs-lookup"><span data-stu-id="94a44-322">The difference is that the initial value of the control is set using the `SelectedValue` attribute.</span></span>

<span data-ttu-id="94a44-323">前に、`GridView`コントロールを追加、`ValidationSummary`制御と同じにする、 *DepartmentsAdd.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-323">Before the `GridView` control, add a `ValidationSummary` control as you did in the *DepartmentsAdd.aspx* page.</span></span>

[!code-aspx[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample17.aspx)]

<span data-ttu-id="94a44-324">開いている*Departments.aspx.cs*部分クラス宣言の直後後を参照するプライベート フィールドを作成する次のコードを追加し、`DropDownList`コントロール。</span><span class="sxs-lookup"><span data-stu-id="94a44-324">Open *Departments.aspx.cs* and immediately after the partial-class declaration, add the following code to create a private field to reference the `DropDownList` control:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample18.cs)]

<span data-ttu-id="94a44-325">ハンドラーを追加、`DropDownList`コントロールの`Init`イベントおよび`GridView`コントロールの`RowUpdating`イベント。</span><span class="sxs-lookup"><span data-stu-id="94a44-325">Then add handlers for the `DropDownList` control's `Init` event and the `GridView` control's `RowUpdating` event:</span></span>

[!code-csharp[Main](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/samples/sample19.cs)]

<span data-ttu-id="94a44-326">ハンドラーを`Init`イベントへの参照を保存する、`DropDownList`クラス フィールド内のコントロールです。</span><span class="sxs-lookup"><span data-stu-id="94a44-326">The handler for the `Init` event saves a reference to the `DropDownList` control in the class field.</span></span> <span data-ttu-id="94a44-327">ハンドラーを`RowUpdating`イベントでは、参照を使用して、ユーザーが入力した値を取得し、それを適用を`Administrator`のプロパティ、`Department`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="94a44-327">The handler for the `RowUpdating` event uses the reference to get the value the user entered and apply it to the `Administrator` property of the `Department` entity.</span></span>

<span data-ttu-id="94a44-328">使用して、 *DepartmentsAdd.aspx*新しい部門を追加するページし、実行、 *Departments.aspx*ページし、をクリックして**編集**追加した行にします。</span><span class="sxs-lookup"><span data-stu-id="94a44-328">Use the *DepartmentsAdd.aspx* page to add a new department, then run the *Departments.aspx* page and click **Edit** on the row that you added.</span></span>

> [!NOTE]
> <span data-ttu-id="94a44-329">追加していない行を編集することはできません (つまり、データベース内に既に)、データベースに無効なデータによりデータベースで作成された行の管理者は、受講者です。</span><span class="sxs-lookup"><span data-stu-id="94a44-329">You will not be able to edit rows that you did not add (that is, that were already in the database), because of invalid data in the database; the administrators for the rows that were created with the database are students.</span></span> <span data-ttu-id="94a44-330">これらのいずれかを編集しようとする場合のようなエラーが報告されるエラー ページが表示されます。`'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span><span class="sxs-lookup"><span data-stu-id="94a44-330">If you try to edit one of them, you will get an error page that reports an error like `'InstructorsDropDownList' has a SelectedValue which is invalid because it does not exist in the list of items.`</span></span>


<span data-ttu-id="94a44-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-331">[![Image10](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image36.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image35.png)</span></span>

<span data-ttu-id="94a44-332">場合は、無効な入力**予算**amount し、をクリックして**更新**、同じアスタリスクとで示したエラー メッセージを参照してください、 *Departments.aspx*ページ。</span><span class="sxs-lookup"><span data-stu-id="94a44-332">If you enter an invalid **Budget** amount and then click **Update**, you see the same asterisk and error message that you saw in the *Departments.aspx* page.</span></span>

<span data-ttu-id="94a44-333">フィールド値を変更または別の管理者を選択し、クリックして**更新**です。</span><span class="sxs-lookup"><span data-stu-id="94a44-333">Change a field value or select a different administrator and click **Update**.</span></span> <span data-ttu-id="94a44-334">変更が表示されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-334">The change is displayed.</span></span>

<span data-ttu-id="94a44-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="94a44-335">[![Image09](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image38.png)](using-the-entity-framework-and-the-objectdatasource-control-part-1-getting-started/_static/image37.png)</span></span>

<span data-ttu-id="94a44-336">これで完了使用の概要、`ObjectDataSource`コントロールの基本的な CRUD (作成、読み取り、更新、削除)、Entity Framework での操作です。</span><span class="sxs-lookup"><span data-stu-id="94a44-336">This completes the introduction to using the `ObjectDataSource` control for basic CRUD (create, read, update, delete) operations with the Entity Framework.</span></span> <span data-ttu-id="94a44-337">簡単な n 層アプリケーションを構築しましたが、ビジネス ロジック層は引き続き緊密に自動化された単体テストを複雑になるデータ アクセス層にします。</span><span class="sxs-lookup"><span data-stu-id="94a44-337">You've built a simple n-tier application, but the business-logic layer is still tightly coupled to the data-access layer, which complicates automated unit testing.</span></span> <span data-ttu-id="94a44-338">次のチュートリアルでは、単体テストを容易にするために、リポジトリ パターンを実装する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="94a44-338">In the following tutorial you'll see how to implement the repository pattern to facilitate unit testing.</span></span>

>[!div class="step-by-step"]
[<span data-ttu-id="94a44-339">次へ</span><span class="sxs-lookup"><span data-stu-id="94a44-339">Next</span></span>](using-the-entity-framework-and-the-objectdatasource-control-part-2-adding-a-business-logic-layer-and-unit-tests.md)
