---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
title: ASP.NET の正常性の監視 (c#) によるエラーの詳細をログ記録 |Microsoft ドキュメント
author: rick-anderson
description: Microsoft の正常性の監視システムは、未処理の例外を含むさまざまな、web イベントをログに記録する、簡単かつカスタマイズ可能な方法を提供します。 このチュートリアルでは、ためを使用しています.
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: b1abb452-642a-4ff3-8504-37b85590ff79
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/logging-error-details-with-asp-net-health-monitoring-cs
msc.type: authoredcontent
ms.openlocfilehash: 370f19b36628a9811a31e263e468453897cb7d92
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
---
<a name="logging-error-details-with-aspnet-health-monitoring-c"></a><span data-ttu-id="51fc6-104">ASP.NET の正常性の監視 (c#) によるエラーの詳細をログ記録</span><span class="sxs-lookup"><span data-stu-id="51fc6-104">Logging Error Details with ASP.NET Health Monitoring (C#)</span></span>
====================
<span data-ttu-id="51fc6-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="51fc6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="51fc6-106">[コードをダウンロードする](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="51fc6-106">[Download Code](http://download.microsoft.com/download/1/0/C/10CC829F-A808-4302-97D3-59989B8F9C01/ASPNET_Hosting_Tutorial_13_CS.zip) or [Download PDF](http://download.microsoft.com/download/5/C/5/5C57DB8C-5DEA-4B3A-92CA-4405544D313B/aspnet_tutorial13_HealthMonitoring_cs.pdf)</span></span>

> <span data-ttu-id="51fc6-107">Microsoft の正常性の監視システムは、未処理の例外を含むさまざまな、web イベントをログに記録する、簡単かつカスタマイズ可能な方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-107">Microsoft's health monitoring system provides an easy and customizable way to log various web events, including unhandled exceptions.</span></span> <span data-ttu-id="51fc6-108">このチュートリアルは、未処理の例外をデータベースにログインして、電子メール メッセージを使用して開発者に通知する監視システム正常性の設定手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-108">This tutorial walks through setting up the health monitoring system to log unhandled exceptions to a database and to notify developers via an email message.</span></span>


## <a name="introduction"></a><span data-ttu-id="51fc6-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="51fc6-109">Introduction</span></span>

<span data-ttu-id="51fc6-110">ログは、配置済みのアプリケーションの正常性を監視して発生する可能性がある問題を診断するための便利なツールです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-110">Logging is a useful tool for monitoring the health of a deployed application and for diagnosing any problems that may arise.</span></span> <span data-ttu-id="51fc6-111">これは、問題を解決するように、配置されたアプリケーションで発生したエラーをログに特に重要です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-111">It is especially important to log errors that occur in a deployed application so that they can be remedied.</span></span> <span data-ttu-id="51fc6-112">`Error`イベントは、ASP.NET アプリケーションでハンドルされない例外が発生するたびに、[前のチュートリアル](processing-unhandled-exceptions-cs.md)エラーの開発者に通知し、のイベントハンドラーを作成してその詳細を記録する方法を示しました`Error`イベント。</span><span class="sxs-lookup"><span data-stu-id="51fc6-112">The `Error` event is raised whenever an unhandled exception occurs in an ASP.NET application; the [preceding tutorial](processing-unhandled-exceptions-cs.md) showed how to notify a developer of an error and log its details by creating an event handler for the `Error` event.</span></span> <span data-ttu-id="51fc6-113">ただし、作成、 `Error` ASP では、このタスクを実行できるように、エラーの詳細を記録し、開発者に通知するイベント ハンドラーは必要ありません。NET の*状態監視システム*です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-113">However, creating an `Error` event handler to log the error's details and notify a developer is unnecessary, as this task can be performed by ASP.NET's *health monitoring system*.</span></span>

<span data-ttu-id="51fc6-114">監視システム正常性は、ASP.NET 2.0 で導入されたし、アプリケーションまたは要求の有効期間中に発生するイベントを記録して配置された ASP.NET アプリケーションのヘルスを監視するよう設計されています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-114">The health monitoring system was introduced in ASP.NET 2.0 and is designed to monitor the health of a deployed ASP.NET application by logging events that occur during the application or request's lifetime.</span></span> <span data-ttu-id="51fc6-115">状態監視システムで記録されたイベントをいいます*状態監視イベント*または*イベントを Web*が含まれます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-115">The events logged by the health monitoring system are referred to as *health monitoring events* or *Web events*, and include:</span></span>

- <span data-ttu-id="51fc6-116">アプリケーションが開始または停止などのアプリケーションの有効期間イベント</span><span class="sxs-lookup"><span data-stu-id="51fc6-116">Application lifetime events, such as when an application starts or stops</span></span>
- <span data-ttu-id="51fc6-117">セキュリティ イベントを含むログイン試行が失敗し、URL 承認要求に失敗しました</span><span class="sxs-lookup"><span data-stu-id="51fc6-117">Security events, including failed login attempts and failed URL authorization requests</span></span>
- <span data-ttu-id="51fc6-118">含む、アプリケーション エラー未処理の例外、例外、要求の検証例外、およびその他の種類のエラーの間でのコンパイル エラーを解析ビュー ステート。</span><span class="sxs-lookup"><span data-stu-id="51fc6-118">Application errors, including unhandled exceptions, view state parsing exceptions, request validation exceptions, and compilation errors, among other types of errors.</span></span>

<span data-ttu-id="51fc6-119">状態監視イベントが発生したときに任意の数を記録できます指定*ログ ソース*です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-119">When a health monitoring event is raised it can be logged to any number of specified *log sources*.</span></span> <span data-ttu-id="51fc6-120">状態監視システムは、Web イベントを Windows イベント ログに、またはその他の電子メール メッセージを使用して、Microsoft SQL Server データベースに記録するログ ソースに付属します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-120">The health monitoring system ships with log sources that log Web events to a Microsoft SQL Server database, to the Windows Event Log, or via an email message, among others.</span></span> <span data-ttu-id="51fc6-121">独自のログ ソースを作成することもできます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-121">You can also create your own log sources.</span></span>

<span data-ttu-id="51fc6-122">使用すると、ログ ソースと共に、状態監視システムに記録するイベントが定義されている`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-122">The events the health monitoring system logs, along with the log sources used, are defined in `Web.config`.</span></span> <span data-ttu-id="51fc6-123">構成マークアップの数行では、データベースへすべての未処理の例外のログオンと通知する電子メールを使用して、例外のように監視ヘルスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-123">With a few lines of configuration markup you can use health monitoring to log all unhandled exceptions to a database and to notify you of the exception via email.</span></span>

## <a name="exploring-the-health-monitoring-systems-configuration"></a><span data-ttu-id="51fc6-124">システムの構成の監視の正常性を調べる</span><span class="sxs-lookup"><span data-stu-id="51fc6-124">Exploring the Health Monitoring System's Configuration</span></span>

<span data-ttu-id="51fc6-125">ヘルスの監視システムの動作が内にある、その構成情報によって定義された、 [ `<healthMonitoring>`要素](https://msdn.microsoft.com/library/2fwh2ss9.aspx)で`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-125">The health monitoring system's behavior is defined by its configuration information, which is located in the [`<healthMonitoring>` element](https://msdn.microsoft.com/library/2fwh2ss9.aspx) in `Web.config`.</span></span> <span data-ttu-id="51fc6-126">この構成セクションを定義、特に、情報の次の 3 つの重要な部分。</span><span class="sxs-lookup"><span data-stu-id="51fc6-126">This configuration section defines, among other things, the following three important pieces of information:</span></span>

1. <span data-ttu-id="51fc6-127">正常性イベントを監視するには、記録するか、発生時に</span><span class="sxs-lookup"><span data-stu-id="51fc6-127">The health monitoring events that, when raised, should be logged,</span></span>
2. <span data-ttu-id="51fc6-128">ログのソースと</span><span class="sxs-lookup"><span data-stu-id="51fc6-128">The log sources, and</span></span>
3. <span data-ttu-id="51fc6-129">各状態の監視 (1) で定義されているイベントをログ ソースにマップする方法は、(2) で定義されています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-129">How each health monitoring event defined in (1) is mapped to the log sources defined in (2).</span></span>

<span data-ttu-id="51fc6-130">この情報は 3 つの子の構成要素を指定: [ `<eventMappings>` ](https://msdn.microsoft.com/library/yc5yk01w.aspx)、 [ `<providers>` ](https://msdn.microsoft.com/library/zaa41kz1.aspx)、および[ `<rules>` ](https://msdn.microsoft.com/library/fe5wyxa0.aspx)、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="51fc6-130">This information is specified through three children configuration elements: [`<eventMappings>`](https://msdn.microsoft.com/library/yc5yk01w.aspx), [`<providers>`](https://msdn.microsoft.com/library/zaa41kz1.aspx), and [`<rules>`](https://msdn.microsoft.com/library/fe5wyxa0.aspx), respectively.</span></span>

<span data-ttu-id="51fc6-131">既定正常性監視システムの構成情報は含まれて、`Web.config`ファイル`%WINDIR%\Microsoft.NET\Framework\version\CONFIG`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-131">The default health monitoring system configuration information can be found in the `Web.config` file in `%WINDIR%\Microsoft.NET\Framework\version\CONFIG` folder.</span></span> <span data-ttu-id="51fc6-132">この既定の構成については、いくつかのマークアップを簡略化のため、削除は、次に示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-132">This default configuration information, with some markup removed for brevity, is shown below:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample1.xml)]

<span data-ttu-id="51fc6-133">目的の監視イベントが定義されている正常性、`<eventMappings>`要素は、状態監視イベントのクラスへのわかりやすい名前を提供します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-133">The health monitoring events of interest are defined in the `<eventMappings>` element, which gives a human-friendly name to a class of health monitoring events.</span></span> <span data-ttu-id="51fc6-134">上記のマークアップで、`<eventMappings>`要素は、正常性の種類のイベントを監視する「すべてのエラー」わかりやすい名前を割り当てます`WebBaseErrorEvent`と、名前「失敗の監査」状態の種類のイベントを監視する`WebFailureAuditEvent`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-134">In the markup above, the `<eventMappings>` element assigns the human-friendly name "All Errors" to the health monitoring events of type `WebBaseErrorEvent` and the name "Failure Audits" to health monitoring events of type `WebFailureAuditEvent`.</span></span>

<span data-ttu-id="51fc6-135">`<providers>`要素はわかりやすい名前を与えることと、ログのソースに固有の構成情報を指定する、ログ ソースを定義します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-135">The `<providers>` element defines the log sources, giving them a human-friendly name and specifying any log source-specific configuration information.</span></span> <span data-ttu-id="51fc6-136">最初の`<add>`要素は、"EventLogProvider"プロバイダー、指定の状態の監視を使用してイベントをログに記録を定義、`EventLogWebEventProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-136">The first `<add>` element defines the "EventLogProvider" provider, which logs the specified health monitoring events using the `EventLogWebEventProvider` class.</span></span> <span data-ttu-id="51fc6-137">`EventLogWebEventProvider`クラスにより、イベントが Windows イベント ログに記録します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-137">The `EventLogWebEventProvider` class logs the event to the Windows Event Log.</span></span> <span data-ttu-id="51fc6-138">2 番目`<add>`要素は、"SqlWebEventProvider"プロバイダー経由で Microsoft SQL Server データベースにイベントをログに記録する、定義、`SqlWebEventProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-138">The second `<add>` element defines the "SqlWebEventProvider" provider, which logs events to a Microsoft SQL Server database via the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="51fc6-139">"SqlWebEventProvider"構成データベースの接続文字列を指定します (`connectionStringName`) 間での他の構成オプション。</span><span class="sxs-lookup"><span data-stu-id="51fc6-139">The "SqlWebEventProvider" configuration specifies the database's connection string (`connectionStringName`) among other configuration options.</span></span>

<span data-ttu-id="51fc6-140">`<rules>`要素で指定されたイベントをマップする、`<eventMappings>`ソースのログインに要素、`<providers>`要素。</span><span class="sxs-lookup"><span data-stu-id="51fc6-140">The `<rules>` element maps the events specified in the `<eventMappings>` element to log sources in the `<providers>` element.</span></span> <span data-ttu-id="51fc6-141">既定では、ASP.NET web アプリケーションはハンドルされない例外がすべてのログし、Windows イベント ログに失敗します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-141">By default, ASP.NET web applications log all unhandled exceptions and audit failures to the Windows Event Log.</span></span>

## <a name="logging-events-to-a-database"></a><span data-ttu-id="51fc6-142">データベースにイベントを記録</span><span class="sxs-lookup"><span data-stu-id="51fc6-142">Logging Events to a Database</span></span>

<span data-ttu-id="51fc6-143">追加することで web アプリケーション、web、アプリケーションごとにヘルスの監視システムの既定の構成をカスタマイズすることができます、`<healthMonitoring>`セクションをアプリケーションの`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="51fc6-143">The health monitoring system's default configuration can be customized on a web application-by-web application basis by adding a `<healthMonitoring>` section to the application's `Web.config` file.</span></span> <span data-ttu-id="51fc6-144">内の追加要素を含めることができます、 `<eventMappings>`、 `<providers>`、および`<rules>`セクションを使用して、`<add>`要素。</span><span class="sxs-lookup"><span data-stu-id="51fc6-144">You can include additional elements in the `<eventMappings>`, `<providers>`, and `<rules>` sections by using the `<add>` element.</span></span> <span data-ttu-id="51fc6-145">既定の構成を使用してから、設定を削除する、`<remove>`要素、または使用`<clear />`からこれらのセクションのいずれかのすべての既定値を削除します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-145">To remove a setting from the default configuration use the `<remove>` element, or use `<clear />` to remove all default values from one of these sections.</span></span> <span data-ttu-id="51fc6-146">使用して Microsoft SQL Server データベースにすべての未処理の例外の記録に書評 web アプリケーションを構成しましょう、`SqlWebEventProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-146">Let's configure the Book Reviews web application to log all unhandled exceptions to a Microsoft SQL Server database using the `SqlWebEventProvider` class.</span></span>

<span data-ttu-id="51fc6-147">`SqlWebEventProvider`クラスは、状態監視システムの一部であるし、性を監視する指定された SQL Server データベースにイベントをログに記録します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-147">The `SqlWebEventProvider` class is part of the health monitoring system and logs a health monitoring event to a specified SQL Server database.</span></span> <span data-ttu-id="51fc6-148">`SqlWebEventProvider`クラスでは、指定されたデータベースがという名前のストアド プロシージャが含まれることが必要ですが`aspnet_WebEvent_LogEvent`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-148">The `SqlWebEventProvider` class expects that the specified database includes a stored procedure named `aspnet_WebEvent_LogEvent`.</span></span> <span data-ttu-id="51fc6-149">このストアド プロシージャは、イベントの詳細が渡され、イベントの詳細を格納するよう課された場合は。</span><span class="sxs-lookup"><span data-stu-id="51fc6-149">This stored procedure is passed the details of the event and is tasked with storing the event details.</span></span> <span data-ttu-id="51fc6-150">良いニュースは、このストアド プロシージャを作成する必要はありませんプロシージャもイベントの詳細を格納するテーブル。</span><span class="sxs-lookup"><span data-stu-id="51fc6-150">The good news is that you do not need to create this stored procedure nor the table to store the event details.</span></span> <span data-ttu-id="51fc6-151">これらのオブジェクトを追加するには、データベースを使用する、`aspnet_regsql.exe`ツールです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-151">You can add these objects to your database using the `aspnet_regsql.exe` tool.</span></span>

> [!NOTE]
> <span data-ttu-id="51fc6-152">`aspnet_regsql.exe`ツールは、バックアップで説明した、 [*サービスの構成、web サイトを使用してアプリケーション*チュートリアル](configuring-a-website-that-uses-application-services-cs.md)ASP のサポートを追加するとき。NET のアプリケーションのサービスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-152">The `aspnet_regsql.exe` tool was discussed back in the [*Configuring a Website That Uses Application Services* tutorial](configuring-a-website-that-uses-application-services-cs.md) when we added support for ASP.NET's application services.</span></span> <span data-ttu-id="51fc6-153">書評 web サイトのデータベースが既に存在する、その結果、`aspnet_WebEvent_LogEvent`ストアド プロシージャをという名前のテーブルにイベント情報を格納する`aspnet_WebEvent_Events`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-153">Consequently, the Book Reviews website's database already contains the `aspnet_WebEvent_LogEvent` stored procedure, which stores the event information into a table named `aspnet_WebEvent_Events`.</span></span>


<span data-ttu-id="51fc6-154">必要なストアド プロシージャと、データベースに追加されたテーブルを作成したら、すべては状態、データベースにすべての未処理の例外をログ記録を監視するように指示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-154">Once you have the necessary stored procedure and table added to your database, all that remains is to instruct health monitoring to log all unhandled exceptions to the database.</span></span> <span data-ttu-id="51fc6-155">これを web サイトの次のマークアップを追加することで実現`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="51fc6-155">Accomplish this by adding the following markup to your website's `Web.config` file:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample2.xml)]

<span data-ttu-id="51fc6-156">状態監視の使用上の構成のマークアップ`<clear />`ワイプする定義済みの状態から構成情報を監視する要素、 `<eventMappings>`、 `<providers>`、および`<rules>`セクション。</span><span class="sxs-lookup"><span data-stu-id="51fc6-156">The health monitoring configuration markup above uses `<clear />` elements to wipe the pre-defined health monitoring configuration information from the `<eventMappings>`, `<providers>`, and `<rules>` sections.</span></span> <span data-ttu-id="51fc6-157">これらのセクションのそれぞれに 1 つのエントリを追加します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-157">It then adds a single entry to each of these sections.</span></span>

- <span data-ttu-id="51fc6-158">`<eventMappings>`要素は 1 つ性を監視する目的はハンドルされない例外が発生するたびに発生「すべてエラー」という名前のイベントを定義します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-158">The `<eventMappings>` element defines a single health monitoring event of interest named "All Errors", which is raised whenever an unhandled exception occurs.</span></span>
- <span data-ttu-id="51fc6-159">`<providers>`要素を使用して"SqlWebEventProvider"という名前の 1 つのログ ソースを定義、`SqlWebEventProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-159">The `<providers>` element defines a single log source named "SqlWebEventProvider" that uses the `SqlWebEventProvider` class.</span></span> <span data-ttu-id="51fc6-160">`connectionStringName` "ReviewsConnectionString"は、接続の名前を指定する属性が設定された文字列で定義されている、`<connectionStrings>`セクションです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-160">The `connectionStringName` attribute has been set to "ReviewsConnectionString", which is the name of our connection string defined in the `<connectionStrings>` section.</span></span>
- <span data-ttu-id="51fc6-161">最後に、&lt;ルール&gt;要素は、「すべてのエラー」イベントが発生する場合にログ記録すること"SqlWebEventProvider"プロバイダーを使用してを示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-161">Finally, the &lt;rules&gt; element indicates that when an "All Errors" event transpires that it should be logged using the "SqlWebEventProvider" provider.</span></span>

<span data-ttu-id="51fc6-162">この構成情報では、状態監視システム書評データベースにすべての未処理の例外をログ記録するように指示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-162">This configuration information instructs the health monitoring system to log all unhandled exceptions to the Book Reviews database.</span></span>

> [!NOTE]
> <span data-ttu-id="51fc6-163">`WebBaseErrorEvent`イベントはサーバー エラー以外の場合は、リソースの要求に、ASP.NET が見つからないことなど、HTTP エラーは発生しません。</span><span class="sxs-lookup"><span data-stu-id="51fc6-163">The `WebBaseErrorEvent` event is only raised for server errors; it is not raised for HTTP errors, such as a request for an ASP.NET resource that is not found.</span></span> <span data-ttu-id="51fc6-164">これの動作とは異なります、`HttpApplication`クラスの`Error`はサーバーと HTTP エラーの両方で発生するイベントです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-164">This differs from the behavior of the `HttpApplication` class's `Error` event, which is raised for both server and HTTP errors.</span></span>


<span data-ttu-id="51fc6-165">監視アクションでシステム正常性を表示するには、web サイトにアクセスしにアクセスして、実行時エラーを生成`Genre.aspx?ID=foo`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-165">To see the health monitoring system in action, visit the website and generate a runtime error by visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="51fc6-166">適切なエラー ページに、例外の詳細黄色画面の死亡 (ローカル オフィスを訪れた) 場合または (実稼働環境でサイトにアクセスする) 場合は、カスタム エラー ページのいずれかが表示されます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-166">You should see the appropriate error page - either the Exception Details Yellow Screen of Death (when visiting locally) or the custom error page (when visiting the site in production).</span></span> <span data-ttu-id="51fc6-167">背後では、監視システム正常性は、データベースにエラー情報を記録します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-167">Behind the scenes, the health monitoring system logged the error information to the database.</span></span> <span data-ttu-id="51fc6-168">1 つのレコードが存在する必要があります、`aspnet_WebEvent_Events`テーブル (を参照してください**図 1**) です。 このレコードに発生したランタイム エラーに関する情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-168">There should be one record in the `aspnet_WebEvent_Events` table (see **Figure 1**); this record contains information about the runtime error that just occurred.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image2.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image1.png)

<span data-ttu-id="51fc6-169">**図 1**: エラーの詳細をログに記録された、`aspnet_WebEvent_Events`テーブル</span><span class="sxs-lookup"><span data-stu-id="51fc6-169">**Figure 1**: The Error Details Were Logged to the `aspnet_WebEvent_Events` Table</span></span>  
<span data-ttu-id="51fc6-170">([フルサイズのイメージを表示するをクリックして](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="51fc6-170">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image3.png))</span></span>

### <a name="displaying-the-error-log-in-a-web-page"></a><span data-ttu-id="51fc6-171">Web ページで、エラー ログを表示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-171">Displaying the Error Log In a Web Page</span></span>

<span data-ttu-id="51fc6-172">Web サイトの現在の構成では、状態監視システムは、データベースにすべての未処理の例外を記録します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-172">With the website's current configuration, the health monitoring system logs all unhandled exceptions to the database.</span></span> <span data-ttu-id="51fc6-173">ただし、正常性の監視は提供されませんを web ページで、エラー ログを表示する任意のメカニズム。</span><span class="sxs-lookup"><span data-stu-id="51fc6-173">However, health monitoring does not provide any mechanism to view the error log through a web page.</span></span> <span data-ttu-id="51fc6-174">ただし、データベースからこの情報を表示するための ASP.NET ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-174">However, you could build an ASP.NET page that displays this information from the database.</span></span> <span data-ttu-id="51fc6-175">(と思いますすぐに、選択できますが、電子メール メッセージで送信するエラーの詳細。)</span><span class="sxs-lookup"><span data-stu-id="51fc6-175">(As we'll see momentarily, you can opt to have the error details sent to you in an email message.)</span></span>

<span data-ttu-id="51fc6-176">このようなページを作成する場合は、エラーの詳細を表示するのには承認されたユーザーのみを許可するための手順を確認します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-176">If you create such a page, make sure you take steps to allow only authorized users to view the error details.</span></span> <span data-ttu-id="51fc6-177">サイトは既にユーザー アカウントを使用する場合は、特定のユーザーまたはロールのページにアクセスを制限する、URL 承認規則を使用できます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-177">If your site already employs user accounts then you can use URL authorization rules to restrict access to the page to certain users or roles.</span></span> <span data-ttu-id="51fc6-178">ログインしているユーザーに基づいて web ページへのアクセスを制限または許可する方法の詳細についてを参照してください  [web サイトのセキュリティ チュートリアル](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-178">For more information on how to grant or restrict access to web pages based on the logged in user, refer to my [Website Security Tutorials](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

> [!NOTE]
> <span data-ttu-id="51fc6-179">その後のチュートリアルでは、ELMAH という別のエラー ログに記録して通知システムについて説明します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-179">The subsequent tutorial explores an alternative error logging and notification system named ELMAH.</span></span> <span data-ttu-id="51fc6-180">ELMAH には、RSS フィードと、両方の web ページからのエラー ログを表示する組み込みのメカニズムが含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-180">ELMAH includes a built-in mechanism to view the error log from both a web page and as an RSS feed.</span></span>


## <a name="logging-events-to-email"></a><span data-ttu-id="51fc6-181">電子メールへのイベントをログ記録</span><span class="sxs-lookup"><span data-stu-id="51fc6-181">Logging Events to Email</span></span>

<span data-ttu-id="51fc6-182">状態監視システムでは、「イベントをログに」電子メール メッセージをログのソース プロバイダーが含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-182">The health monitoring system includes a log source provider that "logs" an event to an email message.</span></span> <span data-ttu-id="51fc6-183">ログのソースには、電子メール メッセージの本文内のデータベースにログに記録されるのと同じ情報が含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-183">The log source includes the same information that is logged to the database in the email message body.</span></span> <span data-ttu-id="51fc6-184">このログ ソースを使用して、特定のヘルスの監視イベントが発生すると、開発者に通知することができます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-184">You can use this log source to notify a developer when a certain health monitoring event occurs.</span></span>

<span data-ttu-id="51fc6-185">Web サイトの構成電子メールを受信するたびに、例外を発生書評を更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="51fc6-185">Let's update the Book Reviews website's configuration so that we receive an email whenever an exception occurs.</span></span> <span data-ttu-id="51fc6-186">これを実現するには、次の 3 つのタスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="51fc6-186">To accomplish this we need to perform three tasks:</span></span>

1. <span data-ttu-id="51fc6-187">電子メールを送信する ASP.NET web アプリケーションを構成します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-187">Configure the ASP.NET web application to send email.</span></span> <span data-ttu-id="51fc6-188">使用して電子メール メッセージを送信する方法を指定してこの情報は、`<system.net>`構成要素。</span><span class="sxs-lookup"><span data-stu-id="51fc6-188">This is accomplished by specifying how email messages are sent via the `<system.net>` configuration element.</span></span> <span data-ttu-id="51fc6-189">ASP.NET アプリケーション内のメッセージを電子メールを送信する方法についてを参照してください[ASP.NET で電子メールを送信する](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)と[System.Net.Mail FAQ](http://systemnetmail.com/)です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-189">For more information on sending email messages in an ASP.NET application refer to [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx) and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>
2. <span data-ttu-id="51fc6-190">電子メール ログ ソース プロバイダーを登録、`<providers>`要素、および</span><span class="sxs-lookup"><span data-stu-id="51fc6-190">Register the email log source provider in the `<providers>` element, and</span></span>
3. <span data-ttu-id="51fc6-191">エントリを追加、 `<rules>` (2) の手順で追加ログ ソース プロバイダーを「すべてのエラー」イベントにマップする要素。</span><span class="sxs-lookup"><span data-stu-id="51fc6-191">Add an entry to the `<rules>` element that maps the "All Errors" event to the log source provider added in step (2).</span></span>

<span data-ttu-id="51fc6-192">状態監視システムには、次の 2 つの電子メール ログ ソース プロバイダー クラスが含まれています:`SimpleMailWebEventProvider`と`TemplatedMailWebEventProvider`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-192">The health monitoring system includes two email log source provider classes: `SimpleMailWebEventProvider` and `TemplatedMailWebEventProvider`.</span></span> <span data-ttu-id="51fc6-193">[ `SimpleMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx)イベントを含むテキスト形式の電子メール メッセージの詳細、および電子メールの本文のカスタマイズはほとんどの説明を送信します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-193">The [`SimpleMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.simplemailwebeventprovider.aspx) sends a plain-text email message that includes the event details and provides little customization of the email body.</span></span> <span data-ttu-id="51fc6-194">[ `TemplatedMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)がレンダリングされるマークアップが電子メール メッセージの本文として使用する ASP.NET ページを指定します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-194">With the [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) you specify an ASP.NET page whose rendered markup is used as the body for the email message.</span></span> <span data-ttu-id="51fc6-195">[ `TemplatedMailWebEventProvider`クラス](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx)多くの内容と、電子メール メッセージの形式をより柔軟に制御が、先行作業は、電子メール メッセージの本文を生成する ASP.NET ページを作成する必要は少し多く必要があります。</span><span class="sxs-lookup"><span data-stu-id="51fc6-195">The [`TemplatedMailWebEventProvider` class](https://msdn.microsoft.com/library/system.web.management.templatedmailwebeventprovider.aspx) gives you much greater control over the contents and format of the email message, but requires a bit more upfront work as you have to create the ASP.NET page that generates the email message's body.</span></span> <span data-ttu-id="51fc6-196">このチュートリアルに焦点を当てます、`SimpleMailWebEventProvider`クラスです。</span><span class="sxs-lookup"><span data-stu-id="51fc6-196">This tutorial focuses on using the `SimpleMailWebEventProvider` class.</span></span>

<span data-ttu-id="51fc6-197">監視システムの正常性を更新`<providers>`内の要素、`Web.config`ファイルにログのソースを含め、`SimpleMailWebEventProvider`クラス。</span><span class="sxs-lookup"><span data-stu-id="51fc6-197">Update the health monitoring system's `<providers>` element in the `Web.config` file to include a log source for the `SimpleMailWebEventProvider` class:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample3.xml)]

<span data-ttu-id="51fc6-198">上記のマークアップを使用して、`SimpleMailWebEventProvider`ログ ソース プロバイダーでは、クラス"EmailWebEventProvider"フレンドリ名を割り当てます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-198">The above markup uses the `SimpleMailWebEventProvider` class as the log source provider, and assigns it the friendly name "EmailWebEventProvider".</span></span> <span data-ttu-id="51fc6-199">さらに、`<add>`属性には、追加の構成オプション、To などと、電子メール メッセージのアドレスが含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-199">Moreover, the `<add>` attribute includes additional configuration options, such as the To and From addresses of the email message.</span></span>

<span data-ttu-id="51fc6-200">定義されている電子メールのログ ソースには状態監視「ログイン」未処理の例外には、このソースを使用するシステムに指示します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-200">With the email log source defined, all that remains is to instruct the health monitoring system to use this source to "log" unhandled exceptions.</span></span> <span data-ttu-id="51fc6-201">新しいルールを追加することでこれを行う、`<rules>`セクション。</span><span class="sxs-lookup"><span data-stu-id="51fc6-201">This is accomplished by adding a new rule in the `<rules>` section:</span></span>

[!code-xml[Main](logging-error-details-with-asp-net-health-monitoring-cs/samples/sample4.xml)]

<span data-ttu-id="51fc6-202">`<rules>`セクションにはここで 2 つの規則が含まれています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-202">The `<rules>` section now includes two rules.</span></span> <span data-ttu-id="51fc6-203">"すべてのエラーを電子メールという"、最初の 1 つは、すべての未処理の例外を"EmailWebEventProvider"ログのソースに送信します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-203">The first one, named "All Errors To Email", sends all unhandled exceptions to the "EmailWebEventProvider" log source.</span></span> <span data-ttu-id="51fc6-204">この規則は、web サイトを指定したエラーの詳細を送信するの効果をアドレスにします。</span><span class="sxs-lookup"><span data-stu-id="51fc6-204">This rule has the effect of sending details about errors on the website to the specified To address.</span></span> <span data-ttu-id="51fc6-205">「すべてのエラー データベースへの」ルールは、サイトのデータベースに、エラーの詳細を記録します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-205">The "All Errors To Database" rule logs the error details to the site's database.</span></span> <span data-ttu-id="51fc6-206">その結果、未処理の例外で、サイトでその詳細が発生したときに両方データベースにログに記録され指定した電子メール アドレスに送信されます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-206">Consequently, whenever an unhandled exception occurs on the site its details are both logged to the database and sent to specified email address.</span></span>

<span data-ttu-id="51fc6-207">**図 2**によって生成された電子メールを示しています、`SimpleMailWebEventProvider`へのアクセス時`Genre.aspx?ID=foo`です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-207">**Figure 2** shows the email generated by the `SimpleMailWebEventProvider` class when visiting `Genre.aspx?ID=foo`.</span></span>

[![](logging-error-details-with-asp-net-health-monitoring-cs/_static/image5.png)](logging-error-details-with-asp-net-health-monitoring-cs/_static/image4.png)

<span data-ttu-id="51fc6-208">**図 2**: のエラーの詳細が電子メール メッセージで送信されます</span><span class="sxs-lookup"><span data-stu-id="51fc6-208">**Figure 2**: The Error Details are Sent in an Email Message</span></span>  
<span data-ttu-id="51fc6-209">([フルサイズのイメージを表示するをクリックして](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="51fc6-209">([Click to view full-size image](logging-error-details-with-asp-net-health-monitoring-cs/_static/image6.png))</span></span>

## <a name="summary"></a><span data-ttu-id="51fc6-210">まとめ</span><span class="sxs-lookup"><span data-stu-id="51fc6-210">Summary</span></span>

<span data-ttu-id="51fc6-211">ASP.NET の正常性監視システムは管理者が展開された web アプリケーションのヘルスを監視するようにするよう設計されています。</span><span class="sxs-lookup"><span data-stu-id="51fc6-211">The ASP.NET health monitoring system is designed to allow administrators to monitor the health of a deployed web application.</span></span> <span data-ttu-id="51fc6-212">状態監視イベントを発生するは、アプリケーションが停止すると、ときにユーザーが正常にログオン、サイトなど、特定のアクションを展開するとき、または、ハンドルされない例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-212">Health monitoring events are raised when certain actions unfold, such as when the application stops, when a user successfully logs onto the site, or when an unhandled exception occurs.</span></span> <span data-ttu-id="51fc6-213">これらのイベントは、ログのソースの任意の数を記録できます。</span><span class="sxs-lookup"><span data-stu-id="51fc6-213">These events can be logged to any number of log sources.</span></span> <span data-ttu-id="51fc6-214">このチュートリアルでは、データベースと、電子メール メッセージを通じて、未処理の例外の詳細を記録する方法を示しました。</span><span class="sxs-lookup"><span data-stu-id="51fc6-214">This tutorial showed how to log the details of unhandled exceptions to a database and through an email message.</span></span>

<span data-ttu-id="51fc6-215">このチュートリアルを使用して正常性の未処理の例外の記録、留意正常性の監視、展開済みの ASP.NET アプリケーションの全体的なヘルスを測定するものでは、さまざまな状態監視イベントが含まれていますが、ログ ソースを監視に重点を置いてください。ここで説明します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-215">This tutorial focused on using health monitoring to log unhandled exceptions, but keep in mind that health monitoring is designed to measure the overall health of a deployed ASP.NET application and includes a wealth of health monitoring events and log sources not explored here.</span></span> <span data-ttu-id="51fc6-216">詳細は、独自の状態のイベントとログのソースを監視を作成することができます必要に応じて発生します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-216">What's more, you can create your own health monitoring events and log sources, should the need arise.</span></span> <span data-ttu-id="51fc6-217">目を通すな最初の手順は、正常性の監視について詳細に知りたい場合は、 [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)の[正常性の監視に関する FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-217">If you are interested in learning more about health monitoring, a good first step is to read through [Erik Reitan](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)'s [health monitoring FAQ](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx).</span></span> <span data-ttu-id="51fc6-218">次を参照してください[How To: ASP.NET 2.0 で使用する正常性の監視](https://msdn.microsoft.com/library/ms998306.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="51fc6-218">Following that, consult [How To: Use Health Monitoring in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998306.aspx).</span></span>

<span data-ttu-id="51fc6-219">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="51fc6-219">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="51fc6-220">関連項目</span><span class="sxs-lookup"><span data-stu-id="51fc6-220">Further Reading</span></span>

<span data-ttu-id="51fc6-221">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="51fc6-221">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="51fc6-222">ASP.NET の状態監視の概要</span><span class="sxs-lookup"><span data-stu-id="51fc6-222">ASP.NET Health Monitoring Overview</span></span>](https://msdn.microsoft.com/library/bb398933.aspx)
- [<span data-ttu-id="51fc6-223">構成および監視 ASP.NET のシステム正常性をカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="51fc6-223">Configuring and Customizing the Health Monitoring System of ASP.NET</span></span>](http://dotnetslackers.com/articles/aspnet/ConfiguringAndCustomizingTheHealthMonitoringSystemOfASPNET.aspx)
- [<span data-ttu-id="51fc6-224">よく寄せられる質問 - 正常性の ASP.NET 2.0 の監視</span><span class="sxs-lookup"><span data-stu-id="51fc6-224">FAQ - Health Monitoring in ASP.NET 2.0</span></span>](https://blogs.msdn.com/erikreitan/archive/2006/05/22/603586.aspx)
- [<span data-ttu-id="51fc6-225">方法: 正常性の監視の通知の電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="51fc6-225">How To: Send E-Mail for Health Monitoring Notifications</span></span>](https://msdn.microsoft.com/library/ms227553.aspx)
- [<span data-ttu-id="51fc6-226">ASP.NET の正常性の監視を使用する方法</span><span class="sxs-lookup"><span data-stu-id="51fc6-226">How To: Use Health Monitoring in ASP.NET</span></span>](https://msdn.microsoft.com/library/ms998306.aspx)
- [<span data-ttu-id="51fc6-227">ASP.NET での監視のヘルス</span><span class="sxs-lookup"><span data-stu-id="51fc6-227">Health Monitoring in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/031407-1.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="51fc6-228">[前へ](processing-unhandled-exceptions-cs.md)
> [次へ](logging-error-details-with-elmah-cs.md)</span><span class="sxs-lookup"><span data-stu-id="51fc6-228">[Previous](processing-unhandled-exceptions-cs.md)
[Next](logging-error-details-with-elmah-cs.md)</span></span>
