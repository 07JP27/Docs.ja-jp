---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
title: 未処理の例外 (VB) の処理 |Microsoft ドキュメント
author: rick-anderson
description: 実稼働環境で web アプリケーションで、実行時エラーが発生したときは、重要なは、開発者に通知して、エラーを記録できるように、la a から診断することがあります.
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/09/2009
ms.topic: article
ms.assetid: 051296f0-9519-4e78-835c-d868da13b0a0
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb
msc.type: authoredcontent
ms.openlocfilehash: cb42cf6c457cf20da7f65352bb7eed1230b59588
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
---
<a name="processing-unhandled-exceptions-vb"></a><span data-ttu-id="b1bd8-103">未処理の例外 (VB) の処理</span><span class="sxs-lookup"><span data-stu-id="b1bd8-103">Processing Unhandled Exceptions (VB)</span></span>
====================
<span data-ttu-id="b1bd8-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b1bd8-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b1bd8-105">[サンプル コードを表示またはダウンロード](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples)します ([ダウンロード方法](/aspnet/core/tutorials/index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-105">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnet/web-forms/overview/older-versions-getting-started/deploying-web-site-projects/processing-unhandled-exceptions-vb/samples) ([how to download](/aspnet/core/tutorials/index#how-to-download-a-sample))</span></span>

> <span data-ttu-id="b1bd8-106">実稼働環境で web アプリケーションで、実行時エラーが発生したときは、重要なは、開発者に通知して、エラーを記録できるように、後の時点で診断可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-106">When a runtime error occurs on a web application in production it is important to notify a developer and to log the error so that it may be diagnosed at a later point in time.</span></span> <span data-ttu-id="b1bd8-107">このチュートリアルでは、ASP.NET のランタイム エラーを処理およびカスタム コードを実行するたびに、ASP.NET ランタイムまで、未処理の例外のバブルの 1 つの方法では検索の概要を示します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-107">This tutorial provides an overview of how ASP.NET processes runtime errors and looks at one way to have custom code execute whenever an unhandled exception bubbles up to the ASP.NET runtime.</span></span>


## <a name="introduction"></a><span data-ttu-id="b1bd8-108">はじめに</span><span class="sxs-lookup"><span data-stu-id="b1bd8-108">Introduction</span></span>

<span data-ttu-id="b1bd8-109">ASP.NET のランタイムを発生させるまでバブルが ASP.NET アプリケーションでハンドルされない例外が発生したときに、`Error`イベントと、適切なエラー ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-109">When an unhandled exception occurs in an ASP.NET application, it bubbles up to the ASP.NET runtime, which raises the `Error` event and displays the appropriate error page.</span></span> <span data-ttu-id="b1bd8-110">エラー ページの次の 3 つの種類があります。 ランタイム エラー黄色画面の死亡 (YSOD) です。例外の詳細 YSOD です。カスタム エラー ページ。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-110">There are three different types of error pages: the Runtime Error Yellow Screen of Death (YSOD); the Exception Details YSOD; and custom error pages.</span></span> <span data-ttu-id="b1bd8-111">[前のチュートリアル](displaying-a-custom-error-page-vb.md)リモート ユーザーおよびユーザーへのアクセスをローカルでの例外の詳細 YSOD にカスタム エラー ページを使用するアプリケーションを構成しました。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-111">In the [preceding tutorial](displaying-a-custom-error-page-vb.md) we configured the application to use a custom error page for remote users and the Exception Details YSOD for users visiting locally.</span></span>

<span data-ttu-id="b1bd8-112">サイトのルック アンド フィールに合ったわかりやすいカスタム エラー ページを使用してランタイム エラー YSOD、既定値に優先はカスタム エラー ページを表示する包括的なエラー処理ソリューションの一部にすぎません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-112">Using a human-friendly custom error page that matches the look and feel of the site is preferred to the default Runtime Error YSOD, but displaying a custom error page is only one part of a comprehensive error handling solution.</span></span> <span data-ttu-id="b1bd8-113">実稼働環境でアプリケーションでエラーが発生するときに、例外の原因を正確に把握してそれに対応できるように、開発者がエラーの通知ことが重要です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-113">When an error occurs in an application in production, it is important that the developers are notified of the error so that they can unearth the cause of the exception and address it.</span></span> <span data-ttu-id="b1bd8-114">さらに、エラーを調査したり、後で時間に診断できるようには、エラーの詳細を記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-114">Furthermore, the error's details should be logged so that the error can be examined and diagnosed at a later point in time.</span></span>

<span data-ttu-id="b1bd8-115">このチュートリアルでは、ログインできるように、未処理の例外の詳細情報にアクセスする方法と、開発者に通知します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-115">This tutorial shows how to access the details of an unhandled exception so that they can be logged and a developer notified.</span></span> <span data-ttu-id="b1bd8-116">次のいずれかのこの 2 つのチュートリアルでは、エラーのログ記録ライブラリを構成では、少し後に自動的に実行時エラーの開発者に通知し、その詳細をログを調査します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-116">The two tutorials following this one explore error logging libraries that, after a bit of configuration, will automatically notify developers of runtime errors and log their details.</span></span>

> [!NOTE]
> <span data-ttu-id="b1bd8-117">このチュートリアルで確認情報は、いくつかの固有またはカスタマイズされた方法で未処理の例外を処理する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-117">The information examined in this tutorial is most useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="b1bd8-118">のみ必要がある場合、例外を記録し、開発者に通知をエラー ログ記録ライブラリを使用する、移動する方法です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-118">In cases where you only need to log the exception and notify a developer, using an error logging library is the way to go.</span></span> <span data-ttu-id="b1bd8-119">次の 2 つのチュートリアルでは、このような 2 つのライブラリの概要を示します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-119">The next two tutorials provide an overview of two such libraries.</span></span>


## <a name="executing-code-when-theerrorevent-is-raised"></a><span data-ttu-id="b1bd8-120">ときにコードを実行する、`Error`イベントが発生しました。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-120">Executing Code When The`Error`Event Is Raised</span></span>

<span data-ttu-id="b1bd8-121">イベントは、オブジェクトに何か興味深いものが発生したこと、シグナルを発生して、応答にコードを実行する別のオブジェクトのメカニズムを提供します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-121">Events provide an object a mechanism for signaling that something interesting has occurred, and for another object to execute code in response.</span></span> <span data-ttu-id="b1bd8-122">ASP.NET の開発者は、イベントの観点から考えることに慣れています。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-122">As an ASP.NET developer you are accustomed to thinking in terms of events.</span></span> <span data-ttu-id="b1bd8-123">そのボタンのイベント ハンドラーを作成する場合は、ユーザーが特定のボタンをクリックしたときに、いくつかのコードを実行するには、`Click`イベント コードを記述してあるとします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-123">If you want to run some code when the visitor clicks a particular Button, you create an event handler for that Button's `Click` event and put your code there.</span></span> <span data-ttu-id="b1bd8-124">ASP.NET ランタイムを発生させることを考えるその[`Error`イベント](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx)エラーの詳細をログ記録のコードは、イベント ハンドラーに移動できる未処理の例外が発生すると、次にします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-124">Given that the ASP.NET runtime raises its [`Error` event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx) whenever an unhandled exception occurs, it follows that the code for logging the error's details would go in an event handler.</span></span> <span data-ttu-id="b1bd8-125">イベント ハンドラーを作成するが、`Error`イベントしますか?</span><span class="sxs-lookup"><span data-stu-id="b1bd8-125">But how do you create an event handler for the `Error` event?</span></span>

<span data-ttu-id="b1bd8-126">`Error`で多数のイベントのいずれかのイベントは、 [ `HttpApplication`クラス](https://msdn.microsoft.com/library/system.web.httpapplication.aspx)要求の有効期間中に HTTP パイプラインの特定の段階で発生します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-126">The `Error` event is one of many events in the [`HttpApplication` class](https://msdn.microsoft.com/library/system.web.httpapplication.aspx) that are raised at certain stages in the HTTP pipeline during the lifetime of a request.</span></span> <span data-ttu-id="b1bd8-127">など、`HttpApplication`クラスの[`BeginRequest`イベント](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx); すべての要求の開始時に発生したその[`AuthenticateRequest`イベント](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx)セキュリティ モジュールが、要求元を識別されたときに発生します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-127">For example, the `HttpApplication` class's [`BeginRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.beginrequest.aspx) is raised at the start of every request; its [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx) is raised when a security module has identified the requestor.</span></span> <span data-ttu-id="b1bd8-128">これら`HttpApplication`イベントに、ページの開発の要求の有効期間中にさまざまな時点でのカスタム ロジックを実行するための手段が得られます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-128">These `HttpApplication` events give the page developer a means to execute custom logic at the various points in the lifetime of a request.</span></span>

<span data-ttu-id="b1bd8-129">イベント ハンドラー、`HttpApplication`イベントは、という名前の特殊なファイルに配置できる`Global.asax`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-129">Event handlers for the `HttpApplication` events can be placed in a special file named `Global.asax`.</span></span> <span data-ttu-id="b1bd8-130">Web サイトでこのファイルを作成するには、名前のグローバル アプリケーション クラス テンプレートを使用して、web サイトのルートに新しい項目を追加`Global.asax`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-130">To create this file in your website, add a new item to the root of your website using the Global Application Class template with the name `Global.asax`.</span></span>

[![](processing-unhandled-exceptions-vb/_static/image2.png)](processing-unhandled-exceptions-vb/_static/image1.png)

<span data-ttu-id="b1bd8-131">**図 1**: 追加`Global.asax`Web アプリケーション</span><span class="sxs-lookup"><span data-stu-id="b1bd8-131">**Figure 1**: Add `Global.asax` To Your Web Application</span></span>  
 <span data-ttu-id="b1bd8-132">([フルサイズのイメージを表示するをクリックして](processing-unhandled-exceptions-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b1bd8-132">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image3.png))</span></span>

<span data-ttu-id="b1bd8-133">コンテンツと構造の`Global.asax`Visual Studio で作成されたファイルが Web アプリケーション プロジェクト (WAP) または Web サイト プロジェクト (WSP) のどちらを使用しているかどうかに基づいて若干が異なります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-133">The contents and structure of the `Global.asax` file created by Visual Studio differ slightly based on whether you are using a Web Application Project (WAP) or Web Site Project (WSP).</span></span> <span data-ttu-id="b1bd8-134">WAP で、`Global.asax`は 2 つの個別ファイル - として実装`Global.asax`と`Global.asax.vb`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-134">With a WAP, the `Global.asax` is implemented as two separate files - `Global.asax` and `Global.asax.vb`.</span></span> <span data-ttu-id="b1bd8-135">`Global.asax`ファイルでは、何も含まれていますが、`@Application`を参照するディレクティブ、`.vb`ファイル以外で目的のハンドラーが定義されているイベントの場合は、`Global.asax.vb`ファイル。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-135">The `Global.asax` file contains nothing but an `@Application` directive that references the `.vb` file; the event handlers of interest are defined in the `Global.asax.vb` file.</span></span> <span data-ttu-id="b1bd8-136">WSPs、1 つのファイルのみが作成、`Global.asax`でイベント ハンドラーが定義されていると、`<script runat="server">`ブロックします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-136">For WSPs, only a single file is created, `Global.asax`, and the event handlers are defined in a `<script runat="server">` block.</span></span>

<span data-ttu-id="b1bd8-137">`Global.asax` WAP で Visual Studio のグローバル アプリケーション クラス テンプレートで作成したファイルには、という名前のイベント ハンドラーが含まれています`Application_BeginRequest`、 `Application_AuthenticateRequest`、および`Application_Error`、用のイベント ハンドラーは、`HttpApplication`イベント`BeginRequest`、 。`AuthenticateRequest`、および`Error`、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-137">The `Global.asax` file created in a WAP by Visual Studio's Global Application Class template includes event handlers named `Application_BeginRequest`, `Application_AuthenticateRequest`, and `Application_Error`, which are event handlers for the `HttpApplication` events `BeginRequest`, `AuthenticateRequest`, and `Error`, respectively.</span></span> <span data-ttu-id="b1bd8-138">という名前のイベント ハンドラーもあります`Application_Start`、 `Session_Start`、 `Application_End`、および`Session_End`、どの web アプリケーションの起動時に、新しいセッションを開始、ときに、アプリケーションの終了時に発生するイベント ハンドラーは、セッションが終了します。それぞれします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-138">There are also event handlers named `Application_Start`, `Session_Start`, `Application_End`, and `Session_End`, which are event handlers that fire when the web application starts, when a new session starts, when the application ends, and when a session ends, respectively.</span></span> <span data-ttu-id="b1bd8-139">`Global.asax` WSP で Visual Studio によって作成されたファイルのみを含み、 `Application_Error`、 `Application_Start`、 `Session_Start`、 `Application_End`、および`Session_End`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-139">The `Global.asax` file created in a WSP by Visual Studio contains just the `Application_Error`, `Application_Start`, `Session_Start`, `Application_End`, and `Session_End` event handlers.</span></span>

> [!NOTE]
> <span data-ttu-id="b1bd8-140">コピーする必要があります、ASP.NET アプリケーションを展開するときに、`Global.asax`運用環境へのファイルです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-140">When deploying the ASP.NET application you need to copy the `Global.asax` file to the production environment.</span></span> <span data-ttu-id="b1bd8-141">`Global.asax.vb` WAP で作成したファイルはこのコードは、プロジェクトのアセンブリにコンパイルされるので、実稼働環境にコピーする必要はありません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-141">The `Global.asax.vb` file, which is created in the WAP, does not need to be copied to production because this code is compiled into the project's assembly.</span></span>


<span data-ttu-id="b1bd8-142">Visual Studio のグローバル アプリケーション クラス テンプレートで作成したイベント ハンドラーが完全ではありません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-142">The event handlers created by Visual Studio's Global Application Class template are not exhaustive.</span></span> <span data-ttu-id="b1bd8-143">イベント ハンドラーを追加するには任意の`HttpApplication`イベント、イベント ハンドラーの名前を付けて`Application_EventName`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-143">You can add an event handler for any `HttpApplication` event by naming the event handler `Application_EventName`.</span></span> <span data-ttu-id="b1bd8-144">次のコードを追加するなど、`Global.asax`のイベント ハンドラーを作成するファイル、 [ `AuthorizeRequest`イベント](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span><span class="sxs-lookup"><span data-stu-id="b1bd8-144">For example, you could add the following code to the `Global.asax` file to create an event handler for the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx):</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample1.vb)]

<span data-ttu-id="b1bd8-145">同様に、不要なグローバル アプリケーション クラス テンプレートで作成されたイベント ハンドラーを削除することができます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-145">Likewise, you can remove any event handlers created by the Global Application Class template that are not needed.</span></span> <span data-ttu-id="b1bd8-146">このチュートリアルでのみ必要がありますのイベント ハンドラー、`Error`イベント; から他のイベント ハンドラーを削除しても構いません、`Global.asax`ファイル。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-146">For this tutorial we only require an event handler for the `Error` event; feel free to remove the other event handlers from the `Global.asax` file.</span></span>

> [!NOTE]
> <span data-ttu-id="b1bd8-147">*HTTP モジュール*イベントのハンドラーを定義することもできます`HttpApplication`イベント。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-147">*HTTP Modules* offer another way to define event handlers for `HttpApplication` events.</span></span> <span data-ttu-id="b1bd8-148">HTTP モジュールは、別のクラス ライブラリに直接 web アプリケーション プロジェクト内に配置したりできる分離クラス ファイルとして作成されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-148">HTTP Modules are created as a class file that can be placed directly within the web application project or separated out into a separate class library.</span></span> <span data-ttu-id="b1bd8-149">HTTP モジュールが作成するための柔軟性と再利用可能なモデルを提供してクラス ライブラリ分割すること、ため`HttpApplication`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-149">Because they can be separated out into a class library, HTTP Modules offer a more flexible and reusable model for creating `HttpApplication` event handlers.</span></span> <span data-ttu-id="b1bd8-150">一方、`Global.asax`ファイルは、特定、web アプリケーションが配置されている場所をするには、HTTP モジュールをアセンブリ、この時点で、web サイトへの HTTP モジュールの追加のアセンブリを削除するように単純にコンパイルすることができます、`Bin`フォルダーとの登録、内のモジュール`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-150">Whereas the `Global.asax` file is specific to the web application where it resides, HTTP Modules can be compiled into assemblies, at which point adding the HTTP Module to a website is as simple as dropping the assembly in the `Bin` folder and registering the Module in `Web.config`.</span></span> <span data-ttu-id="b1bd8-151">このチュートリアルを作成して、HTTP モジュールを使用するのには検索しませんが、次の 2 つのチュートリアルで使用される 2 つのエラーのログ記録ライブラリは、HTTP モジュールとして実装されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-151">This tutorial does not look at creating and using HTTP Modules, but the two error logging libraries used in the following two tutorials are implemented as HTTP Modules.</span></span> <span data-ttu-id="b1bd8-152">HTTP モジュールの利点の詳細についてを参照してください[を使用して HTTP モジュールは、プラグ可能な ASP.NET コンポーネントを作成するハンドラー](https://msdn.microsoft.com/library/aa479332.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-152">For more background on the benefits of HTTP Modules refer to [Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components](https://msdn.microsoft.com/library/aa479332.aspx).</span></span>


## <a name="retrieving-information-about-the-unhandled-exception"></a><span data-ttu-id="b1bd8-153">未処理の例外に関する情報を取得します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-153">Retrieving Information About the Unhandled Exception</span></span>

<span data-ttu-id="b1bd8-154">この時点で、Global.asax ファイルである、`Application_Error`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-154">At this point we have a Global.asax file with an `Application_Error` event handler.</span></span> <span data-ttu-id="b1bd8-155">このイベント ハンドラーを実行するときは、エラーの開発者に通知し、その詳細を記録する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-155">When this event handler executes we need to notify a developer of the error and log its details.</span></span> <span data-ttu-id="b1bd8-156">これらのタスクを実行するには、最初の発生した例外の詳細を確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-156">To accomplish these tasks we first need to determine the details of the exception that was raised.</span></span> <span data-ttu-id="b1bd8-157">サーバー オブジェクトの[`GetLastError`メソッド](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx)、未処理の例外の原因となったの詳細を取得、`Error`イベントが発生します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-157">Use the Server object's [`GetLastError` method](https://msdn.microsoft.com/library/system.web.httpserverutility.getlasterror.aspx) to retrieve details of the unhandled exception that caused the `Error` event to fire.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample2.vb)]

<span data-ttu-id="b1bd8-158">`GetLastError`型のオブジェクトが返されます`Exception`、これは、.NET Framework のすべての例外の基本型です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-158">The `GetLastError` method returns an object of type `Exception`, which is the base type for all exceptions in the .NET Framework.</span></span> <span data-ttu-id="b1bd8-159">ただし、上記のコードでは am オブジェクトをキャスト例外によって返される`GetLastError`に、`HttpException`オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-159">However, in the code above I am casting the Exception object returned by `GetLastError` into an `HttpException` object.</span></span> <span data-ttu-id="b1bd8-160">場合、`Error`内でスローされた例外をラップし、ASP.NET のリソースの処理中に例外がスローされたために、イベントが発生している、`HttpException`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-160">If the `Error` event is being fired because an exception was thrown during the processing of an ASP.NET resource then the exception that was thrown is wrapped within an `HttpException`.</span></span> <span data-ttu-id="b1bd8-161">実際にエラー イベントの使用の原因となった例外を取得する、`InnerException`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-161">To get the actual exception that precipitated the Error event use the `InnerException` property.</span></span> <span data-ttu-id="b1bd8-162">場合、`Error`イベントが存在しないページの要求などの HTTP ベースの例外により発生した、`HttpException`がスローされますが、内部例外にありません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-162">If the `Error` event was raised because of an HTTP-based exception, such as a request for a non-existent page, an `HttpException` is thrown, but it does not have an inner exception.</span></span>

<span data-ttu-id="b1bd8-163">次のコードでは、`GetLastErrormessage`を引き起こした例外に関する情報を取得、`Error`イベントを格納する、`HttpException`という名前の変数で`lastErrorWrapper`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-163">The following code uses the `GetLastErrormessage` to retrieve information about the exception that triggered the `Error` event, storing the `HttpException` in a variable named `lastErrorWrapper`.</span></span> <span data-ttu-id="b1bd8-164">保存の種類、メッセージ、および元の例外のスタック トレースを確認する場合は、次の 3 つの文字列変数で、`lastErrorWrapper`が実際に発生した例外、 `Error` (の場合は HTTP ベースの例外) イベント、または単なるかどうかは、要求の処理中にスローされた例外のラッパーです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-164">It then stores the type, message, and stack trace of the originating exception in three string variables, checking to see if the `lastErrorWrapper` is the actual exception that triggered the `Error` event (in the case of HTTP-based exceptions) or if it's merely a wrapper for an exception that was thrown while processing the request.</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample3.vb)]

<span data-ttu-id="b1bd8-165">この時点ではデータベース テーブルに、例外の詳細を記録するコードを記述する必要。 すべての情報があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-165">At this point you have all the information you need to write code that will log the exception's details to a database table.</span></span> <span data-ttu-id="b1bd8-166">各エラーの詳細については、要求されたページの URL と、現在ログオンしているユーザーの名前などの他の便利部分と共に - 種類、メッセージ、スタック トレース、およびよびな - の関心のある列を含むデータベース テーブルを作成できます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-166">You could create a database table with columns for each of the error details of interest - the type, the message, the stack trace, and so on - along with other useful pieces of information, such as the URL of the requested page and the name of the currently logged on user.</span></span> <span data-ttu-id="b1bd8-167">`Application_Error`イベント ハンドラーは、データベースに接続し、テーブルにレコードを挿入します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-167">In the `Application_Error` event handler you would then connect to the database and insert a record into the table.</span></span> <span data-ttu-id="b1bd8-168">同様に、電子メールでエラーの開発者がアラートを生成するコードを追加できます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-168">Likewise, you could add code to alert a developer of the error via email.</span></span>

<span data-ttu-id="b1bd8-169">次の 2 つのチュートリアルで確認エラー ログ記録ライブラリは、このエラーのログ記録と通知を自分でビルドする必要はありませんのでに既定では、このような機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-169">The error logging libraries examined in the next two tutorials provide such functionality out of the box, so there's no need to build this error logging and notification yourself.</span></span> <span data-ttu-id="b1bd8-170">ただし、ことを示すために、`Error`イベントが発生することと、`Application_Error`ログに記録するエラーの詳細と、開発者に通知エラーが発生したときに、開発者に通知するコードを追加してみましょう。 イベント ハンドラーを使用することができます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-170">However, to illustrate that the `Error` event is being raised and that the `Application_Error` event handler can be used to log error details and notify a developer, let's add code that notifies a developer when an error occurs.</span></span>

## <a name="notifying-a-developer-when-an-unhandled-exception-occurs"></a><span data-ttu-id="b1bd8-171">ハンドルされない例外が発生したときに、開発者に通知します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-171">Notifying a Developer When an Unhandled Exception Occurs</span></span>

<span data-ttu-id="b1bd8-172">実稼働環境でハンドルされない例外が発生したときにすることが重要、エラーを評価し、実行する必要があるアクションを決定できるように、開発チームのアラートを生成します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-172">When an unhandled exception occurs in the production environment it is important to alert the development team so that they can assess the error and determine what actions need to be taken.</span></span> <span data-ttu-id="b1bd8-173">たとえばがある場合 double 型にする必要がありますし、データベースに接続するときにエラー、接続文字列を確認してまた、おそらく、サポート チケットを開く web ホスティング会社です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-173">For example, if there is an error in connecting to the database then you'll need to double check your connection string and, perhaps, open a support ticket with your web hosting company.</span></span> <span data-ttu-id="b1bd8-174">プログラミング エラーのため、例外が発生した場合、追加のコードまたは検証ロジックは、今後、このようなエラーを防ぐために追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-174">If the exception occurred because of a programming error, additional code or validation logic may need to be added to prevent such errors in the future.</span></span>

<span data-ttu-id="b1bd8-175">.NET Framework クラス、 [ `System.Net.Mail`名前空間](https://msdn.microsoft.com/library/system.net.mail.aspx)電子メールを送信するが簡単です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-175">The .NET Framework classes in the [`System.Net.Mail` namespace](https://msdn.microsoft.com/library/system.net.mail.aspx) make it easy to send an email.</span></span> <span data-ttu-id="b1bd8-176">[ `MailMessage`クラス](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx)電子メール メッセージを表しなどのプロパティを持つ`To`、 `From`、 `Subject`、 `Body`、および`Attachments`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-176">The [`MailMessage` class](https://msdn.microsoft.com/library/system.net.mail.mailmessage.aspx) represents an email message and has properties like `To`, `From`, `Subject`, `Body`, and `Attachments`.</span></span> <span data-ttu-id="b1bd8-177">`SmtpClass`送信に使用されて、`MailMessage`オブジェクト指定された SMTP サーバーを使用して; SMTP サーバーの設定をプログラムでも宣言的に指定することができます、 [ `<system.net>`要素](https://msdn.microsoft.com/library/6484zdc1.aspx)で、`Web.config file`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-177">The `SmtpClass` is used to send a `MailMessage` object using a specified SMTP server; the SMTP server settings can be specified programmatically or declaratively in the [`<system.net>` element](https://msdn.microsoft.com/library/6484zdc1.aspx) in the `Web.config file`.</span></span> <span data-ttu-id="b1bd8-178">電子メールの送信の詳細については、ASP.NET アプリケーション内のメッセージをチェック アウト私の記事[ASP.NET で電子メールを送信する](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)、および[System.Net.Mail FAQ](http://systemnetmail.com/)です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-178">For more information on sending email messages in an ASP.NET application check out my article, [Sending Email in ASP.NET](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx), and the [System.Net.Mail FAQ](http://systemnetmail.com/).</span></span>

> [!NOTE]
> <span data-ttu-id="b1bd8-179">`<system.net>`要素にはで使用する SMTP サーバー設定が含まれています、`SmtpClient`クラスの電子メールを送信するときにします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-179">The `<system.net>` element contains the SMTP server settings used by the `SmtpClient` class when sending an email.</span></span> <span data-ttu-id="b1bd8-180">Web ホスティング可能性の高い会社には、アプリケーションから電子メールの送信に使用できる SMTP サーバーがあります。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-180">Your web hosting company likely has an SMTP server that you can use to send email from your application.</span></span> <span data-ttu-id="b1bd8-181">Web アプリケーションで使用する必要があります、SMTP サーバー設定については、web ホストのサポート セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-181">Consult your web host's support section for information on the SMTP server settings you should use in your web application.</span></span>


<span data-ttu-id="b1bd8-182">次のコードを追加、`Application_Error`エラーが発生したときに、開発者に電子メールを送信するイベントのハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-182">Add the following code to the `Application_Error` event handler to send a developer an email when an error occurs:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample4.vb)]

<span data-ttu-id="b1bd8-183">上記のコードは非常に長いですが、その一括は開発者に送信する電子メールに表示される HTML を作成します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-183">While the above code is quite lengthy, the bulk of it creates the HTML that appears in the email sent to the developer.</span></span> <span data-ttu-id="b1bd8-184">コードが参照することで始まる、`HttpException`によって返される、`GetLastError`メソッド (`lastErrorWrapper`)。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-184">The code starts by referencing the `HttpException` returned by the `GetLastError` method (`lastErrorWrapper`).</span></span> <span data-ttu-id="b1bd8-185">実際に要求によって発生した例外はを介して取得された`lastErrorWrapper.InnerException`変数に割り当てられている`lastError`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-185">The actual exception that was raised by the request is retrieved via `lastErrorWrapper.InnerException` and is assigned to the variable `lastError`.</span></span> <span data-ttu-id="b1bd8-186">型、メッセージ、およびスタックからトレース情報を取得`lastError`3 つの文字列変数に格納されているとします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-186">The type, message, and stack trace information is retrieved from `lastError` and stored in three string variables.</span></span>

<span data-ttu-id="b1bd8-187">次に、`MailMessage`という名前のオブジェクト`mm`を作成します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-187">Next, a `MailMessage` object named `mm` is created.</span></span> <span data-ttu-id="b1bd8-188">電子メールの本文は HTML 形式であり、要求されたページの URL、現在ログオンしているユーザー、および例外 (種類、メッセージ、およびスタック トレース) に関する情報の名前を表示します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-188">The email body is HTML formatted and displays the URL of the requested page, the name of the currently logged on user, and information about the exception (the type, message, and stack trace).</span></span> <span data-ttu-id="b1bd8-189">優れた点の 1 つ、`HttpException`クラスは、呼び出すことによって、例外の詳細黄色画面の死亡 (YSOD) を作成するために使用する HTML を生成することができます、 [GetHtmlErrorMessage メソッド](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-189">One of the cool things about the `HttpException` class is that you can generate the HTML used to create the Exception Details Yellow Screen of Death (YSOD) by calling the [GetHtmlErrorMessage method](https://msdn.microsoft.com/library/system.web.httpexception.gethtmlerrormessage.aspx).</span></span> <span data-ttu-id="b1bd8-190">このメソッドは、例外の詳細 YSOD マークアップを取得し、電子メールの添付ファイルとしてに追加するここで使用されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-190">This method is used here to retrieve the Exception Details YSOD markup and add it to the email as an attachment.</span></span> <span data-ttu-id="b1bd8-191">注意: かどうか、例外をトリガーする、`Error`イベントが存在しないページの要求) などの HTTP ベースの例外、`GetHtmlErrorMessage`メソッドが返す`null`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-191">One word of caution: if the exception that triggered the `Error` event was an HTTP-based exception (such as a request for a non-existent page) then the `GetHtmlErrorMessage` method will return `null`.</span></span>

<span data-ttu-id="b1bd8-192">最後に、送信、`MailMessage`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-192">The final step is to send the `MailMessage`.</span></span> <span data-ttu-id="b1bd8-193">これで新たに作成する`SmtpClient`メソッドを呼び出してその`Send`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-193">This is done by creating a new `SmtpClient` method and calling its `Send` method.</span></span>

> [!NOTE]
> <span data-ttu-id="b1bd8-194">Web アプリケーションでこのコードを使用する前にしておくの値を変更、`ToAddress`と`FromAddress`定数のsupport@example.com電子メール エラー通知の電子メール アドレスに送信するかを由来します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-194">Before using this code in your web application you'll want to change the values in the `ToAddress` and `FromAddress` constants from support@example.com to whatever email address the error notification email should be sent to and originate from.</span></span> <span data-ttu-id="b1bd8-195">SMTP サーバー設定を指定する必要も、 `<system.net>` 」の「`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-195">You'll also need to specify SMTP server settings in the `<system.net>` section in `Web.config`.</span></span> <span data-ttu-id="b1bd8-196">使用する SMTP サーバー設定を確認する、web ホスト プロバイダーを参照してください。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-196">Consult your web host provider to determine the SMTP server settings to use.</span></span>


<span data-ttu-id="b1bd8-197">配置でこのコードにエラーが発生するたび、開発者は送信電子メール メッセージ、エラーの概要し、YSOD が含まれていますが、されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-197">With this code in place anytime there's an error the developer is sent an email message that summarizes the error and includes the YSOD.</span></span> <span data-ttu-id="b1bd8-198">前のチュートリアルで Genre.aspx を訪問し、無効な渡すことによって、実行時エラーを示すお`ID`と同様に、クエリ文字列を通じて値`Genre.aspx?ID=foo`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-198">In the preceding tutorial we demonstrated a runtime error by visiting Genre.aspx and passing in an invalid `ID` value through the querystring, like `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="b1bd8-199">使用してページへのアクセス、 `Global.asax` - 前のチュートリアルで開発環境で引き続き実稼働環境で次の手順中に、例外の詳細黄色画面の死亡事故を参照するくださいと、ファイルの場所には、同じユーザー エクスペリエンスを作成します。カスタム エラー ページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-199">Visiting the page with the `Global.asax` file in place produces the same user experience as in the preceding tutorial - in the development environment you'll continue to see the Exception Details Yellow Screen of Death, while in the production environment you'll see the custom error page.</span></span> <span data-ttu-id="b1bd8-200">この既存の動作だけでなく、開発者に電子メールが送信されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-200">In addition to this existing behavior, the developer is sent an email.</span></span>

<span data-ttu-id="b1bd8-201">**図 2**オフィスを訪れたときに受信した電子メールを示しています。`Genre.aspx?ID=foo`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-201">**Figure 2** shows the email received when visiting `Genre.aspx?ID=foo`.</span></span> <span data-ttu-id="b1bd8-202">電子メールの本文には、例外情報をまとめたものです中に、`YSOD.htm`添付ファイルには、例外の詳細 YSOD に表示されているコンテンツが表示されます (を参照してください**図 3**)。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-202">The email body summarizes the exception information, while the `YSOD.htm` attachment displays the content that is shown in the Exception Details YSOD (see **Figure 3**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image5.png)](processing-unhandled-exceptions-vb/_static/image4.png)

<span data-ttu-id="b1bd8-203">**図 2**: ハンドルされない例外が発生するたびに、開発者の電子メール通知が送信します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-203">**Figure 2**: The Developer Is Sent An Email Notification Whenever There's An Unhandled Exception</span></span>  
 <span data-ttu-id="b1bd8-204">([フルサイズのイメージを表示するをクリックして](processing-unhandled-exceptions-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b1bd8-204">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image6.png))</span></span>

[![](processing-unhandled-exceptions-vb/_static/image8.png)](processing-unhandled-exceptions-vb/_static/image7.png)

<span data-ttu-id="b1bd8-205">**図 3**: 電子メール通知には、添付ファイルとして YSOD 例外の詳細が含まれています。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-205">**Figure 3**: The Email Notification Includes the Exception Details YSOD As An Attachment</span></span>  
 <span data-ttu-id="b1bd8-206">([フルサイズのイメージを表示するをクリックして](processing-unhandled-exceptions-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b1bd8-206">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image9.png))</span></span>

## <a name="what-about-using-the-custom-error-page"></a><span data-ttu-id="b1bd8-207">使用する場合は、カスタム エラー ページですか。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-207">What About Using the Custom Error Page?</span></span>

<span data-ttu-id="b1bd8-208">このチュートリアルで使用する方法を示しました`Global.asax`と`Application_Error`ハンドルされない例外が発生したときにコードを実行するイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-208">This tutorial showed how to use `Global.asax` and the `Application_Error` event handler to execute code when an unhandled exception occurs.</span></span> <span data-ttu-id="b1bd8-209">具体的には、使用して、このイベント ハンドラーにするとエラーの開発者に通知また、データベース内のエラーの詳細をログに記録する拡張できます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-209">Specifically, we used this event handler to notify a developer of an error; we could extend it to also log the error details in a database.</span></span> <span data-ttu-id="b1bd8-210">存在、`Application_Error`イベント ハンドラーでは、エンドユーザーのエクスペリエンスには影響しません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-210">The presence of the `Application_Error` event handler does not affect the end user's experience.</span></span> <span data-ttu-id="b1bd8-211">構成済みのエラー ページで、これは、エラーの詳細 YSOD、ランタイム エラー YSOD またはカスタム エラー ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-211">They still see the configured error page, be it the Error Details YSOD, the Runtime Error YSOD, or the custom error page.</span></span>

<span data-ttu-id="b1bd8-212">疑問を抱くと自然なであるかどうか、`Global.asax`ファイルと`Application_Error`イベントは、カスタム エラー ページを使用する場合に必要です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-212">It's natural to wonder whether the `Global.asax` file and `Application_Error` event is necessary when using a custom error page.</span></span> <span data-ttu-id="b1bd8-213">エラーが発生したカスタム エラー ページを表示ため理由できないコードを作成しました、開発者に通知し、カスタム エラー ページの分離コード クラスに、エラーの詳細をログインしますか?</span><span class="sxs-lookup"><span data-stu-id="b1bd8-213">When an error occurs the user is shown the custom error page so why can't we put the code to notify the developer and log the error details into the code-behind class of the custom error page?</span></span> <span data-ttu-id="b1bd8-214">カスタム エラー ページの分離コード クラスにコードを追加できますが、確実に発生する例外の詳細へのアクセスにはできません、`Error`前のチュートリアルでは探索方法を使用するときにイベント。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-214">While you can certainly add code to the custom error page's code-behind class you do not have access to the details of the exception that triggered the `Error` event when using the technique we explored in the preceding tutorial.</span></span> <span data-ttu-id="b1bd8-215">呼び出す、`GetLastError`カスタム エラー ページからメソッドを返します`Nothing`です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-215">Calling the `GetLastError` method from the custom error page returns `Nothing`.</span></span>

<span data-ttu-id="b1bd8-216">この動作の理由のリダイレクトを使用して、カスタム エラー ページに達したためにです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-216">The reason for this behavior is because the custom error page is reached via a redirect.</span></span> <span data-ttu-id="b1bd8-217">未処理の例外に達した場合、ASP.NET ランタイム エンジンは、ASP.NET を発生させるその`Error`イベント (が実行される、`Application_Error`イベント ハンドラー) し、*リダイレクト*を発行して、カスタムエラーページにユーザー`Response.Redirect(customErrorPageUrl)`.</span><span class="sxs-lookup"><span data-stu-id="b1bd8-217">When an unhandled exception reaches the ASP.NET runtime the ASP.NET engine raises its `Error` event (which executes the `Application_Error` event handler) and then *redirects* the user to the custom error page by issuing a `Response.Redirect(customErrorPageUrl)`.</span></span> <span data-ttu-id="b1bd8-218">`Response.Redirect`メソッドは、新しい URL、つまりカスタム エラー ページを要求するブラウザーに指示を HTTP 302 ステータス コードでは、クライアントへの応答を送信します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-218">The `Response.Redirect` method sends a response to the client with an HTTP 302 status code, instructing the browser to request a new URL, namely the custom error page.</span></span> <span data-ttu-id="b1bd8-219">ブラウザーに自動的に要求この新しいページします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-219">The browser then automatically requests this new page.</span></span> <span data-ttu-id="b1bd8-220">わかりますカスタム エラー ページがページから個別に要求されたブラウザーのアドレス バーは、カスタム エラー ページの URL に変更されるため、エラーが発生した (を参照してください**図 4**)。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-220">You can tell that the custom error page was requested separately from the page where the error originated because the browser's Address bar changes to the custom error page URL (see **Figure 4**).</span></span>

[![](processing-unhandled-exceptions-vb/_static/image11.png)](processing-unhandled-exceptions-vb/_static/image10.png)

<span data-ttu-id="b1bd8-221">**図 4**: ブラウザーは、カスタム エラー ページの URL にリダイレクト取得エラーが発生</span><span class="sxs-lookup"><span data-stu-id="b1bd8-221">**Figure 4**: When an Error Occurs the Browser Gets Redirected to the Custom Error Page URL</span></span>  
 <span data-ttu-id="b1bd8-222">([フルサイズのイメージを表示するをクリックして](processing-unhandled-exceptions-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b1bd8-222">([Click to view full-size image](processing-unhandled-exceptions-vb/_static/image12.png))</span></span>

<span data-ttu-id="b1bd8-223">実質的な影響は、サーバーが HTTP 302 リダイレクトに応答するときに未処理の例外が発生した要求を終了します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-223">The net effect is that the request where the unhandled exception occurred ends when the server responds with the HTTP 302 redirect.</span></span> <span data-ttu-id="b1bd8-224">カスタム エラー ページに後続の要求は、新しい要求です。この段階で、ASP.NET エンジン エラー情報が破棄し、さらにのカスタム エラー ページの新しい要求に、前回の要求でハンドルされない例外を関連付けることはできません。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-224">The subsequent request to the custom error page is a brand new request; by this point the ASP.NET engine has discarded the error information and, moreover, has no way to associate the unhandled exception in the previous request with the new request for the custom error page.</span></span> <span data-ttu-id="b1bd8-225">その理由は`GetLastError`返します`null`カスタム エラー ページから呼び出されるとします。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-225">This is why `GetLastError` returns `null` when called from the custom error page.</span></span>

<span data-ttu-id="b1bd8-226">ただし、エラーが発生した同じ要求時に実行されるカスタム エラー ページを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-226">However, it is possible to have the custom error page executed during the same request that caused the error.</span></span> <span data-ttu-id="b1bd8-227">[ `Server.Transfer(url)` ](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx)メソッドが実行を指定した URL に転送し、同じ要求内で処理します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-227">The [`Server.Transfer(url)`](https://msdn.microsoft.com/library/system.web.httpserverutility.transfer.aspx) method transfers execution to the specified URL and processes it within the same request.</span></span> <span data-ttu-id="b1bd8-228">内のコードに移動する可能性があります、`Application_Error`イベント ハンドラーに置き換えることで、カスタム エラー ページの分離コード クラス`Global.asax`を次のコード。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-228">You could move the code in the `Application_Error` event handler to the custom error page's code-behind class, replacing it in `Global.asax` with the following code:</span></span>

[!code-vb[Main](processing-unhandled-exceptions-vb/samples/sample5.vb)]

<span data-ttu-id="b1bd8-229">これでハンドルされない例外が発生すると、`Application_Error`イベント ハンドラーは、HTTP ステータス コードに基づいて、適切なカスタム エラー ページに制御を移します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-229">Now when an unhandled exception occurs the `Application_Error` event handler transfers control to the appropriate custom error page based on the HTTP status code.</span></span> <span data-ttu-id="b1bd8-230">カスタム エラー ページが経由で未処理の例外情報へのアクセスを持つコントロールは、転送されたため`Server.GetLastError`とがエラーの開発者に通知し、その詳細を記録します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-230">Because control was transferred, the custom error page has access to the unhandled exception information via `Server.GetLastError` and can notify a developer of the error and log its details.</span></span> <span data-ttu-id="b1bd8-231">`Server.Transfer`呼び出しには、カスタム エラー ページにユーザーをリダイレクトすることから ASP.NET エンジンが停止しました。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-231">The `Server.Transfer` call stops the ASP.NET engine from redirecting the user to the custom error page.</span></span> <span data-ttu-id="b1bd8-232">代わりに、カスタム エラー ページのコンテンツは、エラーが発生したページへの応答として返されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-232">Instead, the custom error page's content is returned as the response to the page that generated the error.</span></span>

## <a name="summary"></a><span data-ttu-id="b1bd8-233">まとめ</span><span class="sxs-lookup"><span data-stu-id="b1bd8-233">Summary</span></span>

<span data-ttu-id="b1bd8-234">ASP.NET web アプリケーションでハンドルされない例外が発生したときに、ASP.NET ランタイムを発生させます、`Error`イベントと、構成済みのエラー ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-234">When an unhandled exception occurs in an ASP.NET web application the ASP.NET runtime raises the `Error` event and displays the configured error page.</span></span> <span data-ttu-id="b1bd8-235">お開発者にエラーの通知の詳細をログに記録したりエラー イベントのイベント ハンドラーを作成することで、さまざまな方法で処理できます。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-235">We can notify the developer of the error, log its details, or process it in some other fashion, by creating an event handler for the Error event.</span></span> <span data-ttu-id="b1bd8-236">イベント ハンドラーを作成する 2 つの方法がある`HttpApplication`イベントと同様に`Error`: で、`Global.asax`ファイルまたは HTTP モジュールからです。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-236">There are two ways to create an event handler for `HttpApplication` events like `Error`: in the `Global.asax` file or from an HTTP Module.</span></span> <span data-ttu-id="b1bd8-237">このチュートリアルで作成する方法を示しました、`Error`内のイベント ハンドラー、`Global.asax`ファイルを電子メール メッセージを使用して、エラーの開発者に通知します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-237">This tutorial showed how to create an `Error` event handler in the `Global.asax` file that notifies developers of an error by means of an email message.</span></span>

<span data-ttu-id="b1bd8-238">作成する、`Error`イベント ハンドラーがいくつかの固有またはカスタマイズされた方法で未処理の例外を処理する必要がある場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-238">Creating an `Error` event handler is useful if you need to process unhandled exceptions in some unique or customized manner.</span></span> <span data-ttu-id="b1bd8-239">ただし、独自の作成`Error`または開発者に通知する例外をログにイベント ハンドラーは、時間の最も効率的な使用数分で設定できる無料で使いやすいもののエラー ログのライブラリが存在します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-239">However, creating your own `Error` event handler to log the exception or to notify a developer is not the most efficient use of your time as there already exist free and easy to use error logging libraries that can be setup in a matter of minutes.</span></span> <span data-ttu-id="b1bd8-240">次の 2 つのチュートリアルでは、このような 2 つのライブラリを確認します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-240">The next two tutorials examine two such libraries.</span></span>

<span data-ttu-id="b1bd8-241">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="b1bd8-241">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="b1bd8-242">関連項目</span><span class="sxs-lookup"><span data-stu-id="b1bd8-242">Further Reading</span></span>

<span data-ttu-id="b1bd8-243">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-243">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b1bd8-244">ASP.NET HTTP モジュールは、HTTP ハンドラーの概要</span><span class="sxs-lookup"><span data-stu-id="b1bd8-244">ASP.NET HTTP Modules and HTTP Handlers Overview</span></span>](https://support.microsoft.com/kb/307985)
- [<span data-ttu-id="b1bd8-245">未処理の例外の処理 - 未処理の例外に応答して適切に</span><span class="sxs-lookup"><span data-stu-id="b1bd8-245">Gracefully Responding to Unhandled Exceptions - Processing Unhandled Exceptions</span></span>](http://aspnet.4guysfromrolla.com/articles/091306-1.aspx)
- [<span data-ttu-id="b1bd8-246">`HttpApplication` クラスと ASP.NET アプリケーション オブジェクト</span><span class="sxs-lookup"><span data-stu-id="b1bd8-246">`HttpApplication` Class and the ASP.NET Application Object</span></span>](http://www.eggheadcafe.com/articles/20030211.asp)
- [<span data-ttu-id="b1bd8-247">HTTP ハンドラーと ASP.NET の HTTP モジュール</span><span class="sxs-lookup"><span data-stu-id="b1bd8-247">HTTP Handlers and HTTP Modules in ASP.NET</span></span>](http://www.15seconds.com/Issue/020417.htm)
- [<span data-ttu-id="b1bd8-248">ASP.NET で電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="b1bd8-248">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="b1bd8-249">について、`Global.asax`ファイル</span><span class="sxs-lookup"><span data-stu-id="b1bd8-249">Understanding the `Global.asax` File</span></span>](http://aspalliance.com/1114_Understanding_the_Globalasax_file.all)
- [<span data-ttu-id="b1bd8-250">HTTP モジュールとハンドラーを使用して、プラグ可能な ASP.NET コンポーネントを作成するには</span><span class="sxs-lookup"><span data-stu-id="b1bd8-250">Using HTTP Modules and Handlers to Create Pluggable ASP.NET Components</span></span>](https://msdn.microsoft.com/library/aa479332.aspx)
- [<span data-ttu-id="b1bd8-251">ASP.NET を扱う`Global.asax`ファイル</span><span class="sxs-lookup"><span data-stu-id="b1bd8-251">Working with the ASP.NET `Global.asax` File</span></span>](http://articles.techrepublic.com.com/5100-10878_11-5771721.html)
- [<span data-ttu-id="b1bd8-252">扱う`HttpApplication`インスタンス</span><span class="sxs-lookup"><span data-stu-id="b1bd8-252">Working with `HttpApplication` Instances</span></span>](https://msdn.microsoft.com/library/a0xez8f2.aspx)

> [!div class="step-by-step"]
> <span data-ttu-id="b1bd8-253">[前へ](displaying-a-custom-error-page-vb.md)
> [次へ](logging-error-details-with-asp-net-health-monitoring-vb.md)</span><span class="sxs-lookup"><span data-stu-id="b1bd8-253">[Previous](displaying-a-custom-error-page-vb.md)
[Next](logging-error-details-with-asp-net-health-monitoring-vb.md)</span></span>
