---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
title: データベースの開発と配置 (c#) ための戦略 |Microsoft ドキュメント
author: rick-anderson
description: 最初にデータ ドリブン アプリケーションを展開するときに、運用環境に開発環境で無条件データベースをコピーできます。 B...
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 3e8b0627-3eb7-488e-807e-067cba7cec05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/strategies-for-database-development-and-deployment-cs
msc.type: authoredcontent
ms.openlocfilehash: 801eedba50e03b2fd9327e9a2902178b35b4275a
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30889528"
---
<a name="strategies-for-database-development-and-deployment-c"></a>データベースの開発と配置 (c#) ための戦略
====================
によって[Scott Mitchell](https://twitter.com/ScottOnWriting)

[PDF をダウンロードします。](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial10_DBDevel_cs.pdf)

> 最初にデータ ドリブン アプリケーションを展開するときに、運用環境に開発環境で無条件データベースをコピーできます。 ブラインドを実行する、後続のデプロイ内のコピーで、実稼働データベースに入力データが上書きされます。 代わりに、データベースの配置では、実稼働データベースへの最後の配置以降、開発用データベースに行われた変更を適用します。 このチュートリアルでは、これらの課題を調べを chronicling と最後の配置以降のデータベースに加え、変更を適用することを支援するさまざまな方法を提供します。


## <a name="introduction"></a>はじめに

前のチュートリアルで既に説明した、ASP.NET アプリケーションを配置するだけで、開発環境から運用環境に関連するコンテンツをコピーします。 展開が 1 回限りのイベントではありませんではなく場合や、ソフトウェアの新しいバージョンがリリースされるたびに発生するバグまたはセキュリティに関する注意事項を特定して対処します。 ASP.NET ページをコピーするときに、イメージ、JavaScript ファイル、およびこれらのファイルのことを考慮する必要はありません、運用環境にこのようなその他のファイルを最後の配置以降変更されています。 できます盲目的ファイルをコピーする、実稼働環境に既存のコンテンツを上書きします。 残念ながら、シンプルでは、データベースの配置を拡張しません。

最初にデータ ドリブン アプリケーションを展開するときに、運用環境に開発環境で無条件データベースをコピーできます。 ブラインドを実行する、後続のデプロイ内のコピーで、実稼働データベースに入力データが上書きされます。 代わりに、データベースの配置では、適用する、*変更*以後に、開発用データベースを実稼働データベースへの最後の配置。 このチュートリアルでは、これらの課題を調べを chronicling と最後の配置以降のデータベースに加え、変更を適用することを支援するさまざまな方法を提供します。

## <a name="the-challenges-of-deploying-a-database"></a>データベースの配置の問題

最初に、データ ドリブン アプリケーションの配置が完了する前に 1 つのデータベースがある、なぜが最初にデータ ドリブン アプリケーションを展開するときに無条件である開発環境でデータベースが内のデータベースをコピーするつまり、運用環境に開発環境です。 アプリケーションが展開された後、データベースの 2 つのコピー: 開発環境および実稼働環境で 1 つで 1 つです。

展開の間で、データベース開発と実稼働データベースは同期になります。実稼働データベースのスキーマが変更されない、中に新機能が追加されると、開発データベースのスキーマは変更できます。 追加または列、テーブル、ビュー、またはストアド プロシージャを削除する場合があります。 開発用データベースに追加される重要なデータもあります。 多くのデータ ドリブン アプリケーションには、ユーザーが編集されないハード コーディングされた、アプリケーション固有のデータが設定される参照テーブルが含まれます。 たとえば、オークションの web サイトのオークションの対象とされている項目の状態を記述する選択ドロップダウン リストがある: 新規のように、Good、Fair です。 ドロップダウン リストで直接これらのオプションをハード コーディングではなく、データベース テーブルに配置する通常お勧めします。 開発中は、Poor をという名前の新しい条件がテーブルに追加し、アプリケーションを展開するときに場合、この同じレコードを実稼働データベースでのルックアップ テーブルに追加する必要があります。

理想的には、データベースの配置が行われます。 データベースの開発環境から実稼働環境にコピーします。 アプリケーションを展開して、開発を再開したら、実稼働データベースが作成される実際のユーザーからの実際のデータでに注意してください。 そのため、単にデータベースをコピーする開発環境から運用環境で、[次へ] の展開した場合は、実稼働データベースを上書きして、既存のデータを失います。 最終的な結果は、こと、データベースの配置にまとめること、前回の配置以降、開発用データベースに行われた変更を適用します。

データベースの配置では、スキーマと、場合によっては、データの変更を適用する最後の配置以降、変更の履歴、またはでなければなりません保持されます (展開時に決定されます) 実稼働環境にこれらの変更を適用できるようにします。 これは、さまざまな管理およびデータ モデルに変更を適用するための手法です。

### <a name="defining-the-baseline"></a>ベースラインを定義します。

アプリケーションのデータベースへの変更を維持するには、いくつか開始状態に変更を適用する基準がある必要があります。 1 つの極端な例として、開始状態にないテーブル、ビュー、またはストアド プロシージャを空のデータベース可能性があります。 このような基準は、すべてのデータベースのテーブル、ビュー、および初期展開後に加えられた変更とストアド プロシージャの作成を含める必要がありますので、大きな変更ログになります。 スペクトルのもう一方の端では、最初に、実稼働環境に配置されているデータベースのバージョンとしてベースラインを設定できます。 この選択は、次の最初の配置データベースへの変更のみが含まれるために、変更ログはこれより小さな量で生成されます。 これは、(_n) アプローチです。 もちろんできますを選択して道路アプローチの複数の中間、基準を定義するその時点までの間、データベースの最初の作成と、データベースが最初に展開される場合。

作成したら、選択されたベースラインは構成基準のバージョンを再作成を実行できる SQL スクリプトを生成を検討します。 このようなスクリプトでは、データベースのベースライン バージョンを簡単に再作成すること。 この機能が特に役立つ大規模なプロジェクトのプロジェクトまたはテスト、ステージングなどの他の環境で作業する複数の開発者がある可能性がありますでそのそれぞれに独自のデータベースのコピーを必要があります。

これは、さまざまなツールを利用できるように構成基準のバージョンの SQL スクリプトを生成します。 SQL Server Management Studio (SSMS)、データベースを右クリックしては、タスク サブメニューに移動し、スクリプトの生成オプションを選択します。 これは、スクリプトの作成ウィザードは、オブジェクトを作成するデータベースの SQL コマンドを含むファイルを生成するように指示できますを起動します。 データベース パブリッシュ ウィザードには、だけでなく、データベース テーブルに、データベース スキーマも、データを作成する SQL コマンドを生成することもできます。 データベース パブリッシュ ウィザードの詳細に調査に戻り、*データベースの配置*チュートリアルです。 使用するどのようなツールに関係なく末尾が必要で、データベースのベースライン バージョンを再作成に使用できるスクリプト ファイル必要な発生します。

## <a name="documenting-the-database-changes-in-prose"></a>通常の文章でデータベースの変更を文書化します。

開発フェーズ中に、データ モデルへの変更のログを保持する最も簡単な方法では、通常の文章での変更を記録します。 たとえば、展開済みアプリケーションの開発中に、新しい列を追加する場合、`Employees`テーブルから列を削除してください、`Orders`テーブル、および新しいテーブルの追加 (`ProductCategories`)、テキスト ファイルまたは Microsoft Word 文書を維持します。次の履歴。

<a id="0.4_table01"></a>


| **変更日** | **変更の詳細** |
| --- | --- |
| 2009-02-03: | 追加された列`DepartmentID`(`int`、NOT NULL) を`Employees`テーブル。 外部キー制約を追加`Departments.DepartmentID`に`Employees.DepartmentID`です。 |
| 2009-02-05: | 削除された列`TotalWeight`から、`Orders`テーブル。 既にキャプチャしたデータが関連付けられている`OrderDetails`レコード。 |
| 2009-02-12: | 作成された、`ProductCategories`テーブル。 次の 3 つの列がある: `ProductCategoryID` (`int`、 `IDENTITY`、 `NOT NULL`)、 `CategoryName` (`nvarchar(50)`、 `NOT NULL`)、および`Active`(`bit`、 `NOT NULL`)。 主キー制約を追加`ProductCategoryID`と、既定値は 1 ~`Active`します。 |


この手法の欠点の数があります。 まず、automation の見込みはありません。 いつでもこれらの変更する必要があります、データベースに適用するなど、アプリケーションの展開 - 開発者を手動で実装する必要がありますと各変更と、一度に 1 つずつです。 さらに、変更のログを使用して基準からのデータベースの特定のバージョンを再構築する必要がある場合行うので時間がかかりますますます多くのログのサイズの増大に応じて拡張。 このメソッドに別の欠点をわかりやすくするため、各変更のログ エントリの詳細レベルは、左からユーザーの変更を記録します。 複数の開発者とチームの他のものよりより詳細なより読みやすい、またはより細かくのエントリが作成一部可能性があります。 また、入力ミスおよびその他の人に関連するデータ エントリ エラー場合があります。

通常の文章でデータベースの変更を文書化の主な利点は、わかりやすくするためです。 T 必要知識の作成およびデータベース オブジェクトを変更するための SQL 構文ではありません。 代わりに、通常の文章での変更を記録し、SQL Server Management Studio のグラフィカル ユーザー インターフェイスからそれらを実装できます。

複数の開発者を伴う場合も、データ モデルを頻繁に変更がある通常の文章での変更ログは、確かに、スコープで大きなしたものなど、特定のプロジェクトで作業を非常に高度な受注 t を維持します。 この方法がうまくのデータ モデルに生じる変更のみを持ち、場所、単独の開発者が強力なバック グラウンドを作成およびデータベース オブジェクトを変更するための SQL 構文では、小さな、単独のプロジェクトの作業を表示しました。

> [!NOTE]
> 変更ログ内の情報は、技術的には、展開時までにのみ必要、変更の履歴を保持することをお勧めします。 1 つを維持するではなく変更ログ ファイルをこれまで増加することを検討データベース バージョンごとにログ ファイルを別の変更。 通常するバージョンにデータベースが配置されるたびできます。 変更ログのログを管理することにより、ベースラインから開始を再作成する任意のデータベース バージョン バージョン 1 から始まる変更ログ スクリプトを実行することによってとするバージョンに到達するまで続行を再作成する必要があります。


## <a name="recording-the-sql-change-statements"></a>変更の SQL ステートメントの記録

通常の文章で変更のログを維持するための主な欠点は、オートメーションがないことです。 理想的には、展開時に、実稼働データベースにデータベースの変更を実装することは手順のリストを手動で実行することのではなく、スクリプトを実行するボタンをクリックすると同じくらい簡単でしょう。 このようなオートメーションは、データ モデルを変更するために使用するそれらの SQL コマンドを含む変更ログを保持することによって可能性があります。

SQL 構文には、作成して、さまざまなデータベース オブジェクトを変更するためのステートメントの数が含まれています。 たとえば、 [ *CREATE TABLE ステートメント*](https://msdn.microsoft.com/library/ms174979.aspx)を実行すると、指定した列と制約で新しいテーブルを作成します。 [ *ALTER TABLE ステートメント*](https://msdn.microsoft.com/library/ms190273.aspx)追加、削除、またはその列または制約を変更する既存のテーブルを変更します。 作成、変更、およびインデックス、ビュー、ユーザー定義関数、ストアド プロシージャ、トリガー、およびその他のデータベース オブジェクトを削除するステートメントもあります。

新しい列を追加する展開済みアプリケーションの開発中にイメージを前述の例に戻る、`Employees`テーブルから列を削除してください、`Orders`テーブル、および新しいテーブルの追加 (`ProductCategories`)。 などの操作は、次の SQL コマンドで変更のログ ファイルになります。

[!code-sql[Main](strategies-for-database-development-and-deployment-cs/samples/sample1.sql)]

1 回のクリック操作は、展開時に、実稼働データベースにこれらの変更をプッシュします。 SQL Server Management Studio を開き、、実稼働データベースへの接続、新しいクエリ ウィンドウを開き、変更ログの内容を貼り付けますおよびスクリプトを実行する実行 をクリックします。

## <a name="using-a-comparison-tool-to-synchronize-the-data-models"></a>比較ツールを使用して、データ モデルを同期するには

データベースの変更の通常の文章でドキュメントの作成は簡単です。 が、変更を実装するには、開発者は、一度に; のいずれかの実稼働データベースでそれぞれの変更を行うことが必要です。変更 SQL コマンドを文書化、ボタンをクリックして簡単で実稼働データベースでそれらの変更を実装することにより、学習し、SQL ステートメントとの作成およびデータベース オブジェクトを変更するための構文を使いこなすが必要です。 データベースの比較ツールは、両方のアプローチから最良のものを行い、最悪を破棄します。

データベースの比較ツールは、スキーマまたは 2 つのデータベースのデータを比較し、データベースの動作の違いを示すサマリー レポートを表示します。 次に、ボタンをクリックして、1 つまたは複数のデータベース オブジェクトを同期するための SQL コマンドを生成できます。 簡単に言うと、データベースの比較ツールを使用するには、開発を比較して、実行時に変更が適用される実稼働データベースのスキーマにそのため、実稼働データベースの展開時に SQL を含んでいるファイルを生成するコマンドが開発データベース %s のスキーマを反映します。

これは、さまざまなサード パーティ製データベース比較ツールがさまざまなベンダーが提供します。 このような 1 つの例は[ *SQL Compare*](http://www.red-gate.com/products/SQL_Compare/)により、 [ *Red Gate Software*](http://www.red-gate.com/)です。 比較し、開発と実稼働データベースのスキーマを同期する SQL の比較を使用して処理順を追って s を使用できます。

> [!NOTE]
> この記事の執筆時に、現在のバージョンの SQL 比較は、バージョン 7.1、395 ドルのコスト、Standard Edition とをでした。 14 日間の無料試用版をダウンロードしていくことができます。


SQL の比較の開始時に比較プロジェクト ダイアログ ボックスが開き、保存済みの SQL 比較イベントを表示します。 新しいプロジェクトを作成します。 比較する、データベースに関する情報の入力を求められるプロジェクト構成ウィザードが起動 (図 1 を参照してください)。 開発および運用環境のデータベースの情報を入力します。


[![開発と実稼働データベースを比較します。](strategies-for-database-development-and-deployment-cs/_static/image2.jpg)](strategies-for-database-development-and-deployment-cs/_static/image1.jpg)

**図 1**: 開発と実稼働データベースの比較 ([フルサイズのイメージを表示するをクリックして](strategies-for-database-development-and-deployment-cs/_static/image3.jpg))


> [!NOTE]
> かどうか、開発環境のデータベースは、SQL Express Edition のデータベース ファイルで、`App_Data`図 1 に示すように、ダイアログ ボックスから選択するために、SQL Server Express データベース サーバーでデータベースを登録する必要があります、web サイトのフォルダーです。 これを実現する最も簡単な方法は、SQL Server Management Studio (SSMS) を開き、SQL Server Express データベース サーバーに接続し、データベースをアタッチするのにです。 SSMS のコンピューターにインストールされていない場合は、ダウンロードしてから無料でインストール[*バージョンの SQL Server 2008 Management Studio Basic*](https://www.microsoft.com/downloads/details.aspx?FamilyId=7522A683-4CB2-454E-B908-E805E9BD4E28&amp;displaylang=en)です。


比較するデータベースを選択するだけでなく、さまざまなオプション タブから比較の設定も指定できます。1 つのオプションをオンにすることがありますが、「を無視する制約とインデックス名」 前のチュートリアルでは追加されたこと、アプリケーション サービスの開発と実稼働データベースにデータベース オブジェクトに注意してください。 使用した場合、`aspnet_regsql.exe`ツールを開発および運用データベース間に主キーと一意の制約名が異なることがわかります実稼働データベースでこれらのオブジェクトを作成します。 その結果、SQL 比較フラグが設定される、すべてのアプリケーション サービス テーブルが異なるとします。 「を無視する制約とインデックス名」のままにすることができますか、チェックを行わないと制約名の同期または SQL の比較をこれらの相違を無視するように指示します。

データベースを選択した後の比較 (および、比較オプションの確認)、ボタンをクリック、今すぐ比較比較を開始します。 次の数秒では SQL Compare を 2 つのデータベースのスキーマを調べてをどのように異なるのレポートを生成します。 開発用データベースを SQL Compare インターフェイスでこのような相違点を説明する方法を表示するいくつかの変更を意図的に作成しています。 図 2 に示すすれば追加したら、`BirthDate`列を`Authors`テーブル、削除、`ISBN`から列、`Books`テーブル、および新しいテーブルを追加`Ratings`サイト率を確認済みのブックにアクセスできるようにするものではします。

> [!NOTE]
> このチュートリアルでデータ モデルの変更は、データベースの比較ツールを使用して説明するために行われました。 今後のチュートリアルで、データベースにこれらの変更を表示はされていません。


[![SQL の比較は、開発と実稼働データベースの違いを示します](strategies-for-database-development-and-deployment-cs/_static/image5.jpg)](strategies-for-database-development-and-deployment-cs/_static/image4.jpg)

**図 2**: SQL 比較の開発との間の相違点と実稼働データベースの一覧 ([フルサイズのイメージを表示するをクリックして](strategies-for-database-development-and-deployment-cs/_static/image6.jpg))


データベース オブジェクトをグループに分割する SQL Compare、どのようなオブジェクトをすばやく表示する両方のデータベースに存在別、オブジェクトが 1 つのデータベースが、一方に存在してがどのオブジェクトが同じです。 両方のデータベースに存在しますが、異なる 2 つのオブジェクトがあることがわかります。`Authors`列が追加されたテーブルと`Books`テーブルで、1 つ削除します。 つまり、新しく作成された開発用データベースにのみ存在する 1 つのオブジェクトがある`Ratings`テーブル。 両方のデータベースで同一である 117 オブジェクトが存在します。

データベース オブジェクトを選択するには、これらのオブジェクトの動作の違いを表示する SQL の相違ウィンドウが表示されます。 図 2 の下部に表示される、SQL の相違点 ウィンドウが強調表示する、 `Authors` 、開発用データベース内のテーブルが、`BirthDate`列に載っていない、`Authors`実稼働データベースのテーブルです。

相違点を確認し、同期するオブジェクトを選択すると、した後は、次の手順は、開発用データベースに一致するように、実稼働データベースの s スキーマの更新に必要な SQL コマンドを生成します。 これは、同期ウィザードを使用します。 同期ウィザードことを確認どのようなオブジェクトを同期するために、アクションの概要を示します (図 3 を参照してください) を計画します。 データベースをすぐに同期したり、都合実行可能な SQL コマンドを使用してスクリプトを生成できます。


[![同期ウィザードを使用して、データベース スキーマを同期するには](strategies-for-database-development-and-deployment-cs/_static/image8.jpg)](strategies-for-database-development-and-deployment-cs/_static/image7.jpg)

**図 3**: データベース スキーマの同期の同期ウィザードを使用して ([フルサイズのイメージを表示するをクリックして](strategies-for-database-development-and-deployment-cs/_static/image9.jpg))


データベースの比較ツールなどの Red Gate Software の SQL Compare s ように、実稼働データベースをポイントし、をクリックすると簡単に開発データベース スキーマに変更を適用します。

> [!NOTE]
> SQL の比較を比較し、2 つのデータベースを同期*スキーマ*です。 残念ながら、いないを比較し、2 つのデータベース テーブル内のデータを同期します。 Red Gate Software という名前の製品を提供して[ *SQL データの比較*](http://www.red-gate.com/products/SQL_Data_Compare/)を比較し、2 つのデータベース間のデータを同期する、SQL の比較から別の製品であり 395 別ドルのコストがかかります。


## <a name="taking-the-application-offline-during-deployment"></a>配置時にアプリケーションをオフライン

おとしてこれらのチュートリアルでは、全体を見てきました展開は複数の手順を含むプロセス: 開発環境から実稼働へ ASP.NET ページ、マスター ページ、CSS ファイル、JavaScript ファイル、画像、およびその他の必要なコンテンツのコピー環境です。が必要な場合に、実稼働環境に固有の構成情報をコピー前回の配置データ モデルに変更を適用しています。 ファイルの数と、データベースの変更の複雑さ、に応じて次の手順からかかることが任意の場所は数秒数分を完了します。 流動的で web アプリケーションは、この期間中に、サイトにアクセスするユーザーは、エラーまたは予期しない動作が発生します。

Web サイトを展開するときに、展開が完了するまで、「オフライン」web アプリケーションを実行することをお勧めします。 アプリケーションをオフラインにする (とすると、そのバックアップを作成、展開プロセスが終了すると) ファイルをアップロードして、削除する同じくらい簡単です。 ASP.NET 2.0 では、という名前のファイルが存在するだけで始まる`app_offline.htm`アプリケーション s にルート ディレクトリは、全体の web サイト「オフライン」です。 内容では、そのサイトで ASP.NET ページへの要求は応答が自動的に、`app_offline.htm`ファイル。 そのファイルが削除されると、アプリケーションがオンラインに戻る。

オフラインの展開時に、次に、アプリケーションはアップロードするだけで、 `app_offline.htm` s 実稼働環境へのファイルのルート ディレクトリ展開プロセスを開始し、削除する (または別のものに名前を変更する) の前に 1 回の展開完了しました。 この方法の詳細については、John peterson と一緒にお届けの資料を参照してくださいを[ *ASP.NET アプリケーション オフライン*](http://www.15seconds.com/issue/061207.htm)です。

## <a name="summary"></a>まとめ

データ ドリブン アプリケーションを配置する主な課題、データベースの配置を中心として展開します。 開発環境で 1、および実稼働環境で 1 つのデータベースの 2 つのバージョンがあるためには、開発の新機能が追加されるとこれらの 2 つのデータベース スキーマがとれてなります。 さらに、実際のユーザーからの実際のデータで作成されると、実稼働データベースをすることはできませんを上書きするため、実稼働データベースで変更された開発用データベース (ASP.NET ページ、アプリケーションを構成するファイルを展開する場合と同様にどのような s画像ファイルなど)。 代わりに、データベースを展開する場合は、前回の配置、実稼働データベースの開発用データベースに加えられた変更の正確なセットを実装する必要があります。

このチュートリアルは、3 つの手法を保守し、データベースの変更のログを適用することであった。 最も簡単な方法では、通常の文章での変更を記録します。 この方針がいる実稼働データベースの手動プロセスでこれらの変更を実装する場合は不要 SQL コマンドのナレッジを作成およびデータベース オブジェクトを変更するためです。 高度なアプローチでは、および複数の開発者と大規模なプロジェクトまたはプロジェクトでより適切である 1 つは、一連の SQL コマンドとして、変更を記録するです。 これは、ターゲット データベースにこれらの変更をロールアウトが大幅に hastens です。 両方のアプローチの最適なは、SQL Compare Red Gate Software s などのデータベースの比較ツールを使用して実現できます。

このチュートリアルでは、データ ドリブン アプリケーションの配置への取り組みで終了します。 次のチュートリアルのセットは、実稼働環境でのエラーに応答する方法を検索します。 黄色の画面死亡の代わりにではなくフレンドリ エラー ページを表示する方法を紹介します。 このようなエラーが発生したときにアラートを生成する方法と、s のエラーの詳細を記録する方法を見てみましょう。

満足プログラミング!

> [!div class="step-by-step"]
> [前へ](configuring-a-website-that-uses-application-services-cs.md)
> [次へ](displaying-a-custom-error-page-cs.md)
