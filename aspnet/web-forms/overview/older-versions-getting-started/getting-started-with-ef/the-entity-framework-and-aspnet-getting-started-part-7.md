---
uid: web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
title: "データベースの概要 Entity Framework 4.0 最初および ASP.NET 4 Web フォームの第 7 部 |Microsoft ドキュメント"
author: tdykstra
description: "Contoso 大学でサンプル web アプリケーションでは、Entity Framework を使用して ASP.NET Web フォーム アプリケーションを作成する方法を示します。 サンプル アプリケーションは、."
ms.author: aspnetcontent
manager: wpickett
ms.date: 12/03/2010
ms.topic: article
ms.assetid: f8afb245-b705-419c-8790-0b295e90d5e2
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/getting-started-with-ef/the-entity-framework-and-aspnet-getting-started-part-7
msc.type: authoredcontent
ms.openlocfilehash: aeea122636f5235364e6a40cb6e041b1fe221317
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="getting-started-with-entity-framework-40-database-first-and-aspnet-4-web-forms---part-7"></a><span data-ttu-id="ba029-104">データベースの概要 Entity Framework 4.0 最初および ASP.NET 4 Web フォームの第 7 部</span><span class="sxs-lookup"><span data-stu-id="ba029-104">Getting Started with Entity Framework 4.0 Database First and ASP.NET 4 Web Forms - Part 7</span></span>
====================
<span data-ttu-id="ba029-105">によって[Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="ba029-105">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

> <span data-ttu-id="ba029-106">Contoso 大学でサンプル web アプリケーションでは、Entity Framework 4.0 および Visual Studio 2010 を使用して ASP.NET Web フォーム アプリケーションを作成する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="ba029-106">The Contoso University sample web application demonstrates how to create ASP.NET Web Forms applications using the Entity Framework 4.0 and Visual Studio 2010.</span></span> <span data-ttu-id="ba029-107">一連のチュートリアルについては、次を参照してください[系列内の最初のチュートリアル。](the-entity-framework-and-aspnet-getting-started-part-1.md)</span><span class="sxs-lookup"><span data-stu-id="ba029-107">For information about the tutorial series, see [the first tutorial in the series](the-entity-framework-and-aspnet-getting-started-part-1.md)</span></span>


## <a name="using-stored-procedures"></a><span data-ttu-id="ba029-108">ストアド プロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="ba029-108">Using Stored Procedures</span></span>

<span data-ttu-id="ba029-109">前のチュートリアルでは、テーブルの階層あたりの継承パターンを実装します。</span><span class="sxs-lookup"><span data-stu-id="ba029-109">In the previous tutorial you implemented a table-per-hierarchy inheritance pattern.</span></span> <span data-ttu-id="ba029-110">このチュートリアルでは、ストアド プロシージャを使用して、データベースのアクセスをより詳細に制御する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="ba029-110">This tutorial will show you how to use stored procedures to gain more control over database access.</span></span>

<span data-ttu-id="ba029-111">Entity Framework では、データベースへのアクセスのストアド プロシージャを使用するように指定することができます。</span><span class="sxs-lookup"><span data-stu-id="ba029-111">The Entity Framework lets you specify that it should use stored procedures for database access.</span></span> <span data-ttu-id="ba029-112">任意のエンティティ型の作成、更新、またはその型のエンティティの削除に使用するストアド プロシージャを指定できます。</span><span class="sxs-lookup"><span data-stu-id="ba029-112">For any entity type, you can specify a stored procedure to use for creating, updating, or deleting entities of that type.</span></span> <span data-ttu-id="ba029-113">データ モデルでは、エンティティのセットを取得するなどのタスクの実行に使用できるストアド プロシージャへの参照を追加できます。</span><span class="sxs-lookup"><span data-stu-id="ba029-113">Then in the data model you can add references to stored procedures that you can use to perform tasks such as retrieving sets of entities.</span></span>

<span data-ttu-id="ba029-114">データベースへのアクセスの一般的な要件は、ストアド プロシージャを使用します。</span><span class="sxs-lookup"><span data-stu-id="ba029-114">Using stored procedures is a common requirement for database access.</span></span> <span data-ttu-id="ba029-115">場合によっては、データベース管理者は、すべてのデータベースへのアクセスがセキュリティ上の理由のためのストアド プロシージャを介して行われる必要があります。</span><span class="sxs-lookup"><span data-stu-id="ba029-115">In some cases a database administrator may require that all database access go through stored procedures for security reasons.</span></span> <span data-ttu-id="ba029-116">それ以外の場合、データベースを更新するときに、Entity Framework が使用するプロセスの一部にビジネス ロジックを構築する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="ba029-116">In other cases you may want to build business logic into some of the processes that the Entity Framework uses when it updates the database.</span></span> <span data-ttu-id="ba029-117">たとえば、エンティティを削除するたびに可能性があるアーカイブ データベースにコピーします。</span><span class="sxs-lookup"><span data-stu-id="ba029-117">For example, whenever an entity is deleted you might want to copy it to an archive database.</span></span> <span data-ttu-id="ba029-118">または、行が更新されるたびには、変更を行ったユーザーを記録するログ テーブルに行を記述することができます。</span><span class="sxs-lookup"><span data-stu-id="ba029-118">Or whenever a row is updated you might want to write a row to a logging table that records who made the change.</span></span> <span data-ttu-id="ba029-119">Entity Framework のエンティティを削除またはエンティティを更新するたびに呼び出されるストアド プロシージャでは、このようなタスクを実行できます。</span><span class="sxs-lookup"><span data-stu-id="ba029-119">You can perform these kinds of tasks in a stored procedure that's called whenever the Entity Framework deletes an entity or updates an entity.</span></span>

<span data-ttu-id="ba029-120">前のチュートリアルと同様にない新しいページを作成します。</span><span class="sxs-lookup"><span data-stu-id="ba029-120">As in the previous tutorial, you'll not create any new pages.</span></span> <span data-ttu-id="ba029-121">代わりに、Entity Framework をまだ作成して、ページの一部のデータベースにアクセスする方法を変更します。</span><span class="sxs-lookup"><span data-stu-id="ba029-121">Instead, you'll change the way the Entity Framework accesses the database for some of the pages you already created.</span></span>

<span data-ttu-id="ba029-122">このチュートリアルでは、挿入するため、データベース内のストアド プロシージャを作成します`Student`と`Instructor`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="ba029-122">In this tutorial you'll create stored procedures in the database for inserting `Student` and `Instructor` entities.</span></span> <span data-ttu-id="ba029-123">データ モデルを追加して、Entity Framework 必要がありますを追加するために使用を指定します`Student`と`Instructor`エンティティをデータベースにします。</span><span class="sxs-lookup"><span data-stu-id="ba029-123">You'll add them to the data model, and you'll specify that the Entity Framework should use them for adding `Student` and `Instructor` entities to the database.</span></span> <span data-ttu-id="ba029-124">取得に使用できるストアド プロシージャを作成することもあります。`Course`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="ba029-124">You'll also create a stored procedure that you can use to retrieve `Course` entities.</span></span>

## <a name="creating-stored-procedures-in-the-database"></a><span data-ttu-id="ba029-125">データベースでストアド プロシージャの作成</span><span class="sxs-lookup"><span data-stu-id="ba029-125">Creating Stored Procedures in the Database</span></span>

<span data-ttu-id="ba029-126">(使用する場合、 *School.mdf*ファイル プロジェクトからこのチュートリアルをダウンロードできる、ストアド プロシージャが既に存在するため、このセクションをスキップできます)。</span><span class="sxs-lookup"><span data-stu-id="ba029-126">(If you're using the *School.mdf* file from the project available for download with this tutorial, you can skip this section because the stored procedures already exist.)</span></span>

<span data-ttu-id="ba029-127">**サーバー エクスプ ローラー**、展開*School.mdf*を右クリックして**Stored Procedures**を選択し、**新しいストアド プロシージャの追加**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-127">In **Server Explorer**, expand *School.mdf*, right-click **Stored Procedures**, and select **Add New Stored Procedure**.</span></span>

<span data-ttu-id="ba029-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-128">[![image15](the-entity-framework-and-aspnet-getting-started-part-7/_static/image2.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image1.png)</span></span>

<span data-ttu-id="ba029-129">次の SQL ステートメントをコピーし、貼り付けるストアド プロシージャ ウィンドウで、スケルトンのストアド プロシージャを置換します。</span><span class="sxs-lookup"><span data-stu-id="ba029-129">Copy the following SQL statements and paste them into the stored procedure window, replacing the skeleton stored procedure.</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample1.sql)]

<span data-ttu-id="ba029-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-130">[![image14](the-entity-framework-and-aspnet-getting-started-part-7/_static/image4.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image3.png)</span></span>

<span data-ttu-id="ba029-131">`Student`エンティティがある 4 つのプロパティ: `PersonID`、 `LastName`、 `FirstName`、および`EnrollmentDate`です。</span><span class="sxs-lookup"><span data-stu-id="ba029-131">`Student` entities have four properties: `PersonID`, `LastName`, `FirstName`, and `EnrollmentDate`.</span></span> <span data-ttu-id="ba029-132">データベース ID 値を自動的に生成して、ストアド プロシージャは、その他の 3 つのパラメーターを受け取ります。</span><span class="sxs-lookup"><span data-stu-id="ba029-132">The database generates the ID value automatically, and the stored procedure accepts parameters for the other three.</span></span> <span data-ttu-id="ba029-133">ストアド プロシージャは、Entity Framework を追跡できますをメモリに保持するエンティティのバージョンように、新しい行のレコードのキーの値を返します。</span><span class="sxs-lookup"><span data-stu-id="ba029-133">The stored procedure returns the value of the new row's record key so that the Entity Framework can keep track of that in the version of the entity it keeps in memory.</span></span>

<span data-ttu-id="ba029-134">保存して、ストアド プロシージャ ウィンドウを閉じます。</span><span class="sxs-lookup"><span data-stu-id="ba029-134">Save and close the stored procedure window.</span></span>

<span data-ttu-id="ba029-135">作成、`InsertInstructor`ストアド プロシージャを次の SQL ステートメントを使用して、同じ方法で。</span><span class="sxs-lookup"><span data-stu-id="ba029-135">Create an `InsertInstructor` stored procedure in the same manner, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample2.sql)]

<span data-ttu-id="ba029-136">作成`Update`ストアド プロシージャの`Student`と`Instructor`エンティティもします。</span><span class="sxs-lookup"><span data-stu-id="ba029-136">Create `Update` stored procedures for `Student` and `Instructor` entities also.</span></span> <span data-ttu-id="ba029-137">(データベースは既に、`DeletePerson`ストアド プロシージャの両方で動作する`Instructor`と`Student`エンティティです)。</span><span class="sxs-lookup"><span data-stu-id="ba029-137">(The database already has a `DeletePerson` stored procedure which will work for both `Instructor` and `Student` entities.)</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample3.sql)]

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample4.sql)]

<span data-ttu-id="ba029-138">このチュートリアルではエンティティ型ごとのすべての 3 つ関数--insert、update、および delete--をマップします。</span><span class="sxs-lookup"><span data-stu-id="ba029-138">In this tutorial you'll map all three functions -- insert, update, and delete -- for each entity type.</span></span> <span data-ttu-id="ba029-139">Entity Framework バージョン 4 では、1 つだけマップできますまたは、他のユーザー、1 つの例外を割り当てずにストアド プロシージャにこれらの 2 つの関数: Entity Framework は例外をスロー マップする場合、update 関数が、削除関数ではない、ときにする。エンティティを削除しようとしてください。</span><span class="sxs-lookup"><span data-stu-id="ba029-139">The Entity Framework version 4 allows you to map just one or two of these functions to stored procedures without mapping the others, with one exception: if you map the update function but not the delete function, the Entity Framework will throw an exception when you attempt to delete an entity.</span></span> <span data-ttu-id="ba029-140">Entity Framework バージョン 3.5 ではありませんでしたストアド プロシージャのマッピングにこれほどの柔軟性: 3 つすべてをマップする必要がある 1 つの関数をマップする場合。</span><span class="sxs-lookup"><span data-stu-id="ba029-140">In the Entity Framework version 3.5, you did not have this much flexibility in mapping stored procedures: if you mapped one function you were required to map all three.</span></span>

<span data-ttu-id="ba029-141">データを更新するのではなく、読み取りをストアド プロシージャを作成するには、すべて選択する 1 つを作成`Course`エンティティ、次の SQL ステートメントを使用します。</span><span class="sxs-lookup"><span data-stu-id="ba029-141">To create a stored procedure that reads rather than updates data, create one that selects all `Course` entities, using the following SQL statements:</span></span>

[!code-sql[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample5.sql)]

## <a name="adding-the-stored-procedures-to-the-data-model"></a><span data-ttu-id="ba029-142">データ モデルにストアド プロシージャを追加します。</span><span class="sxs-lookup"><span data-stu-id="ba029-142">Adding the Stored Procedures to the Data Model</span></span>

<span data-ttu-id="ba029-143">ストアド プロシージャは、データベースで定義されているようになりましたが、これらは、Entity Framework に使用できるようにするデータ モデルに追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="ba029-143">The stored procedures are now defined in the database, but they must be added to the data model to make them available to the Entity Framework.</span></span> <span data-ttu-id="ba029-144">開いている*SchoolModel.edmx*をデザイン サーフェイスを右クリックし、**データベースからモデルを更新**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-144">Open *SchoolModel.edmx*, right-click the design surface, and select **Update Model from Database**.</span></span> <span data-ttu-id="ba029-145">**追加**のタブ、**データベース オブジェクトの選択** ダイアログ ボックスで、展開**Stored Procedures**、新しく作成されたストアド プロシージャを選択し、 `DeletePerson`ストアド プロシージャをクリックして**完了**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-145">In the **Add** tab of the **Choose Your Database Objects** dialog box, expand **Stored Procedures**, select the newly created stored procedures and the `DeletePerson` stored procedure, and then click **Finish**.</span></span>

<span data-ttu-id="ba029-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-146">[![image20](the-entity-framework-and-aspnet-getting-started-part-7/_static/image6.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image5.png)</span></span>

## <a name="mapping-the-stored-procedures"></a><span data-ttu-id="ba029-147">ストアド プロシージャのマッピング</span><span class="sxs-lookup"><span data-stu-id="ba029-147">Mapping the Stored Procedures</span></span>

<span data-ttu-id="ba029-148">データ モデル デザイナー内を右クリックし、`Student`エンティティと選択**ストアド プロシージャ マッピング**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-148">In the data model designer, right-click the `Student` entity and select **Stored Procedure Mapping**.</span></span>

<span data-ttu-id="ba029-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-149">[![image21](the-entity-framework-and-aspnet-getting-started-part-7/_static/image8.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image7.png)</span></span>

<span data-ttu-id="ba029-150">**マッピングの詳細**ウィンドウが表示されたら、Entity Framework は、挿入、更新、およびこの型のエンティティの削除に使用するストアド プロシージャを指定することができます。</span><span class="sxs-lookup"><span data-stu-id="ba029-150">The **Mapping Details** window appears, in which you can specify stored procedures that the Entity Framework should use for inserting, updating, and deleting entities of this type.</span></span>

<span data-ttu-id="ba029-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-151">[![image22](the-entity-framework-and-aspnet-getting-started-part-7/_static/image10.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image9.png)</span></span>

<span data-ttu-id="ba029-152">設定、**挿入**関数**InsertStudent**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-152">Set the **Insert** function to **InsertStudent**.</span></span> <span data-ttu-id="ba029-153">ウィンドウは、エンティティ プロパティにそれぞれがマップする必要があります、ストアド プロシージャのパラメーターの一覧を示します。</span><span class="sxs-lookup"><span data-stu-id="ba029-153">The window shows a list of stored procedure parameters, each of which must be mapped to an entity property.</span></span> <span data-ttu-id="ba029-154">これらの 2 つが自動的にマップ名前が同じであるためです。</span><span class="sxs-lookup"><span data-stu-id="ba029-154">Two of these are mapped automatically because the names are the same.</span></span> <span data-ttu-id="ba029-155">名前付きエンティティのプロパティが存在しない`FirstName`手動で選択する必要がありますので、`FirstMidName`使用可能なエンティティのプロパティを表示するドロップダウン リストからです。</span><span class="sxs-lookup"><span data-stu-id="ba029-155">There's no entity property named `FirstName`, so you must manually select `FirstMidName` from a drop-down list that shows available entity properties.</span></span> <span data-ttu-id="ba029-156">(これは、名前を変更したため、`FirstName`プロパティを`FirstMidName`内の最初のチュートリアルです)。</span><span class="sxs-lookup"><span data-stu-id="ba029-156">(This is because you changed the name of the `FirstName` property to `FirstMidName` in the first tutorial.)</span></span>

<span data-ttu-id="ba029-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-157">[![image23](the-entity-framework-and-aspnet-getting-started-part-7/_static/image12.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image11.png)</span></span>

<span data-ttu-id="ba029-158">同じ**マッピングの詳細**ウィンドウで、マップ、`Update`関数を`UpdateStudent`ストアド プロシージャ (を指定するかどうかを確認`FirstMidName`のパラメーター値として`FirstName`場合と同様、 `Insert`ストアド プロシージャ) および`Delete`関数を`DeletePerson`ストアド プロシージャです。</span><span class="sxs-lookup"><span data-stu-id="ba029-158">In the same **Mapping Details** window, map the `Update` function to the `UpdateStudent` stored procedure (make sure you specify `FirstMidName` as the parameter value for `FirstName`, as you did for the `Insert` stored procedure) and the `Delete` function to the `DeletePerson` stored procedure.</span></span>

<span data-ttu-id="ba029-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-159">[![image01](the-entity-framework-and-aspnet-getting-started-part-7/_static/image14.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image13.png)</span></span>

<span data-ttu-id="ba029-160">講習においてインストラクターにストアド プロシージャの挿入、更新、および削除をマップする同じ手順に従って、`Instructor`エンティティです。</span><span class="sxs-lookup"><span data-stu-id="ba029-160">Follow the same procedure to map the insert, update, and delete stored procedures for instructors to the `Instructor` entity.</span></span>

<span data-ttu-id="ba029-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-161">[![image02](the-entity-framework-and-aspnet-getting-started-part-7/_static/image16.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image15.png)</span></span>

<span data-ttu-id="ba029-162">使用するデータの更新ではなく読み取りストアド プロシージャの場合、**モデル ブラウザー**ストアド プロシージャをエンティティにマップするウィンドウから、入力を返します。</span><span class="sxs-lookup"><span data-stu-id="ba029-162">For stored procedures that read rather than update data, you use the **Model Browser** window to map the stored procedure to the entity type it returns.</span></span> <span data-ttu-id="ba029-163">データ モデル デザイナーでデザイン画面と選択を右クリックして**モデル ブラウザー**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-163">In the data model designer, right-click the design surface and select **Model Browser**.</span></span> <span data-ttu-id="ba029-164">開く、 **SchoolModel.Store**ノードし、開きます、 **Stored Procedures**ノード。</span><span class="sxs-lookup"><span data-stu-id="ba029-164">Open the **SchoolModel.Store** node and then open the **Stored Procedures** node.</span></span> <span data-ttu-id="ba029-165">右クリックし、`GetCourses`ストアド プロシージャと選択**関数インポートの追加**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-165">Then right-click the `GetCourses` stored procedure and select **Add Function Import**.</span></span>

<span data-ttu-id="ba029-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-166">[![image24](the-entity-framework-and-aspnet-getting-started-part-7/_static/image18.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image17.png)</span></span>

<span data-ttu-id="ba029-167">**関数インポートの追加**ダイアログ ボックスで、**コレクションを返します**選択**エンティティ**、し、`Course`エンティティ型として返されます。</span><span class="sxs-lookup"><span data-stu-id="ba029-167">In the **Add Function Import** dialog box, under **Returns a Collection Of** select **Entities**, and then select `Course` as the entity type returned.</span></span> <span data-ttu-id="ba029-168">完了したら、をクリックして**OK**です。</span><span class="sxs-lookup"><span data-stu-id="ba029-168">When you're done, click **OK**.</span></span> <span data-ttu-id="ba029-169">保存して閉じます、 *.edmx*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ba029-169">Save and close the *.edmx* file.</span></span>

<span data-ttu-id="ba029-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-170">[![image25](the-entity-framework-and-aspnet-getting-started-part-7/_static/image20.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image19.png)</span></span>

## <a name="using-insert-update-and-delete-stored-procedures"></a><span data-ttu-id="ba029-171">Insert を使用して、Update、Delete ストアド プロシージャ</span><span class="sxs-lookup"><span data-stu-id="ba029-171">Using Insert, Update, and Delete Stored Procedures</span></span>

<span data-ttu-id="ba029-172">ストアド プロシージャを挿入するには、更新、およびデータの削除は、Entity Framework によって自動的に使用、データ モデルに追加し、それらを適切なエンティティにマップした後です。</span><span class="sxs-lookup"><span data-stu-id="ba029-172">Stored procedures to insert, update, and delete data are used by the Entity Framework automatically after you've added them to the data model and mapped them to the appropriate entities.</span></span> <span data-ttu-id="ba029-173">今すぐ実行することができます、 *StudentsAdd.aspx*  ページで、新しい学生を作成するたびに、Entity Framework を使用して、`InsertStudent`ストアド プロシージャに新しい行を追加する、`Student`テーブル。</span><span class="sxs-lookup"><span data-stu-id="ba029-173">You can now run the *StudentsAdd.aspx* page, and every time you create a new student, the Entity Framework will use the `InsertStudent` stored procedure to add the new row to the `Student` table.</span></span>

<span data-ttu-id="ba029-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-174">[![image03](the-entity-framework-and-aspnet-getting-started-part-7/_static/image22.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image21.png)</span></span>

<span data-ttu-id="ba029-175">実行、 *Students.aspx*ページおよび新しい学生が一覧に表示します。</span><span class="sxs-lookup"><span data-stu-id="ba029-175">Run the *Students.aspx* page and the new student appears in the list.</span></span>

<span data-ttu-id="ba029-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-176">[![image04](the-entity-framework-and-aspnet-getting-started-part-7/_static/image24.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image23.png)</span></span>

<span data-ttu-id="ba029-177">Update 関数が動作することを確認する名前を変更し、機能の削除が動作することを確認する、受講者を削除します。</span><span class="sxs-lookup"><span data-stu-id="ba029-177">Change the name to verify that the update function works, and then delete the student to verify that the delete function works.</span></span>

<span data-ttu-id="ba029-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="ba029-178">[![image05](the-entity-framework-and-aspnet-getting-started-part-7/_static/image26.png)](the-entity-framework-and-aspnet-getting-started-part-7/_static/image25.png)</span></span>

## <a name="using-select-stored-procedures"></a><span data-ttu-id="ba029-179">Select ストアド プロシージャの使用</span><span class="sxs-lookup"><span data-stu-id="ba029-179">Using Select Stored Procedures</span></span>

<span data-ttu-id="ba029-180">Entity Framework は自動的に実行されないストアド プロシージャなど`GetCourses`、これらを使用することはできませんし、`EntityDataSource`コントロール。</span><span class="sxs-lookup"><span data-stu-id="ba029-180">The Entity Framework does not automatically run stored procedures such as `GetCourses`, and you cannot use them with the `EntityDataSource` control.</span></span> <span data-ttu-id="ba029-181">を使用するには、コードから呼び出しです。</span><span class="sxs-lookup"><span data-stu-id="ba029-181">To use them, you call them from code.</span></span>

<span data-ttu-id="ba029-182">開く、 *InstructorsCourses.aspx.cs*ファイル。</span><span class="sxs-lookup"><span data-stu-id="ba029-182">Open the *InstructorsCourses.aspx.cs* file.</span></span> <span data-ttu-id="ba029-183">`PopulateDropDownLists`メソッドでは、LINQ-エンティティ クエリを使用して、一覧をループし、インストラクターに割り当てられているうち、どれ割り当てが解除されるを決定できるように、すべてのコース エンティティを取得します。</span><span class="sxs-lookup"><span data-stu-id="ba029-183">The `PopulateDropDownLists` method uses a LINQ-to-Entities query to retrieve all course entities so that it can loop through the list and determine which ones an instructor is assigned to and which ones are unassigned:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample6.cs)]

<span data-ttu-id="ba029-184">これを次のコードで置き換えます。</span><span class="sxs-lookup"><span data-stu-id="ba029-184">Replace this with the following code:</span></span>

[!code-csharp[Main](the-entity-framework-and-aspnet-getting-started-part-7/samples/sample7.cs)]

<span data-ttu-id="ba029-185">ページを使用して今すぐ、`GetCourses`ストアド プロシージャをすべてのコースの一覧を取得します。</span><span class="sxs-lookup"><span data-stu-id="ba029-185">The page now uses the `GetCourses` stored procedure to retrieve the list of all courses.</span></span> <span data-ttu-id="ba029-186">以前と同じように動作することを確認する ページを実行します。</span><span class="sxs-lookup"><span data-stu-id="ba029-186">Run the page to verify that it works as it did before.</span></span>

<span data-ttu-id="ba029-187">(ストアド プロシージャによって取得されたエンティティのナビゲーション プロパティがありますいない自動的に設定されますに応じて、これらのエンティティに関連するデータ`ObjectContext`既定の設定。</span><span class="sxs-lookup"><span data-stu-id="ba029-187">(Navigation properties of entities retrieved by a stored procedure might not be automatically populated with the data related to those entities, depending on `ObjectContext` default settings.</span></span> <span data-ttu-id="ba029-188">詳細については、次を参照してください[関連オブジェクトの読み込み](https://msdn.microsoft.com/library/bb896272.aspx)、MSDN ライブラリです。)。</span><span class="sxs-lookup"><span data-stu-id="ba029-188">For more information, see [Loading Related Objects](https://msdn.microsoft.com/library/bb896272.aspx) in the MSDN Library.)</span></span>

<span data-ttu-id="ba029-189">次のチュートリアルでは、Dynamic Data 機能を使用して、プログラムとテスト データの書式設定と検証規則に容易にできるようにする方法を学習します。</span><span class="sxs-lookup"><span data-stu-id="ba029-189">In the next tutorial, you'll learn how to use Dynamic Data functionality to make it easier to program and test data formatting and validation rules.</span></span> <span data-ttu-id="ba029-190">などのデータの書式指定文字列には、各 web ページ ルールとフィールドが必要かどうかを指定することではなくデータ モデルのメタデータでこのようなルールを指定することができ、すべてのページに自動的に適用します。</span><span class="sxs-lookup"><span data-stu-id="ba029-190">Instead of specifying on each web page rules such as data format strings and whether or not a field is required, you can specify such rules in data model metadata and they're automatically applied on every page.</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="ba029-191">[前へ](the-entity-framework-and-aspnet-getting-started-part-6.md)
[次へ](the-entity-framework-and-aspnet-getting-started-part-8.md)</span><span class="sxs-lookup"><span data-stu-id="ba029-191">[Previous](the-entity-framework-and-aspnet-getting-started-part-6.md)
[Next](the-entity-framework-and-aspnet-getting-started-part-8.md)</span></span>
