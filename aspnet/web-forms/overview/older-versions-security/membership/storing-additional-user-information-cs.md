---
uid: web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
title: "追加のユーザー情報 (c#) を格納する |Microsoft ドキュメント"
author: rick-anderson
description: "このチュートリアルでは、非常に基本的なゲストブック アプリケーションを構築してこの質問に回答されます。 そうでは、modeli のさまざまなオプションを確認しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: 1642132a-1ca5-4872-983f-ab59fc8865d3
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/storing-additional-user-information-cs
msc.type: authoredcontent
ms.openlocfilehash: 0d3c622dc352c804ddfea072bf3d52496c719ea6
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="storing-additional-user-information-c"></a><span data-ttu-id="d5e8b-104">ファイルを格納する追加のユーザー情報 (c#)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-104">Storing Additional User Information (C#)</span></span>
====================
<span data-ttu-id="d5e8b-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="d5e8b-106">[コードをダウンロードする](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-106">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_08_CS.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial08_ExtraUserInfo_cs.pdf)</span></span>

> <span data-ttu-id="d5e8b-107">このチュートリアルでは、非常に基本的なゲストブック アプリケーションを構築してこの質問に回答されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-107">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="d5e8b-108">これにより、データベースでは、ユーザー情報をモデルのさまざまなオプションを拝見し、メンバーシップ framework によって作成されたユーザー アカウントにこのデータを関連付ける方法について説明し、されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-108">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span>


## <a name="introduction"></a><span data-ttu-id="d5e8b-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="d5e8b-109">Introduction</span></span>

<span data-ttu-id="d5e8b-110">ASP です。NET のメンバーシップのフレームワークでは、ユーザーを管理するための柔軟なインターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-110">ASP.NET's Membership framework offers a flexible interface for managing users.</span></span> <span data-ttu-id="d5e8b-111">メンバーシップ API には、資格情報の検証、現在ログオンしているユーザーに関する情報を取得する、新しいユーザー アカウントを作成および他のユーザー アカウントを削除するためのメソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-111">The Membership API includes methods for validating credentials, retrieving information about the currently logged on user, creating a new user account, and deleting a user account, among others.</span></span> <span data-ttu-id="d5e8b-112">メンバーシップ フレームワーク内の各ユーザー アカウントには、資格情報を検証し、重要なユーザー アカウントに関連するタスクを実行するために必要なプロパティのみが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-112">Each user account in the Membership framework contains only the properties needed for validating credentials and performing essential user account-related tasks.</span></span> <span data-ttu-id="d5e8b-113">メソッドとプロパティが示すこれは、 [ `MembershipUser`クラス](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.aspx)、メンバーシップ フレームワーク内のユーザー アカウントをモデル化します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-113">This is evidenced by the methods and properties of the [`MembershipUser` class](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.aspx), which models a user account in the Membership framework.</span></span> <span data-ttu-id="d5e8b-114">このクラスのようなプロパティには[ `UserName` ](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.username.aspx)、 [ `Email` ](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.email.aspx)、および[ `IsLockedOut`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.islockedout.aspx)などのメソッドと[ `GetPassword` ](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.getpassword.aspx)と[ `UnlockUser`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.unlockuser.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-114">This class has properties like [`UserName`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.username.aspx), [`Email`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.email.aspx), and [`IsLockedOut`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.islockedout.aspx), and methods like [`GetPassword`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.getpassword.aspx) and [`UnlockUser`](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.unlockuser.aspx).</span></span>

<span data-ttu-id="d5e8b-115">多くの場合、アプリケーションは、メンバーシップ framework に含まれていない追加のユーザー情報を格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-115">Oftentimes, applications need to store additional user information not included in the Membership framework.</span></span> <span data-ttu-id="d5e8b-116">たとえば、オンラインの小売店舗では、各ユーザー、および請求先住所、お支払い情報は、配信設定を保存し、連絡先の電話番号を使用できます必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-116">For example, an online retailer might need to let each user store her shipping and billing addresses, payment information, delivery preferences, and contact phone number.</span></span> <span data-ttu-id="d5e8b-117">さらに、各注文システムでは、特定のユーザー アカウントに関連付けられます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-117">Furthermore, each order in the system is associated with a particular user account.</span></span>

<span data-ttu-id="d5e8b-118">`MembershipUser`クラスなどのプロパティを含まない`PhoneNumber`または`DeliveryPreferences`または`PastOrders`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-118">The `MembershipUser` class does not include properties like `PhoneNumber` or `DeliveryPreferences` or `PastOrders`.</span></span> <span data-ttu-id="d5e8b-119">どのように行うお、アプリケーションで必要なユーザー情報を追跡してそれをメンバーシップ フレームワークに統合しますか。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-119">So how do we track the user information needed by the application and have it integrate with the Membership framework?</span></span> <span data-ttu-id="d5e8b-120">このチュートリアルでは、非常に基本的なゲストブック アプリケーションを構築してこの質問に回答されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-120">In this tutorial we will answer this question by building a very rudimentary guestbook application.</span></span> <span data-ttu-id="d5e8b-121">これにより、データベースでは、ユーザー情報をモデルのさまざまなオプションを拝見し、メンバーシップ framework によって作成されたユーザー アカウントにこのデータを関連付ける方法について説明し、されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-121">In doing so, we will look at different options for modeling user information in a database, and then see how to associate this data with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="d5e8b-122">開始しましょう!</span><span class="sxs-lookup"><span data-stu-id="d5e8b-122">Let's get started!</span></span>

## <a name="step-1-creating-the-guestbook-applications-data-model"></a><span data-ttu-id="d5e8b-123">手順 1: ゲストブック アプリケーションのデータ モデルの作成</span><span class="sxs-lookup"><span data-stu-id="d5e8b-123">Step 1: Creating the Guestbook Application's Data Model</span></span>

<span data-ttu-id="d5e8b-124">これは、さまざまな手法を利用すると、データベース内のユーザー情報をキャプチャし、メンバーシップ、フレームワークによって作成されたユーザー アカウントに関連付けます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-124">There are a variety of techniques that can be employed to capture user information in a database and associate it with the user accounts created by the Membership framework.</span></span> <span data-ttu-id="d5e8b-125">これらの手法を示すためには、するためには、何らかのユーザー関連データがキャプチャされるように、チュートリアルの web アプリケーションを強化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-125">In order to illustrate these techniques, we will need to augment the tutorial web application so that it captures some sort of user-related data.</span></span> <span data-ttu-id="d5e8b-126">(現在、アプリケーションのデータ モデルに、アプリケーション サービスで必要になったテーブルのみが含まれています、 `SqlMembershipProvider`)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-126">(Currently, the application's data model contains only the application services tables needed by the `SqlMembershipProvider`.)</span></span>

<span data-ttu-id="d5e8b-127">認証されたユーザーが、コメントを任せることができます、非常に単純なゲストブック アプリケーションを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-127">Let's create a very simple guestbook application where an authenticated user can leave a comment.</span></span> <span data-ttu-id="d5e8b-128">ゲストブック コメントを保存するだけでなくできるようにして、各ユーザーは自分の出身地、ホーム ページ、および署名を保存します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-128">In addition to storing guestbook comments, let's allow each user to store his home town, homepage, and signature.</span></span> <span data-ttu-id="d5e8b-129">指定した場合、ユーザーのホーム町、ホーム ページ、および署名は、ゲストブック内の残りが彼は各メッセージに表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-129">If provided, the user's home town, homepage, and signature will appear on each message he has left in the guestbook.</span></span>

### <a name="adding-theguestbookcommentstable"></a><span data-ttu-id="d5e8b-130">追加する、`GuestbookComments`テーブル</span><span class="sxs-lookup"><span data-stu-id="d5e8b-130">Adding the`GuestbookComments`Table</span></span>

<span data-ttu-id="d5e8b-131">ゲストブック コメントをキャプチャするために必要がありますをという名前のデータベース テーブルを作成する`GuestbookComments`のように列を持つ`CommentId`、 `Subject`、 `Body`、および`CommentDate`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-131">In order to capture the guestbook comments, we need to create a database table named `GuestbookComments` that has columns like `CommentId`, `Subject`, `Body`, and `CommentDate`.</span></span> <span data-ttu-id="d5e8b-132">各レコードがある必要も、`GuestbookComments`テーブルの参照、コメントを左したユーザー。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-132">We also need to have each record in the `GuestbookComments` table reference the user who left the comment.</span></span>

<span data-ttu-id="d5e8b-133">データベースには、このテーブルを追加するには、Visual Studio の データベース エクスプ ローラーに移動し、ドリル ダウン、`SecurityTutorials`データベース。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-133">To add this table to our database, go to the Database Explorer in Visual Studio and drill down into the `SecurityTutorials` database.</span></span> <span data-ttu-id="d5e8b-134">テーブル フォルダーを右クリックし、新しいテーブルの追加 をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-134">Right-click on the Tables folder and choose Add New Table.</span></span> <span data-ttu-id="d5e8b-135">使用すると、新しいテーブルの列を定義するインターフェイスが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-135">This brings up an interface that allows us to define the columns for the new table.</span></span>


<span data-ttu-id="d5e8b-136">[![SecurityTutorials データベースに新しいテーブルを追加します。](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-136">[![Add a New Table to the SecurityTutorials Database](storing-additional-user-information-cs/_static/image2.png)](storing-additional-user-information-cs/_static/image1.png)</span></span>

<span data-ttu-id="d5e8b-137">**図 1**: 新しいテーブルを追加、`SecurityTutorials`データベース ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-137">**Figure 1**: Add a New Table to the `SecurityTutorials` Database  ([Click to view full-size image](storing-additional-user-information-cs/_static/image3.png))</span></span>


<span data-ttu-id="d5e8b-138">次に、定義、`GuestbookComments`の列です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-138">Next, define the `GuestbookComments`'s columns.</span></span> <span data-ttu-id="d5e8b-139">という名前の列を追加することによって開始`CommentId`型の`uniqueidentifier`します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-139">Start by adding a column named `CommentId` of type `uniqueidentifier`.</span></span> <span data-ttu-id="d5e8b-140">この列は、ゲストブックには、各コメントを一意に識別する、許可しないように`NULL`s し、テーブルの主キーとしてマークします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-140">This column will uniquely identify each comment in the guestbook, so disallow `NULL` s and mark it as the table's primary key.</span></span> <span data-ttu-id="d5e8b-141">値を提供するのではなく、`CommentId`フィールドごとに`INSERT`、ことを示すお新しい`uniqueidentifier`値に自動的に生成するこのフィールドの`INSERT`列の既定値を設定して`NEWID()`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-141">Rather than providing a value for the `CommentId` field on each `INSERT`, we can indicate that a new `uniqueidentifier` value should be automatically generated for this field on `INSERT` by setting the column's default value to `NEWID()`.</span></span> <span data-ttu-id="d5e8b-142">Primary key、および設定として、既定値を指定してこの最初のフィールドを追加した後、画面は、スクリーン ショット図 2 に示すようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-142">After adding this first field, marking it as the primary key, and settings its default value, your screen should look similar to the screen shot shown in Figure 2.</span></span>


<span data-ttu-id="d5e8b-143">[![CommentId をという名前の主な列を追加します。](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-143">[![Add a Primary Column Named CommentId](storing-additional-user-information-cs/_static/image5.png)](storing-additional-user-information-cs/_static/image4.png)</span></span>

<span data-ttu-id="d5e8b-144">**図 2**: プライマリという名前の列を追加`CommentId`([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-144">**Figure 2**: Add a Primary Column Named `CommentId` ([Click to view full-size image](storing-additional-user-information-cs/_static/image6.png))</span></span>


<span data-ttu-id="d5e8b-145">という名前の列を次に、追加`Subject`型の`nvarchar(50)`という名前の列と`Body`型の`nvarchar(MAX)`、禁止する`NULL`両方の列にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-145">Next, add a column named `Subject` of type `nvarchar(50)` and a column named `Body` of type `nvarchar(MAX)`, disallowing `NULL` s in both columns.</span></span> <span data-ttu-id="d5e8b-146">次に、という名前の列を追加`CommentDate`型の`datetime`します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-146">Following that, add a column named `CommentDate` of type `datetime`.</span></span> <span data-ttu-id="d5e8b-147">禁止`NULL`s とセット、`CommentDate`列の既定値を`getdate()`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-147">Disallow `NULL` s and set the `CommentDate` column's default value to `getdate()`.</span></span>

<span data-ttu-id="d5e8b-148">各ゲストブック コメントに、ユーザー アカウントを関連付ける列を追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-148">All that remains is to add a column that associates a user account with each guestbook comment.</span></span> <span data-ttu-id="d5e8b-149">という名前の列を追加する方法もあります`UserName`型の`nvarchar(256)`します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-149">One option would be to add a column named `UserName` of type `nvarchar(256)`.</span></span> <span data-ttu-id="d5e8b-150">メンバーシップ プロバイダーを使用する以外の場合これは、適切な選択、`SqlMembershipProvider`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-150">This is a suitable choice when using a Membership provider other than the `SqlMembershipProvider`.</span></span> <span data-ttu-id="d5e8b-151">使用する場合は、`SqlMembershipProvider`でこのチュートリアル シリーズの、`UserName`内の列、`aspnet_Users`テーブルは、一意であることは保証されません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-151">But when using the `SqlMembershipProvider`, as we are in this tutorial series, the `UserName` column in the `aspnet_Users` table is not guaranteed to be unique.</span></span> <span data-ttu-id="d5e8b-152">`aspnet_Users`テーブルの主キーが`UserId`と型`uniqueidentifier`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-152">The `aspnet_Users` table's primary key is `UserId` and is of type `uniqueidentifier`.</span></span> <span data-ttu-id="d5e8b-153">したがって、`GuestbookComments`という名前の列がテーブルに必要がある`UserId`型の`uniqueidentifier`(禁止`NULL`値)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-153">Therefore, the `GuestbookComments` table needs a column named `UserId` of type `uniqueidentifier` (disallowing `NULL` values).</span></span> <span data-ttu-id="d5e8b-154">この列を追加してください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-154">Go ahead and add this column.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-155">説明したよう、 [*メンバーシップ スキーマを作成する SQL Server で*](creating-the-membership-schema-in-sql-server-cs.md)チュートリアル、メンバーシップ フレームワークが別のユーザー アカウントでの複数の web アプリケーションを同じ共有を有効にするように設計されていますユーザーのストア。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-155">As we discussed in the [*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial, the Membership framework is designed to enable multiple web applications with different user accounts to share the same user store.</span></span> <span data-ttu-id="d5e8b-156">この機能を使用するには、異なるアプリケーションにユーザー アカウントをパーティション分割します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-156">It does this by partitioning user accounts into different applications.</span></span> <span data-ttu-id="d5e8b-157">同じユーザー ストアを使用して別のアプリケーションで同じユーザー名は使用可能性があります各ユーザー名は、アプリケーション内で一意であることが保証、中に。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-157">And while each username is guaranteed to be unique within an application, the same username may be used in different applications using the same user store.</span></span> <span data-ttu-id="d5e8b-158">複合`UNIQUE`内の制約、`aspnet_Users`テーブルに対して、`UserName`と`ApplicationId`フィールド、ものではないのだけ`UserName`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-158">There is a composite `UNIQUE` constraint in the `aspnet_Users` table on the `UserName` and `ApplicationId` fields, but not one on just the `UserName` field.</span></span> <span data-ttu-id="d5e8b-159">したがって、可能であれば、aspnet の\_ユーザー テーブルで、同じ 2 つ (以上) のレコードに`UserName`値。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-159">Consequently, it is possible for the aspnet\_Users table to have two (or more) records with the same `UserName` value.</span></span> <span data-ttu-id="d5e8b-160">ただし、`UNIQUE`に制約、`aspnet_Users`テーブルの`UserId`(があるため、主キー) フィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-160">There is, however, a `UNIQUE` constraint on the `aspnet_Users` table's `UserId` field (since it is the primary key).</span></span> <span data-ttu-id="d5e8b-161">A`UNIQUE`指定されていない場合は、間の外部キー制約を確立できないために、制約は重要、`GuestbookComments`と`aspnet_Users`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-161">A `UNIQUE` constraint is important because without it we cannot establish a foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables.</span></span>


<span data-ttu-id="d5e8b-162">追加した後、`UserId`列で、ツールバーの [保存] アイコンをクリックすると、テーブルを保存します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-162">After adding the `UserId` column, save the table by clicking on the Save icon in the Toolbar.</span></span> <span data-ttu-id="d5e8b-163">新しいテーブルの名前を`GuestbookComments`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-163">Name the new table `GuestbookComments`.</span></span>

<span data-ttu-id="d5e8b-164">最後に注意する問題の 1 つがある、`GuestbookComments`テーブル: を作成する必要があります、[外部キー制約](https://msdn.microsoft.com/en-us/library/ms175464.aspx)間、`GuestbookComments.UserId`列と`aspnet_Users.UserId`列です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-164">We have one last issue to attend to with the `GuestbookComments` table: we need to create a [foreign key constraint](https://msdn.microsoft.com/en-us/library/ms175464.aspx) between the `GuestbookComments.UserId` column and the `aspnet_Users.UserId` column.</span></span> <span data-ttu-id="d5e8b-165">これを実現するには、するには、外部キー リレーションシップ ダイアログ ボックスを起動するには、ツールバーの リレーションシップ アイコンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-165">To achieve this, click the Relationship icon in the Toolbar to launch the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="d5e8b-166">(またはを起動できますこのダイアログ ボックス、テーブル デザイナー メニューに移動し、リレーションシップを選択する。)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-166">(Alternatively, you can launch this dialog box by going to the Table Designer menu and choosing Relationships.)</span></span>

<span data-ttu-id="d5e8b-167">外部キーのリレーションシップ ダイアログ ボックスの左下隅の 追加 ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-167">Click the Add button in the lower left corner of the Foreign Key Relationships dialog box.</span></span> <span data-ttu-id="d5e8b-168">リレーションシップに参加しているテーブルを定義する必要がありますが、新しい外部キー制約は追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-168">This will add a new foreign key constraint, although we still need to define the tables that participate in the relationship.</span></span>


<span data-ttu-id="d5e8b-169">[![外部キー リレーションシップ ダイアログ ボックスを使用して、テーブルの外部キー制約を管理するには](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-169">[![Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints](storing-additional-user-information-cs/_static/image8.png)](storing-additional-user-information-cs/_static/image7.png)</span></span>

<span data-ttu-id="d5e8b-170">**図 3**: 外部キー リレーションシップ ダイアログ ボックスを使用して、テーブルの外部キー制約を管理する ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-170">**Figure 3**: Use the Foreign Key Relationships Dialog Box to Manage a Table's Foreign Key Constraints  ([Click to view full-size image](storing-additional-user-information-cs/_static/image9.png))</span></span>


<span data-ttu-id="d5e8b-171">次に、右側の「テーブルと列の仕様」行にある省略記号アイコンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-171">Next, click the ellipses icon in the "Table and Columns Specifications" row on the right.</span></span> <span data-ttu-id="d5e8b-172">これは、テーブルと列 ダイアログ ボックス起動、主キー テーブルと列から外部キー列を指定お元となる、`GuestbookComments`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-172">This will launch the Tables and Columns dialog box, from which we can specify the primary key table and column and the foreign key column from the `GuestbookComments` table.</span></span> <span data-ttu-id="d5e8b-173">具体的には、選択`aspnet_Users`と`UserId`として主キー テーブルと列、および`UserId`から、`GuestbookComments`が外部キー列とテーブル (図 4 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-173">In particular, select `aspnet_Users` and `UserId` as the primary key table and column, and `UserId` from the `GuestbookComments` table as the foreign key column (see Figure 4).</span></span> <span data-ttu-id="d5e8b-174">主キーと外部キー テーブルと列を定義した後は、外部キー リレーションシップ ダイアログ ボックスに戻るには ok をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-174">After defining the primary and foreign key tables and columns, click OK to return to the Foreign Key Relationships dialog box.</span></span>


<span data-ttu-id="d5e8b-175">[![外部キー制約との間、aspnet_Users と GuesbookComments テーブルを確立します。](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-175">[![Establish a Foreign Key Constraint Between the aspnet_Users and GuesbookComments Tables](storing-additional-user-information-cs/_static/image11.png)](storing-additional-user-information-cs/_static/image10.png)</span></span>

<span data-ttu-id="d5e8b-176">**図 4**: 外部キー制約の間に確立、`aspnet_Users`と`GuesbookComments`テーブル ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-176">**Figure 4**: Establish a Foreign Key Constraint Between the `aspnet_Users` and `GuesbookComments` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image12.png))</span></span>


<span data-ttu-id="d5e8b-177">この時点で、外部キー制約が確立されました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-177">At this point the foreign key constraint has been established.</span></span> <span data-ttu-id="d5e8b-178">この制約が存在することを確認[リレーショナル整合性](http://en.wikipedia.org/wiki/Referential_integrity)が保証されませんがあるゲストブック エントリが存在しないユーザー アカウントを参照する 2 つのテーブルの間です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-178">The presence of this constraint ensures [relational integrity](http://en.wikipedia.org/wiki/Referential_integrity) between the two tables by guaranteeing that there will never be a guestbook entry referring to a non-existent user account.</span></span> <span data-ttu-id="d5e8b-179">既定では、外部キー制約には親レコードを子レコードに対応する場合に削除が許可されなくなります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-179">By default, a foreign key constraint will disallow a parent record to be deleted if there are corresponding child records.</span></span> <span data-ttu-id="d5e8b-180">つまり、ユーザーが 1 つまたは複数のゲストブック コメントし、そのユーザー アカウントを削除しようとは、削除が失敗、ゲストブック コメントが最初に削除しない限り、します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-180">That is, if a user makes one or more guestbook comments, and then we attempt to delete that user account, the delete will fail unless his guestbook comments are deleted first.</span></span>

<span data-ttu-id="d5e8b-181">親レコードが削除されたときに自動的に関連付けられている子レコードを削除する外部キー制約を構成することができます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-181">Foreign key constraints can be configured to automatically delete the associated child records when a parent record is deleted.</span></span> <span data-ttu-id="d5e8b-182">つまり、ユーザーのゲストブック エントリは、自分のユーザー アカウントが削除されたときに自動的に削除できるように、この外部キー制約をセットアップおできます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-182">In other words, we can setup this foreign key constraint so that a user's guestbook entries are automatically deleted when her user account is deleted.</span></span> <span data-ttu-id="d5e8b-183">これを実現するには、「挿入と更新の指定」セクションを展開し Cascade に「ルールの削除」プロパティを設定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-183">To accomplish this, expand the "INSERT And UPDATE Specification" section and set the "Delete Rule" property to Cascade.</span></span>


<span data-ttu-id="d5e8b-184">[![連鎖削除する外部キー制約を構成します。](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-184">[![Configure the Foreign Key Constraint to Cascade Deletes](storing-additional-user-information-cs/_static/image14.png)](storing-additional-user-information-cs/_static/image13.png)</span></span>

<span data-ttu-id="d5e8b-185">**図 5**: Cascade を削除する外部キー制約を構成する ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-185">**Figure 5**: Configure the Foreign Key Constraint to Cascade Deletes  ([Click to view full-size image](storing-additional-user-information-cs/_static/image15.png))</span></span>


<span data-ttu-id="d5e8b-186">外部キー制約を付けて保存するには、外部キーのリレーションシップを終了する閉じるボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-186">To save the foreign key constraint, click the Close button to exit out of the Foreign Key Relationships.</span></span> <span data-ttu-id="d5e8b-187">テーブルと、これを保存するには、ツールバーで [保存] アイコンをクリックしてリレーションシップです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-187">Then click the Save icon in the Toolbar to save the table and the this relationship.</span></span>

### <a name="storing-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="d5e8b-188">ユーザーのホーム町、ホーム ページ、および署名を格納します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-188">Storing the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="d5e8b-189">`GuestbookComments`テーブルは、ユーザー アカウントと一対多のリレーションシップを共有する情報を格納する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-189">The `GuestbookComments` table illustrates how to store information that shares a one-to-many relationship with user accounts.</span></span> <span data-ttu-id="d5e8b-190">各ユーザー アカウントには、関連付けられているコメントの任意の数を含めることがあります、ために、このリレーションシップは、特定のユーザーにリンクが各コメントをバックする列を含むコメントのセットを保持するテーブルを作成してモデル化されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-190">Since each user account may have an arbitrary number of associated comments, this relationship is modeled by creating a table to hold the set of comments that includes a column that links back each comment to a particular user.</span></span> <span data-ttu-id="d5e8b-191">使用する場合、 `SqlMembershipProvider`、という名前の列を作成することでこのリンクが確立される最適な`UserId`型の`uniqueidentifier`とこの列の間の外部キー制約と`aspnet_Users.UserId`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-191">When using the `SqlMembershipProvider`, this link is best established by creating a column named `UserId` of type `uniqueidentifier` and a foreign key constraint between this column and `aspnet_Users.UserId`.</span></span>

<span data-ttu-id="d5e8b-192">これに 3 つの列をユーザーのホーム町、ホーム ページ、および彼ゲストブック コメントに表示されるシグネチャを格納するには、各ユーザー アカウントに関連付ける必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-192">We now need to associate three columns with each user account to store the user's home town, homepage, and signature, which will appear in his guestbook comments.</span></span> <span data-ttu-id="d5e8b-193">これを実現するさまざまな方法の数。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-193">There are number of different ways to accomplish this:</span></span>

- <span data-ttu-id="d5e8b-194">**新しい列を追加、* * *`aspnet_Users`* * * または * * *`aspnet_Membership`* * * テーブル。**</span><span class="sxs-lookup"><span data-stu-id="d5e8b-194">**Add new columns to the****`aspnet_Users`****or****`aspnet_Membership`****tables.**</span></span> <span data-ttu-id="d5e8b-195">によって使用されるスキーマを変更するためにこの方法を推奨、I、`SqlMembershipProvider`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-195">I would not recommend this approach because it modifies the schema used by the `SqlMembershipProvider`.</span></span> <span data-ttu-id="d5e8b-196">この決定は、落ちて発言に返される可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-196">This decision may come back to haunt you down the road.</span></span> <span data-ttu-id="d5e8b-197">たとえば、what-if ASP.NET の将来のバージョンを使用して、さまざまな`SqlMembershipProvider`スキーマです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-197">For example, what if a future version of ASP.NET uses a different `SqlMembershipProvider` schema.</span></span> <span data-ttu-id="d5e8b-198">Microsoft は、ASP.NET 2.0 を移行するためのツールを含めることが`SqlMembershipProvider`ASP.NET 2.0 を変更した場合は、新しいスキーマにデータ`SqlMembershipProvider`スキーマ、変換できない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-198">Microsoft may include a tool to migrate the ASP.NET 2.0 `SqlMembershipProvider` data to the new schema, but if you have modified the ASP.NET 2.0 `SqlMembershipProvider` schema, such a conversion may not be possible.</span></span>

- <span data-ttu-id="d5e8b-199">**ASP を使用します。NET のプロファイルのフレームワーク、ホーム町、ホーム ページ、および署名のプロファイル プロパティを定義します。**</span><span class="sxs-lookup"><span data-stu-id="d5e8b-199">**Use ASP.NET's Profile framework, defining a profile property for the home town, homepage, and signature.**</span></span> <span data-ttu-id="d5e8b-200">ASP.NET には、その他のユーザーに固有のデータを格納するように設計されたプロファイルのフレームワークが含まれています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-200">ASP.NET includes a Profile framework that is designed to store additional user-specific data.</span></span> <span data-ttu-id="d5e8b-201">メンバーシップ フレームワークと同様に、プロファイルのフレームワークはプロバイダー モデル上に構築されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-201">Like the Membership framework, the Profile framework is built atop the provider model.</span></span> <span data-ttu-id="d5e8b-202">.NET Framework が付属しています、`SqlProfileProvider`したが、SQL Server データベースにプロファイル データを格納します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-202">The .NET Framework ships with a `SqlProfileProvider` sthat stores profile data in a SQL Server database.</span></span> <span data-ttu-id="d5e8b-203">実際には、データベースは既にで使用されるテーブル、 `SqlProfileProvider` (`aspnet_Profile`) で、アプリケーション サービスのバックアップを追加したときに追加された、 <a id="_msoanchor_2"> </a> [ *SQL でのメンバーシップのスキーマの作成サーバー* ](creating-the-membership-schema-in-sql-server-cs.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-203">In fact, our database already has the table used by the `SqlProfileProvider` (`aspnet_Profile`), as it was added when we added the application services back in the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](creating-the-membership-schema-in-sql-server-cs.md) tutorial.</span></span>   
 <span data-ttu-id="d5e8b-204">プロファイルのフレームワークの主な利点は、開発者のプロファイルのプロパティを定義することができる`Web.config`– コードを基になるデータ ストアと、プロファイル データをシリアル化に書き込む必要はありません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-204">The main benefit of the Profile framework is that it allows for developers to define the profile properties in `Web.config` – no code needs to be written to serialize the profile data to and from the underlying data store.</span></span> <span data-ttu-id="d5e8b-205">つまり、プロファイルのプロパティのセットを定義して、コードで作業するには驚くほど簡単です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-205">In short, it is incredibly easy to define a set of profile properties and to work with them in code.</span></span> <span data-ttu-id="d5e8b-206">ただし、プロファイル システム不十分、バージョン管理する際に必要なため、後の時刻、または既存のテーブルを削除または変更されると、追加された新しいユーザーに固有のプロパティを期待するし、プロファイルのフレームワークができない可能性があります、アプリケーションがある場合、 最適なオプションです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-206">However, the Profile system leaves a lot to be desired when it comes to versioning, so if you have an application where you expect new user-specific properties to be added at a later time, or existing ones to be removed or modified, then the Profile framework may not be the best option.</span></span> <span data-ttu-id="d5e8b-207">さらに、`SqlProfileProvider`次に不可能にすることをプロファイル データ (など、ユーザーの数では、New York のホーム町がある) に対して直接クエリを実行する、高非正規化方式で、プロファイルのプロパティを格納します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-207">Moreover, the `SqlProfileProvider` stores the profile properties in a highly denormalized fashion, making it next to impossible to run queries directly against the profile data (such as, how many users have a home town of New York).</span></span>   
 <span data-ttu-id="d5e8b-208">プロファイルのフレームワークの詳細については、このチュートリアルの最後に、「これ以上の測定値」セクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-208">For more information on the Profile framework, consult the "Further Readings" section at the end of this tutorial.</span></span>

- <span data-ttu-id="d5e8b-209">**データベースに新しいテーブルにはこれら 3 つの列を追加し、このテーブルの間の一対一の関係を確立し、* * *`aspnet_Users`* * *。**</span><span class="sxs-lookup"><span data-stu-id="d5e8b-209">**Add these three columns to a new table in the database and establish a one-to-one relationship between this table and****`aspnet_Users`****.**</span></span> <span data-ttu-id="d5e8b-210">この方法は、プロファイル フレームワークよりも少し多くの作業が含まれますが、追加のユーザー プロパティがデータベースにモデル化方法で最大限の柔軟性を提供しています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-210">This approach involves a bit more work than with the Profile framework, but offers maximum flexibility in how the additional user properties are modeled in the database.</span></span> <span data-ttu-id="d5e8b-211">これは、このチュートリアルで使用するオプションです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-211">This is the option we will use in this tutorial.</span></span>

<span data-ttu-id="d5e8b-212">という名前の新しいテーブルを作成、`UserProfiles`ホーム町、ホーム ページ、および各ユーザーの署名を保存します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-212">We will create a new table called `UserProfiles` to save the home town, homepage, and signature for each user.</span></span> <span data-ttu-id="d5e8b-213">データベース エクスプ ローラー ウィンドウで テーブル フォルダーを右クリックし、新しいテーブルを作成するを選択します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-213">Right-click on the Tables folder in the Database Explorer window and choose to create a new table.</span></span> <span data-ttu-id="d5e8b-214">最初の列の名前を付けます`UserId`にその型を設定および`uniqueidentifier`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-214">Name the first column `UserId` and set its type to `uniqueidentifier`.</span></span> <span data-ttu-id="d5e8b-215">禁止`NULL`値し、列を主キーとしてマークします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-215">Disallow `NULL` values and mark the column as a primary key.</span></span> <span data-ttu-id="d5e8b-216">次に、という名前の列を追加:`HomeTown`型の`nvarchar(50)`です。`HomepageUrl`型の`nvarchar(100)`; 型のシグネチャと`nvarchar(500)`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-216">Next, add columns named: `HomeTown` of type `nvarchar(50)`; `HomepageUrl` of type `nvarchar(100)`; and Signature of type `nvarchar(500)`.</span></span> <span data-ttu-id="d5e8b-217">これら 3 つの列のそれぞれを受け入れることができます、`NULL`値。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-217">Each of these three columns can accept a `NULL` value.</span></span>


<span data-ttu-id="d5e8b-218">[![ユーザー テーブルを作成します。](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-218">[![Create the UserProfiles Table](storing-additional-user-information-cs/_static/image17.png)](storing-additional-user-information-cs/_static/image16.png)</span></span>

<span data-ttu-id="d5e8b-219">**図 6**: 作成、`UserProfiles`テーブル ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-219">**Figure 6**: Create the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image18.png))</span></span>


<span data-ttu-id="d5e8b-220">テーブルを保存し、名前を付けます`UserProfiles`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-220">Save the table and name it `UserProfiles`.</span></span> <span data-ttu-id="d5e8b-221">最後との間の外部キー制約を確立、`UserProfiles`テーブルの`UserId`フィールドおよび`aspnet_Users.UserId`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-221">Lastly, establish a foreign key constraint between the `UserProfiles` table's `UserId` field and the `aspnet_Users.UserId` field.</span></span> <span data-ttu-id="d5e8b-222">間で外部キー制約と同様、`GuestbookComments`と`aspnet_Users`テーブルがあるこの制約の連鎖的に削除します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-222">As we did with the foreign key constraint between the `GuestbookComments` and `aspnet_Users` tables, have this constraint cascade deletes.</span></span> <span data-ttu-id="d5e8b-223">以降、`UserId`フィールドに`UserProfiles`プライマリ キー、これにより、内の 2 つ以上のレコードがある、`UserProfiles`ユーザー アカウントごとにテーブルです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-223">Since the `UserId` field in `UserProfiles` is the primary key, this ensures that there will be no more than one record in the `UserProfiles` table for each user account.</span></span> <span data-ttu-id="d5e8b-224">この種のリレーションシップは、一対一に呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-224">This type of relationship is referred to as one-to-one.</span></span>

<span data-ttu-id="d5e8b-225">これが、データ モデルを作成、使用する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-225">Now that we have the data model created, we are ready to use it.</span></span> <span data-ttu-id="d5e8b-226">手順 2 および 3 を見てみましょう方法、現在ログオンしているユーザーを表示およびそのホーム町、ホーム ページ、および署名情報を編集できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-226">In Steps 2 and 3 we will look at how the currently logged on user can view and edit their home town, homepage, and signature information.</span></span> <span data-ttu-id="d5e8b-227">手順 4. で認証されたユーザー、ゲストブックに新しいコメントを送信し、既存のサーバーを表示するためのインターフェイスを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-227">In Step 4 we will create the interface for authenticated users to submit new comments to the guestbook and view the existing ones.</span></span>

## <a name="step-2-displaying-the-users-home-town-homepage-and-signature"></a><span data-ttu-id="d5e8b-228">手順 2: ユーザーのホーム町、ホーム ページ、および署名の表示</span><span class="sxs-lookup"><span data-stu-id="d5e8b-228">Step 2: Displaying the User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="d5e8b-229">これは、さまざまな方法は現在ログオンしているユーザーが自分のホームの町、ホーム ページ、および署名情報を表示および編集できるようにします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-229">There are a variety of ways to allow the currently logged on user to view and edit his home town, homepage, and signature information.</span></span> <span data-ttu-id="d5e8b-230">テキスト ボックスと、ユーザー インターフェイスを手動で作成する可能性がありますおよびラベル コントロールまたはおが使用データ DetailsView コントロールなどの Web コントロールのいずれか。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-230">We could manually create the user interface with TextBox and Label controls or we could use one of the data Web controls, such as the DetailsView control.</span></span> <span data-ttu-id="d5e8b-231">データベースを実行する`SELECT`と`UPDATE`ADO.NET 作成ステートメントは、ページの分離コード クラス内のコードまたは、代わりに、SqlDataSource による宣言型の方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-231">To perform the database `SELECT` and `UPDATE` statements we could write ADO.NET code in our page's code-behind class or, alternatively, employ a declarative approach with the SqlDataSource.</span></span> <span data-ttu-id="d5e8b-232">理想的には、アプリケーションには、おでしたか、プログラムで起動または宣言によって、ページの分離コード クラスから、ObjectDataSource コントロールを使用して、階層化されたアーキテクチャが含まれます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-232">Ideally our application would contain a tiered architecture, which we could either invoke programmatically from the page's code-behind class or declaratively via the ObjectDataSource control.</span></span>

<span data-ttu-id="d5e8b-233">このチュートリアルの系列では、フォーム認証、承認、ユーザー アカウント、およびロールに焦点を当てています、以降はありませんこれらのさまざまなデータ アクセス オプションまたは理由階層化されたアーキテクチャよりもが望ましい直接 SQL ステートメントを実行する方法についてASP.NET ページです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-233">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, there will not be a thorough discussion of these different data access options or why a tiered architecture is preferred over executing SQL statements directly from the ASP.NET page.</span></span> <span data-ttu-id="d5e8b-234">順を追って DetailsView と SqlDataSource (最も速いと最も簡単なオプション) を使用するつもりが説明する概念は、別の Web コントロールとデータ アクセス ロジックに確実に適用できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-234">I am going to walk through using a DetailsView and SqlDataSource – the quickest and easiest option – but the concepts discussed can certainly be applied to alternative Web controls and data access logic.</span></span> <span data-ttu-id="d5e8b-235">ASP.NET 内のデータ処理の詳細についてを参照してください   *[ASP.NET 2.0 のデータを扱う](../../data-access/index.md)*一連のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-235">For more information on working with data in ASP.NET, refer to my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>

<span data-ttu-id="d5e8b-236">開く、 `AdditionalUserInfo.aspx`  ページで、`Membership`フォルダー DetailsView コントロール、ページの設定を追加し、その`ID`プロパティを`UserProfile`を消去して、`Width`と`Height`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-236">Open the `AdditionalUserInfo.aspx` page in the `Membership` folder and add a DetailsView control to the page, setting its `ID` property to `UserProfile` and clearing out its `Width` and `Height` properties.</span></span> <span data-ttu-id="d5e8b-237">DetailsView のスマート タグを展開し、新しいデータ ソース コントロールにバインドを選択します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-237">Expand the DetailsView's Smart Tag and choose to bind it to a new data source control.</span></span> <span data-ttu-id="d5e8b-238">これは、データ ソース構成ウィザードが起動 (図 7 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-238">This will launch the DataSource Configuration Wizard (see Figure 7).</span></span> <span data-ttu-id="d5e8b-239">最初の手順では、データ ソースの種類を指定するよう求められます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-239">The first step asks you to specify the data source type.</span></span> <span data-ttu-id="d5e8b-240">直接接続するので、`SecurityTutorials`データベース、データベース アイコンを選択を指定する、`ID`として`UserProfileDataSource`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-240">Since we are going to connect directly to the `SecurityTutorials` database, choose the Database icon, specifying the `ID` as `UserProfileDataSource`.</span></span>


<span data-ttu-id="d5e8b-241">[![UserProfileDataSource をという名前の新しい SqlDataSource コントロールを追加します。](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-241">[![Add a New SqlDataSource Control Named UserProfileDataSource](storing-additional-user-information-cs/_static/image20.png)](storing-additional-user-information-cs/_static/image19.png)</span></span>

<span data-ttu-id="d5e8b-242">**図 7**: 新しい SqlDataSource コントロールという追加`UserProfileDataSource`([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-242">**Figure 7**: Add a New SqlDataSource Control Named `UserProfileDataSource` ([Click to view full-size image](storing-additional-user-information-cs/_static/image21.png))</span></span>


<span data-ttu-id="d5e8b-243">次の画面は、使用するデータベースのメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-243">The next screen prompts for the database to use.</span></span> <span data-ttu-id="d5e8b-244">内の接続文字列は既に定義`Web.config`の`SecurityTutorials`データベース。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-244">We have already defined a connection string in `Web.config` for the `SecurityTutorials` database.</span></span> <span data-ttu-id="d5e8b-245">この接続文字列名 – `SecurityTutorialsConnectionString` – ドロップダウン リストにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-245">This connection string name – `SecurityTutorialsConnectionString` – should be in the drop-down list.</span></span> <span data-ttu-id="d5e8b-246">このオプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-246">Select this option and click Next.</span></span>


<span data-ttu-id="d5e8b-247">[![SecurityTutorialsConnectionString をドロップダウン リストから選択します。](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-247">[![Choose SecurityTutorialsConnectionString from the Drop-Down List](storing-additional-user-information-cs/_static/image23.png)](storing-additional-user-information-cs/_static/image22.png)</span></span>

<span data-ttu-id="d5e8b-248">**図 8**: 選択`SecurityTutorialsConnectionString`ドロップダウン リストから ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-248">**Figure 8**: Choose `SecurityTutorialsConnectionString` from the Drop-Down List  ([Click to view full-size image](storing-additional-user-information-cs/_static/image24.png))</span></span>


<span data-ttu-id="d5e8b-249">後続の画面では、テーブルと列のクエリを指定するよう求められます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-249">The subsequent screen asks us to specify the table and columns to query.</span></span> <span data-ttu-id="d5e8b-250">選択、`UserProfiles`ドロップダウン リストからテーブルし、すべての列を確認します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-250">Choose the `UserProfiles` table from the drop-down list and check all of the columns.</span></span>


<span data-ttu-id="d5e8b-251">[![Bring ユーザー テーブルからすべての列のバックアップ](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-251">[![Bring Back All of the Columns from the UserProfiles Table](storing-additional-user-information-cs/_static/image26.png)](storing-additional-user-information-cs/_static/image25.png)</span></span>

<span data-ttu-id="d5e8b-252">**図 9**: Bring 戻るすべての列から、`UserProfiles`テーブル ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-252">**Figure 9**: Bring Back All of the Columns from the `UserProfiles` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image27.png))</span></span>


<span data-ttu-id="d5e8b-253">図 9 を返しますの現在のクエリ*すべて*内のレコードの`UserProfiles`、だけでは、現在ログオンしているユーザーのレコードが、します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-253">The current query in Figure 9 returns *all* of the records in `UserProfiles`, but we are only interested in the currently logged on user's record.</span></span> <span data-ttu-id="d5e8b-254">追加する、`WHERE`句をクリックして、 `WHERE`  ボタンの追加 を`WHERE`句 ダイアログ ボックス (図 10 参照)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-254">To add a `WHERE` clause, click the `WHERE` button to bring up the Add `WHERE` Clause dialog box (see Figure 10).</span></span> <span data-ttu-id="d5e8b-255">ここでは、フィルターを適用する列、演算子、およびフィルター パラメーターのソースを選択できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-255">Here you can select the column to filter on, the operator, and the source of the filter parameter.</span></span> <span data-ttu-id="d5e8b-256">選択`UserId`列と演算子として「=」として。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-256">Select `UserId` as the column and "=" as the Operator.</span></span>

<span data-ttu-id="d5e8b-257">残念ながら、現在ログオンしているユーザーを返す組み込みのパラメーターの送信元がない`UserId`値。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-257">Unfortunately there is no built-in parameter source to return the currently logged on user's `UserId` value.</span></span> <span data-ttu-id="d5e8b-258">プログラムでこの値を取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-258">We will need to grab this value programmatically.</span></span> <span data-ttu-id="d5e8b-259">このため、"なしに、"の追加は、パラメーターを追加するボタンをクリックし、[ok] をクリックしをクリックしてソースのドロップダウン リストを設定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-259">Therefore, set the Source drop-down list to "None," click the Add button to add the parameter, and then click OK.</span></span>


<span data-ttu-id="d5e8b-260">[![ユーザー Id の列にフィルター パラメーターを追加します。](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-260">[![Add a Filter Parameter on the UserId Column](storing-additional-user-information-cs/_static/image29.png)](storing-additional-user-information-cs/_static/image28.png)</span></span>

<span data-ttu-id="d5e8b-261">**図 10**: で Filter パラメーターを追加、`UserId`列 ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-261">**Figure 10**: Add a Filter Parameter on the `UserId` Column  ([Click to view full-size image](storing-additional-user-information-cs/_static/image30.png))</span></span>


<span data-ttu-id="d5e8b-262">[Ok] をクリックした後に、図 9 に示すように画面に返されるされます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-262">After clicking OK you will be returned to the screen shown in Figure 9.</span></span> <span data-ttu-id="d5e8b-263">このとき、ただし、画面の下部にある SQL クエリ含める必要があります、`WHERE`句。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-263">This time, however, the SQL query at the bottom of the screen should include a `WHERE` clause.</span></span> <span data-ttu-id="d5e8b-264">「テスト クエリ」画面に移動するには、次にクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-264">Click Next to move on to the "Test Query" screen.</span></span> <span data-ttu-id="d5e8b-265">ここで、クエリを実行し、結果を確認します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-265">Here you can run the query and see the results.</span></span> <span data-ttu-id="d5e8b-266">ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-266">Click Finish to complete the wizard.</span></span>

<span data-ttu-id="d5e8b-267">データ ソース構成ウィザードを完了すると、Visual Studio は、ウィザードで指定された設定に基づいて、SqlDataSource コントロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-267">Upon completing the DataSource Configuration Wizard, Visual Studio creates the SqlDataSource control based on the settings specified in the wizard.</span></span> <span data-ttu-id="d5e8b-268">さらに、手動で追加 BoundFields SqlDataSource のによって返される列ごとに DetailsView に`SelectCommand`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-268">Moreover, it manually adds BoundFields to the DetailsView for each column returned by the SqlDataSource's `SelectCommand`.</span></span> <span data-ttu-id="d5e8b-269">表示する必要はありません、`UserId`ユーザーがこの値を調べる必要がないため、DetailsView のフィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-269">There's no need to show the `UserId` field in the DetailsView, since the user does not need to know this value.</span></span> <span data-ttu-id="d5e8b-270">DetailsView コントロールの宣言型マークアップから直接フィールドを削除します。 または、フィールドをクリックして、"編集"のスマート タグからリンクできます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-270">You can remove this field directly from the DetailsView control's declarative markup or by clicking the "Edit Fields" link from its Smart Tag.</span></span>

<span data-ttu-id="d5e8b-271">この時点で、ページの宣言型マークアップは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-271">At this point your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample1.aspx)]

<span data-ttu-id="d5e8b-272">SqlDataSource コントロールをプログラムで設定する必要があります`UserId`パラメーターを現在ログインしているユーザーの`UserId`データが選択される前にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-272">We need to programmatically set the SqlDataSource control's `UserId` parameter to the currently logged in user's `UserId` before the data is selected.</span></span> <span data-ttu-id="d5e8b-273">これには、SqlDataSource のイベント ハンドラーを作成することで`Selecting`イベントと、次を追加するコードがあります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-273">This can be accomplished by creating an event handler for the SqlDataSource's `Selecting` event and adding the following code there:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample2.cs)]

<span data-ttu-id="d5e8b-274">上記のコードを呼び出すことによって、現在ログオンしているユーザーへの参照を取得することによって開始、`Membership`クラスの`GetUser`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-274">The above code starts by obtaining a reference to the currently logged on user by calling the `Membership` class's `GetUser` method.</span></span> <span data-ttu-id="d5e8b-275">これを返します、`MembershipUser`オブジェクト、`ProviderUserKey`プロパティが含まれています、`UserId`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-275">This returns a `MembershipUser` object, whose `ProviderUserKey` property contains the `UserId`.</span></span> <span data-ttu-id="d5e8b-276">`UserId`し、値は、SqlDataSource`@UserId`パラメーター。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-276">The `UserId` value is then assigned to the SqlDataSource's `@UserId` parameter.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-277">`Membership.GetUser()`メソッドは、現在ログオンしているユーザーに関する情報を返します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-277">The `Membership.GetUser()` method returns information about the currently logged on user.</span></span> <span data-ttu-id="d5e8b-278">匿名ユーザーがページを訪問している場合の値が返されます。`null`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-278">If an anonymous user is visiting the page, it will return a value of `null`.</span></span> <span data-ttu-id="d5e8b-279">このような場合は、結果には、 `NullReferenceException` 、次のコード行に読み取りを試みたとき、`ProviderUserKey`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-279">In such a case, this will lead to a `NullReferenceException` on the following line of code when attempting to read the `ProviderUserKey` property.</span></span> <span data-ttu-id="d5e8b-280">について心配する必要はないもちろん、`Membership.GetUser()`を返す、`null`値で、`AdditionalUserInfo.aspx`おように構成されている URL 承認前のチュートリアルで認証されたユーザーのみがこのフォルダーに ASP.NET リソースにアクセスできなかったためにのページです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-280">Of course, we don't have to worry about `Membership.GetUser()` returning a `null` value in the `AdditionalUserInfo.aspx` page because we configured URL authorization in a previous tutorial so that only authenticated users could access the ASP.NET resources in this folder.</span></span> <span data-ttu-id="d5e8b-281">匿名アクセスが許可されているページで、現在ログオンしているユーザーに関する情報にアクセスする必要がある場合を確認することを確認以外`null MembershipUser`からオブジェクトが返されます、`GetUser()`メソッド、プロパティを参照する前にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-281">If you need to access information about the currently logged on user in a page where anonymous access is permitted, make sure to check that a non-`null MembershipUser` object is returned from the `GetUser()` method before referencing its properties.</span></span>


<span data-ttu-id="d5e8b-282">アクセスした場合、`AdditionalUserInfo.aspx`ページ ブラウザーを使ってまだに任意の行を追加しているために、空白のページを表示は、`UserProfiles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-282">If you visit the `AdditionalUserInfo.aspx` page through a browser you will see a blank page because we have yet to add any rows to the `UserProfiles` table.</span></span> <span data-ttu-id="d5e8b-283">手順 6. で見ていきますを自動的に新しい行を追加する CreateUserWizard コントロールをカスタマイズする方法、`UserProfiles`表に、新しいユーザー アカウントの作成時にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-283">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span> <span data-ttu-id="d5e8b-284">ここでは、ただしは必要があります、テーブルにレコードを手動で作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-284">For now, however, we will need to manually create a record in the table.</span></span>

<span data-ttu-id="d5e8b-285">Visual Studio の データベース エクスプ ローラーに移動し、テーブル フォルダーを展開します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-285">Navigate to the Database Explorer in Visual Studio and expand the Tables folder.</span></span> <span data-ttu-id="d5e8b-286">右クリックし、`aspnet_Users`テーブルし"を表示するテーブルのデータの選択"、テーブル内のレコードを表示する; 同じ操作を行う、`UserProfiles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-286">Right-click on the `aspnet_Users` table and choose "Show Table Data" to see the records in the table; do the same thing for the `UserProfiles` table.</span></span> <span data-ttu-id="d5e8b-287">図 11 は、垂直方向に並べて表示されるときに、これらの結果を示します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-287">Figure 11 shows these results when tiled vertically.</span></span> <span data-ttu-id="d5e8b-288">データベースで発生している`aspnet_Users`ブルース、Fred、および Tito、レコードはレコードがありません、`UserProfiles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-288">In my database there are currently `aspnet_Users` records for Bruce, Fred, and Tito, but no records in the `UserProfiles` table.</span></span>


<span data-ttu-id="d5e8b-289">[![Aspnet_Users の内容は、ユーザー テーブルが表示されます。](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-289">[![The Contents of the aspnet_Users and UserProfiles Tables are Displayed](storing-additional-user-information-cs/_static/image32.png)](storing-additional-user-information-cs/_static/image31.png)</span></span>

<span data-ttu-id="d5e8b-290">**図 11**: の 目次、`aspnet_Users`と`UserProfiles`テーブルが表示されます ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-290">**Figure 11**: The Contents of the `aspnet_Users` and `UserProfiles` Tables are Displayed  ([Click to view full-size image](storing-additional-user-information-cs/_static/image33.png))</span></span>


<span data-ttu-id="d5e8b-291">新しいレコードを追加、`UserProfiles`テーブルの値に手動で入力して、 `HomeTown`、 `HomepageUrl`、および`Signature`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-291">Add a new record to the `UserProfiles` table by manually typing in values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span> <span data-ttu-id="d5e8b-292">簡単に有効な`UserId`、新しい値`UserProfiles`レコードは、選択する、`UserId`フィールド内の特定のユーザー アカウントを`aspnet_Users`の表に、コピーして貼り付けます、`UserId`フィールドに`UserProfiles`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-292">The easiest way to get a valid `UserId` value in the new `UserProfiles` record is to select the `UserId` field from a particular user account in the `aspnet_Users` table and copy and paste it into the `UserId` field in `UserProfiles`.</span></span> <span data-ttu-id="d5e8b-293">図 12 を示しています、`UserProfiles`ブルースに対して新しいレコードを追加した後の表にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-293">Figure 12 shows the `UserProfiles` table after a new record has been added for Bruce.</span></span>


<span data-ttu-id="d5e8b-294">[![レコードがのブルース ユーザーに追加されました](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-294">[![A Record was Added to UserProfiles for Bruce](storing-additional-user-information-cs/_static/image35.png)](storing-additional-user-information-cs/_static/image34.png)</span></span>

<span data-ttu-id="d5e8b-295">**図 12**: に A レコードを追加した`UserProfiles`ブルースの ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-295">**Figure 12**: A Record was Added to `UserProfiles` for Bruce  ([Click to view full-size image](storing-additional-user-information-cs/_static/image36.png))</span></span>


<span data-ttu-id="d5e8b-296">戻り、 `AdditionalUserInfo.aspx`  ページで、ブルースとしてログインします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-296">Return to the `AdditionalUserInfo.aspx` page, logged in as Bruce.</span></span> <span data-ttu-id="d5e8b-297">図 13 に示す Bruce's 設定が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-297">As Figure 13 shows, Bruce's settings are displayed.</span></span>


<span data-ttu-id="d5e8b-298">[![現在訪問ユーザーは His 設定の表示](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-298">[![The Currently Visiting User is Shown His Settings](storing-additional-user-information-cs/_static/image38.png)](storing-additional-user-information-cs/_static/image37.png)</span></span>

<span data-ttu-id="d5e8b-299">**図 13**: 現在訪問ユーザーは His 設定の表示 ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-299">**Figure 13**: The Currently Visiting User is Shown His Settings  ([Click to view full-size image](storing-additional-user-information-cs/_static/image39.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d5e8b-300">移動先を手動で追加のレコード、`UserProfiles`メンバーシップ ユーザーごとにテーブルです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-300">Go ahead and manually add records in the `UserProfiles` table for each Membership user.</span></span> <span data-ttu-id="d5e8b-301">手順 6. で見ていきますを自動的に新しい行を追加する CreateUserWizard コントロールをカスタマイズする方法、`UserProfiles`表に、新しいユーザー アカウントの作成時にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-301">In Step 6 we will look at how to customize the CreateUserWizard control to automatically add a new row to the `UserProfiles` table when a new user account is created.</span></span>


## <a name="step-3-allowing-the-user-to-edit-his-home-town-homepage-and-signature"></a><span data-ttu-id="d5e8b-302">手順 3: ユーザーが自分のホーム町、ホーム ページ、および署名の編集を許可します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-302">Step 3: Allowing the User to Edit His Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="d5e8b-303">そのホーム町、ホーム ページ、および署名の設定、この時点で、現在ログインしているユーザーを表示できますが、まだ変更されることはできません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-303">At this point the currently logged in user can view their home town, homepage, and signature setting, but they cannot yet modify them.</span></span> <span data-ttu-id="d5e8b-304">データを編集できるように DetailsView コントロールを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-304">Let's update the DetailsView control so that the data can be edited.</span></span>

<span data-ttu-id="d5e8b-305">まずを行うには必要なは、追加、 `UpdateCommand` 、SqlDataSource を指定する、`UPDATE`を実行するステートメントとその対応するパラメーターです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-305">The first thing we need to do is add an `UpdateCommand` for the SqlDataSource, specifying the `UPDATE` statement to execute and its corresponding parameters.</span></span> <span data-ttu-id="d5e8b-306">SqlDataSource を選択し、[プロパティ] ウィンドウからコマンドおよびパラメーターのエディター ダイアログ ボックスを表示する抽出プロパティの横にある省略記号ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-306">Select the SqlDataSource and, from the Properties window, click on the ellipses next to the UpdateQuery property to bring up the Command and Parameter Editor dialog box.</span></span> <span data-ttu-id="d5e8b-307">次の入力`UPDATE`ステートメントをテキスト ボックスに。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-307">Enter the following `UPDATE` statement into the textbox:</span></span>

[!code-sql[Main](storing-additional-user-information-cs/samples/sample3.sql)]

<span data-ttu-id="d5e8b-308">次に、 をクリック「パラメーターの更新」、SqlDataSource コントロールのパラメーターを作成する`UpdateParameters`ごとでは、パラメーターのコレクション、`UPDATE`ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-308">Next, click the "Refresh Parameters" button, which will create a parameter in the SqlDataSource control's `UpdateParameters` collection for each of the parameters in the `UPDATE` statement.</span></span> <span data-ttu-id="d5e8b-309">[なし] にパラメーター セットのすべてのソースのままにし、ダイアログ ボックスに [ok] ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-309">Leave the source for all of the parameters set to None and click the OK button to complete the dialog box.</span></span>


<span data-ttu-id="d5e8b-310">[![SqlDataSource の UpdateCommand と UpdateParameters を指定します。](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-310">[![Specify the SqlDataSource's UpdateCommand and UpdateParameters](storing-additional-user-information-cs/_static/image41.png)](storing-additional-user-information-cs/_static/image40.png)</span></span>

<span data-ttu-id="d5e8b-311">**図 14**: 指定 SqlDataSource の`UpdateCommand`と`UpdateParameters`([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-311">**Figure 14**: Specify the SqlDataSource's `UpdateCommand` and `UpdateParameters` ([Click to view full-size image](storing-additional-user-information-cs/_static/image42.png))</span></span>


<span data-ttu-id="d5e8b-312">追加機能のためには、SqlDataSource コントロール、コントロールが編集をサポートできるようになりました DetailsView に行われます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-312">Due to the additions we made to the SqlDataSource control, the DetailsView control can now support editing.</span></span> <span data-ttu-id="d5e8b-313">DetailsView のスマート タグから「編集を有効にする」のチェック ボックスを確認します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-313">From the DetailsView's Smart Tag, check the "Enable Editing" checkbox.</span></span> <span data-ttu-id="d5e8b-314">コントロールの追加、CommandField`Fields`コレクションでその`ShowEditButton`プロパティを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-314">This adds a CommandField to the control's `Fields` collection with its `ShowEditButton` property set to True.</span></span> <span data-ttu-id="d5e8b-315">[編集] ボタンは、読み取り専用モードと Update DetailsView が表示され、編集モードを [キャンセル] ボタンに表示されるときにこのレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-315">This renders an Edit button when the DetailsView is displayed in read-only mode and Update and Cancel buttons when displayed in edit mode.</span></span> <span data-ttu-id="d5e8b-316">されなくても、[編集] をクリックするユーザーがあっても DetailsView レンダリング「常に編集可能」状態で DetailsView コントロールの設定によって[`DefaultMode`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx)に`Edit`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-316">Rather than requiring the user to click Edit, though, we can have the DetailsView render in an "always editable" state by setting the DetailsView control's [`DefaultMode` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.detailsview.defaultmode.aspx) to `Edit`.</span></span>

<span data-ttu-id="d5e8b-317">これらの変更、DetailsView コントロールの宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-317">With these changes, your DetailsView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample4.aspx)]

<span data-ttu-id="d5e8b-318">CommandField の追加に注意してください、`DefaultMode`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-318">Note the addition of the CommandField and the `DefaultMode` property.</span></span>

<span data-ttu-id="d5e8b-319">ブラウザーからこのページをテストしてください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-319">Go ahead and test this page through a browser.</span></span> <span data-ttu-id="d5e8b-320">対応するレコードのあるユーザーにアクセスしたとき`UserProfiles`ユーザーの設定が編集可能なインターフェイスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-320">When visiting with a user that has a corresponding record in `UserProfiles`, the user's settings are displayed in an editable interface.</span></span>


<span data-ttu-id="d5e8b-321">[![DetailsView が編集可能なインターフェイスを表示します。](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-321">[![The DetailsView Renders an Editable Interface](storing-additional-user-information-cs/_static/image44.png)](storing-additional-user-information-cs/_static/image43.png)</span></span>

<span data-ttu-id="d5e8b-322">**図 15**: DetailsView が編集可能なインターフェイスを表示 ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image45.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-322">**Figure 15**: The DetailsView Renders an Editable Interface  ([Click to view full-size image](storing-additional-user-information-cs/_static/image45.png))</span></span>


<span data-ttu-id="d5e8b-323">再試行の値を変更および更新 をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-323">Try changing the values and clicking the Update button.</span></span> <span data-ttu-id="d5e8b-324">何かのように表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-324">It appears as if nothing happens.</span></span> <span data-ttu-id="d5e8b-325">ポストバックがあると値は、データベースに保存されますが、保存が発生した視覚的なフィードバックはありません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-325">There is a postback and the values are saved to the database, but there's no visual feedback that the save occurred.</span></span>

<span data-ttu-id="d5e8b-326">この問題を解決するには、Visual Studio に戻り、DetailsView 上のラベル コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-326">To remedy this, return to Visual Studio and add a Label control above the DetailsView.</span></span> <span data-ttu-id="d5e8b-327">設定の`ID`に`SettingsUpdatedMessage`、その`Text`プロパティを「の設定が更新されました」とその`Visible`と`EnableViewState`プロパティ`false`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-327">Set its `ID` to `SettingsUpdatedMessage`, its `Text` property to "Your settings have been updated," and its `Visible` and `EnableViewState` properties to `false`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample5.aspx)]

<span data-ttu-id="d5e8b-328">表示する必要があります、 `SettingsUpdatedMessage` DetailsView が更新されるたびにラベルを付けます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-328">We need to display the `SettingsUpdatedMessage` Label whenever the DetailsView is updated.</span></span> <span data-ttu-id="d5e8b-329">これを実現するには、detailsview のイベント ハンドラーを作成`ItemUpdated`イベントし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-329">To accomplish this, create an event handler for the DetailsView's `ItemUpdated` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample6.cs)]

<span data-ttu-id="d5e8b-330">戻り、`AdditionalUserInfo.aspx`ブラウザー内でページし、データを更新します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-330">Return to the `AdditionalUserInfo.aspx` page through a browser and update the data.</span></span> <span data-ttu-id="d5e8b-331">このとき、役立つステータス メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-331">This time, a helpful status message is displayed.</span></span>


<span data-ttu-id="d5e8b-332">[![短いメッセージが表示されるときに、設定を更新](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-332">[![A Short Message is Displayed When the Settings are Updated](storing-additional-user-information-cs/_static/image47.png)](storing-additional-user-information-cs/_static/image46.png)</span></span>

<span data-ttu-id="d5e8b-333">**図 16**: 設定が更新されたときに、短いメッセージが表示されます ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image48.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-333">**Figure 16**: A Short Message is Displayed When the Settings are Updated  ([Click to view full-size image](storing-additional-user-information-cs/_static/image48.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d5e8b-334">DetailsView コントロールのインターフェイスのままに編集するが必要なことはたくさんのです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-334">The DetailsView control's editing interface leaves a lot to be desired.</span></span> <span data-ttu-id="d5e8b-335">テキスト ボックスの標準サイズを使用してが署名フィールドには、複数行テキスト ボックスある必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-335">It uses standard-sized textboxes, but the Signature field should probably be a multi-line textbox.</span></span> <span data-ttu-id="d5e8b-336">RegularExpressionValidator はホームページの URL を入力した場合で開始する"http://"または"https://"ことを確認するために必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-336">A RegularExpressionValidator should be used to ensure that the homepage URL, if entered, starts with "http://" or "https://".</span></span> <span data-ttu-id="d5e8b-337">さらに、コントロールが DetailsView 以降その`DefaultMode`プロパティに設定`Edit`、[キャンセル] ボタンは何も行わない。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-337">Moreover, since the DetailsView control has its `DefaultMode` property set to `Edit`, the Cancel button does not do anything.</span></span> <span data-ttu-id="d5e8b-338">これは、いずれかを削除するか、または、クリックすると、ユーザーをリダイレクト他のページ (など`~/Default.aspx`)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-338">It should either be removed or, when clicked, redirect the user to some other page (such as `~/Default.aspx`).</span></span> <span data-ttu-id="d5e8b-339">これらの拡張機能は、リーダーの課題として退出です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-339">I leave these enhancements as an exercise for the reader.</span></span>


### <a name="adding-a-link-to-theadditionaluserinfoaspxpage-in-the-master-page"></a><span data-ttu-id="d5e8b-340">リンクを追加する、`AdditionalUserInfo.aspx`マスター ページのページ</span><span class="sxs-lookup"><span data-stu-id="d5e8b-340">Adding a Link to the`AdditionalUserInfo.aspx`Page in the Master Page</span></span>

<span data-ttu-id="d5e8b-341">現時点では、web サイトの管轄外へのリンク、`AdditionalUserInfo.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-341">Currently, the website does not provide any links to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="d5e8b-342">アクセスする唯一の方法では、ブラウザーのアドレス バーに直接、ページの URL を入力します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-342">The only way to reach it is to enter the page's URL directly into the browser's Address bar.</span></span> <span data-ttu-id="d5e8b-343">ここで、このページへのリンクを追加、`Site.master`マスター ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-343">Let's add a link to this page in the `Site.master` master page.</span></span>

<span data-ttu-id="d5e8b-344">マスター ページがで LoginView Web コントロールを含むことに注意してください、 `LoginContent` ContentPlaceHolder 認証済みおよび匿名のビジターに対して異なるマークアップを表示します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-344">Recall that the master page contains a LoginView Web control in its `LoginContent` ContentPlaceHolder that displays different markup for authenticated and anonymous visitors.</span></span> <span data-ttu-id="d5e8b-345">LoginView コントロールの更新`LoggedInTemplate`へのリンクを含める、`AdditionalUserInfo.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-345">Update the LoginView control's `LoggedInTemplate` to include a link to the `AdditionalUserInfo.aspx` page.</span></span> <span data-ttu-id="d5e8b-346">LoginView、これらの変更を行った後コントロールの宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-346">After making these changes the LoginView control's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample7.aspx)]

<span data-ttu-id="d5e8b-347">追加に注意してください、`lnkUpdateSettings`ハイパーリンク コントロールを`LoggedInTemplate`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-347">Note the addition of the `lnkUpdateSettings` HyperLink control to the `LoggedInTemplate`.</span></span> <span data-ttu-id="d5e8b-348">このリンクで認証されたユーザーにすばやく移動できます、ページを表示およびそのホーム町、ホーム ページ、および署名の設定を変更します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-348">With this link in place, authenticated users can quickly jump to the page to view and modify their home town, homepage, and signature settings.</span></span>

## <a name="step-4-adding-new-guestbook-comments"></a><span data-ttu-id="d5e8b-349">手順 4: 新しいゲストブック コメントを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-349">Step 4: Adding New Guestbook Comments</span></span>

<span data-ttu-id="d5e8b-350">`Guestbook.aspx`ページが認証されたユーザーが、ゲストブックを表示し、コメントのままにします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-350">The `Guestbook.aspx` page is where authenticated users can view the guestbook and leave a comment.</span></span> <span data-ttu-id="d5e8b-351">新しいゲストブック コメントを追加するインターフェイスの作成を始めましょう。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-351">Let's start with creating the interface to add new guestbook comments.</span></span>

<span data-ttu-id="d5e8b-352">開く、 `Guestbook.aspx` Visual Studio でページおよび新しいコメントの件名と本文の 2 つのテキスト ボックス コントロールで構成されるユーザー インターフェイスを構築します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-352">Open the `Guestbook.aspx` page in Visual Studio and construct a user interface consisting of two TextBox controls, one for the new comment's subject and one for its body.</span></span> <span data-ttu-id="d5e8b-353">最初の TextBox コントロールの設定`ID`プロパティを`Subject`とその`Columns`40 プロパティ以外の設定の 2 番目の`ID`に`Body`、その`TextMode`に`MultiLine`、およびその`Width`と`Rows`プロパティを「95%」や 8、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-353">Set the first TextBox control's `ID` property to `Subject` and its `Columns` property to 40; set second's `ID` to `Body`, its `TextMode` to `MultiLine`, and its `Width` and `Rows` properties to "95%" and 8, respectively.</span></span> <span data-ttu-id="d5e8b-354">完了するには、ユーザー インターフェイスという名前のボタンの Web コントロールを追加`PostCommentButton`設定とその`Text`プロパティを「投稿、コメント」です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-354">To complete the user interface, add a Button Web control named `PostCommentButton` and set its `Text` property to "Post Your Comment".</span></span>

<span data-ttu-id="d5e8b-355">各ゲストブック コメントには、件名と本文が必要とするため、各テキスト ボックス、RequiredFieldValidator を追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-355">Since each guestbook comment requires a subject and body, add a RequiredFieldValidator for each of the TextBoxes.</span></span> <span data-ttu-id="d5e8b-356">設定、 `ValidationGroup` "EnterComment"です。 これらのコントロールのプロパティ同様に、設定、`PostCommentButton`コントロールの`ValidationGroup`プロパティを"EnterComment"です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-356">Set the `ValidationGroup` property of these controls to "EnterComment"; likewise, set the `PostCommentButton` control's `ValidationGroup` property to "EnterComment".</span></span> <span data-ttu-id="d5e8b-357">ASP の詳細についてはします。NET の検証コントロール、チェック アウト[ASP.NET でのフォーム検証](http://www.4guysfromrolla.com/webtech/090200-1.shtml)、 [ASP.NET 2.0 の検証コントロールを分解](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)、および[検証サーバー コントロールのチュートリアル](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp)[W3Schools](http://www.w3schools.com/)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-357">For more information on ASP.NET's validation controls, check out [Form Validation in ASP.NET](http://www.4guysfromrolla.com/webtech/090200-1.shtml), [Dissecting the Validation Controls in ASP.NET 2.0](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx), and the [Validation Server Controls Tutorial](http://www.w3schools.com/aspnet/aspnet_refvalidationcontrols.asp) on [W3Schools](http://www.w3schools.com/).</span></span>

<span data-ttu-id="d5e8b-358">ユーザー インターフェイスを作成したら、ページの宣言型マークアップなります次のような。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-358">After crafting the user interface your page's declarative markup should look something like the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample8.aspx)]

<span data-ttu-id="d5e8b-359">完全なユーザー インターフェイスと、次のタスクに新しいレコードを挿入する、`GuestbookComments`時にテーブル、`PostCommentButton`をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-359">With the user interface complete, our next task is to insert a new record into the `GuestbookComments` table when the `PostCommentButton` is clicked.</span></span> <span data-ttu-id="d5e8b-360">これには、さまざまな方法で: ボタンの ADO.NET コードを記述できます`Click`イベント ハンドラーですお SqlDataSource コントロール、ページを追加、構成することができます、 `InsertCommand`、まずその`Insert`メソッドから、`Click`イベント。ハンドラーです。またはおが新しいゲストブック コメントの挿入を担当する中間層を作成してそのからこの機能を実行することも、`Click`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-360">This can be accomplished in a number of ways: we can write ADO.NET code in the Button's `Click` event handler; we can add a SqlDataSource control to the page, configure its `InsertCommand`, and then call its `Insert` method from the `Click` event handler; or we could build a middle tier that was responsible for inserting new guestbook comments, and invoke this functionality from the `Click` event handler.</span></span> <span data-ttu-id="d5e8b-361">手順 3 で、SqlDataSource を使用して検索すると、以降は、ここで ADO.NET コードを使用してみましょう。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-361">Since we looked at using a SqlDataSource in Step 3, let's use ADO.NET code here.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-362">Microsoft SQL Server データベースからデータをプログラムでアクセスするために使用する ADO.NET クラスにある、`System.Data.SqlClient`名前空間。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-362">The ADO.NET classes used to programmatically access data from a Microsoft SQL Server database are located in the `System.Data.SqlClient` namespace.</span></span> <span data-ttu-id="d5e8b-363">ページの分離コード クラスにこの名前空間をインポートする必要があります (つまり、 `using System.Data.SqlClient;`)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-363">You may need to import this namespace into your page's code-behind class (i.e., `using System.Data.SqlClient;`).</span></span>


<span data-ttu-id="d5e8b-364">イベント ハンドラーを作成、`PostCommentButton`の`Click`イベントし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-364">Create an event handler for the `PostCommentButton`'s `Click` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample9.cs)]

<span data-ttu-id="d5e8b-365">`Click`ユーザーが指定したデータが有効であるかをチェックしてイベント ハンドラーを起動します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-365">The `Click` event handler starts by checking that the user-supplied data is valid.</span></span> <span data-ttu-id="d5e8b-366">そうでない場合、イベント ハンドラーは、レコードを挿入する前に終了します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-366">If it is not, the event handler exits before inserting a record.</span></span> <span data-ttu-id="d5e8b-367">指定されたデータは、有効なと仮定すると、現在ログオンしているユーザーの`UserId`値が取得されに格納されている、`currentUserId`ローカル変数。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-367">Assuming the supplied data is valid, the currently logged on user's `UserId` value is retrieved and stored in the `currentUserId` local variable.</span></span> <span data-ttu-id="d5e8b-368">提供する必要がありますので、この値が必要な`UserId`にレコードを挿入するときの値`GuestbookComments`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-368">This value is needed because we must supply a `UserId` value when inserting a record into `GuestbookComments`.</span></span>

<span data-ttu-id="d5e8b-369">次に、接続文字列が、`SecurityTutorials`からデータベースを取得`Web.config`と`INSERT`SQL ステートメントを指定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-369">Following that, the connection string for the `SecurityTutorials` database is retrieved from `Web.config` and the `INSERT` SQL statement is specified.</span></span> <span data-ttu-id="d5e8b-370">A`SqlConnection`オブジェクトが作成され、開かれました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-370">A `SqlConnection` object is then created and opened.</span></span> <span data-ttu-id="d5e8b-371">次に、`SqlCommand`オブジェクトが構築されで使用されるパラメーターの値、`INSERT`クエリが割り当てられています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-371">Next, a `SqlCommand` object is constructed and the values for the parameters used in the `INSERT` query are assigned.</span></span> <span data-ttu-id="d5e8b-372">`INSERT`ステートメントを実行して、接続が終了します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-372">The `INSERT` statement is then executed and the connection closed.</span></span> <span data-ttu-id="d5e8b-373">イベント ハンドラーの最後に、`Subject`と`Body`テキスト ボックスの`Text`プロパティがオフになってできるように、ユーザーの値は、ポストバック間で保持されません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-373">At the end of the event handler, the `Subject` and `Body` TextBoxes' `Text` properties are cleared out so that the user's values are not persisted across the postback.</span></span>

<span data-ttu-id="d5e8b-374">このページをブラウザーでテストしてください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-374">Go ahead and test out this page in a browser.</span></span> <span data-ttu-id="d5e8b-375">このページがであるため、`Membership`フォルダーはアクセスできない匿名の訪問者にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-375">Since this page is in the `Membership` folder it is not accessible to anonymous visitors.</span></span> <span data-ttu-id="d5e8b-376">したがって、最初 (されませんが既にある場合) にログオンする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-376">Therefore, you will need to first log on (if you have not already).</span></span> <span data-ttu-id="d5e8b-377">値を入力して、`Subject`と`Body`テキスト ボックス をクリックし、`PostCommentButton`ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-377">Enter a value into the `Subject` and `Body` TextBoxes and click the `PostCommentButton` button.</span></span> <span data-ttu-id="d5e8b-378">これにより、新しいレコードに追加する`GuestbookComments`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-378">This will cause a new record to be added to `GuestbookComments`.</span></span> <span data-ttu-id="d5e8b-379">ポストバックで件名と本文の指定したが、テキスト ボックスからワイプされます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-379">On postback, the subject and body you provided are wiped from the TextBoxes.</span></span>

<span data-ttu-id="d5e8b-380">クリックした後、`PostCommentButton`ボタンがありますに視覚的なフィードバックはありません、コメント、ゲストブックを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-380">After clicking the `PostCommentButton` button there is no visual feedback that the comment was added to the guestbook.</span></span> <span data-ttu-id="d5e8b-381">既存のゲストブックのコメントは、手順 5. での処理を表示するには、このページを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-381">We still need to update this page to display the existing guestbook comments, which we will do in Step 5.</span></span> <span data-ttu-id="d5e8b-382">これを実行するだけで追加したコメントが適切な視覚的なフィードバックを提供する、コメントの一覧に表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-382">Once we accomplish that, the just-added comment will appear in the list of comments, providing adequate visual feedback.</span></span> <span data-ttu-id="d5e8b-383">ここでは、確認の内容を確認するには、ゲストブック コメントが保存されたこと、`GuestbookComments`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-383">For now, confirm that your guestbook comment was saved by examining the contents of the `GuestbookComments` table.</span></span>

<span data-ttu-id="d5e8b-384">図 17 の内容を示しています、`GuestbookComments`表の後、2 つのコメントが残されています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-384">Figure 17 shows the contents of the `GuestbookComments` table after two comments have been left.</span></span>


<span data-ttu-id="d5e8b-385">[![GuestbookComments テーブルでゲストブック コメントを確認できます。](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-385">[![You Can See the Guestbook Comments in the GuestbookComments Table](storing-additional-user-information-cs/_static/image50.png)](storing-additional-user-information-cs/_static/image49.png)</span></span>

<span data-ttu-id="d5e8b-386">**図 17**: でゲストブック コメントを表示できます、`GuestbookComments`テーブル ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image51.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-386">**Figure 17**: You Can See the Guestbook Comments in the `GuestbookComments` Table  ([Click to view full-size image](storing-additional-user-information-cs/_static/image51.png))</span></span>


> [!NOTE]
> <span data-ttu-id="d5e8b-387">ユーザーを含む可能性のあるゲストブック コメントを挿入しようとしました。 危険性のあるマークアップ: HTML – ASP.NET などがスローされます、`HttpRequestValidationException`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-387">If a user attempts to insert a guestbook comment that contains potentially dangerous markup – such as HTML – ASP.NET will throw an `HttpRequestValidationException`.</span></span> <span data-ttu-id="d5e8b-388">この例外がスローされた原因と危険性のある値を送信するユーザーを許可する方法の詳細についてを参照してください、[要求の検証に関するホワイト ペーパー](../../../../whitepapers/request-validation.md)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-388">To learn more about this exception, why it's thrown, and how to permit users to submit potentially dangerous values, consult the [Request Validation Whitepaper](../../../../whitepapers/request-validation.md).</span></span>


## <a name="step-5-listing-the-existing-guestbook-comments"></a><span data-ttu-id="d5e8b-389">手順 5:、既存のゲストブック コメントが一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-389">Step 5: Listing the Existing Guestbook Comments</span></span>

<span data-ttu-id="d5e8b-390">コメント、ユーザーが訪問のままに加え、`Guestbook.aspx`ページをゲストブックの既存のコメントを表示することもする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-390">In addition to leaving comments, a user visiting the `Guestbook.aspx` page should also be able to view the guestbook's existing comments.</span></span> <span data-ttu-id="d5e8b-391">これを実現する、という名前の ListView コントロールを追加`CommentList`ページの下部にします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-391">To accomplish this, add a ListView control named `CommentList` to the bottom of the page.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-392">ListView コントロールは ASP.NET 3.5 が新たに追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-392">The ListView control is new to ASP.NET version 3.5.</span></span> <span data-ttu-id="d5e8b-393">非常にカスタマイズ可能な柔軟なレイアウトに項目の一覧を表示しながら組み込みの編集、挿入、削除、ページング、および並べ替え GridView のような機能をまだ提供されています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-393">It is designed to display a list of items in a very customizable and flexible layout, yet still offer built-in editing, inserting, deleting, paging, and sorting functionality like the GridView.</span></span> <span data-ttu-id="d5e8b-394">ASP.NET 2.0 を使用している場合は、代わりに、DataList またはリピータ コントロールを使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-394">If you are using ASP.NET 2.0, you will need to use the DataList or Repeater control instead.</span></span> <span data-ttu-id="d5e8b-395">ListView の使用に関する詳細については、次を参照してください。 [Scott Guthrie](https://weblogs.asp.net/scottgu/)のブログ エントリ「 [asp: ListView コントロール](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)、と私の記事[ListView コントロールにデータを表示する](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-395">For more information on using the ListView, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry, [The asp:ListView Control](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx), and my article, [Displaying Data with the ListView Control](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx).</span></span>


<span data-ttu-id="d5e8b-396">ListView のスマート タグを開き、データ ソースのドロップダウン リストから新しいデータ ソースにコントロールをバインドします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-396">Open the ListView's Smart Tag and, from the Choose Data Source drop-down list, bind the control to a new data source.</span></span> <span data-ttu-id="d5e8b-397">手順 2 で説明したとおり、これが、データ ソース構成ウィザードが起動します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-397">As we saw in Step 2, this will launch the Data Source Configuration Wizard.</span></span> <span data-ttu-id="d5e8b-398">[データベース] アイコンを選択し、結果として得られる SqlDataSource という名前を`CommentsDataSource`、[ok] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-398">Select the Database icon, name the resulting SqlDataSource `CommentsDataSource`, and click OK.</span></span> <span data-ttu-id="d5e8b-399">次に、選択、`SecurityTutorialsConnectionString`接続がドロップダウン リストから文字列を [次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-399">Next, select the `SecurityTutorialsConnectionString` connection string from the drop-down list and click Next.</span></span>

<span data-ttu-id="d5e8b-400">この時点で手順 2. で指定したデータのクエリをピッキングで、`UserProfiles`ドロップダウン リストからテーブルが表示され、返される列を選択する (戻るは図 9 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-400">At this point in Step 2 we specified the data to query by picking the `UserProfiles` table from the drop-down list and selecting the columns to return (refer back to Figure 9).</span></span> <span data-ttu-id="d5e8b-401">このとき、ただし、たい戻るだけでなく、レコードを取得する SQL ステートメントを作成する`GuestbookComments`が、コメントの出身地も、ホーム ページ、署名、およびユーザー名。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-401">This time, however, we want to craft a SQL statement that pulls back not only the records from `GuestbookComments`, but also the commenter's home town, homepage, signature, and username.</span></span> <span data-ttu-id="d5e8b-402">したがって、「カスタム SQL ステートメントまたはストアド プロシージャを指定する」オプション ボタンを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-402">Therefore, select the "Specify a custom SQL statement or stored procedure" radio button and click Next.</span></span>

<span data-ttu-id="d5e8b-403">これは、「を定義するカスタム ステートメントまたはストアド プロシージャ」画面が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-403">This will bring up the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="d5e8b-404">クエリをグラフィカルに作成するクエリ ビルダー ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-404">Click the Query Builder button to graphically build the query.</span></span> <span data-ttu-id="d5e8b-405">クエリ ビルダーからクエリを実行するテーブルを指定するよう求められますが開始されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-405">The Query Builder starts by prompting us to specify the tables we want to query from.</span></span> <span data-ttu-id="d5e8b-406">選択、 `GuestbookComments`、 `UserProfiles`、および`aspnet_Users`テーブルし、[ok] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-406">Select the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables and click OK.</span></span> <span data-ttu-id="d5e8b-407">これでは、3 つすべてのテーブルをデザイン画面に追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-407">This will add all three tables to the design surface.</span></span> <span data-ttu-id="d5e8b-408">間で外部キー制約があるため、 `GuestbookComments`、 `UserProfiles`、および`aspnet_Users`テーブル、クエリ ビルダーは、自動的に`JOIN`s これらのテーブルです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-408">Since there are foreign key constraints amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables, the Query Builder automatically `JOIN` s these tables.</span></span>

<span data-ttu-id="d5e8b-409">返される列を指定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-409">All that remains is to specify the columns to return.</span></span> <span data-ttu-id="d5e8b-410">`GuestbookComments`テーブルの選択、 `Subject`、 `Body`、および`CommentDate`列以外の戻り値の場合は、 `HomeTown`、 `HomepageUrl`、および`Signature`からの列、 `UserProfiles` ; テーブルし、返す`UserName`から`aspnet_Users`.</span><span class="sxs-lookup"><span data-stu-id="d5e8b-410">From the `GuestbookComments` table select the `Subject`, `Body`, and `CommentDate` columns; return the `HomeTown`, `HomepageUrl`, and `Signature` columns from the `UserProfiles` table; and return `UserName` from `aspnet_Users`.</span></span> <span data-ttu-id="d5e8b-411">また、追加"`ORDER BY CommentDate DESC`"の末尾に、`SELECT`最新の投稿が最初に返されるようにクエリを実行します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-411">Also, add "`ORDER BY CommentDate DESC`" to the end of the `SELECT` query so that the most recent posts are returned first.</span></span> <span data-ttu-id="d5e8b-412">これらの選択を行った後、クエリ ビルダー インターフェイスは図 18 でスクリーン ショットのようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-412">After making these selections, your Query Builder interface should look similar to the screen shot in Figure 18.</span></span>


<span data-ttu-id="d5e8b-413">[![構築クエリ GuestbookComments、ユーザー、および aspnet_Users テーブルを結合します。](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-413">[![The Constructed Query JOINs the GuestbookComments, UserProfiles, and aspnet_Users Tables](storing-additional-user-information-cs/_static/image53.png)](storing-additional-user-information-cs/_static/image52.png)</span></span>

<span data-ttu-id="d5e8b-414">**図 18**:、構築されたクエリ`JOIN`s、 `GuestbookComments`、 `UserProfiles`、および`aspnet_Users`テーブル ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image54.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-414">**Figure 18**: The Constructed Query `JOIN` s the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` Tables  ([Click to view full-size image](storing-additional-user-information-cs/_static/image54.png))</span></span>


<span data-ttu-id="d5e8b-415">クエリ ビルダー ウィンドウを閉じて、「を定義するカスタム ステートメントまたはストアド プロシージャ」の画面に戻るには、ok をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-415">Click OK to close the Query Builder window and return to the "Define Custom Statements or Stored Procedures" screen.</span></span> <span data-ttu-id="d5e8b-416">クエリのテスト ボタンをクリックして、クエリの結果を表示することがあります、「テスト クエリ」の画面に詳細の横にあるをクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-416">Click Next to advance to the "Test Query" screen, where you may view the query results by clicking the Test Query button.</span></span> <span data-ttu-id="d5e8b-417">準備ができたら、データ ソース構成ウィザードを完了するには、[完了] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-417">When you're ready, click Finish to complete the Configure Data Source wizard.</span></span>

<span data-ttu-id="d5e8b-418">ステップ 2 で、関連付けられた DetailsView コントロールのデータ ソース構成ウィザードを完了して`Fields`コレクションは、によって返される列ごとに BoundField を含むように更新されました、`SelectCommand`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-418">When we completed the Configure Data Source wizard in Step 2, the associated DetailsView control's `Fields` collection was updated to include a BoundField for each column returned by the `SelectCommand`.</span></span> <span data-ttu-id="d5e8b-419">ListView、ただしは変更されていません。そのレイアウトを定義する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-419">The ListView, however, remains unchanged; we still need to define its layout.</span></span> <span data-ttu-id="d5e8b-420">ListView のレイアウトは、その宣言型マークアップまたはのスマート タグで"ListView の構成"オプションから、手動で作成できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-420">The ListView's layout can be constructed manually through its declarative markup or from the "Configure ListView" option in its Smart Tag.</span></span> <span data-ttu-id="d5e8b-421">通常、マークアップを手動で定義したがりますが、最も自然なメソッドを使用します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-421">I usually prefer defining the markup by hand, but use whatever method is most natural to you.</span></span>

<span data-ttu-id="d5e8b-422">結局、次を使用して`LayoutTemplate`、 `ItemTemplate`、および`ItemSeparatorTemplate`ListView コントロールの。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-422">I ended up using the following `LayoutTemplate`, `ItemTemplate`, and `ItemSeparatorTemplate` for my ListView control:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample10.aspx)]

<span data-ttu-id="d5e8b-423">`LayoutTemplate`のマークアップを定義、コントロールによって発生したときに、 `ItemTemplate` SqlDataSource によって返される各項目をレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-423">The `LayoutTemplate` defines the markup emitted by the control, while the `ItemTemplate` renders each item returned by the SqlDataSource.</span></span> <span data-ttu-id="d5e8b-424">`ItemTemplate`の結果として得られるマークアップが配置されます、`LayoutTemplate`の`itemPlaceholder`コントロール。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-424">The `ItemTemplate`'s resulting markup is placed in the `LayoutTemplate`'s `itemPlaceholder` control.</span></span> <span data-ttu-id="d5e8b-425">加え、 `itemPlaceholder`、 `LayoutTemplate` ListView を 1 ページ (既定) のみ 10 ゲストブック コメントの表示を制限する DataPager コントロールが含まれており、ページング インターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-425">In addition to the `itemPlaceholder`, the `LayoutTemplate` includes a DataPager control, which limits the ListView to showing just 10 guestbook comments per page (the default) and renders a paging interface.</span></span>

<span data-ttu-id="d5e8b-426">マイ`ItemTemplate`で各ゲストブック コメントの内容を表示、`<h4>`サブジェクトの下に離れた本文を持つ要素。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-426">My `ItemTemplate` displays each guestbook comment's subject in an `<h4>` element with the body situated below the subject.</span></span> <span data-ttu-id="d5e8b-427">本文を表示するための構文がによって返されるデータを受け取ることに注意してください、`Eval("Body")`データ バインド ステートメントでは、文字列に変換すること、および置換の改行を`<br />`要素。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-427">Note that that syntax used for displaying the body takes the data returned by the `Eval("Body")` databinding statement, converts it to a string, and replaces line breaks with the `<br />` element.</span></span> <span data-ttu-id="d5e8b-428">HTML での空白は無視されますので、コメントを送信するときに入力した行区切りを表示するのには、この変換が必要です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-428">This conversion is needed in order to show the line breaks entered when submitting the comment since whitespace is ignored by HTML.</span></span> <span data-ttu-id="d5e8b-429">ユーザーの署名は、ユーザーのホーム町、自分のホーム ページ、コメントが行われた、およびコメントを左人のユーザー名へのリンクを続けて、斜体で本文の下に表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-429">The user's signature is displayed beneath the body in italics, followed by the user's home town, a link to his homepage, the date and time the comment was made, and the username of the person who left the comment.</span></span>

<span data-ttu-id="d5e8b-430">すぐをブラウザーでページを表示します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-430">Take a moment to view the page through a browser.</span></span> <span data-ttu-id="d5e8b-431">ここに表示される手順 5 でゲストブックを追加したコメントが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-431">You should see the comments that you added to the guestbook in Step 5 displayed here.</span></span>


<span data-ttu-id="d5e8b-432">[![Guestbook.aspx Now には、ゲストブックのコメントが表示されます。](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-432">[![Guestbook.aspx Now Displays the Guestbook's Comments](storing-additional-user-information-cs/_static/image56.png)](storing-additional-user-information-cs/_static/image55.png)</span></span>

<span data-ttu-id="d5e8b-433">**図 19**:`Guestbook.aspx`ゲストブックのコメントが表示されます ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image57.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-433">**Figure 19**: `Guestbook.aspx` Now Displays the Guestbook's Comments  ([Click to view full-size image](storing-additional-user-information-cs/_static/image57.png))</span></span>


<span data-ttu-id="d5e8b-434">新しいコメントを追加するには、ゲストブックを再試行してください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-434">Try adding a new comment to the guestbook.</span></span> <span data-ttu-id="d5e8b-435">クリックすると、`PostCommentButton`ボタン、ページがポストバックしコメントは、データベースを追加が ListView コントロールは、新しいコメントを表示するのには更新されません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-435">Upon clicking the `PostCommentButton` button the page posts back and the comment is added to the database, but the ListView control is not updated to show the new comment.</span></span> <span data-ttu-id="d5e8b-436">これは、いずれかで修正できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-436">This can be fixed by either:</span></span>

- <span data-ttu-id="d5e8b-437">更新、`PostCommentButton`ボタンの`Click`イベント ハンドラーを呼び出します ListView コントロールのため`DataBind()`メソッド、データベースに新しいコメントを挿入した後に、または</span><span class="sxs-lookup"><span data-stu-id="d5e8b-437">Updating the `PostCommentButton` button's `Click` event handler so that it invokes the ListView control's `DataBind()` method after inserting the new comment into the database, or</span></span>
- <span data-ttu-id="d5e8b-438">ListView コントロールの設定`EnableViewState`プロパティを`false`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-438">Setting the ListView control's `EnableViewState` property to `false`.</span></span> <span data-ttu-id="d5e8b-439">この方法は、コントロールのビューステートを無効にすると、ポストバックのたびに基になるデータにバインドする必要がありますので機能します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-439">This approach works because by disabling the control's view state, it must rebind to the underlying data on every postback.</span></span>

<span data-ttu-id="d5e8b-440">このチュートリアルからダウンロード可能なチュートリアルの web サイトは、両方の方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-440">The tutorial website downloadable from this tutorial illustrates both techniques.</span></span> <span data-ttu-id="d5e8b-441">ListView コントロールの`EnableViewState`プロパティを`false`ListView にデータをプログラムによって再バインドするために必要なコードがである、 `Click` 、イベント ハンドラーがコメント アウトしますが、します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-441">The ListView control's `EnableViewState` property to `false` and the code needed to programmatically rebind the data to the ListView is present in the `Click` event handler, but is commented out.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-442">現在、 `AdditionalUserInfo.aspx`  ページでは、ユーザーを表示およびそのホーム町、ホーム ページ、および署名の設定を編集します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-442">Currently the `AdditionalUserInfo.aspx` page allows the user to view and edit their home town, homepage, and signature settings.</span></span> <span data-ttu-id="d5e8b-443">更新する便利な場合があります`AdditionalUserInfo.aspx`ゲストブックのユーザーのコメントに、ログ記録を表示します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-443">It might be nice to update `AdditionalUserInfo.aspx` to display the logged in user's guestbook comments.</span></span> <span data-ttu-id="d5e8b-444">つまり、確認して、自分の情報を変更する、に加えて、ユーザーがアクセスできる、`AdditionalUserInfo.aspx`ページを参照するどのゲストブック コメント過去で彼女が行われます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-444">That is, in addition to examining and modifying her information, a user can visit the `AdditionalUserInfo.aspx` page to see what guestbook comments she's made in the past.</span></span> <span data-ttu-id="d5e8b-445">I のままに練習として、興味のリーダーの。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-445">I leave this as an exercise for the interested reader.</span></span>


## <a name="step-6-customizing-the-createuserwizard-control-to-include-an-interface-for-the-home-town-homepage-and-signature"></a><span data-ttu-id="d5e8b-446">手順 6: ホーム町、ホーム ページ、および署名のインターフェイスを含める CreateUserWizard コントロールのカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="d5e8b-446">Step 6: Customizing the CreateUserWizard Control to Include an Interface for the Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="d5e8b-447">`SELECT`によって使用されるクエリ、`Guestbook.aspx`ページの使用、`INNER JOIN`間で関連レコードを結合して、 `GuestbookComments`、 `UserProfiles`、および`aspnet_Users`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-447">The `SELECT` query used by the `Guestbook.aspx` page uses an `INNER JOIN` to combine the related records amongst the `GuestbookComments`, `UserProfiles`, and `aspnet_Users` tables.</span></span> <span data-ttu-id="d5e8b-448">場合にレコードがないユーザー`UserProfiles`ゲストブック行うコメントの追加、コメント、ListView には表示されません、`INNER JOIN`のみが返されます`GuestbookComments`レコード内の一致レコードがある場合に`UserProfiles`と`aspnet_Users`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-448">If a user that has no record in `UserProfiles` makes a guestbook comment, the comment won't be displayed in the ListView because the `INNER JOIN` only returns `GuestbookComments` records when there are matching records in `UserProfiles` and `aspnet_Users`.</span></span> <span data-ttu-id="d5e8b-449">ユーザーがレコード手順 3. で示したように、`UserProfiles`彼女を表示または自分で設定を編集できない、`AdditionalUserInfo.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-449">And as we saw in Step 3, if a user does not have a record in `UserProfiles` she cannot view or edit her settings in the `AdditionalUserInfo.aspx` page.</span></span>

<span data-ttu-id="d5e8b-450">言うまでも、設計のため、メンバーシップ システム内のすべてのユーザー アカウントは、一致することが重要である意思決定を記録で、`UserProfiles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-450">Needless to say, due to our design decisions it is important that every user account in the Membership system have a matching record in the `UserProfiles` table.</span></span> <span data-ttu-id="d5e8b-451">対応するレコードに追加するのには、必要な`UserProfiles`CreateUserWizard、新しいメンバーシップ ユーザー アカウントを作成するときにします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-451">What we want is for a corresponding record to be added to `UserProfiles` whenever a new Membership user account is created through the CreateUserWizard.</span></span>

<span data-ttu-id="d5e8b-452">説明したように、 [*ユーザー アカウントを作成する*](creating-user-accounts-cs.md)チュートリアルでは、新しいメンバーシップ ユーザーのアカウントには CreateUserWizard コントロールが作成された後発生その[`CreatedUser`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span><span class="sxs-lookup"><span data-stu-id="d5e8b-452">As discussed in the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, after the new Membership user account is created the CreateUserWizard control raises its [`CreatedUser` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx).</span></span> <span data-ttu-id="d5e8b-453">このイベントのイベント ハンドラーを作成、だけが作成したユーザーのユーザー Id を取得したりにレコードを挿入できます、`UserProfiles`の既定値を持つテーブル、 `HomeTown`、 `HomepageUrl`、および`Signature`列です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-453">We can create an event handler for this event, get the UserId for the just-created user, and then insert a record into the `UserProfiles` table with default values for the `HomeTown`, `HomepageUrl`, and `Signature` columns.</span></span> <span data-ttu-id="d5e8b-454">さらに含める追加のテキスト ボックス、CreateUserWizard コントロールのインターフェイスをカスタマイズすることにより、ユーザーにこれらの値を確認することができます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-454">What's more, it is possible to prompt the user for these values by customizing the CreateUserWizard control's interface to include additional TextBoxes.</span></span>

<span data-ttu-id="d5e8b-455">最初に新しい行を追加する方法を見てみましょう、`UserProfiles`テーブルに、`CreatedUser`既定値を持つイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-455">Let's first look at how to add a new row to the `UserProfiles` table in the `CreatedUser` event handler with default values.</span></span> <span data-ttu-id="d5e8b-456">次に、新しいユーザーのホーム町、ホーム ページ、および署名を収集する追加のフォーム フィールドを含める CreateUserWizard コントロールのユーザー インターフェイスをカスタマイズする方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-456">Following that, we will see how to customize the CreateUserWizard control's user interface to include additional form fields to collect the new user's home town, homepage, and signature.</span></span>

### <a name="adding-a-default-row-touserprofiles"></a><span data-ttu-id="d5e8b-457">既定の行を追加します。`UserProfiles`</span><span class="sxs-lookup"><span data-stu-id="d5e8b-457">Adding a Default Row to`UserProfiles`</span></span>

<span data-ttu-id="d5e8b-458">[*ユーザー アカウントを作成する*](creating-user-accounts-cs.md)チュートリアルに CreateUserWizard コントロールを追加しました、 `CreatingUserAccounts.aspx`  ページで、`Membership`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-458">In the [*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we added a CreateUserWizard control to the `CreatingUserAccounts.aspx` page in the `Membership` folder.</span></span> <span data-ttu-id="d5e8b-459">コントロールを CreateUserWizard を確保するためにレコードを追加する`UserProfiles`テーブル ユーザー アカウントの作成時に CreateUserWizard コントロールの機能を更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-459">In order to have the CreateUserWizard control add a record to `UserProfiles` table upon user account creation, we need to update the CreateUserWizard control's functionality.</span></span> <span data-ttu-id="d5e8b-460">これらの変更を行うのではなく、 `CreatingUserAccounts.aspx`  ページで、代わりに新しい CreateUserWizard コントロールを追加してみましょう`EnhancedCreateUserWizard.aspx`ページし、このチュートリアルでは、ある変更を行います。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-460">Rather than making these changes to the `CreatingUserAccounts.aspx` page, let's instead add a new CreateUserWizard control to `EnhancedCreateUserWizard.aspx` page and make the modifications for this tutorial there.</span></span>

<span data-ttu-id="d5e8b-461">開く、 `EnhancedCreateUserWizard.aspx` Visual Studio でのページし、ページには、ツールボックスから CreateUserWizard コントロールをドラッグします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-461">Open the `EnhancedCreateUserWizard.aspx` page in Visual Studio and drag a CreateUserWizard control from the Toolbox onto the page.</span></span> <span data-ttu-id="d5e8b-462">CreateUserWizard コントロールの設定`ID`プロパティを`NewUserWizard`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-462">Set the CreateUserWizard control's `ID` property to `NewUserWizard`.</span></span> <span data-ttu-id="d5e8b-463">説明したよう、 <a id="_msoanchor_5"> </a> [*ユーザー アカウントを作成する*](creating-user-accounts-cs.md)チュートリアル、CreateUserWizard の既定のユーザー インターフェイスに必要な情報のビジターをメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-463">As we discussed in the <a id="_msoanchor_5"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial, the CreateUserWizard's default user interface prompts the visitor for the necessary information.</span></span> <span data-ttu-id="d5e8b-464">この情報が指定されていますコントロール内部的に作成、新しいユーザー アカウント framework では、メンバーシップ、すべてせずに 1 行のコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-464">Once this information has been supplied, the control internally creates a new user account in the Membership framework, all without us having to write a single line of code.</span></span>

<span data-ttu-id="d5e8b-465">CreateUserWizard コントロールでは、そのワークフロー内で複数のイベントを発生させます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-465">The CreateUserWizard control raises a number of events during its workflow.</span></span> <span data-ttu-id="d5e8b-466">CreateUserWizard コントロールが最初に起動訪問者は要求情報を提供し、フォームを送信する、その[`CreatingUser`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-466">After a visitor supplies the request information and submits the form, the CreateUserWizard control initially fires its [`CreatingUser` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.creatinguser.aspx).</span></span> <span data-ttu-id="d5e8b-467">作成プロセス中に問題がある場合、 [ `CreateUserError`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx)が発生します。 ただし、ユーザーが正常に作成される場合は、次に、 [ `CreatedUser`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx)が発生します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-467">If there is a problem during the create process, the [`CreateUserError` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createusererror.aspx) is fired; however, if the user is successfully created, then the [`CreatedUser` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.createduser.aspx) is raised.</span></span> <span data-ttu-id="d5e8b-468"><a id="_msoanchor_6"> </a> [*ユーザー アカウントを作成する*](creating-user-accounts-cs.md)のイベント ハンドラーを作成したチュートリアル、`CreatingUser`イベントを指定されたユーザー名が、先頭を含まないことを確認してください。末尾のスペースや、ユーザー名は、パスワードに任意の場所出現しませんでした。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-468">In the <a id="_msoanchor_6"></a>[*Creating User Accounts*](creating-user-accounts-cs.md) tutorial we created an event handler for the `CreatingUser` event to ensure that the supplied username did not contain any leading or trailing spaces, and that the username did not appear anywhere in the password.</span></span>

<span data-ttu-id="d5e8b-469">内の行を追加するために、`UserProfiles`テーブルだけが作成したユーザーの必要がありますのイベント ハンドラーを作成する、`CreatedUser`イベント。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-469">In order to add a row in the `UserProfiles` table for the just-created user, we need to create an event handler for the `CreatedUser` event.</span></span> <span data-ttu-id="d5e8b-470">時間によって、`CreatedUser`イベントが発生した、ユーザー アカウントが有効にすると、アカウントのユーザー Id の値を取得するメンバーシップ framework は、既に作成されています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-470">By the time the `CreatedUser` event has fired, the user account has already been created in the Membership framework, enabling us to retrieve the account's UserId value.</span></span>

<span data-ttu-id="d5e8b-471">イベント ハンドラーを作成、`NewUserWizard`の`CreatedUser`イベントし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-471">Create an event handler for the `NewUserWizard`'s `CreatedUser` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample11.cs)]

<span data-ttu-id="d5e8b-472">だけで追加したユーザー アカウントのユーザー Id を取得することによって上記のコード開始。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-472">The above code beings by retrieving the UserId of the just-added user account.</span></span> <span data-ttu-id="d5e8b-473">使用してこの情報は、 `Membership.GetUser(username)` 、特定のユーザーと、使用に関する情報を返すメソッド、`ProviderUserKey`ユーザー Id を取得するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-473">This is accomplished by using the `Membership.GetUser(username)` method to return information about a particular user, and then using the `ProviderUserKey` property to retrieve their UserId.</span></span> <span data-ttu-id="d5e8b-474">CreateUserWizard コントロールでユーザーが入力されたユーザー名を利用し、 [ `UserName`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.username.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-474">The username entered by the user in the CreateUserWizard control is available via its [`UserName` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.username.aspx).</span></span>

<span data-ttu-id="d5e8b-475">次に、接続文字列がから取得されます`Web.config`と`INSERT`ステートメントを指定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-475">Next, the connection string is retrieved from `Web.config` and the `INSERT` statement is specified.</span></span> <span data-ttu-id="d5e8b-476">必要な ADO.NET オブジェクトがインスタンス化され、コマンドを実行します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-476">The necessary ADO.NET objects are instantiated and the command executed.</span></span> <span data-ttu-id="d5e8b-477">コードを割り当てます、 [ `DBNull` ](https://msdn.microsoft.com/en-us/library/system.dbnull.aspx)インスタンスを`@HomeTown`、 `@HomepageUrl`、および`@Signature`パラメーターで、データベースの挿入の効果を`NULL`の値を`HomeTown`、 `HomepageUrl`、および`Signature`フィールドです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-477">The code assigns a [`DBNull`](https://msdn.microsoft.com/en-us/library/system.dbnull.aspx) instance to the `@HomeTown`, `@HomepageUrl`, and `@Signature` parameters, which has the effect of inserting database `NULL` values for the `HomeTown`, `HomepageUrl`, and `Signature` fields.</span></span>

<span data-ttu-id="d5e8b-478">参照してください、`EnhancedCreateUserWizard.aspx`ブラウザー内でページおよび新しいユーザー アカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-478">Visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account.</span></span> <span data-ttu-id="d5e8b-479">その後、Visual Studio に戻りの内容の確認、`aspnet_Users`と`UserProfiles`テーブル (同じように図 12 に戻ります)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-479">After doing so, return to Visual Studio and examine the contents of the `aspnet_Users` and `UserProfiles` tables (like we did back in Figure 12).</span></span> <span data-ttu-id="d5e8b-480">新しいユーザー アカウントが表示されます`aspnet_Users`と対応する`UserProfiles`行 (に`NULL`の値を`HomeTown`、 `HomepageUrl`、および`Signature`)。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-480">You should see the new user account in `aspnet_Users` and a corresponding `UserProfiles` row (with `NULL` values for `HomeTown`, `HomepageUrl`, and `Signature`).</span></span>


<span data-ttu-id="d5e8b-481">[![新しいユーザー アカウントとユーザー レコードが追加されました](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-481">[![A New User Account and UserProfiles Record Have Been Added](storing-additional-user-information-cs/_static/image59.png)](storing-additional-user-information-cs/_static/image58.png)</span></span>

<span data-ttu-id="d5e8b-482">**図 20**: ユーザー アカウントの新規および`UserProfiles`レコードが追加されました ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image60.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-482">**Figure 20**: A New User Account and `UserProfiles` Record Have Been Added  ([Click to view full-size image](storing-additional-user-information-cs/_static/image60.png))</span></span>


<span data-ttu-id="d5e8b-483">訪問者が、新しいアカウント情報を提供し、"Create User"ボタンをクリックしたユーザー アカウントの作成は、行に追加した後、`UserProfiles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-483">After the visitor has supplied his new account information and clicked the "Create User" button, the user account is created and a row added to the `UserProfiles` table.</span></span> <span data-ttu-id="d5e8b-484">CreateUserWizard を表示し、その`CompleteWizardStep`、成功メッセージと、[続行] ボタンが表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-484">The CreateUserWizard then displays its `CompleteWizardStep`, which displays a success message and a Continue button.</span></span> <span data-ttu-id="d5e8b-485">[続行] ボタンをクリックすると、ポストバックがアクションは実行されませんでスタックしているユーザーのまま、`EnhancedCreateUserWizard.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-485">Clicking the Continue button causes a postback, but no action is taken, leaving the user stuck on the `EnhancedCreateUserWizard.aspx` page.</span></span>

<span data-ttu-id="d5e8b-486">CreateUserWizard コントロールの経由で続行 ボタンがクリックされたときにユーザーに送信する URL を指定できます[`ContinueDestinationPageUrl`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-486">We can specify a URL to send the user to when the Continue button is clicked via the CreateUserWizard control's [`ContinueDestinationPageUrl` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.continuedestinationpageurl.aspx).</span></span> <span data-ttu-id="d5e8b-487">設定、`ContinueDestinationPageUrl`プロパティを"~/Membership/AdditionalUserInfo.aspx"です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-487">Set the `ContinueDestinationPageUrl` property to "~/Membership/AdditionalUserInfo.aspx".</span></span> <span data-ttu-id="d5e8b-488">これにかかる時間に新しいユーザー `AdditionalUserInfo.aspx`、ここで、表示して設定を更新します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-488">This takes the new user to `AdditionalUserInfo.aspx`, where they can view and update their settings.</span></span>

### <a name="customizing-the-createuserwizards-interface-to-prompt-for-the-new-users-home-town-homepage-and-signature"></a><span data-ttu-id="d5e8b-489">新しいユーザーのホーム町、ホーム ページ、および署名を要求する CreateUserWizard のインターフェイスのカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="d5e8b-489">Customizing the CreateUserWizard's Interface to Prompt for the New User's Home Town, Homepage, and Signature</span></span>

<span data-ttu-id="d5e8b-490">CreateUserWizard コントロールの既定のインターフェイスは、ユーザー名、パスワード、および電子メールのように唯一のコア ユーザー アカウント情報を収集する必要がある簡易アカウントの作成シナリオで十分です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-490">The CreateUserWizard control's default interface is sufficient for simple account creation scenarios where only core user account information like username, password, and email need be collected.</span></span> <span data-ttu-id="d5e8b-491">しかし、自分のアカウントを作成するときに自分の出身地、ホーム ページ、および署名を入力するビジターを要求する場合でしょうか。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-491">But what if we wanted to prompt the visitor to enter her home town, homepage, and signature while creating her account?</span></span> <span data-ttu-id="d5e8b-492">サインアップの詳細情報を収集する CreateUserWizard コントロールのインターフェイスをカスタマイズすることは、この情報を使用することがあります、`CreatedUser`基になるデータベースに追加のレコードを挿入するイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-492">It is possible to customize the CreateUserWizard control's interface to collect additional information at signup, and this information may be used in the `CreatedUser` event handler to insert additional records into the underlying database.</span></span>

<span data-ttu-id="d5e8b-493">CreateUserWizard コントロールは、一連の順序を定義するページの開発者ができるコントロールを ASP.NET ウィザード コントロールの拡張`WizardSteps`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-493">The CreateUserWizard control extends the ASP.NET Wizard control, which is a control that allows a page developer to define a series of ordered `WizardSteps`.</span></span> <span data-ttu-id="d5e8b-494">ウィザード コントロールは、アクティブなステップを表示し、次の手順を移動するビジターをできるナビゲーション インターフェイスを提供します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-494">The Wizard control renders the active step and provides a navigation interface that allows the visitor to move through these steps.</span></span> <span data-ttu-id="d5e8b-495">ウィザード コントロールは、複数の短いステップに長いタスクの分割に最適です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-495">The Wizard control is ideal for breaking down a long task into several short steps.</span></span> <span data-ttu-id="d5e8b-496">ウィザード コントロールの詳細については、次を参照してください。 [ASP.NET 2.0 のウィザードの制御のステップ バイ ステップ ユーザー インターフェイスを作成する](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-496">For more information on the Wizard control, see [Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx).</span></span>

<span data-ttu-id="d5e8b-497">2 つ CreateUserWizard コントロールの既定のマークアップ定義`WizardSteps`:`CreateUserWizardStep`と`CompleteWizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-497">The CreateUserWizard control's default markup defines two `WizardSteps`: `CreateUserWizardStep` and `CompleteWizardStep`.</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample12.aspx)]

<span data-ttu-id="d5e8b-498">最初の`WizardStep`、 `CreateUserWizardStep`、ユーザー名、パスワード、電子メール、およびなどの入力を求めるインターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-498">The first `WizardStep`, `CreateUserWizardStep`, renders the interface that prompts for the username, password, email, and so on.</span></span> <span data-ttu-id="d5e8b-499">彼女が示すように訪問者は、この情報を提供し、「ユーザーの作成」をクリックすると、 `CompleteWizardStep`、成功メッセージと、[続行] ボタンが示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-499">After the visitor supplies this information and clicks "Create User", she is shown the `CompleteWizardStep`, which shows the success message and a Continue button.</span></span>

<span data-ttu-id="d5e8b-500">追加のフォーム フィールドを含める CreateUserWizard コントロールのインターフェイスをカスタマイズするには、ことを実行できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-500">To customize the CreateUserWizard control's interface to include additional form fields, we can:</span></span>

- <span data-ttu-id="d5e8b-501">**1 つまたは複数を新規作成 * * *`WizardStep`* * * 追加のユーザー インターフェイス要素を格納する s**です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-501">**Create one or more new****`WizardStep`****s to contain the additional user interface elements**.</span></span> <span data-ttu-id="d5e8b-502">新しいを追加する`WizardStep`、CreateUserWizard をクリックして、"追加/削除`WizardSteps`"を起動するスマート タグからのリンク、`WizardStep`コレクション エディターです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-502">To add a new `WizardStep` to the CreateUserWizard, click the "Add/Remove `WizardSteps`" link from its Smart Tag to launch the `WizardStep` Collection Editor.</span></span> <span data-ttu-id="d5e8b-503">そこから追加、削除、またはウィザードの手順の順序を変更することができます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-503">From there you can add, remove, or reorder the steps in the wizard.</span></span> <span data-ttu-id="d5e8b-504">これは、このチュートリアルのために使用するアプローチです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-504">This is the approach we will use for this tutorial.</span></span>

- <span data-ttu-id="d5e8b-505">**変換、* * *`CreateUserWizardStep`* * *、編集可能なに * * *`WizardStep`* * *。**</span><span class="sxs-lookup"><span data-stu-id="d5e8b-505">**Convert the****`CreateUserWizardStep`****into an editable****`WizardStep`****.**</span></span> <span data-ttu-id="d5e8b-506">これに置き換えられます、`CreateUserWizardStep`同等な`WizardStep`をマークアップに一致するユーザー インターフェイスを定義する、 `CreateUserWizardStep`' s。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-506">This replaces the `CreateUserWizardStep` with an equivalent `WizardStep` whose markup defines a user interface that matches the `CreateUserWizardStep`'s.</span></span> <span data-ttu-id="d5e8b-507">変換することで、`CreateUserWizardStep`に、`WizardStep`おコントロールの位置を変更したり、このステップに追加のユーザー インターフェイス要素を追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-507">By converting the `CreateUserWizardStep` into a `WizardStep` we can reposition the controls or add additional user interface elements to this step.</span></span> <span data-ttu-id="d5e8b-508">変換する、`CreateUserWizardStep`または`CompleteWizardStep`が編集可能に`WizardStep`コントロールのスマート タグからのリンクを「完了ステップのカスタマイズ」または「をカスタマイズするユーザーの作成ステップ」をクリックします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-508">To convert the `CreateUserWizardStep` or `CompleteWizardStep` into an editable `WizardStep`, click the "Customize Create User Step" or "Customize Complete Step" link from the control's Smart Tag.</span></span>

- <span data-ttu-id="d5e8b-509">**上記の 2 つのオプションの組み合わせを使用します。**</span><span class="sxs-lookup"><span data-stu-id="d5e8b-509">**Use some combination of the above two options.**</span></span>

<span data-ttu-id="d5e8b-510">1 つの重要な点に注意してくださいは CreateUserWizard コントロールでは、内から、「ユーザーの作成」ボタンがクリックされたときに、そのユーザー アカウントの作成プロセスが実行されるその`CreateUserWizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-510">One important thing to keep in mind is that the CreateUserWizard control executes its user account creation process when the "Create User" button is clicked from within its `CreateUserWizardStep`.</span></span> <span data-ttu-id="d5e8b-511">追加がある場合は重要でありません`WizardStep`秒後に、`CreateUserWizardStep`か。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-511">It doesn't matter if there are additional `WizardStep` s after the `CreateUserWizardStep` or not.</span></span>

<span data-ttu-id="d5e8b-512">カスタムを追加するときに`WizardStep`CreateUserWizard コントロール、カスタムである追加のユーザー入力を収集するために`WizardStep`前に、または後に配置することができます、`CreateUserWizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-512">When adding a custom `WizardStep` to the CreateUserWizard control to collect additional user input, the custom `WizardStep` can be placed before or after the `CreateUserWizardStep`.</span></span> <span data-ttu-id="d5e8b-513">前になる場合、`CreateUserWizardStep`カスタムから追加のユーザー入力を収集し`WizardStep`利用、`CreatedUser`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-513">If it comes before the `CreateUserWizardStep` then the additional user input collected from the custom `WizardStep` is available for the `CreatedUser` event handler.</span></span> <span data-ttu-id="d5e8b-514">ただし場合、カスタム`WizardStep`の後に続く`CreateUserWizardStep`時間によって、カスタム`WizardStep`が表示されます、新しいユーザー アカウントが既に作成されて、`CreatedUser`イベントが既に発生しています。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-514">However, if the custom `WizardStep` comes after `CreateUserWizardStep` then by the time the custom `WizardStep` is displayed the new user account has already been created and the `CreatedUser` event has already fired.</span></span>

<span data-ttu-id="d5e8b-515">図 21 は、ワークフローを示しています。 ときに、追加した`WizardStep`の前に、`CreateUserWizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-515">Figure 21 shows the workflow when the added `WizardStep` precedes the `CreateUserWizardStep`.</span></span> <span data-ttu-id="d5e8b-516">追加のユーザー情報が、時間によって収集されたため、`CreatedUser`イベントが発生する必要がありますすべては、更新、`CreatedUser`これらの入力を取得しのものを使用するイベント ハンドラー、`INSERT`ステートメントのパラメーター値 (なく`DBNull.Value`).</span><span class="sxs-lookup"><span data-stu-id="d5e8b-516">Since the additional user information has been collected by the time the `CreatedUser` event fires, all we have to do is update the `CreatedUser` event handler to retrieve these inputs and use those for the `INSERT` statement's parameter values (rather than `DBNull.Value`).</span></span>


<span data-ttu-id="d5e8b-517">[![追加の WizardStep の直前に、CreateUserWizardStep CreateUserWizard ワークフロー](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-517">[![The CreateUserWizard Workflow When an Additional WizardStep Precedes the CreateUserWizardStep](storing-additional-user-information-cs/_static/image62.png)](storing-additional-user-information-cs/_static/image61.png)</span></span>

<span data-ttu-id="d5e8b-518">**図 21**:「CreateUserWizard ワークフローときに、追加`WizardStep`Precedes、 `CreateUserWizardStep` ([フルサイズのイメージを表示するには、をクリックして](storing-additional-user-information-cs/_static/image63.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-518">**Figure 21**: The CreateUserWizard Workflow When an Additional `WizardStep` Precedes the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image63.png))</span></span>


<span data-ttu-id="d5e8b-519">場合、カスタム`WizardStep`配置*後*、 `CreateUserWizardStep`、ただし、ユーザー アカウントの作成処理は実行前に、ユーザーが自分の出身地、ホームページ、または署名を入力します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-519">If the custom `WizardStep` is placed *after* the `CreateUserWizardStep`, however, the create user account process occurs before the user has had a chance to enter her home town, homepage, or signature.</span></span> <span data-ttu-id="d5e8b-520">このような場合は、この追加情報はデータベースに挿入される、ユーザー アカウントが作成されて、22 の図に示すようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-520">In such a case, this additional information needs to be inserted into the database after the user account has been created, as Figure 22 illustrates.</span></span>


<span data-ttu-id="d5e8b-521">[![追加の WizardStep は、CreateUserWizardStep の後に続くときに、CreateUserWizard ワークフロー](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-521">[![The CreateUserWizard Workflow When an Additional WizardStep Comes After the CreateUserWizardStep](storing-additional-user-information-cs/_static/image65.png)](storing-additional-user-information-cs/_static/image64.png)</span></span>

<span data-ttu-id="d5e8b-522">**図 22**:「CreateUserWizard ワークフローときに、追加`WizardStep`後は、 `CreateUserWizardStep` ([フルサイズ イメージを表示するに、をクリックして](storing-additional-user-information-cs/_static/image66.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-522">**Figure 22**: The CreateUserWizard Workflow When an Additional `WizardStep` Comes After the `CreateUserWizardStep` ([Click to view full-size image](storing-additional-user-information-cs/_static/image66.png))</span></span>


<span data-ttu-id="d5e8b-523">図 22 に示すようにワークフローを待機にレコードを挿入する、`UserProfiles`手順 2 が完了後するまでテーブルします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-523">The workflow shown in Figure 22 waits to insert a record into the `UserProfiles` table until after Step 2 completes.</span></span> <span data-ttu-id="d5e8b-524">場合は、訪問者は、手順 1 の後に、ブラウザーを閉じ、ただしに到達したこと、ユーザー アカウント作成されましたに追加されたレコードがない状態`UserProfiles`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-524">If the visitor closes her browser after step 1, however, we will have reached a state where a user account was created, but no record was added to `UserProfiles`.</span></span> <span data-ttu-id="d5e8b-525">1 つの回避策は持つレコードが存在する`NULL`または既定の値を挿入`UserProfiles`で、 `CreatedUser` (手順 1 の後に発生) するイベント ハンドラー、および手順 2 が完了したらこの記録し、更新します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-525">One workaround is to have a record with `NULL` or default values inserted into `UserProfiles` in the `CreatedUser` event handler (which fires after step 1), and then update this record after step 2 completes.</span></span> <span data-ttu-id="d5e8b-526">これにより、`UserProfiles`レコードは、ユーザーが登録プロセスが途中終了した場合でも、ユーザー アカウントの追加されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-526">This ensures that a `UserProfiles` record will be added for the user account even if the user quits the registration process midway through.</span></span>

<span data-ttu-id="d5e8b-527">このチュートリアルを作成しましょう新しい`WizardStep`以降後に発生した、`CreateUserWizardStep`前に、`CompleteWizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-527">For this tutorial let's create a new `WizardStep` that occurs after the `CreateUserWizardStep` but before the `CompleteWizardStep`.</span></span> <span data-ttu-id="d5e8b-528">最初の get で WizardStep 配置および構成し、そこでを見てみましょうコード。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-528">Let's first get the WizardStep in place and configured and then we'll look at the code.</span></span>

<span data-ttu-id="d5e8b-529">CreateUserWizard コントロールのスマート タグから選択、"追加/削除`WizardStep`s"、これにより、`WizardStep`コレクション エディター ダイアログ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-529">From the CreateUserWizard control's Smart Tag, select the "Add/Remove `WizardStep` s", which brings up the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="d5e8b-530">新しい`WizardStep`、設定その`ID`に`UserSettings`、その`Title`"の設定 に、その`StepType`に`Step`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-530">Add a new `WizardStep`, setting its `ID` to `UserSettings`, its `Title` to "Your Settings" and its `StepType` to `Step`.</span></span> <span data-ttu-id="d5e8b-531">配置後に続くことができるように、 `CreateUserWizardStep` (「へのサインアップ、新しいアカウント」) との前に、 `CompleteWizardStep` (「完了」)、図 23 に示すようにします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-531">Then position it so that it comes after the `CreateUserWizardStep` ("Sign Up for Your New Account") and before the `CompleteWizardStep` ("Complete"), as shown in Figure 23.</span></span>


<span data-ttu-id="d5e8b-532">[![新しい WizardStep コントロールへ追加 CreateUserWizard](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-532">[![Add a New WizardStep to the CreateUserWizard Control](storing-additional-user-information-cs/_static/image68.png)](storing-additional-user-information-cs/_static/image67.png)</span></span>

<span data-ttu-id="d5e8b-533">**図 23**: 新規追加`WizardStep`CreateUserWizard コントロールに ([フルサイズのイメージを表示するをクリックして](storing-additional-user-information-cs/_static/image69.png))</span><span class="sxs-lookup"><span data-stu-id="d5e8b-533">**Figure 23**: Add a New `WizardStep` to the CreateUserWizard Control  ([Click to view full-size image](storing-additional-user-information-cs/_static/image69.png))</span></span>


<span data-ttu-id="d5e8b-534">閉じるには、ok をクリックして、`WizardStep`コレクション エディター ダイアログ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-534">Click OK to close the `WizardStep` Collection Editor dialog.</span></span> <span data-ttu-id="d5e8b-535">新しい`WizardStep`CreateUserWizard コントロールの更新された宣言型マークアップを検出します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-535">The new `WizardStep` is evidenced by the CreateUserWizard control's updated declarative markup:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample13.aspx)]

<span data-ttu-id="d5e8b-536">新しいメモ`<asp:WizardStep>`要素。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-536">Note the new `<asp:WizardStep>` element.</span></span> <span data-ttu-id="d5e8b-537">新しいユーザーのホーム町、ホーム ページ、およびここに署名を収集するためのユーザー インターフェイスを追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-537">We need to add the user interface to collect the new user's home town, homepage, and signature here.</span></span> <span data-ttu-id="d5e8b-538">デザイナーを使用または宣言の構文では、このコンテンツを入力できます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-538">You can enter this content in the declarative syntax or through the Designer.</span></span> <span data-ttu-id="d5e8b-539">デザイナーを使用するには、デザイナーでの手順を参照するスマート タグのドロップ ダウン リストから「の設定」の手順を選択します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-539">To use the Designer, select the "Your Settings" step from the drop-down list in the Smart Tag to see the step in the Designer.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-540">CreateUserWizard コントロールのスマート タグのドロップダウン リストからステップを選択すると更新[`ActiveStepIndex`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx)、開始ステップのインデックスを指定します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-540">Selecting a step through the Smart Tag's drop-down list updates the CreateUserWizard control's [`ActiveStepIndex` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.createuserwizard.activestepindex.aspx), which specifies the index of the starting step.</span></span> <span data-ttu-id="d5e8b-541">そのため、このドロップダウン リストを使用して、デザイナーで [ユーザー設定] ステップを編集する場合を必ず最初にアクセスして、この手順が表示されるように「記号に、新しいアカウント」に設定、`EnhancedCreateUserWizard.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-541">Therefore, if you use this drop-down list to edit the "Your Settings" step in the Designer, be sure to set it back to "Sign Up for Your New Account" so that this step is shown when users first visit the `EnhancedCreateUserWizard.aspx` page.</span></span>


<span data-ttu-id="d5e8b-542">という 3 つのテキスト ボックス コントロールが含まれています「の設定」のステップ内のユーザー インターフェイスを作成する`HomeTown`、 `HomepageUrl`、および`Signature`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-542">Create a user interface within the "Your Settings" step that contains three TextBox controls named `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="d5e8b-543">このインターフェイスを構築した後 CreateUserWizard の宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-543">After constructing this interface, the CreateUserWizard's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](storing-additional-user-information-cs/samples/sample14.aspx)]

<span data-ttu-id="d5e8b-544">ブラウザーからこのページにアクセスしてくださいホーム町、ホーム ページ、および署名の値を指定する、新しいユーザー アカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-544">Go ahead and visit this page through a browser and create a new user account, specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="d5e8b-545">完了した後、`CreateUserWizardStep`メンバーシップ フレームワークでユーザー アカウントを作成し、`CreatedUser`イベント ハンドラーが実行される、新しい行を追加する`UserProfiles`、データベースが`NULL`値を`HomeTown`、 `HomepageUrl`、および`Signature`.</span><span class="sxs-lookup"><span data-stu-id="d5e8b-545">After completing the `CreateUserWizardStep` the user account is created in the Membership framework and the `CreatedUser` event handler runs, which adds a new row to `UserProfiles`, but with a database `NULL` value for `HomeTown`, `HomepageUrl`, and `Signature`.</span></span> <span data-ttu-id="d5e8b-546">ホーム町、ホーム ページ、および署名に入力された値は使用されません。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-546">The values entered for the home town, homepage, and signature are never used.</span></span> <span data-ttu-id="d5e8b-547">最終的な結果は、新しいユーザー アカウントに、`UserProfiles`レコードを`HomeTown`、 `HomepageUrl`、および`Signature`を指定するフィールドがまだ必要です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-547">The net result is a new user account with a `UserProfiles` record whose `HomeTown`, `HomepageUrl`, and `Signature` fields have yet to be specified.</span></span>

<span data-ttu-id="d5e8b-548">ユーザーが入力したホーム町、honepage、および署名の値を受け取り、適切な更新プログラム「の設定」の手順の後にコードを実行する必要があります`UserProfiles`レコード。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-548">We need to execute code after the "Your Settings" step that takes the home town, honepage, and signature values entered by the user and updates the appropriate `UserProfiles` record.</span></span> <span data-ttu-id="d5e8b-549">ユーザーが、ウィザードの手順の間で移動するたびにコントロールをウィザードの[`ActiveStepChanged`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx)発生します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-549">Each time the user moves between steps in a Wizard control, the Wizard's [`ActiveStepChanged` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.wizard.activestepchanged.aspx) fires.</span></span> <span data-ttu-id="d5e8b-550">このイベントと更新プログラムのイベント ハンドラーを生み出すことができます、`UserProfiles`表に、「Your 設定」の手順が完了するとします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-550">We can create an event handler for this event and update the `UserProfiles` table when the "Your Settings" step has completed.</span></span>

<span data-ttu-id="d5e8b-551">CreateUserWizard のイベント ハンドラーを追加`ActiveStepChanged`イベントし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-551">Add an event handler for the CreateUserWizard's `ActiveStepChanged` event and add the following code:</span></span>

[!code-csharp[Main](storing-additional-user-information-cs/samples/sample15.cs)]

<span data-ttu-id="d5e8b-552">場合は、「完了」手順を単に到達したことを確認することで、上記のコードを開始します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-552">The above code starts by determining if we have just reached the "Complete" step.</span></span> <span data-ttu-id="d5e8b-553">"の設定 ステップの直後に、「完了」手順が発生したため、訪問者に達すると「完了」ステップ「の設定」の手順が彼女に終了したことを意味しますします。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-553">Since the "Complete" step occurs immediately after the "Your Settings" step, then when the visitor reaches "Complete" step that means she just finished the "Your Settings" step.</span></span>

<span data-ttu-id="d5e8b-554">このような場合は、必要があります内のテキスト ボックス コントロールをプログラムで参照する、`UserSettings WizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-554">In such a case, we need to programmatically reference the TextBox controls within the `UserSettings WizardStep`.</span></span> <span data-ttu-id="d5e8b-555">最初を使用してこの情報は、`FindControl`プログラムで参照するメソッド、 `UserSettings WizardStep`、およびその内からのテキスト ボックスを参照するためにもう一度、`WizardStep`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-555">This is accomplished by first using the `FindControl` method to programmatically referencing the `UserSettings WizardStep`, and then again to reference the TextBoxes from within the `WizardStep`.</span></span> <span data-ttu-id="d5e8b-556">実行する準備ができました、テキスト ボックスが参照されていると、`UPDATE`ステートメントです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-556">Once the TextBoxes have been referenced, we're ready to execute the `UPDATE` statement.</span></span> <span data-ttu-id="d5e8b-557">`UPDATE`ステートメントでは同じ数とパラメーターの`INSERT`内のステートメント、 `CreatedUser` 、イベント ハンドラーが、ここでユーザーによって指定されたホーム町、ホーム ページ、および署名の値を使用します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-557">The `UPDATE` statement has the same number of parameters as the `INSERT` statement in the `CreatedUser` event handler, but here we use the home town, homepage, and signature values supplied by the user.</span></span>

<span data-ttu-id="d5e8b-558">場所にこのイベント ハンドラーで、次を参照してください。、`EnhancedCreateUserWizard.aspx`ブラウザー内でページとホーム町、ホーム ページ、および署名の値を指定する新しいユーザー アカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-558">With this event handler in place, visit the `EnhancedCreateUserWizard.aspx` page through a browser and create a new user account specifying values for the home town, homepage, and signature.</span></span> <span data-ttu-id="d5e8b-559">新しいアカウントの作成後にリダイレクトする必要があります、 `AdditionalUserInfo.aspx`  ページで、だけが入力したホーム町、ホーム ページ、および署名情報が表示されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-559">After creating the new account you should be redirected to the `AdditionalUserInfo.aspx` page, where the just-entered home town, homepage, and signature information is displayed.</span></span>

> [!NOTE]
> <span data-ttu-id="d5e8b-560">当社の web サイトの訪問者が新しいアカウントを作成できる 2 つのページが現在:`CreatingUserAccounts.aspx`と`EnhancedCreateUserWizard.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-560">Our website currently has two pages from which a visitor can create a new account: `CreatingUserAccounts.aspx` and `EnhancedCreateUserWizard.aspx`.</span></span> <span data-ttu-id="d5e8b-561">Web サイトのサイト マップし、ログイン ページを指す、 `CreatingUserAccounts.aspx`  ページで、ですが、`CreatingUserAccounts.aspx`ページ ホーム町、ホーム ページ、および署名については、ユーザー プロンプトが表示されず、対応する行は追加されません`UserProfiles`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-561">The website's sitemap and login page point to the `CreatingUserAccounts.aspx` page, but the `CreatingUserAccounts.aspx` page does not prompt the user for their home town, homepage, and signature information and does not add a corresponding row to `UserProfiles`.</span></span> <span data-ttu-id="d5e8b-562">そのため、更新するか、`CreatingUserAccounts.aspx`この機能を提供できるようにのページか、更新、sitemap とログイン ページを参照する`EnhancedCreateUserWizard.aspx`の代わりに`CreatingUserAccounts.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-562">Therefore, either update the `CreatingUserAccounts.aspx` page so that it offers this functionality or update the sitemap and login page to reference `EnhancedCreateUserWizard.aspx` instead of `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="d5e8b-563">後者のオプションを選択する場合は必ず更新して、`Membership`フォルダーの`Web.config`匿名ユーザーへのアクセスを許可するためのファイル、`EnhancedCreateUserWizard.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-563">If you choose the latter option, be sure to update the `Membership` folder's `Web.config` file so as to allow anonymous users access to the `EnhancedCreateUserWizard.aspx` page.</span></span>


## <a name="summary"></a><span data-ttu-id="d5e8b-564">概要</span><span class="sxs-lookup"><span data-stu-id="d5e8b-564">Summary</span></span>

<span data-ttu-id="d5e8b-565">このチュートリアルでは、メンバーシップ フレームワーク内のユーザー アカウントに関連付けられているデータのモデリング手法について説明しました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-565">In this tutorial we looked at techniques for modeling data that is related to user accounts within the Membership framework.</span></span> <span data-ttu-id="d5e8b-566">具体的には、一対多のリレーションシップを一対一のリレーションシップを共有するデータだけでなく、ユーザー アカウントと共有するエンティティをモデル化について説明しました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-566">In particular, we looked at modeling entities that share a one-to-many relationship with user accounts as well as data that shares a one-to-one relationship.</span></span> <span data-ttu-id="d5e8b-567">この関連する情報を表示、挿入、および更新、およびその他の SqlDataSource コントロールを使用する例をいくつかだった方法を説明しましたさらに、ADO.NET コードを使用します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-567">Furthermore, we saw how this related information could be displayed, inserted, and updated, with some examples using the SqlDataSource control and others using ADO.NET code.</span></span>

<span data-ttu-id="d5e8b-568">このチュートリアルでは、ユーザー アカウントを確認を完了します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-568">This tutorial completes our look at user accounts.</span></span> <span data-ttu-id="d5e8b-569">以降、次のチュートリアルでの役割に注目を変換されます。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-569">Starting with the next tutorial we will turn our attention to roles.</span></span> <span data-ttu-id="d5e8b-570">今後は、ロール フレームワークを見ていきましょういくつかのチュートリアルは、新しいロールを作成する方法を参照してください。 どのような役割を決定する、ユーザーが所属する方法と、ユーザーにロールを割り当てる方法、ロールベースの承認を適用します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-570">Over the next several tutorials we will look at the Roles framework, see how to create new roles, how to assign roles to users, how to determine what roles a user belongs to, and how to apply role-based authorization.</span></span>

<span data-ttu-id="d5e8b-571">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="d5e8b-571">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="d5e8b-572">関連項目</span><span class="sxs-lookup"><span data-stu-id="d5e8b-572">Further Reading</span></span>

<span data-ttu-id="d5e8b-573">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-573">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="d5e8b-574">アクセスして、ASP.NET 2.0 のデータの更新</span><span class="sxs-lookup"><span data-stu-id="d5e8b-574">Accessing and Updating Data in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/011106-1.aspx)
- [<span data-ttu-id="d5e8b-575">ASP.NET 2.0 のウィザード コントロール</span><span class="sxs-lookup"><span data-stu-id="d5e8b-575">ASP.NET 2.0 Wizard Control</span></span>](https://weblogs.asp.net/scottgu/archive/2006/02/21/438732.aspx)
- [<span data-ttu-id="d5e8b-576">ASP.NET 2.0 のウィザード コントロールでステップ バイ ステップのユーザー インターフェイスの作成</span><span class="sxs-lookup"><span data-stu-id="d5e8b-576">Creating a Step-by-Step User Interface with the ASP.NET 2.0 Wizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/061406-1.aspx)
- [<span data-ttu-id="d5e8b-577">カスタム データ ソース コントロールのパラメーターを作成します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-577">Creating Custom DataSource Control Parameters</span></span>](http://aspnet.4guysfromrolla.com/articles/110106-1.aspx)
- [<span data-ttu-id="d5e8b-578">CreateUserWizard コントロールのカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="d5e8b-578">Customizing the CreateUserWizard Control</span></span>](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx)
- [<span data-ttu-id="d5e8b-579">DetailsView コントロールのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="d5e8b-579">DetailsView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/data/detailsview.aspx)
- [<span data-ttu-id="d5e8b-580">ListView コントロールでデータの表示</span><span class="sxs-lookup"><span data-stu-id="d5e8b-580">Displaying Data with the ListView Control</span></span>](http://aspnet.4guysfromrolla.com/articles/122607-1.aspx)
- [<span data-ttu-id="d5e8b-581">ASP.NET 2.0 の検証コントロールの例を分析します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-581">Dissecting the Validation Controls in ASP.NET 2.0</span></span>](http://aspnet.4guysfromrolla.com/articles/112305-1.aspx)
- [<span data-ttu-id="d5e8b-582">挿入を編集し、データを削除します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-582">Editing Insert and Deleting Data</span></span>](../../data-access/editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-cs.md)
- [<span data-ttu-id="d5e8b-583">ASP.NET でのフォームの検証</span><span class="sxs-lookup"><span data-stu-id="d5e8b-583">Form Validation in ASP.NET</span></span>](http://www.4guysfromrolla.com/webtech/090200-1.shtml)
- [<span data-ttu-id="d5e8b-584">カスタム ユーザー登録情報の収集</span><span class="sxs-lookup"><span data-stu-id="d5e8b-584">Gathering Custom User Registration Information</span></span>](https://weblogs.asp.net/scottgu/archive/2006/07/05/Tip_2F00_Trick_3A00_-Gathering-Custom-User-Registration-Information.aspx)
- [<span data-ttu-id="d5e8b-585">ASP.NET 2.0 のプロファイル</span><span class="sxs-lookup"><span data-stu-id="d5e8b-585">Profiles in ASP.NET 2.0</span></span>](http://www.odetocode.com/Articles/440.aspx)
- [<span data-ttu-id="d5e8b-586">Asp: ListView コントロール</span><span class="sxs-lookup"><span data-stu-id="d5e8b-586">The asp:ListView Control</span></span>](https://weblogs.asp.net/scottgu/archive/2007/08/10/the-asp-listview-control-part-1-building-a-product-listing-page-with-clean-css-ui.aspx)
- [<span data-ttu-id="d5e8b-587">ユーザー プロファイルのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="d5e8b-587">User Profiles QuickStart</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/profile/default.aspx)

### <a name="about-the-author"></a><span data-ttu-id="d5e8b-588">作成者について</span><span class="sxs-lookup"><span data-stu-id="d5e8b-588">About the Author</span></span>

<span data-ttu-id="d5e8b-589">Scott Mitchell、複数の受け取りますブックの作成者と 4GuysFromRolla.com の創設者は、Microsoft の Web テクノロジと 1998 年取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-589">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="d5e8b-590">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-590">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="d5e8b-591">最新の著書 *[Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-591">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="d5e8b-592">Scott に到達できる[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)または彼のブログでを介して[http://ScottOnWriting.NET](http://scottonwriting.net/)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-592">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="d5e8b-593">特別に感謝しています.</span><span class="sxs-lookup"><span data-stu-id="d5e8b-593">Special Thanks To…</span></span>

<span data-ttu-id="d5e8b-594">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-594">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="d5e8b-595">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-595">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="d5e8b-596">場合は、ドロップ me 一度に 1 行ずつ[ mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)です。</span><span class="sxs-lookup"><span data-stu-id="d5e8b-596">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="d5e8b-597">[前へ](user-based-authorization-cs.md)
[次へ](creating-the-membership-schema-in-sql-server-vb.md)</span><span class="sxs-lookup"><span data-stu-id="d5e8b-597">[Previous](user-based-authorization-cs.md)
[Next](creating-the-membership-schema-in-sql-server-vb.md)</span></span>
