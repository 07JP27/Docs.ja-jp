---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: "ユーザー ベースの承認 (VB) |Microsoft ドキュメント"
author: rick-anderson
description: "このチュートリアルでは、ページへのアクセスを制限して、さまざまな手法によってページ レベルの機能を制限するのになります。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: 152b9a4b12f55bd999960568b11d08c96d342c03
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="user-based-authorization-vb"></a><span data-ttu-id="c8fff-103">ユーザー ベースの承認 (VB)</span><span class="sxs-lookup"><span data-stu-id="c8fff-103">User-Based Authorization (VB)</span></span>
====================
<span data-ttu-id="c8fff-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="c8fff-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="c8fff-105">[コードをダウンロードする](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip)または[PDF のダウンロード](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="c8fff-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="c8fff-106">このチュートリアルでは、ページへのアクセスを制限して、さまざまな手法によってページ レベルの機能を制限するのになります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>


## <a name="introduction"></a><span data-ttu-id="c8fff-107">はじめに</span><span class="sxs-lookup"><span data-stu-id="c8fff-107">Introduction</span></span>

<span data-ttu-id="c8fff-108">ユーザー アカウントを提供するほとんどの web アプリケーションでは、サイト内の特定のページへのアクセスを特定のユーザーを制限する一部のようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="c8fff-109">大半のオンライン messageboard サイト、たとえば、- 匿名と認証済みのすべてのユーザーが messageboard の投稿を表示することいますが、認証されたユーザーだけが新しい投稿を作成する web ページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="c8fff-110">特定のユーザー (または、特定の一連のユーザー) にアクセスできる、のみの管理ページがある可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="c8fff-111">さらに、ページ レベルの機能は、ユーザー単位のユーザーごとに異なることができます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="c8fff-112">投稿の一覧を表示すると、認証されたユーザーはこのインターフェイスは、匿名の訪問者に対し、その個々 の投稿を評価するためのインターフェイスに表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="c8fff-113">ASP.NET では、簡単にユーザー ベースの承認規則を定義します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="c8fff-114">内のマークアップのほんの少しだけ`Web.config`、特定の web ページまたはディレクトリ全体をロックできますダウンは、のみ、指定したユーザーのサブセットにアクセスできるようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="c8fff-115">ページ レベルの機能にできます、オンまたはオフ プログラムと宣言の手段で現在ログインしているユーザーに基づいて。</span><span class="sxs-lookup"><span data-stu-id="c8fff-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="c8fff-116">このチュートリアルでは、ページへのアクセスを制限して、さまざまな手法によってページ レベルの機能を制限するのになります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="c8fff-117">開始しましょう!</span><span class="sxs-lookup"><span data-stu-id="c8fff-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="c8fff-118">URL 承認ワークフローを見る</span><span class="sxs-lookup"><span data-stu-id="c8fff-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="c8fff-119">説明したように、 [*フォーム認証の概要を*](../introduction/an-overview-of-forms-authentication-vb.md)チュートリアルでは、ASP.NET ランタイムが ASP.NET リソース要求のライフ サイクル中にイベントの数を発生させるため、要求を処理するときにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="c8fff-120">*HTTP モジュール*マネージ クラスのコードを持つは要求のライフ サイクルの特定のイベントに応答して実行します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="c8fff-121">ASP.NET は、バック グラウンドでの必須のタスクを実行する HTTP モジュールの数が付属しています。</span><span class="sxs-lookup"><span data-stu-id="c8fff-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="c8fff-122">このような 1 つの HTTP モジュールが[ `FormsAuthenticationModule`](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/en-us/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="c8fff-123">主な機能、前のチュートリアルで説明したように、`FormsAuthenticationModule`は現在の要求の id を確認します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="c8fff-124">これは、cookie であるか、URL 内に埋め込まれているフォーム認証チケットを調べることによって行います。</span><span class="sxs-lookup"><span data-stu-id="c8fff-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="c8fff-125">この識別中に行われる、 [ `AuthenticateRequest`イベント](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="c8fff-126">別の重要な HTTP モジュールが、 [ `UrlAuthorizationModule`](https://msdn.microsoft.com/en-us/library/system.web.security.urlauthorizationmodule.aspx)への応答で発生する、 [ `AuthorizeRequest`イベント](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authorizerequest.aspx)(後の動作を`AuthenticateRequest`イベント)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/en-us/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/en-us/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="c8fff-127">`UrlAuthorizationModule`で構成のマークアップを調べて`Web.config`を現在の id が指定したページにアクセスする権限を持つかどうかを判断します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="c8fff-128">このプロセスと呼びます*URL 承認*です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="c8fff-129">について確認手順 1 で、URL 承認規則の構文がまずみましょう見てどのような`UrlAuthorizationModule`は、要求が承認されているかどうかどうかによって異なります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="c8fff-130">場合、`UrlAuthorizationModule`と判断した要求が承認されると、し、それは何も、ライフ サイクルを通じて要求が続行されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="c8fff-131">ただし、要求がある場合*いない*、承認、`UrlAuthorizationModule`ライフ サイクルを中止し、指示、`Response`返されるオブジェクト、 [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html)状態。</span><span class="sxs-lookup"><span data-stu-id="c8fff-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="c8fff-132">この HTTP 401 ステータスは、クライアントに返されませんフォーム認証を使用するときに場合、`FormsAuthenticationModule`ステータスは、HTTP 401 に変更を検出した、 [HTTP 302 リダイレクト](http://www.checkupdown.com/status/E302.html)ログイン ページにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="c8fff-133">図 1 は、ASP.NET パイプラインのワークフローを示す、 `FormsAuthenticationModule`、および`UrlAuthorizationModule`未承認の要求の受信時にします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="c8fff-134">具体的には、図 1 はの匿名の訪問者によって要求を示しています。 `ProtectedPage.aspx`、これは匿名ユーザーにアクセスを拒否するページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="c8fff-135">訪問者が、匿名であるため、`UrlAuthorizationModule`は要求を中止し、HTTP 401 Unauthorized ステータスを返します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="c8fff-136">`FormsAuthenticationModule`ログイン ページへの 302 リダイレクトに 401 ステータスを変換します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="c8fff-137">ログイン ページを使用して、ユーザーが認証された後にリダイレクトされます`ProtectedPage.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="c8fff-138">この時間、`FormsAuthenticationModule`彼認証チケットに基づく、ユーザーを識別します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="c8fff-139">訪問者が認証されると、これで、`UrlAuthorizationModule`ページへのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>


<span data-ttu-id="c8fff-140">[![フォーム認証と承認ワークフローの URL](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="c8fff-141">**図 1**: フォーム認証と承認ワークフローの URL ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>


<span data-ttu-id="c8fff-142">図 1 は、匿名ユーザーが匿名ユーザーに利用可能なないリソースにアクセスしようとしたときに発生する相互作用を示しています。</span><span class="sxs-lookup"><span data-stu-id="c8fff-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="c8fff-143">このような場合は、匿名ユーザーは、クエリ文字列の指定を参照してください彼女しようとしました ページで、ログイン ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="c8fff-144">ユーザーが正常にログオン後、彼女は自動的にリダイレクトされます彼女が最初に表示しようとするリソースに。</span><span class="sxs-lookup"><span data-stu-id="c8fff-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="c8fff-145">未承認の要求が行われると、匿名ユーザーによって、このワークフローは簡単です、簡単に何が起こったかを理解するビジターおよびその理由です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="c8fff-146">ことに注意に維持しながら、`FormsAuthenticationModule`がリダイレクト*任意*要求が認証済みユーザーによって行われた場合でも、ログイン ページにユーザー権限がありません。</span><span class="sxs-lookup"><span data-stu-id="c8fff-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="c8fff-147">機関を彼女がないページにアクセスしようとすると、認証されたユーザーは、ユーザー エクスペリエンスに混乱をこれがあります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="c8fff-148">当社の web サイトの URL 承認規則の構成であることを想像してくださいになるよう、ASP.NET ページ`OnlyTito.aspx`Tito にのみアクセスできます。 でした。</span><span class="sxs-lookup"><span data-stu-id="c8fff-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="c8fff-149">Sam にサイトを訪問し、ログオンして、アクセスを試むことになっているでしょう`OnlyTito.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="c8fff-150">`UrlAuthorizationModule`は要求のライフ サイクルを中断し、HTTP 401 Unauthorized ステータスを返します`FormsAuthenticationModule`が検出され、Sam をログイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="c8fff-151">Sam のログインが既に、以降は、彼女は可能性があります不思議に思えるかもしれません理由彼女が送信された、ログイン ページに戻ります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="c8fff-152">彼女は、自分のログイン資格情報が何らかの理由で、失われたまたは彼女に無効な資格情報が入力されている理由可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="c8fff-153">Sam は、ログイン ページから自分の資格情報を再入力する場合彼女 (再) ログに記録されにリダイレクト`OnlyTito.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="c8fff-154">`UrlAuthorizationModule`ことが検出 Sam は、このページを開いたことはできませんし、ログイン ページに彼女が返されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="c8fff-155">図 2 は、この混乱を招くワークフローを示しています。</span><span class="sxs-lookup"><span data-stu-id="c8fff-155">Figure 2 depicts this confusing workflow.</span></span>


<span data-ttu-id="c8fff-156">[![混乱を招くサイクルにつながる可能性が既定のワークフロー](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="c8fff-157">**図 2**: の既定のワークフローにつながる可能性が混乱を招くサイクル ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>


<span data-ttu-id="c8fff-158">図 2 に示すワークフローには、でも、ほとんどのコンピューター詳しければビジター befuddle すばやくことができます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="c8fff-159">手順 2. でサイクルが混乱これを防止する方法について取り上げます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-160">ASP.NET では、2 つのメカニズムを使用して、現在のユーザーが特定の web ページにアクセスできるかどうかを判断します。 URL 承認およびファイルの承認。</span><span class="sxs-lookup"><span data-stu-id="c8fff-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="c8fff-161">ファイルの承認がによって実装される、 [ `FileAuthorizationModule` ](https://msdn.microsoft.com/en-us/library/system.web.security.fileauthorizationmodule.aspx)、要求されたファイルの Acl を参照して権限を決定します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/en-us/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="c8fff-162">ファイルの承認が最もよく使用 Windows 認証されている Acl を Windows アカウントに適用されるアクセス許可があるためです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="c8fff-163">フォーム認証を使用する場合は、オペレーティング システムとファイル システム レベルのすべての要求がサイトにアクセスするユーザーに関係なく、同じ Windows アカウントで実行されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="c8fff-164">このチュートリアルの系列では、フォーム認証に焦点を当てています、のでおはについては説明しませんファイル承認します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>


### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="c8fff-165">URL 承認のスコープ</span><span class="sxs-lookup"><span data-stu-id="c8fff-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="c8fff-166">`UrlAuthorizationModule`はマネージ コードは、ASP.NET ランタイムの一部であります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="c8fff-167">前の Microsoft のバージョン 7[インターネット インフォメーション サービス (IIS)](https://www.iis.net/) web サーバー IIS の HTTP パイプラインと、ASP.NET ランタイムのパイプラインの間で異なるバリアが発生しました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="c8fff-168">要約すると、IIS 6 と前に、ASP です。NET の`UrlAuthorizationModule`ASP.NET ランタイムを IIS からの要求が委任されて場合にのみ実行します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="c8fff-169">既定では、IIS が HTML ページ、CSS、JavaScript、およびイメージ ファイルのように静的なコンテンツそのものを処理し、ASP.NET ランタイムときの拡張機能のページへの要求を渡しのみ`.aspx`、 `.asmx`、または`.ashx`を要求します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="c8fff-170">IIS 7 では、ただしでは、統合された IIS と ASP.NET パイプライン。</span><span class="sxs-lookup"><span data-stu-id="c8fff-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="c8fff-171">呼び出すための IIS 7 をセットアップするいくつかの構成設定で、`UrlAuthorizationModule`の*すべて*要求、任意の種類のファイルに対する URL 承認規則を定義できることを意味します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="c8fff-172">さらに、IIS 7 には、独自の URL 承認エンジンが含まれています。</span><span class="sxs-lookup"><span data-stu-id="c8fff-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="c8fff-173">ASP.NET 統合と IIS 7 のネイティブの URL 承認機能の詳細については、次を参照してください。 [Understanding IIS7 URL 承認](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="c8fff-174">ASP.NET と IIS 7 の統合の詳細については、Shahram Khosravi のブックのコピーを取得します。 *Professional IIS 7 と ASP.NET 統合プログラミング*(ISBN: 978 0470152539)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="c8fff-175">簡単に言うと、IIS 7 より前のバージョン、URL 承認規則だけに適用されます、ASP.NET ランタイムによって処理されるリソース。</span><span class="sxs-lookup"><span data-stu-id="c8fff-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="c8fff-176">IIS 7 と IIS のネイティブの URL 承認機能を使用したり、ASP を統合することができます。NET の`UrlAuthorizationModule`に IIS の HTTP パイプラインでは、すべての要求にこの機能を拡張することです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-177">方法にいくつかの微妙ながら、重要な違いが ASP です。NET の`UrlAuthorizationModule`と IIS 7 の URL 承認の機能は、承認規則を処理します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="c8fff-178">このチュートリアルは、IIS 7 の URL の承認機能やと比較すると、承認規則を解析する方法の違いを検査しない、`UrlAuthorizationModule`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="c8fff-179">これらのトピックの詳細については、msdn または IIS 7 のドキュメントを参照してください[www.iis.net](https://www.iis.net/)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="c8fff-180">手順 1: での URL 承認規則を定義します。`Web.config`</span><span class="sxs-lookup"><span data-stu-id="c8fff-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="c8fff-181">`UrlAuthorizationModule`アプリケーションの構成で定義されている URL 承認規則に基づいて特定の id の要求されたリソースにアクセス許可または拒否するかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="c8fff-182">承認規則が記述された、 [ `<authorization>`要素](https://msdn.microsoft.com/en-us/library/8d82143t.aspx)の形式で`<allow>`と`<deny>`子要素です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/en-us/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="c8fff-183">各`<allow>`と`<deny>`子要素を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="c8fff-184">特定のユーザー</span><span class="sxs-lookup"><span data-stu-id="c8fff-184">A particular user</span></span>
- <span data-ttu-id="c8fff-185">ユーザーのコンマ区切りの一覧</span><span class="sxs-lookup"><span data-stu-id="c8fff-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="c8fff-186">疑問符 (?) で表される、すべての匿名ユーザー</span><span class="sxs-lookup"><span data-stu-id="c8fff-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="c8fff-187">アスタリスクで示される、すべてのユーザー (\*)</span><span class="sxs-lookup"><span data-stu-id="c8fff-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="c8fff-188">次のマークアップは、ユーザー Tito および Scott を許可およびその他のすべてを拒否する URL 承認規則を使用する方法を示しています。</span><span class="sxs-lookup"><span data-stu-id="c8fff-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="c8fff-189">`<allow>` - Tito と Scott - ユーザーは、要素を定義中に、`<deny>`要素に指示する*すべて*ユーザーが拒否されました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-190">`<allow>`と`<deny>`要素は、ロールの承認規則も指定できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="c8fff-191">今後のチュートリアルでのロールベースの承認を見ていきます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-191">We will examine role-based authorization in a future tutorial.</span></span>


<span data-ttu-id="c8fff-192">次の設定は、Sam (匿名の訪問者を含む) 以外のユーザーにアクセスを付与します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="c8fff-193">認証されたユーザーのみを許可するのには、次の構成は、すべての匿名ユーザーに対してアクセスを拒否を使用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="c8fff-194">承認規則が内で定義された、`<system.web>`内の要素`Web.config`し、すべての web アプリケーションで ASP.NET リソースに適用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="c8fff-195">多くの場合、アプリケーションでは、さまざまなセクションのさまざまな承認規則があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="c8fff-196">など、電子商取引サイトですべてのビジター可能性があります、製品を熟読、製品レビューを参照してください、カタログを検索およびなどです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="c8fff-197">ただし、認証されたユーザーだけは、チェック アウト、または 1 つの配布の履歴を管理するページに到達可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="c8fff-198">さらに、サイト管理者など、ユーザーの選択 でアクセスできるサイトの部分があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="c8fff-199">ASP.NET では、簡単に、サイトの別のファイルとフォルダーのさまざまな承認規則を定義します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="c8fff-200">ルート フォルダーの指定された承認規則`Web.config`ファイルは、サイト内のすべての ASP.NET リソースに適用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="c8fff-201">ただし、これら既定承認上書きできる特定のフォルダーを追加することによって、`Web.config`で、`<authorization>`セクションです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="c8fff-202">認証されたユーザーのみが ASP.NET のページにアクセスできるようにしましょう当社の web サイトを更新する、`Membership`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="c8fff-203">追加する必要があります。 これを実現する、`Web.config`ファイルの名前を、`Membership`フォルダーを匿名ユーザーを拒否するには、その承認設定を設定します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="c8fff-204">右クリックし、`Membership`ソリューション エクスプ ローラーでフォルダーが、コンテキスト メニューから、[新しい項目の追加] メニューを選択し、という名前の新しい Web 構成ファイルを追加`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>


<span data-ttu-id="c8fff-205">[![メンバーシップ フォルダーに Web.config ファイルを追加します。](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="c8fff-206">**図 3**: 追加、`Web.config`ファイルの名前を`Membership`フォルダー ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>


<span data-ttu-id="c8fff-207">この時点で、プロジェクトを含めることは 2 つ`Web.config`ファイル: 1 つで 1 つのルート ディレクトリで、`Membership`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>


<span data-ttu-id="c8fff-208">[![アプリケーションは、2 つの Web.config ファイルを含める必要がありますようになりました](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="c8fff-209">**図 4**: Your アプリケーションする必要がありますを含む 2 つ`Web.config`ファイル ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>


<span data-ttu-id="c8fff-210">構成ファイルを更新、`Membership`フォルダーが匿名ユーザーにアクセスを禁止するようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="c8fff-211">すべてであることには!</span><span class="sxs-lookup"><span data-stu-id="c8fff-211">That's all there is to it!</span></span>

<span data-ttu-id="c8fff-212">この変更をテストするには、ブラウザーでのホーム ページを参照してくださいし、ログに記録されるかどうかを確認します。ASP.NET アプリケーションの既定の動作は、すべてのビジターを許可するため、ルート ディレクトリの承認変更を加えることがありませんでしたので`Web.config`ファイル、匿名ユーザーとしてのルート ディレクトリ内のファイルにアクセスすることができます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="c8fff-213">左の列にあるユーザー アカウントを作成するリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="c8fff-214">これは、操作により、`~/Membership/CreatingUserAccounts.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="c8fff-215">以降、`Web.config`ファイルで、`Membership`フォルダーは、匿名アクセスを禁止する承認規則を定義、`UrlAuthorizationModule`は要求を中止し、HTTP 401 Unauthorized ステータスを返します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="c8fff-216">`FormsAuthenticationModule`ログイン ページに送信する、302 リダイレクト ステータスにこれを変更します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="c8fff-217">あるページおしようとしたアクセスに注意してください (`CreatingUserAccounts.aspx`) 経由でログイン ページに渡される、 `ReturnUrl` querystring パラメーター。</span><span class="sxs-lookup"><span data-stu-id="c8fff-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>


<span data-ttu-id="c8fff-218">[![URL 承認規則匿名アクセスを禁止する、以降は、ログイン ページにリダイレクトしておされます。](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="c8fff-219">**図 5**: おはログイン ページにリダイレクト URL 承認規則の匿名アクセスを禁止する場合、ので ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>


<span data-ttu-id="c8fff-220">リダイレクトしてログインすると、時に、`CreatingUserAccounts.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="c8fff-221">この時間、`UrlAuthorizationModule`匿名不要になったために、ページへのアクセスを許可します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="c8fff-222">特定の場所に URL 承認規則を適用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="c8fff-223">定義されている承認の設定、`<system.web>`のセクション`Web.config`そのディレクトリとそのサブディレクトリ内の ASP.NET リソースのすべてに適用 (それ以外の場合、別の作業でオーバーライドされるまで`Web.config`ファイル)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="c8fff-224">場合によっては、ただしは必要があります、1 つまたは 2 つの特定のページを除く特定の承認設定に指定されたディレクトリ内のすべての ASP.NET リソース。</span><span class="sxs-lookup"><span data-stu-id="c8fff-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="c8fff-225">追加することでこれを行う、`<location>`内の要素`Web.config`が承認規則とは異なる、ファイルを指す、およびその中の一意の承認規則を定義します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="c8fff-226">使用して説明するために、`<location>`みましょう Tito のみがアクセスできるように承認の設定をカスタマイズ、特定のリソースの構成設定をオーバーライドする要素`CreatingUserAccounts.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="c8fff-227">これを実現するには追加、`<location>`要素を`Membership`フォルダーの`Web.config`ファイルし、次のように見えるように、そのマークアップを更新します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="c8fff-228">`<authorization>`内の要素`<system.web>`、ASP.NET のリソースの既定の URL 承認規則を定義、`Membership`フォルダーとそのサブフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="c8fff-229">`<location>`要素により、特定のリソースに対してこれらの規則を上書きします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="c8fff-230">上記のマークアップで、`<location>`要素の参照、`CreatingUserAccounts.aspx`ページおよび Tito を許可するなどの承認規則を指定しますが、拒否する他のすべてです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="c8fff-231">この承認の変更をテストするには、匿名ユーザーとして、web サイトを訪問して起動します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="c8fff-232">任意のページにアクセスしようとする場合、`Membership`フォルダーなど`UserBasedAuthorization.aspx`、`UrlAuthorizationModule`要求を拒否し、ログイン ページにリダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="c8fff-233">言い、Scott、としてログインした後の任意のページにアクセスすることができます、`Membership`フォルダー*を除く*の`CreatingUserAccounts.aspx`します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="c8fff-234">アクセスしようとしています。`CreatingUserAccounts.aspx`すべてのユーザーとしてログオンして起こしません Tito が承認されていないアクセス試行、ログイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-235">`<location>`要素は、構成の外側に記述する必要があります`<system.web>`要素。</span><span class="sxs-lookup"><span data-stu-id="c8fff-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="c8fff-236">個別を使用する必要があります`<location>`各リソースの承認設定をオーバーライドするための要素。</span><span class="sxs-lookup"><span data-stu-id="c8fff-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="c8fff-237">見てどの`UrlAuthorizationModule`アクセスを許可または拒否の承認規則の使用</span><span class="sxs-lookup"><span data-stu-id="c8fff-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="c8fff-238">`UrlAuthorizationModule`かどうかを特定の URL の URL 承認を分析して特定の id を承認する規則を最初から開始し、ダウンさかのぼり、一度に 1 つを決定します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="c8fff-239">場合によっては、一致が見つかったで、一致が見つかるとすぐに、ユーザーがアクセス許可または拒否する`<allow>`または`<deny>`要素。</span><span class="sxs-lookup"><span data-stu-id="c8fff-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="c8fff-240">**一致するものが見つからない場合、ユーザーがアクセスを許可します。**</span><span class="sxs-lookup"><span data-stu-id="c8fff-240">**If no match is found, the user is granted access.**</span></span> <span data-ttu-id="c8fff-241">そのため、アクセスを制限する場合を使用すること、 `<deny>` URL 承認の構成の最後の要素としての要素。</span><span class="sxs-lookup"><span data-stu-id="c8fff-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="c8fff-242">**省略した場合、* * *`<deny>`* * *、要素のすべてのユーザー アクセスが許可されます。**</span><span class="sxs-lookup"><span data-stu-id="c8fff-242">**If you omit a****`<deny>`****element, all users will be granted access.**</span></span>

<span data-ttu-id="c8fff-243">使用されるプロセスを理解するのには、`UrlAuthorizationModule`機関を確認するのに例を考えてみます URL 承認規則がこの手順について説明しました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="c8fff-244">最初のルールを`<allow>`Tito および Scott へのアクセスを可能な要素です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="c8fff-245">2 番目のルールは、`<deny>`すべてのユーザーにアクセスを拒否する要素。</span><span class="sxs-lookup"><span data-stu-id="c8fff-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="c8fff-246">匿名ユーザーがアクセスする場合、`UrlAuthorizationModule`調べれば、開始が匿名 Scott または Tito のいずれかですか?</span><span class="sxs-lookup"><span data-stu-id="c8fff-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="c8fff-247">答えは、当然ながらはなし、2 番目のルールに進みます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="c8fff-248">すべてのユーザーのセットに匿名ですか。</span><span class="sxs-lookup"><span data-stu-id="c8fff-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="c8fff-249">以降、応答は、[はい]、ここで、`<deny>`とルールが有効で格納されます訪問者がログイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="c8fff-250">同様に Jisun を訪問している場合は、`UrlAuthorizationModule`質問は Jisun 開始 Scott または Tito しますか?</span><span class="sxs-lookup"><span data-stu-id="c8fff-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="c8fff-251">彼女はではないため、 `UrlAuthorizationModule` 2 番目の質問では、すべてのユーザーのセットには、Jisun に進みますか?</span><span class="sxs-lookup"><span data-stu-id="c8fff-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="c8fff-252">彼女は、彼女は、アクセスが拒否されるようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="c8fff-253">最後に、Tito 場合、最初の質問はによって引き起こされる、`UrlAuthorizationModule`肯定の応答は Tito はアクセスが許可されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="c8fff-254">以降、`UrlAuthorizationModule`プロセスが、承認規則の上、すべての一致で停止するから特定の規則を汎用性の前に設定することが重要です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="c8fff-255">つまり、Jisun と、匿名ユーザーが禁止されているが、他のすべての認証されたユーザーを許可する承認規則を定義するのにはの先頭に最も固有のルールの 1 つに影響を与えず Jisun - してより限定規則の他のすべてを許可するものに進みます認証されたユーザーがすべての匿名ユーザーを拒否します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="c8fff-256">次の URL 承認規則では、まず Jisun、拒否して、匿名ユーザーを拒否して、このポリシーを実装します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="c8fff-257">Jisun 以外のユーザーは認証済みアクセスが許可されるためこれらのどちらも`<deny>`ステートメントと一致することです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="c8fff-258">手順 2: 承認されていない、認証されたユーザーに対して、ワークフローを修正します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="c8fff-259">URL 承認のワークフロー セクションには、A の場所 では、このチュートリアルで既に説明したよう anytime 未承認の要求には、`UrlAuthorizationModule`は要求を中止し、HTTP 401 Unauthorized ステータスを返します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="c8fff-260">この 401 ステータスの変更では、 `FormsAuthenticationModule` 302 にユーザーをログイン ページに送信する状態をリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="c8fff-261">このワークフローは、ユーザーが認証された場合でも、未承認の要求で発生します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="c8fff-262">ログイン ページに、認証されたユーザーを返すことは、システムに既にログインしている、以降は混乱する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="c8fff-263">ほんの少しの作業が、制限されているページにアクセスしようとしたことを説明するページに対して承認されていない要求を行う認証されたユーザーをリダイレクトすることで、このワークフローを向上します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="c8fff-264">という名前の web アプリケーションのルート フォルダーに新しい ASP.NET ページを作成して開始`UnauthorizedAccess.aspx`; 忘れずにこのページに関連付ける、`Site.master`マスター ページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="c8fff-265">このページを作成した後にを参照するコンテンツ コントロールを削除、 `LoginContent` ContentPlaceHolder のため、マスター ページの既定のコンテンツを表示するようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="c8fff-266">つまり、状況を説明するメッセージを次に、追加、ユーザーが保護されたリソースにアクセスしようとしたことです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="c8fff-267">このようなメッセージを追加した後、`UnauthorizedAccess.aspx`ページの宣言型マークアップは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="c8fff-268">今すぐに送信される場合は、承認されていない要求が認証済みユーザーによって実行されるように、ワークフローを変更する必要があります、`UnauthorizedAccess.aspx`ログイン ページではなくページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="c8fff-269">プライベート メソッド内でログイン ページに不正な要求をリダイレクトするロジックが埋め込まれています、`FormsAuthenticationModule`クラス、おこの動作をカスタマイズすることはできません。</span><span class="sxs-lookup"><span data-stu-id="c8fff-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="c8fff-270">ユーザーをリダイレクトするログイン ページに独自のロジックを追加、何ができるか、ただし、 `UnauthorizedAccess.aspx`、必要に応じて。</span><span class="sxs-lookup"><span data-stu-id="c8fff-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="c8fff-271">ときに、`FormsAuthenticationModule`未承認のユーザーをリダイレクトするログイン ページに、名前を持つクエリ文字列の要求、承認されていない URL の追加`ReturnUrl`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="c8fff-272">たとえば、未認証のユーザーにアクセスしようとしました。 `OnlyTito.aspx`、`FormsAuthenticationModule`がリダイレクトするに`Login.aspx?ReturnUrl=OnlyTito.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="c8fff-273">そのため、認証されたユーザーを含むクエリ文字列でログイン ページに達した場合、`ReturnUrl`パラメーターは、次のトピックこの未認証のユーザーだけ試行されたことを表示するユーザー権限がないページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="c8fff-274">このような場合は、彼女にリダイレクトする`UnauthorizedAccess.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="c8fff-275">これを実現するには、ログイン ページの次のコードを追加`Page_Load`イベントのハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="c8fff-276">上記のコード、承認されていない認証されたユーザーをリダイレクトする、`UnauthorizedAccess.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="c8fff-277">このロジックの動作を表示するには、匿名ユーザーとしてサイトにアクセスし、左の列にユーザー アカウントを作成するリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="c8fff-278">これは、操作により、`~/Membership/CreatingUserAccounts.aspx`ページのみを構成しました手順 1. で Tito へのアクセス許可。</span><span class="sxs-lookup"><span data-stu-id="c8fff-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="c8fff-279">匿名ユーザーは禁止されていますので、 `FormsAuthenticationModule` us をログイン ページにリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="c8fff-280">この時点では匿名ため、`Request.IsAuthenticated`返します`False`にリダイレクトされないことと`UnauthorizedAccess.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="c8fff-281">代わりに、ログイン ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="c8fff-282">Tito、ブルースなど別のユーザーとしてログインします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="c8fff-283">適切な資格情報を入力すると、ログイン ページに設定されて us リダイレクト`~/Membership/CreatingUserAccounts.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="c8fff-284">ただし、このページが Tito にアクセスできるのみ、ためおを表示する権限し、ログイン ページに迅速に返されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="c8fff-285">ただし、この時間`Request.IsAuthenticated`返します`True`(および`ReturnUrl`querystring パラメーターが存在する) にリダイレクトしましたので、`UnauthorizedAccess.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>


<span data-ttu-id="c8fff-286">[![認証、承認されていないユーザーは UnauthorizedAccess.aspx にリダイレクトされます。](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="c8fff-287">**図 6**: 認証、承認されていないユーザーがリダイレクトされるを`UnauthorizedAccess.aspx`([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>


<span data-ttu-id="c8fff-288">このカスタマイズされたワークフローは、短いサーキット図 2 にサイクルよりわかりやすい、単純なユーザー エクスペリエンスを表示します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="c8fff-289">手順 3: 現在のログインのユーザーに基づく機能を制限します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="c8fff-290">URL 承認簡単粗い承認規則を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="c8fff-291">手順 1. で説明したとおり、URL の承認おできます簡潔状態どの id が許可されており、どれがフォルダー内の特定のページまたはすべてのページの表示を拒否します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="c8fff-292">特定のシナリオでただし、することも、ページにアクセスして、訪問するユーザーに基づいて、ページの機能を制限するためのすべてのユーザーを許可します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="c8fff-293">独自の製品を確認する認証済みの訪問者をできるようにする電子商取引 web サイトの場合を考えます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="c8fff-294">匿名ユーザーが製品のページを訪問したとき、製品情報だけが表示されない与えられます、レビューのままにすることです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="c8fff-295">ただし、同じページにアクセス、認証されたユーザーには 変更履歴のインターフェイス参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="c8fff-296">認証されたユーザーは、この製品をまだ確認されませんが場合、インターフェイスが有効にする; レビューを送信するにはそれ以外の場合に表示して、以前から送信されたレビュー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="c8fff-297">このシナリオの手順を実行するには、さらに、製品ページ可能性があります追加情報を表示および e コマース ポータルで使用できるこれらのユーザーの拡張機能を提供します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="c8fff-298">やなどの製品ページ可能性があります stock では、インベントリの一覧を製品の価格と従業員がアクセスしたときの説明を編集するオプションが含まれます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="c8fff-299">宣言またはプログラムによって (または、2 つの組み合わせを通じて)、このような細かい粒度の承認規則を実装することができます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="c8fff-300">次のセクションで LoginView コントロールを使用して細かい粒度の承認を実装する方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="c8fff-301">次は、プログラムによる手法について説明します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="c8fff-302">きめ細かく承認規則を適用することで見ることができます、前にただし、まずいただくために機能を持つは、それにアクセスしたユーザーによって異なります。 ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="c8fff-303">GridView 内の特定のディレクトリ内のファイルを一覧するページを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c8fff-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="c8fff-304">GridView がある 2 つの列を含める各ファイルの名前、サイズ、およびその他の情報を一覧表示する、と共に: いずれかのビュー「and」というタイトルが付けられた 1 つの削除。</span><span class="sxs-lookup"><span data-stu-id="c8fff-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="c8fff-305">ビューの LinkButton がクリックされた場合、選択したファイルの内容が表示されます。削除の LinkButton がクリックされた場合は、ファイルが削除されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="c8fff-306">そのビューおよび delete の機能をすべてのユーザーに使用できるように、このページを最初に作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="c8fff-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="c8fff-307">使用方法で LoginView コントロールおよび機能をプログラムで制限するセクションでは、有効にするにまたはページにアクセスするユーザーに基づくこれらの機能を無効にする方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-308">ビルドには ASP.NET ページは、ファイルの一覧を表示するのに GridView コントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="c8fff-309">このチュートリアルでは、系列は、フォーム認証、承認、ユーザー アカウント、およびロールに焦点を当てています、以降しない GridView コントロールの内部動作をについて説明する時間をかけるにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="c8fff-310">このチュートリアルでは、このページを設定するための特定の詳細な手順についてはの特定の選択肢が行われた理由または影響の特定のプロパティが表示される出力が詳細には掘り下げてされません。</span><span class="sxs-lookup"><span data-stu-id="c8fff-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="c8fff-311">GridView コントロールの詳細についてを参照してください   *[ASP.NET 2.0 のデータを扱う](../../data-access/index.md)*一連のチュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>


<span data-ttu-id="c8fff-312">開いて開始、`UserBasedAuthorization.aspx`ファイルで、`Membership`フォルダーとという名前のページへの GridView コントロールの追加`FilesGrid`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="c8fff-313">GridView のスマート タグで、[フィールド] ダイアログ ボックスを起動する列の編集リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="c8fff-314">ここでは、左下隅で自動生成のフィールドのチェック ボックスをオフにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="c8fff-315">次に、左上隅 (Select および削除のボタンで見つかります CommandField 型) から選択 ボタン、削除 ボタン、および 2 つの BoundFields を追加します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="c8fff-316">[選択] ボタンを設定`SelectText`プロパティを表示し、最初の BoundField の`HeaderText`と`DataField`プロパティ名にします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="c8fff-317">2 番目の BoundField の設定`HeaderText`プロパティ サイズ (バイト単位) をその`DataField`プロパティの長さをその`DataFormatString`{0: n0} プロパティとその`HtmlEncode`プロパティを False にします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="c8fff-318">GridView の列を構成した後、[フィールド] ダイアログ ボックスを閉じるには、[ok] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="c8fff-319">[プロパティ] ウィンドウからの設定、GridView の`DataKeyNames`プロパティを`FullName`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="c8fff-320">この時点で、GridView の宣言型マークアップは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="c8fff-321">GridView のマークアップを作成、特定のディレクトリ内のファイルを取得し、それらを GridView にバインドするコードを記述する準備ができました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="c8fff-322">ページの次のコードを追加`Page_Load`イベントのハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="c8fff-323">上記のコードを使用して、 [ `DirectoryInfo`クラス](https://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx)アプリケーションのルート フォルダー内のファイルの一覧を取得します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/en-us/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="c8fff-324">[ `GetFiles()`メソッド](https://msdn.microsoft.com/en-us/library/system.io.directoryinfo.getfiles.aspx)ディレクトリ内のすべてのファイルの配列として返します[`FileInfo`オブジェクト](https://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx)、これが GridView にバインドし、します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-324">The [`GetFiles()` method](https://msdn.microsoft.com/en-us/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/en-us/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="c8fff-325">`FileInfo`オブジェクトなどさまざまなプロパティがあります`Name`、 `Length`、および`IsReadOnly`、その他。</span><span class="sxs-lookup"><span data-stu-id="c8fff-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="c8fff-326">GridView がだけ表示されます、宣言型マークアップからわかるように、`Name`と`Length`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-327">`DirectoryInfo`と`FileInfo`クラスは、 [ `System.IO`名前空間](https://msdn.microsoft.com/en-us/library/system.io.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/en-us/library/system.io.aspx).</span></span> <span data-ttu-id="c8fff-328">では、これらのクラス名、名前空間の名前を付けますまたはクラス ファイルにインポートされた名前空間があるかが必要 (を介して`Imports System.IO`)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>


<span data-ttu-id="c8fff-329">すぐをブラウザーからこのページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="c8fff-330">アプリケーションのルート ディレクトリに存在するファイルの一覧が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="c8fff-331">クリックすると、ビューまたはあるの削除のいずれかによって、ポストバックがアクションが発生しないきたところ、必要なイベント ハンドラーを作成します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>


<span data-ttu-id="c8fff-332">[![GridView は、Web アプリケーションのルート ディレクトリ内のファイルを一覧表示します。](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="c8fff-333">**図 7**: GridView は、Web アプリケーションのルート ディレクトリにファイルを示します ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>


<span data-ttu-id="c8fff-334">選択したファイルの内容を表示するための手段が必要です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="c8fff-335">Visual Studio に戻り、という名前のテキスト ボックスを追加して`FileContents`GridView 上。</span><span class="sxs-lookup"><span data-stu-id="c8fff-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="c8fff-336">設定の`TextMode`プロパティを`MultiLine`とその`Columns`と`Rows`プロパティ 95%、10、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="c8fff-337">Gridview のイベント ハンドラーを次に、作成[`SelectedIndexChanged`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx)し、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="c8fff-338">この例では、GridView の`SelectedValue`プロパティを選択したファイルの完全なファイル名を確認します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="c8fff-339">内部的には、`DataKeys`コレクションが取得するために参照されている、 `SelectedValue`、GridView を設定することが不可欠であるため、`DataKeyNames`プロパティを名前、この手順で既に説明したようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="c8fff-340">[ `File`クラス](https://msdn.microsoft.com/en-us/library/system.io.file.aspx)に代入している文字列に、選択したファイルの内容の読み取りに使用、`FileContents`テキスト ボックスの`Text`プロパティ、それによって ページで選択したファイルの内容を表示します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-340">The [`File` class](https://msdn.microsoft.com/en-us/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>


<span data-ttu-id="c8fff-341">[![テキスト ボックスに、選択したファイルの内容が表示されます。](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="c8fff-342">**図 8**: テキスト ボックスに、選択したファイルの内容が表示されます ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c8fff-343">HTML マークアップを含むファイルの内容を表示して表示またはファイルの削除を試みますが表示されます、`HttpRequestValidationException`エラーです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="c8fff-344">これは、ポストバック時に、テキスト ボックスの内容は web サーバーに送信されるために発生します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="c8fff-345">既定では、ASP.NET を発生させます、`HttpRequestValidationException`エラーは、HTML マークアップなどの危険性のあるポストバック コンテンツを検出します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="c8fff-346">このエラーの発生を無効にするには、してオフに、ページの要求の検証を追加する`ValidateRequest="false"`を`@Page`ディレクティブです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="c8fff-347">どのような予防措置としても行う必要がありますタイミングとして要求の検証の利点の詳細について無効にすることをお読み[要求の検証 - スクリプト攻撃の防止](https://asp.net/learn/whitepapers/request-validation/)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>


<span data-ttu-id="c8fff-348">Gridview の最後に、次のコードでイベント ハンドラーを追加[`RowDeleting`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="c8fff-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="c8fff-349">コードで、削除するファイルの完全名を表示するだけ、 `FileContents` TextBox*せず*ファイルを実際に削除します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>


<span data-ttu-id="c8fff-350">[![[削除] ボタンをクリックするとは実際にファイルを削除できません。](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="c8fff-351">**図 9**: ファイルをクリックする、削除ボタンは実際に削除されません ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>


<span data-ttu-id="c8fff-352">手順 1 で匿名ユーザーが内のページを表示することを禁止する URL 承認規則を構成しました、`Membership`フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="c8fff-353">細かい粒度の認証を示す、するためにできるようにして、匿名ユーザーのアクセス、 `UserBasedAuthorization.aspx`  ページで、限られた機能がします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="c8fff-354">このページに開放にすべてのユーザーがアクセスして、次のコードを追加`<location>`要素を`Web.config`ファイルで、`Membership`フォルダー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="c8fff-355">これを追加した後`<location>`要素、サイトからのログ記録で新しい URL 承認規則をテストします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="c8fff-356">匿名ユーザーとしてする必要がありますを許可するを参照してください、`UserBasedAuthorization.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="c8fff-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="c8fff-357">現時点では、任意の認証済みまたは匿名ユーザーがアクセスできる、`UserBasedAuthorization.aspx`ページを表示し、またはファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="c8fff-358">させて認証されたユーザーのみがファイルの内容を表示し、Tito のみが、ファイルを削除できるようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="c8fff-359">宣言によって、プログラム、または両方のメソッドの組み合わせによって、このような細かい粒度の承認規則を適用できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="c8fff-360">みましょう宣言型の方法を使用して、ファイルの内容を表示できるを制限するにはプログラムによる、ファイルを削除できるユーザーを制限する方法を使用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="c8fff-361">LoginView コントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-361">Using the LoginView Control</span></span>

<span data-ttu-id="c8fff-362">これまで見てきた過去のチュートリアルでと LoginView コントロールは、認証と匿名ユーザー用の別のインターフェイスを表示するのに便利ですが匿名ユーザーにアクセスできない機能を非表示にする簡単な方法を提供します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="c8fff-363">のみを表示する必要があります匿名ユーザーは、表示するか、またはファイルを削除することはできませんから、`FileContents`認証済みユーザーによってアクセスすると、このページのテキスト ボックス。</span><span class="sxs-lookup"><span data-stu-id="c8fff-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="c8fff-364">これを実現する、LoginView コントロール、ページを追加、名前を付けます`LoginViewForFileContentsTextBox`に移動し、 `FileContents` LoginView コントロールのテキスト ボックスの宣言型マークアップ`LoggedInTemplate`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="c8fff-365">LoginView のテンプレートでの Web コントロールは、分離コード クラスから直接アクセスではなくなりました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="c8fff-366">たとえば、 `FilesGrid` GridView の`SelectedIndexChanged`と`RowDeleting`イベント ハンドラーを現在参照、`FileContents`などのコードのある TextBox コントロール。</span><span class="sxs-lookup"><span data-stu-id="c8fff-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="c8fff-367">ただし、このコードは有効ではなくなりました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-367">However, this code is no longer valid.</span></span> <span data-ttu-id="c8fff-368">移動することによって、 `FileContents`  テキスト ボックスに、`LoggedInTemplate`テキスト ボックスに直接アクセスできません。</span><span class="sxs-lookup"><span data-stu-id="c8fff-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="c8fff-369">代わりに、使用する必要があります、`FindControl("controlId")`コントロールをプログラムによって参照されるメソッド。</span><span class="sxs-lookup"><span data-stu-id="c8fff-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="c8fff-370">更新プログラム、`FilesGrid`イベント ハンドラー ボックスを参照する次のようにします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="c8fff-371">LoginView をテキスト ボックスを移動した後`LoggedInTemplate`ページのコードを使用して、テキスト ボックスの参照を更新し、`FindControl("controlId")`パターン、匿名ユーザーとしてそのページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="c8fff-372">図 10 に示す、 `FileContents`  テキスト ボックスは表示されません。</span><span class="sxs-lookup"><span data-stu-id="c8fff-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="c8fff-373">ただし、ビューの LinkButton は引き続き表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-373">However, the View LinkButton is still displayed.</span></span>


<span data-ttu-id="c8fff-374">[![LoginView コントロールを表示する、FileContents テキスト ボックスに認証されたユーザーのみ](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="c8fff-375">**図 10**:「LoginView コントロールのみがレンダリング、 `FileContents` Authenticated Users をテキスト ボックス ([フルサイズ イメージを表示するに、をクリックして](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>


<span data-ttu-id="c8fff-376">匿名ユーザーの表示 ボタンを非表示にする方法の 1 つは GridView フィールドを TemplateField に変換することです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="c8fff-377">これにより、ビューの LinkButton の宣言型マークアップを含むテンプレートが生成されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="c8fff-378">TemplateField に LoginView コントロールを追加したり LoginView の内の LinkButton を配置できます`LoggedInTemplate`これにより、匿名の訪問者から [表示] ボタンを非表示にします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="c8fff-379">これを実現するには、[フィールド] ダイアログ ボックスを起動する GridView のスマート タグからの列の編集リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="c8fff-380">次に、左下隅にある一覧から選択 ボタンを選択し、このフィールドを TemplateField リンクに変換 をクリックします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="c8fff-381">これによりから、フィールドの宣言型マークアップを変更します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="c8fff-382">移動先:</span><span class="sxs-lookup"><span data-stu-id="c8fff-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="c8fff-383">この時点で、LoginView、TemplateField に追加できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="c8fff-384">次のマークアップでは、認証されたユーザーに対してのみ表示 LinkButton が表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="c8fff-385">図 11 に示す、最終的な結果はかなりのビューとして列がまだ表示されている場合でも、非表示には、列内でビューのあります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="c8fff-386">見てみましょう全体の GridView 列 (と LinkButton だけでなく) を非表示にする方法、次のセクションでします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>


<span data-ttu-id="c8fff-387">[![LoginView コントロールは、匿名の訪問者のビューのあるを非表示に](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="c8fff-388">**図 11**: LoginView コントロールは、匿名の訪問者のビューのあるを非表示に ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>


### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="c8fff-389">プログラムで機能を制限します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="c8fff-390">状況によっては、宣言的な手法では、ページに機能を制限するための十分なです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="c8fff-391">たとえば、特定のページの機能の可用性は、ページにアクセスしたユーザーは、匿名または認証されたかどうかを超える条件に依存する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="c8fff-392">このような場合は、さまざまなユーザー インターフェイス要素表示したり、プログラムによる方法で非表示になります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="c8fff-393">機能をプログラムで制限するためには、2 つのタスクを実行する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="c8fff-394">ページにアクセスしたユーザーが、機能にアクセスできるかどうかを判断し、</span><span class="sxs-lookup"><span data-stu-id="c8fff-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="c8fff-395">プログラムによってユーザーが対象の機能へのアクセスを持っているかどうかに基づくユーザー インターフェイスを変更します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="c8fff-396">これら 2 つのタスクのアプリケーションを示すためには、説明のみを許可 Tito GridView からファイルを削除します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="c8fff-397">最初のタスクは、次は Tito ページにアクセスであるかどうかを決定します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="c8fff-398">決定されています (表示または非表示)、GridView の列を削除する必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="c8fff-399">GridView の列が経由でアクセスできる、`Columns`プロパティです。 列だけ表示する場合、`Visible`プロパティがに設定されている`True`(既定)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="c8fff-400">次のコードを追加、 `Page_Load` GridView にデータをバインドする前にイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="c8fff-401">説明したよう、 [*フォーム認証の概要を*](../introduction/an-overview-of-forms-authentication-vb.md)チュートリアルでは、 `User.Identity.Name` id の名前を返します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="c8fff-402">これは、ログイン コントロールに入力されたユーザー名に対応します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="c8fff-403">Tito ページにアクセス、GridView の 2 番目の列のかどうかは`Visible`プロパティに設定されている`True`、それ以外に設定されている`False`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="c8fff-404">最終的には、Tito 以外にアクセス ページで、別の認証されたユーザーまたは匿名ユーザーのいずれかと、列の削除はレンダリングされません (図 12 を参照)。ただし、ページにアクセスする Tito、列の削除が存在 (図 13 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="c8fff-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>


<span data-ttu-id="c8fff-405">[![列の削除はされませんレンダリングされるときに訪問によって他のユーザー以外の Tito (ブルース) など](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="c8fff-406">**図 12**: 列の削除はされませんレンダリングされるときに訪問によって他のユーザー以外の Tito (ブルース) など ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>


<span data-ttu-id="c8fff-407">[![Tito 用に描画される列の削除](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="c8fff-408">**図 13**: Tito に対して列の削除がレンダリング ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="c8fff-409">手順 4: クラスとメソッドに承認規則を適用します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="c8fff-410">手順 3 は、匿名ユーザーによるファイルの内容の表示を許可されていませんし、ファイルを削除してから、すべてのユーザーも Tito を禁止します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="c8fff-411">宣言とプログラムの手法を承認されていない訪問者に関連するユーザー インターフェイス要素を非表示にすることで実現しました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="c8fff-412">この単純な例では、については、単純なユーザー インターフェイス要素を適切に非表示がより複雑なサイトで同じ機能を実行するさまざまな方法である可能性がありますか。</span><span class="sxs-lookup"><span data-stu-id="c8fff-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="c8fff-413">未承認のユーザーにその機能を制限したり、非表示またはすべての該当するユーザー インターフェイス要素を無効にするを忘れる場合の対処方法</span><span class="sxs-lookup"><span data-stu-id="c8fff-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="c8fff-414">機能の特定の部分を未認証のユーザーがアクセスできないことを確認する簡単な方法は、そのクラスまたはメソッドを装飾するが、 [ `PrincipalPermission`属性](https://msdn.microsoft.com/en-us/library/system.security.permissions.principalpermissionattribute.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/en-us/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="c8fff-415">.NET ランタイム クラスを使用して、そのメソッドの 1 つを実行時に現在のセキュリティ コンテキストが、クラスを使用するか、メソッドを実行する権限を持っていることを確認することを確認します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="c8fff-416">`PrincipalPermission`属性は、これらの規則を定義できる機構を提供します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="c8fff-417">使用する例を見てみましょう、 `PrincipalPermission` GridView の属性`SelectedIndexChanged`と`RowDeleting`それぞれ匿名ユーザーと Tito、以外のユーザーが実行を禁止するイベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="c8fff-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="c8fff-418">必要なことを行うには、各関数の定義の上に適切な属性を追加です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="c8fff-419">属性、`SelectedIndexChanged`の属性として、イベントのハンドラーが決定され、認証されたユーザーだけが、イベント ハンドラーを実行できる、`RowDeleting`イベント ハンドラーが Tito に実行を制限します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="c8fff-420">属性は、クラス、メソッド、プロパティ、またはイベントに適用できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="c8fff-421">属性を追加する場合は、クラス、メソッド、プロパティ、またはイベント宣言ステートメントの一部にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="c8fff-422">Visual Basic では、ステートメント区切り文字として改行文字を使用するための属性は必要がありますか、宣言とまたは行連結文字 (アンダー スコア) とそのすぐ上の同じ行に表示されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="c8fff-423">上記のコード スニペットは、行連結文字を使用して、1 つの行で、別のメソッドの宣言属性を配置するします。</span><span class="sxs-lookup"><span data-stu-id="c8fff-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>


<span data-ttu-id="c8fff-424">場合、Tito は別のユーザーが実行しようとした何らかの理由で、`RowDeleting`イベント ハンドラーまたは認証されていないユーザーが実行を試みる、 `SelectedIndexChanged` .NET ランタイムで発生するイベント ハンドラー、`SecurityException`です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>


<span data-ttu-id="c8fff-425">[![SecurityException がスローされるセキュリティ コンテキストが、メソッドを実行する権限がない場合](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="c8fff-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="c8fff-426">**図 14**: セキュリティ コンテキストが、メソッドを実行する権限がない場合、`SecurityException`がスローされます ([フルサイズのイメージを表示するをクリックして](user-based-authorization-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="c8fff-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>


> [!NOTE]
> <span data-ttu-id="c8fff-427">複数のセキュリティ コンテキストがクラスまたはメソッドにアクセスできるように、クラスまたはメソッドを装飾できるは`PrincipalPermission`の各セキュリティ コンテキストの属性です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="c8fff-428">つまり、Tito およびブルースの両方が実行を許可する、 `RowDeleting` 、イベント ハンドラーを追加*2* `PrincipalPermission`属性。</span><span class="sxs-lookup"><span data-stu-id="c8fff-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>


[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="c8fff-429">ASP.NET ページだけでなく多くのアプリケーションでは、ビジネス ロジックとデータ アクセス レイヤーなど、さまざまな層が含まれています、アーキテクチャもが存在します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="c8fff-430">これらのレイヤーでは、一般に、クラス ライブラリとして実装し、クラスとビジネス ロジックとデータに関連する機能を実行するためのメソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="c8fff-431">`PrincipalPermission`属性はこれらのレイヤーに承認規則を適用するために役立ちます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="c8fff-432">使用する方法について、`PrincipalPermission`属性をクラスやメソッドで承認規則を定義しを参照してください[Scott Guthrie](https://weblogs.asp.net/scottgu/)のブログ エントリ[ビジネス レイヤーを使用してデータして承認規則を追加します。`PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="c8fff-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="c8fff-433">概要</span><span class="sxs-lookup"><span data-stu-id="c8fff-433">Summary</span></span>

<span data-ttu-id="c8fff-434">このチュートリアルでは、ユーザー ベースの承認規則を適用する方法を説明しました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="c8fff-435">ASP を見てから始まります。NET の URL の承認フレームワークです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="c8fff-436">要求ごとに、ASP.NET エンジンの`UrlAuthorizationModule`id が要求されたリソースにアクセスを承認されているかどうかを決定する、アプリケーションの構成で定義されている URL 承認規則を検査します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="c8fff-437">つまり、URL 承認簡単に特定のディレクトリ内のすべてのページまたは特定のページの承認規則を指定できます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="c8fff-438">URL の承認フレームワークでは、ページ単位ごとに承認規則が適用されます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="c8fff-439">URL 承認では、要求元のいずれかの id はか特定のリソースにアクセスする権限します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="c8fff-440">多くのシナリオでは、ただし、さらにきめ細かく承認ルールの呼び出します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="c8fff-441">ページへのアクセスが許可されるユーザーを定義するのではなく、everyone のアクセス、ページが別のデータを表示するか、ページにアクセスしたユーザーによって異なる機能を提供することがあります。</span><span class="sxs-lookup"><span data-stu-id="c8fff-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="c8fff-442">ページ レベルの承認には、通常、承認されていないユーザーが禁止されている機能にアクセスすることを防ぐために特定のユーザー インターフェイス要素を非表示が含まれます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="c8fff-443">さらに、クラスと特定のユーザーに対してそのメソッドの実行にアクセスを制限する属性を使用することができます。</span><span class="sxs-lookup"><span data-stu-id="c8fff-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="c8fff-444">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="c8fff-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="c8fff-445">関連項目</span><span class="sxs-lookup"><span data-stu-id="c8fff-445">Further Reading</span></span>

<span data-ttu-id="c8fff-446">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="c8fff-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="c8fff-447">ビジネスおよびデータ層を使用する承認規則の追加`PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="c8fff-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="c8fff-448">ASP.NET の承認</span><span class="sxs-lookup"><span data-stu-id="c8fff-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/en-us/library/wce3kxhd.aspx)
- [<span data-ttu-id="c8fff-449">Iis 6 と iis 7 のセキュリティの変更</span><span class="sxs-lookup"><span data-stu-id="c8fff-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="c8fff-450">特定のファイルおよびサブディレクトリを構成します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/en-us/library/6hbkh9s7.aspx)
- [<span data-ttu-id="c8fff-451">ユーザーに基づくデータ変更機能を制限します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="c8fff-452">LoginView コントロールのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="c8fff-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="c8fff-453">IIS7 URL 承認を理解します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="c8fff-454">`UrlAuthorizationModule`テクニカル ドキュメント</span><span class="sxs-lookup"><span data-stu-id="c8fff-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/en-us/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="c8fff-455">ASP.NET 2.0 のデータの操作</span><span class="sxs-lookup"><span data-stu-id="c8fff-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="c8fff-456">作成者について</span><span class="sxs-lookup"><span data-stu-id="c8fff-456">About the Author</span></span>

<span data-ttu-id="c8fff-457">Scott Mitchell、複数の受け取りますブックの作成者と 4GuysFromRolla.com の創設者は、Microsoft の Web テクノロジと 1998 年取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="c8fff-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="c8fff-458">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="c8fff-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="c8fff-459">最新の著書 *[Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="c8fff-460">Scott に到達できる[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)または彼のブログでを介して[http://ScottOnWriting.NET](http://scottonwriting.net/)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="c8fff-461">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="c8fff-461">Special Thanks To</span></span>

<span data-ttu-id="c8fff-462">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="c8fff-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="c8fff-463">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="c8fff-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="c8fff-464">場合は、ドロップ me 一度に 1 行ずつ[ mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)です。</span><span class="sxs-lookup"><span data-stu-id="c8fff-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="c8fff-465">[前へ](validating-user-credentials-against-the-membership-user-store-vb.md)
[次へ](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="c8fff-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
