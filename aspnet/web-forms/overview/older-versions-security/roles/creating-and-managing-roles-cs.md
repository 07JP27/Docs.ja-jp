---
uid: web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
title: 作成と管理の役割 (c#) |Microsoft ドキュメント
author: rick-anderson
description: このチュートリアルでは、ロールのフレームワークを構成するために必要な手順について説明します。 次は、web ページを作成し、ロールの削除を構築します。
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/24/2008
ms.topic: article
ms.assetid: 113f10b3-a19a-471b-8ff6-db3c79ce8a91
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/roles/creating-and-managing-roles-cs
msc.type: authoredcontent
ms.openlocfilehash: a4ea7e76e023cd436d1d8ac52307a3ac17267fef
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891680"
---
<a name="creating-and-managing-roles-c"></a><span data-ttu-id="b48a5-104">作成と管理の役割 (c#)</span><span class="sxs-lookup"><span data-stu-id="b48a5-104">Creating and Managing Roles (C#)</span></span>
====================
<span data-ttu-id="b48a5-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="b48a5-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="b48a5-106">[コードをダウンロードする](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip)または[PDF のダウンロード](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="b48a5-106">[Download Code](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/CS.09.zip) or [Download PDF](http://download.microsoft.com/download/6/0/3/6032582f-360d-4739-b935-38721fdb86ea/aspnet_tutorial09_CreatingRoles_cs.pdf)</span></span>

> <span data-ttu-id="b48a5-107">このチュートリアルでは、ロールのフレームワークを構成するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-107">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="b48a5-108">次は、web ページを作成し、ロールの削除を構築します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-108">Following that, we will build web pages to create and delete roles.</span></span>


## <a name="introduction"></a><span data-ttu-id="b48a5-109">はじめに</span><span class="sxs-lookup"><span data-stu-id="b48a5-109">Introduction</span></span>

<span data-ttu-id="b48a5-110"><a id="_msoanchor_1"> </a> [*ユーザー ベースの承認*](../membership/user-based-authorization-cs.md)チュートリアル URL 承認を使用して、ページのセットから特定のユーザーを制限するには検索し、宣言的に調査し、アクセスしたユーザーに基づいて ASP.NET ページの機能を調整するためのプログラムによるテクニック</span><span class="sxs-lookup"><span data-stu-id="b48a5-110">In the <a id="_msoanchor_1"></a>[*User-Based Authorization*](../membership/user-based-authorization-cs.md) tutorial we looked at using URL authorization to restrict certain users from a set of pages and explored declarative and programmatic techniques for adjusting an ASP.NET page's functionality based on the visiting user.</span></span> <span data-ttu-id="b48a5-111">ページへのアクセスやユーザー単位のユーザーごとの機能にアクセス権を付与するには、ただし、なることのシナリオでのメンテナンス大変な作業が多くのユーザー アカウントがある場合、またはユーザーの特権を頻繁に変更します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-111">Granting permission for page access or functionality on a user-by-user basis, however, can become a maintenance nightmare in scenarios where there are many user accounts or when users' privileges change often.</span></span> <span data-ttu-id="b48a5-112">ユーザーを取得したり、特定のタスクを実行するための承認を失ったり、いつでも、管理者は、適切な URL 承認規則、宣言型のマークアップとコードを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-112">Any time a user gains or loses authorization to perform a particular task, the administrator needs to update the appropriate URL authorization rules, declarative markup, and code.</span></span>

<span data-ttu-id="b48a5-113">通常では、ユーザーをグループに分類または*ロール*とそのアクセス許可をロール別のロールごとに適用するためにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-113">It usually helps to classify users into groups or *roles* and then to apply permissions on a role-by-role basis.</span></span> <span data-ttu-id="b48a5-114">たとえば、ほとんどの web アプリケーションでは、特定の一連のページまたは管理ユーザーに対してのみに予約されているタスクがあります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-114">For example, most web applications have a certain set of pages or tasks that are reserved only for administrative users.</span></span> <span data-ttu-id="b48a5-115">学習技法を使用して、*ユーザー ベースの承認*チュートリアルでは、私たちは、適切な URL 承認規則、宣言型のマークアップと追加管理タスクを実行する指定されたユーザー アカウントを許可するためのコード。</span><span class="sxs-lookup"><span data-stu-id="b48a5-115">Using the techniques learned in the *User-Based Authorization* tutorial, we would add the appropriate URL authorization rules, declarative markup, and code to allow the specified user accounts to perform administrative tasks.</span></span> <span data-ttu-id="b48a5-116">新しい管理者を追加した場合、または既存の管理者が失効して自分の管理権限を持っている必要な場合は、返すし、構成ファイルと web ページを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-116">But if a new administrator was added or if an existing administrator needed to have her administration rights revoked, we would have to return and update the configuration files and web pages.</span></span> <span data-ttu-id="b48a5-117">ただし、ロールで管理者と呼ばれるロールを作成し、管理者ロールにこれらの信頼されたユーザーを割り当てるでしたおです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-117">With roles, however, we could create a role called Administrators and assign those trusted users to the Administrators role.</span></span> <span data-ttu-id="b48a5-118">次に、おは、適切な URL 承認規則、宣言型のマークアップとさまざまな管理タスクを実行する管理者ロールを許可するコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-118">Next, we would add the appropriate URL authorization rules, declarative markup, and code to allow the Administrators role to perform the various administrative tasks.</span></span> <span data-ttu-id="b48a5-119">このインフラストラクチャを導入するには、サイトに新しい管理者を追加または既存のテーブルを削除するなど、または管理者ロールからユーザーを削除するだけでです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-119">With this infrastructure in place, adding new administrators to the site or removing existing ones is as simple as including or removing the user from the Administrators role.</span></span> <span data-ttu-id="b48a5-120">構成、宣言型マークアップ、またはコードの変更は必要ありません。</span><span class="sxs-lookup"><span data-stu-id="b48a5-120">No configuration, declarative markup, or code changes are necessary.</span></span>

<span data-ttu-id="b48a5-121">ASP.NET には、ロールの定義とユーザー アカウントに関連付けるロール フレームワークが用意されています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-121">ASP.NET offers a Roles framework for defining roles and associating them with user accounts.</span></span> <span data-ttu-id="b48a5-122">ロールを作成してロールを削除、フレームワークでは、または削除するユーザー ロールから特定のロールに属しているし、ユーザーが特定のロールに属しているかどうかを通知するユーザーのセットを決定するユーザーを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-122">With the Roles framework we can create and delete roles, add users to or remove users from a role, determine the set of users that belong to a particular role, and tell whether a user belongs to a particular role.</span></span> <span data-ttu-id="b48a5-123">ロール フレームワークを構成すると、お URL 承認規則経由での役割の役割ごとにページへのアクセスを制限し、表示と非表示追加情報や、現在ログオンしているユーザーの役割に基づいた ページで機能します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-123">Once the Roles framework has been configured, we can limit access to pages on a role-by-role basis through URL authorization rules and show or hide additional information or functionality on a page based on the currently logged on user's roles.</span></span>

<span data-ttu-id="b48a5-124">このチュートリアルでは、ロールのフレームワークを構成するために必要な手順について説明します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-124">This tutorial examines the steps necessary for configuring the Roles framework.</span></span> <span data-ttu-id="b48a5-125">次は、web ページを作成し、ロールの削除を構築します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-125">Following that, we will build web pages to create and delete roles.</span></span> <span data-ttu-id="b48a5-126"><a id="_msoanchor_2"> </a> [*ロールをユーザーに割り当てる*](assigning-roles-to-users-cs.md)チュートリアルを追加およびロールからユーザーを削除する方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-126">In the <a id="_msoanchor_2"></a>[*Assigning Roles to Users*](assigning-roles-to-users-cs.md) tutorial we will look at how to add and remove users from roles.</span></span> <span data-ttu-id="b48a5-127">および、 <a id="_msoanchor_3"> </a> [*ロールベース承認*](role-based-authorization-cs.md)チュートリアル ページ機能によってを調整する方法と共にの役割の役割ごとにページへのアクセスを制限する方法が表示されますアクセスしたユーザーのロール。</span><span class="sxs-lookup"><span data-stu-id="b48a5-127">And in the <a id="_msoanchor_3"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will see how to limit access to pages on a role-by-role basis along with how to adjust page functionality depending on the visiting user's role.</span></span> <span data-ttu-id="b48a5-128">開始しましょう!</span><span class="sxs-lookup"><span data-stu-id="b48a5-128">Let's get started!</span></span>

## <a name="step-1-adding-new-aspnet-pages"></a><span data-ttu-id="b48a5-129">手順 1: 新規の ASP.NET ページの追加</span><span class="sxs-lookup"><span data-stu-id="b48a5-129">Step 1: Adding New ASP.NET Pages</span></span>

<span data-ttu-id="b48a5-130">このチュートリアルで次の 2 つお検査さまざまなロール関連の機能と機能します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-130">In this tutorial and the next two we will be examining various roles-related functions and capabilities.</span></span> <span data-ttu-id="b48a5-131">一連のトピックでは、これらのチュートリアル全体で検証を実装する ASP.NET ページが必要ですが。</span><span class="sxs-lookup"><span data-stu-id="b48a5-131">We will need a series of ASP.NET pages to implement the topics examined throughout these tutorials.</span></span> <span data-ttu-id="b48a5-132">これらのページを作成し、サイト マップを更新してみましょう。</span><span class="sxs-lookup"><span data-stu-id="b48a5-132">Let's create these pages and update the site map.</span></span>

<span data-ttu-id="b48a5-133">という名前のプロジェクトに新しいフォルダーを作成して開始`Roles`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-133">Start by creating a new folder in the project named `Roles`.</span></span> <span data-ttu-id="b48a5-134">次に、追加する 4 つの新しい ASP.NET ページ、`Roles`フォルダーで、各ページのリンク、`Site.master`マスター ページ。</span><span class="sxs-lookup"><span data-stu-id="b48a5-134">Next, add four new ASP.NET pages to the `Roles` folder, linking each page with the `Site.master` master page.</span></span> <span data-ttu-id="b48a5-135">ページの名前を付けます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-135">Name the pages:</span></span>

- `ManageRoles.aspx`
- `UsersAndRoles.aspx`
- `CreateUserWizardWithRoles.aspx`
- `RoleBasedAuthorization.aspx`

<span data-ttu-id="b48a5-136">この時点で、プロジェクトのソリューション エクスプ ローラーはのスクリーン ショット、図 1 に示すようになります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-136">At this point your project's Solution Explorer should look similar to the screen shot shown in Figure 1.</span></span>


<span data-ttu-id="b48a5-137">[![[ロール] フォルダーに 4 つの新しいページが追加されました](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-137">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image2.png)](creating-and-managing-roles-cs/_static/image1.png)</span></span>

<span data-ttu-id="b48a5-138">**図 1**: 次の 4 つ新しいページに追加されている、`Roles`フォルダー ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-138">**Figure 1**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image3.png))</span></span>


<span data-ttu-id="b48a5-139">各ページ、この時点では 2 つのコンテンツ コントロールは、マスター ページの contentplaceholders にごとに 1 つ:`MainContent`と`LoginContent`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-139">Each page should, at this point, have the two Content controls, one for each of the master page's ContentPlaceHolders: `MainContent` and `LoginContent`.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample1.aspx)]

<span data-ttu-id="b48a5-140">注意してください、 `LoginContent` ContentPlaceHolder の既定のマークアップにログオンするか、いったんログオフして、ユーザーが認証されるかどうかに応じて、サイトからへのリンクが表示されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-140">Recall that the `LoginContent` ContentPlaceHolder's default markup displays a link to log on or log off the site, depending on whether the user is authenticated.</span></span> <span data-ttu-id="b48a5-141">存在、`Content2`コンテンツ、ASP.NET ページ内のコントロールがただし、マスター ページの既定のマークアップをオーバーライドします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-141">The presence of the `Content2` Content control in the ASP.NET page, however, overrides the master page's default markup.</span></span> <span data-ttu-id="b48a5-142">説明したよう<a id="_msoanchor_4"> </a> [*フォーム認証の概要を*](../introduction/an-overview-of-forms-authentication-cs.md)チュートリアルでは、既定のマークアップをオーバーライドする、場所たくないを表示するログインに関連するページに便利です左の列にオプションです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-142">As we discussed in <a id="_msoanchor_4"></a>[*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-cs.md) tutorial, overriding the default markup is useful in pages where we do not want to display login-related options in the left column.</span></span>

<span data-ttu-id="b48a5-143">これら 4 つのページ、ただし、表示することのマスター ページの既定のマークアップ、 `LoginContent` ContentPlaceHolder です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-143">For these four pages, however, we want to show the master page's default markup for the `LoginContent` ContentPlaceHolder.</span></span> <span data-ttu-id="b48a5-144">このため、削除の宣言型マークアップ、`Content2`コンテンツ コントロールです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-144">Therefore, remove the declarative markup for the `Content2` Content control.</span></span> <span data-ttu-id="b48a5-145">その後、1 つだけのコンテンツ コントロールを含めるそれぞれ 4 つのページのマークアップの必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-145">After doing so, each of the four page's markup should contain just one Content control.</span></span>

<span data-ttu-id="b48a5-146">最後に、サイト マップを更新してみましょう (`Web.sitemap`) にこれらの新しい web ページが含まれます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-146">Finally, let's update the site map (`Web.sitemap`) to include these new web pages.</span></span> <span data-ttu-id="b48a5-147">後に次の XML を追加、`<siteMapNode>`メンバーシップ チュートリアルについては、追加しました。</span><span class="sxs-lookup"><span data-stu-id="b48a5-147">Add the following XML after the `<siteMapNode>` we added for the Membership tutorials.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample2.xml)]

<span data-ttu-id="b48a5-148">更新されたサイト マップには、ブラウザーを使用してサイトを参照してください。</span><span class="sxs-lookup"><span data-stu-id="b48a5-148">With the site map updated, visit the site through a browser.</span></span> <span data-ttu-id="b48a5-149">図 2 では、左側のナビゲーションには、ロール チュートリアルについては、アイテムが含まれます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-149">As Figure 2 shows, the navigation on the left now includes items for the Roles tutorials.</span></span>


<span data-ttu-id="b48a5-150">[![[ロール] フォルダーに 4 つの新しいページが追加されました](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-150">[![Four New Pages Have Been Added to the Roles Folder](creating-and-managing-roles-cs/_static/image5.png)](creating-and-managing-roles-cs/_static/image4.png)</span></span>

<span data-ttu-id="b48a5-151">**図 2**: 次の 4 つ新しいページに追加されている、`Roles`フォルダー ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-151">**Figure 2**: Four New Pages Have Been Added to the `Roles` Folder  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image6.png))</span></span>


## <a name="step-2-specifying-and-configuring-the-roles-framework-provider"></a><span data-ttu-id="b48a5-152">手順 2: を指定して、ロール Framework プロバイダーの構成</span><span class="sxs-lookup"><span data-stu-id="b48a5-152">Step 2: Specifying and Configuring the Roles Framework Provider</span></span>

<span data-ttu-id="b48a5-153">メンバーシップ フレームワークと同様にロール フレームワークはプロバイダー モデルの上に構築されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-153">Like the Membership framework, the Roles framework is built atop the provider model.</span></span> <span data-ttu-id="b48a5-154">説明したように、 <a id="_msoanchor_5"> </a> [*セキュリティの基礎と ASP.NET サポート*](../introduction/security-basics-and-asp-net-support-cs.md)チュートリアルでは、次の 3 つの組み込みのロール プロバイダーが付属して .NET Framework: [ `AuthorizationStoreRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx)、 [ `WindowsTokenRoleProvider` ](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx)、および[ `SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-154">As discussed in the <a id="_msoanchor_5"></a>[*Security Basics and ASP.NET Support*](../introduction/security-basics-and-asp-net-support-cs.md) tutorial, the .NET Framework ships with three built-in Roles providers: [`AuthorizationStoreRoleProvider`](https://msdn.microsoft.com/library/system.web.security.authorizationstoreroleprovider.aspx), [`WindowsTokenRoleProvider`](https://msdn.microsoft.com/library/system.web.security.windowstokenroleprovider.aspx), and [`SqlRoleProvider`](https://msdn.microsoft.com/library/system.web.security.sqlroleprovider.aspx).</span></span> <span data-ttu-id="b48a5-155">このチュートリアルのシリーズについて重点的に、 `SqlRoleProvider`、ロール ストアとして、Microsoft SQL Server データベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-155">This tutorial series focuses on the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span>

<span data-ttu-id="b48a5-156">背後のロール フレームワークと`SqlRoleProvider`メンバーシップ framework と同じように動作し、`SqlMembershipProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-156">Underneath the covers the Roles framework and `SqlRoleProvider` work just like the Membership framework and `SqlMembershipProvider`.</span></span> <span data-ttu-id="b48a5-157">.NET Framework には、`Roles`ロール フレームワーク API として機能するクラス。</span><span class="sxs-lookup"><span data-stu-id="b48a5-157">The .NET Framework contains a `Roles` class that serves as the API to the Roles framework.</span></span> <span data-ttu-id="b48a5-158">`Roles`クラスには静的メソッドと同様に`CreateRole`、 `DeleteRole`、 `GetAllRoles`、 `AddUserToRole`、`IsUserInRole`などのようにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-158">The `Roles` class has static methods like `CreateRole`, `DeleteRole`, `GetAllRoles`, `AddUserToRole`, `IsUserInRole`, and so forth.</span></span> <span data-ttu-id="b48a5-159">これらのメソッドのいずれかが呼び出されると、`Roles`クラスが構成されているプロバイダーへの呼び出しを代行します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-159">When one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="b48a5-160">`SqlRoleProvider`役割に固有のテーブルで機能 (`aspnet_Roles`と`aspnet_UsersInRoles`) で応答します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-160">The `SqlRoleProvider` works with the role-specific tables (`aspnet_Roles` and `aspnet_UsersInRoles`) in response.</span></span>

<span data-ttu-id="b48a5-161">使用するために、`SqlRoleProvider`プロバイダー アプリケーションでは、ストアとして使用するデータベースの内容を指定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-161">In order to use the `SqlRoleProvider` provider in our application, we need to specify what database to use as the store.</span></span> <span data-ttu-id="b48a5-162">`SqlRoleProvider`特定のデータベース テーブル、ビュー、およびストアド プロシージャに指定されたロール ストアが必要です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-162">The `SqlRoleProvider` expects the specified role store to have certain database tables, views, and stored procedures.</span></span> <span data-ttu-id="b48a5-163">使用してこれらの必要なデータベース オブジェクトを追加することができます、 [ `aspnet_regsql.exe`ツール](https://msdn.microsoft.com/library/ms229862.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-163">These requisite database objects can be added using the [`aspnet_regsql.exe` tool](https://msdn.microsoft.com/library/ms229862.aspx).</span></span> <span data-ttu-id="b48a5-164">この時点で既にデータベースがあるために必要なスキーマを持つ、`SqlRoleProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-164">At this point we already have a database with the schema necessary for the `SqlRoleProvider`.</span></span> <span data-ttu-id="b48a5-165">戻り、 <a id="_msoanchor_6"> </a> [*メンバーシップ スキーマを作成する SQL Server で*](../membership/creating-the-membership-schema-in-sql-server-cs.md)という名前のデータベースを作成したチュートリアル`SecurityTutorials.mdf`使用`aspnet_regsql.exe`アプリケーションを追加サービスに必要なデータベース オブジェクトが含まれている、`SqlRoleProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-165">Back in the <a id="_msoanchor_6"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial we created a database named `SecurityTutorials.mdf` and used `aspnet_regsql.exe` to add the application services, which included the database objects required by the `SqlRoleProvider`.</span></span> <span data-ttu-id="b48a5-166">したがってだけいただくために使用するロールのサポートを有効にして、ロール フレームワーク、`SqlRoleProvider`で、`SecurityTutorials.mdf`ロール ストアとしてのデータベースです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-166">Therefore we just need to tell the Roles framework to enable role support and to use the `SqlRoleProvider` with the `SecurityTutorials.mdf` database as the role store.</span></span>

<span data-ttu-id="b48a5-167">使用して役割、フレームワークが構成されている、 &lt; `roleManager` &gt;アプリケーションの要素`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="b48a5-167">The Roles framework is configured via the &lt;`roleManager`&gt; element in the application's `Web.config` file.</span></span> <span data-ttu-id="b48a5-168">既定では、ロールのサポートは無効です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-168">By default, role support is disabled.</span></span> <span data-ttu-id="b48a5-169">有効にするに設定する必要があります、 [ &lt; `roleManager` &gt; ](https://msdn.microsoft.com/library/ms164660.aspx)要素の`enabled`属性を`true`次のようにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-169">To enable it, you must set the [&lt;`roleManager`&gt;](https://msdn.microsoft.com/library/ms164660.aspx) element's `enabled` attribute to `true` like so:</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample3.xml)]

<span data-ttu-id="b48a5-170">既定では、すべての web アプリケーションがあるという名前のロール プロバイダー`AspNetSqlRoleProvider`型の`SqlRoleProvider`します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-170">By default, all web applications have a Roles provider named `AspNetSqlRoleProvider` of type `SqlRoleProvider`.</span></span> <span data-ttu-id="b48a5-171">この既定のプロバイダーが登録されている`machine.config`(にある`%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`)。</span><span class="sxs-lookup"><span data-stu-id="b48a5-171">This default provider is registered in `machine.config` (located at `%WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG`):</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample4.xml)]

<span data-ttu-id="b48a5-172">プロバイダーの`connectionStringName`属性が使用されるロール ストアを指定します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-172">The provider's `connectionStringName` attribute specifies the role store that is used.</span></span> <span data-ttu-id="b48a5-173">`AspNetSqlRoleProvider`プロバイダーでは、この属性を設定`LocalSqlServer`でも定義されている`machine.config`と既定では、SQL Server 2005 Express Edition のデータベースに、ポイント、`App_Data`という名前のフォルダー`aspnet.mdf`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-173">The `AspNetSqlRoleProvider` provider sets this attribute to `LocalSqlServer`, which is also defined in `machine.config` and points, by default, to a SQL Server 2005 Express Edition database in the `App_Data` folder named `aspnet.mdf`.</span></span>

<span data-ttu-id="b48a5-174">その結果、おだけを有効にするロール framework アプリケーションでの任意のプロバイダー情報を指定しない場合`Web.config`ファイル、アプリケーションが登録されている既定のロール プロバイダーを使用して`AspNetSqlRoleProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-174">Consequently, if we simply enable the Roles framework without specifying any provider information in our application's `Web.config` file, the application uses the default registered Roles provider, `AspNetSqlRoleProvider`.</span></span> <span data-ttu-id="b48a5-175">場合、`~/App_Data/aspnet.mdf`データベースが存在しないか、ASP.NET ランタイムが自動的に作成し、アプリケーションのサービス スキーマを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-175">If the `~/App_Data/aspnet.mdf` database does not exist, the ASP.NET runtime will automatically create it and add the application services schema.</span></span> <span data-ttu-id="b48a5-176">ただし、ここを使用しない、`aspnet.mdf`データベース; を使用する代わりに、`SecurityTutorials.mdf`データベースを既に作成して、アプリケーションのサービス スキーマを追加しました。</span><span class="sxs-lookup"><span data-stu-id="b48a5-176">However, we don't want to use the `aspnet.mdf` database; rather, we want to use the `SecurityTutorials.mdf` database that we have already created and added the application services schema to.</span></span> <span data-ttu-id="b48a5-177">この変更は、2 つの方法のいずれかで実行できます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-177">This modification can be accomplished in one of two ways:</span></span>

- <span data-ttu-id="b48a5-178"><strong>値を指定、</strong><strong>`LocalSqlServer`</strong><strong>での接続文字列名</strong><strong>`Web.config`</strong><strong>です。</strong></span><span class="sxs-lookup"><span data-stu-id="b48a5-178"><strong>Specify a value for the</strong><strong>`LocalSqlServer`</strong><strong>connection string name in</strong><strong>`Web.config`</strong><strong>.</strong></span></span> <span data-ttu-id="b48a5-179">上書きすることによって、`LocalSqlServer`の接続文字列名値`Web.config`は登録されている既定のロール プロバイダーを使用することができます (`AspNetSqlRoleProvider`) で正しく動作させることが、`SecurityTutorials.mdf`データベース。</span><span class="sxs-lookup"><span data-stu-id="b48a5-179">By overwriting the `LocalSqlServer` connection string name value in `Web.config`, we can use the default registered Roles provider (`AspNetSqlRoleProvider`) and have it correctly work with the `SecurityTutorials.mdf` database.</span></span> <span data-ttu-id="b48a5-180">この方法の詳細については、次を参照してください。 [Scott Guthrie](https://weblogs.asp.net/scottgu/)のブログ投稿「[を使用して SQL Server 2000 または SQL Server 2005 に ASP.NET 2.0 アプリケーション サービスを構成する](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-180">For more information on this technique, see [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog post, [Configuring ASP.NET 2.0 Application Services to Use SQL Server 2000 or SQL Server 2005](https://weblogs.asp.net/scottgu/archive/2005/08/25/423703.aspx).</span></span>
- <span data-ttu-id="b48a5-181"><strong>型の場合は、新しい登録済みプロバイダーの追加</strong><strong>`SqlRoleProvider`</strong><strong>構成とその</strong><strong>`connectionStringName`</strong><strong>をポイントする設定</strong><strong>`SecurityTutorials.mdf`</strong><strong>データベース。</strong></span><span class="sxs-lookup"><span data-stu-id="b48a5-181"><strong>Add a new registered provider of type</strong><strong>`SqlRoleProvider`</strong><strong>and configure its</strong><strong>`connectionStringName`</strong><strong>setting to point to the</strong><strong>`SecurityTutorials.mdf`</strong><strong>database.</strong></span></span> <span data-ttu-id="b48a5-182">これは、ことをお勧めしてで使用される方法は、 <a id="_msoanchor_7"> </a> [*メンバーシップ スキーマを作成する SQL Server で*](../membership/creating-the-membership-schema-in-sql-server-cs.md)チュートリアルでは、これはもこのチュートリアルで使用するアプローチです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-182">This is the approach I recommended and used in the <a id="_msoanchor_7"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-cs.md) tutorial, and it is the approach I will use in this tutorial as well.</span></span>

<span data-ttu-id="b48a5-183">次の役割の構成のマークアップを追加、`Web.config`ファイル。</span><span class="sxs-lookup"><span data-stu-id="b48a5-183">Add the following Roles configuration markup to the `Web.config` file.</span></span> <span data-ttu-id="b48a5-184">このマークアップという名前の新しいプロバイダーを登録する`SecurityTutorialsSqlRoleProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-184">This markup registers a new provider named `SecurityTutorialsSqlRoleProvider`.</span></span>

[!code-xml[Main](creating-and-managing-roles-cs/samples/sample5.xml)]

<span data-ttu-id="b48a5-185">上記のマークアップを定義、`SecurityTutorialsSqlRoleProvider`既定のプロバイダーとして (を使用して、`defaultProvider`属性、`<roleManager>`要素)。</span><span class="sxs-lookup"><span data-stu-id="b48a5-185">The above markup defines the `SecurityTutorialsSqlRoleProvider` as the default provider (via the `defaultProvider` attribute in the `<roleManager>` element).</span></span> <span data-ttu-id="b48a5-186">また、設定、`SecurityTutorialsSqlRoleProvider`の`applicationName`設定`SecurityTutorials`、これは同じ`applicationName`メンバーシップ プロバイダーによって使用される設定 (`SecurityTutorialsSqlMembershipProvider`)。</span><span class="sxs-lookup"><span data-stu-id="b48a5-186">It also sets the `SecurityTutorialsSqlRoleProvider`'s `applicationName` setting to `SecurityTutorials`, which is the same `applicationName` setting used by the Membership provider (`SecurityTutorialsSqlMembershipProvider`).</span></span> <span data-ttu-id="b48a5-187">ここでは、表示されません中に、 [ `<add>`要素](https://msdn.microsoft.com/library/ms164662.aspx)の`SqlRoleProvider`含まれることも、`commandTimeout`データベース タイムアウト期間を秒単位で指定する属性。</span><span class="sxs-lookup"><span data-stu-id="b48a5-187">While not shown here, the [`<add>` element](https://msdn.microsoft.com/library/ms164662.aspx) for the `SqlRoleProvider` may also contain a `commandTimeout` attribute to specify the database timeout duration, in seconds.</span></span> <span data-ttu-id="b48a5-188">既定値は 30 です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-188">The default value is 30.</span></span>

<span data-ttu-id="b48a5-189">この構成には、インプレースのマークアップが、アプリケーション内でロール機能の使用を開始する準備が整いました。</span><span class="sxs-lookup"><span data-stu-id="b48a5-189">With this configuration markup in place, we are ready to start using role functionality within our application.</span></span>

> [!NOTE]
> <span data-ttu-id="b48a5-190">使用して上記の構成のマークアップを示しています、 &lt; `roleManager` &gt;要素の`enabled`と`defaultProvider`属性。</span><span class="sxs-lookup"><span data-stu-id="b48a5-190">The above configuration markup illustrates using the &lt;`roleManager`&gt; element's `enabled` and `defaultProvider` attributes.</span></span> <span data-ttu-id="b48a5-191">ロール framework がユーザーによってごとにロール情報を関連付ける方法に影響するその他の属性の数があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-191">There are a number of other attributes that affect how the Roles framework associates role information on a user-by-user basis.</span></span> <span data-ttu-id="b48a5-192">これらの設定で見ていきます、 <a id="_msoanchor_8"> </a> [*ロールベース承認*](role-based-authorization-cs.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-192">We will examine these settings in the <a id="_msoanchor_8"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial.</span></span>


## <a name="step-3-examining-the-roles-api"></a><span data-ttu-id="b48a5-193">手順 3: API の役割を確認します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-193">Step 3: Examining the Roles API</span></span>

<span data-ttu-id="b48a5-194">ロール フレームワークの機能がを介して公開される、 [ `Roles`クラス](https://msdn.microsoft.com/library/system.web.security.roles.aspx)役割に基づいた操作を実行するため、13 個の静的メソッドが含まれています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-194">The Roles framework's functionality is exposed via the [`Roles` class](https://msdn.microsoft.com/library/system.web.security.roles.aspx), which contains thirteen static methods for performing role-based operations.</span></span> <span data-ttu-id="b48a5-195">ときに作成および手順 4. でロールを削除する見るし、6 を使用、 [ `CreateRole` ](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx)と[ `DeleteRole` ](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx)メソッドを追加またはロールをシステムから削除します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-195">When we look at creating and deleting roles in Steps 4 and 6 we will use the [`CreateRole`](https://msdn.microsoft.com/library/system.web.security.roles.createrole.aspx) and [`DeleteRole`](https://msdn.microsoft.com/library/system.web.security.roles.deleterole.aspx) methods, which add or remove a role from the system.</span></span>

<span data-ttu-id="b48a5-196">システム内のすべての役割の一覧を取得する、 [ `GetAllRoles`メソッド](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx)(手順 5. を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="b48a5-196">To get a list of all of the roles in the system, use the [`GetAllRoles` method](https://msdn.microsoft.com/library/system.web.security.roles.getallroles.aspx) (see Step 5).</span></span> <span data-ttu-id="b48a5-197">[ `RoleExists`メソッド](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx)指定されたロールが存在するかどうかを示すブール値を返します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-197">The [`RoleExists` method](https://msdn.microsoft.com/library/system.web.security.roles.roleexists.aspx) returns a Boolean value indicating whether a specified role exists.</span></span>

<span data-ttu-id="b48a5-198">次のチュートリアルでは、ユーザー ロールに関連付ける方法について調べます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-198">In the next tutorial we will examine how to associate users with roles.</span></span> <span data-ttu-id="b48a5-199">`Roles`クラスの[ `AddUserToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx)、 [ `AddUserToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx)、 [ `AddUsersToRole` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx)、および[ `AddUsersToRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx)メソッドは、1 つまたは複数のユーザーを 1 つまたは複数のロールに追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-199">The `Roles` class's [`AddUserToRole`](https://msdn.microsoft.com/library/system.web.security.roles.addusertorole.aspx), [`AddUserToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.addusertoroles.aspx), [`AddUsersToRole`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstorole.aspx), and [`AddUsersToRoles`](https://msdn.microsoft.com/library/system.web.security.roles.adduserstoroles.aspx) methods add one or more users to one or more roles.</span></span> <span data-ttu-id="b48a5-200">ユーザー ロールから削除するを使用して、 [ `RemoveUserFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx)、 [ `RemoveUserFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx)、 [ `RemoveUsersFromRole` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx)、または[ `RemoveUsersFromRoles` ](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx)メソッド。</span><span class="sxs-lookup"><span data-stu-id="b48a5-200">To remove users from roles, use the [`RemoveUserFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromrole.aspx), [`RemoveUserFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeuserfromroles.aspx), [`RemoveUsersFromRole`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromrole.aspx), or [`RemoveUsersFromRoles`](https://msdn.microsoft.com/library/system.web.security.roles.removeusersfromroles.aspx) methods.</span></span>

<span data-ttu-id="b48a5-201"><a id="_msoanchor_9"> </a> [*ロールベース承認*](role-based-authorization-cs.md)チュートリアル プログラムで非表示機能、現在ログインしているユーザーの役割に基づいた方法を紹介します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-201">In the <a id="_msoanchor_9"></a>[*Role-Based Authorization*](role-based-authorization-cs.md) tutorial we will look at ways to programmatically show or hide functionality based on the currently logged in user's role.</span></span> <span data-ttu-id="b48a5-202">これを行うには、使用、`Role`クラスの[ `FindUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx)、 [ `GetRolesForUser` ](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx)、 [ `GetUsersInRole` ](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx)、または[ `IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx)メソッドです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-202">To accomplish this, we can use the `Role` class's [`FindUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.findusersinrole.aspx), [`GetRolesForUser`](https://msdn.microsoft.com/library/system.web.security.roles.getrolesforuser.aspx), [`GetUsersInRole`](https://msdn.microsoft.com/library/system.web.security.roles.getusersinrole.aspx), or [`IsUserInRole`](https://msdn.microsoft.com/library/system.web.security.roles.isuserinrole.aspx) methods.</span></span>

> [!NOTE]
> <span data-ttu-id="b48a5-203">これらのメソッドのいずれかが呼び出されることに注意してください、`Roles`クラスが構成されているプロバイダーへの呼び出しを代行します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-203">Keep in mind that any time one of these methods is invoked, the `Roles` class delegates the call to the configured provider.</span></span> <span data-ttu-id="b48a5-204">ここではつまり、呼び出しに送信されている、`SqlRoleProvider`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-204">In our case, this means that the call is being sent to the `SqlRoleProvider`.</span></span> <span data-ttu-id="b48a5-205">`SqlRoleProvider`呼び出されたメソッドに基づく適切なデータベース操作を実行します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-205">The `SqlRoleProvider` then performs the appropriate database operation based on the invoked method.</span></span> <span data-ttu-id="b48a5-206">たとえば、コード`Roles.CreateRole("Administrators")`結果、`SqlRoleProvider`を実行する、`aspnet_Roles_CreateRole`に新しいレコードを挿入するプロシージャが格納されている、`aspnet_Roles`管理者という名前のテーブルです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-206">For example, the code `Roles.CreateRole("Administrators")` results in the `SqlRoleProvider` executing the `aspnet_Roles_CreateRole` stored procedure, which inserts a new record into the `aspnet_Roles` table named Administrators .</span></span>


<span data-ttu-id="b48a5-207">このチュートリアルの残りの部分参照を使用して、`Roles`クラスの`CreateRole`、 `GetAllRoles`、および`DeleteRole`システムの役割を管理する方法です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-207">The remainder of this tutorial looks at using the `Roles` class's `CreateRole`, `GetAllRoles`, and `DeleteRole` methods to manage the roles in the system.</span></span>

## <a name="step-4-creating-new-roles"></a><span data-ttu-id="b48a5-208">手順 4: 新しいロールの作成</span><span class="sxs-lookup"><span data-stu-id="b48a5-208">Step 4: Creating New Roles</span></span>

<span data-ttu-id="b48a5-209">ロールを任意のグループのユーザーを使用して、承認規則を適用する方が便利な方法をこのグループ化を使用する最も一般的です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-209">Roles offer a way to arbitrarily group users, and most commonly this grouping is used for a more convenient way to apply authorization rules.</span></span> <span data-ttu-id="b48a5-210">最初に、アプリケーション内にあるロールを定義する必要がありますの認証メカニズムとしての役割を使用するためにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-210">But in order to use roles as an authorization mechanism we first need to define what roles exist in the application.</span></span> <span data-ttu-id="b48a5-211">残念ながら、ASP.NET では、CreateRoleWizard コントロールは含まれません。</span><span class="sxs-lookup"><span data-stu-id="b48a5-211">Unfortunately, ASP.NET does not include a CreateRoleWizard control.</span></span> <span data-ttu-id="b48a5-212">新しいロールを追加するのには、適切なユーザー インターフェイスを作成し、社内でロール API を呼び出す必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-212">In order to add new roles we need to create a suitable user interface and invoke the Roles API ourselves.</span></span> <span data-ttu-id="b48a5-213">良いニュースは、これは、非常に簡単に実行します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-213">The good news is that this is very easy to accomplish.</span></span>

> [!NOTE]
> <span data-ttu-id="b48a5-214">CreateRoleWizard Web コントロールはありませんが、 [ASP.NET Web サイト管理ツール](https://msdn.microsoft.com/library/ms228053.aspx)、これは、ローカルの ASP.NET アプリケーションを表示して、web アプリケーションの構成の管理を支援するように設計します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-214">While there is no CreateRoleWizard Web control, there is the [ASP.NET Web Site Administration Tool](https://msdn.microsoft.com/library/ms228053.aspx), which is a local ASP.NET application designed to assist with viewing and managing your web application's configuration.</span></span> <span data-ttu-id="b48a5-215">ただし、私はいない 2 つの理由の大好きな ASP.NET Web サイト管理ツールです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-215">However, I am not a big fan of the ASP.NET Web Site Administration Tool for two reasons.</span></span> <span data-ttu-id="b48a5-216">最初に、少しバグであるし、ユーザー エクスペリエンスが必要なことはたくさんのままにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-216">First, it is a bit buggy and the user experience leaves a lot to be desired.</span></span> <span data-ttu-id="b48a5-217">次に、ASP.NET Web サイト管理ツールは設計されていますローカルでのみ動作する実際のサイトの役割をリモートで管理する必要がある場合、独自のロールの管理 web ページを構築する必要があることを意味します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-217">Second, the ASP.NET Web Site Administration Tool is designed to only work locally, meaning that you will have to build your own role management web pages if you need to manage roles on a live site remotely.</span></span> <span data-ttu-id="b48a5-218">これら 2 つの理由から、このチュートリアルと、次へは焦点 ASP.NET Web サイト管理ツールで証明書利用者のではなく、必要なロール、web ページで、管理ツールを構築します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-218">For these two reasons, this tutorial and the next will focus on building the necessary role management tools in a web page rather than relying on the ASP.NET Web Site Administration Tool.</span></span>


<span data-ttu-id="b48a5-219">開く、 `ManageRoles.aspx`  ページで、`Roles`フォルダーと、ページにテキスト ボックスとボタンの Web コントロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-219">Open the `ManageRoles.aspx` page in the `Roles` folder and add a TextBox and a Button Web control to the page.</span></span> <span data-ttu-id="b48a5-220">TextBox コントロールの設定`ID`プロパティを`RoleName`とボタンの`ID`と`Text`プロパティ`CreateRoleButton`とロールの作成、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-220">Set the TextBox control's `ID` property to `RoleName` and the Button's `ID` and `Text` properties to `CreateRoleButton` and Create Role, respectively.</span></span> <span data-ttu-id="b48a5-221">この時点では、ページの宣言型マークアップは、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-221">At this point, your page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample6.aspx)]

<span data-ttu-id="b48a5-222">次をダブルクリックして、`CreateRoleButton`ボタン コントロールを作成するデザイナーで、`Click`イベント ハンドラーし、次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-222">Next, double-click the `CreateRoleButton` Button control in the Designer to create a `Click` event handler and then add the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample7.cs)]

<span data-ttu-id="b48a5-223">上記のコードを開始で入力したトリミングされたロール名を割り当てることによって、`RoleName`するテキスト ボックス、`newRoleName`変数。</span><span class="sxs-lookup"><span data-stu-id="b48a5-223">The above code starts by assigning the trimmed role name entered in the `RoleName` TextBox to the `newRoleName` variable.</span></span> <span data-ttu-id="b48a5-224">次に、`Roles`クラスの`RoleExists`かどうかをメソッドが呼び出されたロール`newRoleName`システムに既に存在します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-224">Next, the `Roles` class's `RoleExists` method is called to determine if the role `newRoleName` already exists in the system.</span></span> <span data-ttu-id="b48a5-225">ロールが存在しない場合への呼び出しを使用して作成、`CreateRole`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-225">If the role does not exist, it is created via a call to the `CreateRole` method.</span></span> <span data-ttu-id="b48a5-226">場合、`CreateRole`メソッドは、システムに既に存在するロール名が渡される、`ProviderException`例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-226">If the `CreateRole` method is passed a role name that already exists in the system, a `ProviderException` exception is thrown.</span></span> <span data-ttu-id="b48a5-227">これは、ため、コードは、ロールが存在しないように既に呼び出す前に、システムでまず`CreateRole`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-227">This is why the code first checks to ensure that the role does not already exist in the system before calling `CreateRole`.</span></span> <span data-ttu-id="b48a5-228">`Click`をクリアするイベント ハンドラーの終了、`RoleName`テキスト ボックスの`Text`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-228">The `Click` event handler concludes by clearing out the `RoleName` TextBox's `Text` property.</span></span>

> [!NOTE]
> <span data-ttu-id="b48a5-229">思うかもしれません何が起こるかユーザーに任意の値を入力しない場合、 `RoleName`  テキスト ボックス。</span><span class="sxs-lookup"><span data-stu-id="b48a5-229">You may be wondering what will happen if the user doesn't enter any value into the `RoleName` TextBox.</span></span> <span data-ttu-id="b48a5-230">値が渡された場合、`CreateRole`メソッドは`null`空の文字列、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-230">If the value passed into the `CreateRole` method is `null` or an empty string, an exception is raised.</span></span> <span data-ttu-id="b48a5-231">同様に、ロール名にコンマが含まれている場合、例外が発生します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-231">Likewise, if the role name contains a comma an exception is raised.</span></span> <span data-ttu-id="b48a5-232">そのため、ページには、ユーザーは、ロールの入力をコンマが含まれていないことを確認する検証コントロールを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-232">Consequently, the page should contain validation controls to ensure that the user enters a role and that it does not contain any commas.</span></span> <span data-ttu-id="b48a5-233">私は、リーダーの課題としてままにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-233">I leave as an exercise for the reader.</span></span>


<span data-ttu-id="b48a5-234">管理者をという名前のロールを作成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="b48a5-234">Let's create a role named Administrators.</span></span> <span data-ttu-id="b48a5-235">参照してください、`ManageRoles.aspx`ブラウザーを使って ページで、管理者に、テキスト ボックスに入力 (図 3 を参照)、ロールの作成ボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-235">Visit the `ManageRoles.aspx` page through a browser, type in Administrators into the textbox (see Figure 3), and then click the Create Role button.</span></span>


<span data-ttu-id="b48a5-236">[![管理者ロールを作成します。](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-236">[![Create an Administrators Role](creating-and-managing-roles-cs/_static/image8.png)](creating-and-managing-roles-cs/_static/image7.png)</span></span>

<span data-ttu-id="b48a5-237">**図 3**: 管理者の役割を作成 ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-237">**Figure 3**: Create an Administrators Role  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image9.png))</span></span>


<span data-ttu-id="b48a5-238">どうなりますか。</span><span class="sxs-lookup"><span data-stu-id="b48a5-238">What happens?</span></span> <span data-ttu-id="b48a5-239">ポストバックが発生するがないを視覚的にロールがされて実際には、システムに追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-239">A postback occurs, but there's no visual cue that the role has actually been added to the system.</span></span> <span data-ttu-id="b48a5-240">このページを視覚的なフィードバックを含める手順 5 で更新されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-240">We will update this page in Step 5 to include visual feedback.</span></span> <span data-ttu-id="b48a5-241">ここでは、ただし、ことを確認するに移動して、ロールが作成されたこと、`SecurityTutorials.mdf`データベースとデータを表示する、`aspnet_Roles`テーブル。</span><span class="sxs-lookup"><span data-stu-id="b48a5-241">For now, however, you can verify that the role was created by going to the `SecurityTutorials.mdf` database and displaying the data from the `aspnet_Roles` table.</span></span> <span data-ttu-id="b48a5-242">図 4 に示す、`aspnet_Roles`テーブルには、単に追加された管理者の役割のレコードが含まれています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-242">As Figure 4 shows, the `aspnet_Roles` table contains a record for the just-added Administrators roles.</span></span>


<span data-ttu-id="b48a5-243">[![Aspnet_Roles テーブルは、管理者は、行を含む](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-243">[![The aspnet_Roles Table has a Row for the Administrators](creating-and-managing-roles-cs/_static/image11.png)](creating-and-managing-roles-cs/_static/image10.png)</span></span>

<span data-ttu-id="b48a5-244">**図 4**:`aspnet_Roles`テーブルには、管理者用の行 ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-244">**Figure 4**: The `aspnet_Roles` Table has a Row for the Administrators  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image12.png))</span></span>


## <a name="step-5-displaying-the-roles-in-the-system"></a><span data-ttu-id="b48a5-245">手順 5: システムの役割を表示します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-245">Step 5: Displaying the Roles in the System</span></span>

<span data-ttu-id="b48a5-246">みましょう補強、`ManageRoles.aspx`システムの現在のロールの一覧を挿入するページ。</span><span class="sxs-lookup"><span data-stu-id="b48a5-246">Let's augment the `ManageRoles.aspx` page to include a list of the current roles in the system.</span></span> <span data-ttu-id="b48a5-247">これを実現する GridView コントロールをページに追加し、設定、`ID`プロパティを`RoleList`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-247">To accomplish this, add a GridView control to the page and set its `ID` property to `RoleList`.</span></span> <span data-ttu-id="b48a5-248">という名前のページの分離コード クラスにメソッドを次に、追加`DisplayRolesInGrid`次のコードを使用します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-248">Next, add a method to the page's code-behind class named `DisplayRolesInGrid` using the following code:</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample8.cs)]

<span data-ttu-id="b48a5-249">`Roles`クラスの`GetAllRoles`メソッドのすべての役割のシステムとして返します文字列の配列。</span><span class="sxs-lookup"><span data-stu-id="b48a5-249">The `Roles` class's `GetAllRoles` method returns all of the roles in the system as an array of strings.</span></span> <span data-ttu-id="b48a5-250">この文字列の配列が GridView にバインドし、されています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-250">This string array is then bound to the GridView.</span></span> <span data-ttu-id="b48a5-251">ページが最初に読み込まれたときに、ロールの一覧を GridView にバインドする必要がありますを呼び出して、`DisplayRolesInGrid`メソッドから、ページの`Page_Load`イベント ハンドラー。</span><span class="sxs-lookup"><span data-stu-id="b48a5-251">In order to bind the list of roles to the GridView when the page is first loaded, we need to call the `DisplayRolesInGrid` method from the page's `Page_Load` event handler.</span></span> <span data-ttu-id="b48a5-252">次のコードは、ページが初めてアクセスしたときに、以降のポストバックではなく、このメソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-252">The following code calls this method when the page is first visited, but not on subsequent postbacks.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample9.cs)]

<span data-ttu-id="b48a5-253">配置でこのコードでは、ブラウザーでページを参照してください。</span><span class="sxs-lookup"><span data-stu-id="b48a5-253">With this code in place, visit the page through a browser.</span></span> <span data-ttu-id="b48a5-254">図 5 に示す項目ラベルの付いた 1 つの列をグリッドが表示されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-254">As Figure 5 shows, you should see a grid with a single column labeled Item.</span></span> <span data-ttu-id="b48a5-255">グリッドには、手順 4. で追加して、管理者ロールの行が含まれています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-255">The grid includes a row for the Administrators role we added in Step 4.</span></span>


<span data-ttu-id="b48a5-256">[![GridView は、1 つの列で、ロールを表示します。](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-256">[![The GridView Displays the Roles in a Single Column](creating-and-managing-roles-cs/_static/image14.png)](creating-and-managing-roles-cs/_static/image13.png)</span></span>

<span data-ttu-id="b48a5-257">**図 5**: GridView はの役割を 1 つの列に表示されます ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-257">**Figure 5**: The GridView Displays the Roles in a Single Column  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image15.png))</span></span>


<span data-ttu-id="b48a5-258">GridView ために、ラベルの付いた項目内の単一行の列を表示する GridView の`AutoGenerateColumns`プロパティが True (既定)、これにより、内の各プロパティの列を自動的に作成する GridView にその`DataSource`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-258">The GridView displays a lone column labeled Item because the GridView's `AutoGenerateColumns` property is set to True (the default), which causes the GridView to automatically create a column for each property in its `DataSource`.</span></span> <span data-ttu-id="b48a5-259">配列には、GridView で 1 つの列のため、配列内の要素を表す 1 つのプロパティがあります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-259">An array has a single property that represents the elements in the array, hence the single column in the GridView.</span></span>

<span data-ttu-id="b48a5-260">GridView にデータを表示するときに (_n) GridView によって暗黙的に生成されることがあるのではなく、明示的に列を定義します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-260">When displaying data with a GridView, I prefer to explicitly define my columns rather than have them implicitly generated by the GridView.</span></span> <span data-ttu-id="b48a5-261">によって、データの書式をはるかに簡単である列を明示的に定義するには、列を並べ替えるにし、その他の一般的なタスクを実行します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-261">By explicitly defining the columns it is much easier to format the data, rearrange the columns, and perform other common tasks.</span></span> <span data-ttu-id="b48a5-262">このため、みましょう更新 GridView の宣言型マークアップの列が明示的に定義できるようにします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-262">Therefore, let's update the GridView's declarative markup so that its columns are explicitly defined.</span></span>

<span data-ttu-id="b48a5-263">開始するには、GridView の`AutoGenerateColumns`プロパティを False にします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-263">Start by setting the GridView's `AutoGenerateColumns` property to False.</span></span> <span data-ttu-id="b48a5-264">次に、設定、TemplateField をグリッドに追加の`HeaderText`、ロールにプロパティを構成して、`ItemTemplate`配列の内容を表示するようです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-264">Next, add a TemplateField to the grid, set its `HeaderText` property to Roles, and configure its `ItemTemplate` so that it displays the contents of the array.</span></span> <span data-ttu-id="b48a5-265">これを実現する、という名前のラベルの Web コントロールを追加`RoleNameLabel`を`ItemTemplate`バインドとその`Text`プロパティを`Container.DataItem`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-265">To accomplish this, add a Label Web control named `RoleNameLabel` to the `ItemTemplate` and bind its `Text` property to `Container.DataItem`.</span></span>

<span data-ttu-id="b48a5-266">これらのプロパティと`ItemTemplate`の宣言またはにより GridView のフィールド] ダイアログ ボックスと [テンプレートの編集インターフェイス コンテンツを設定できます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-266">These properties and the `ItemTemplate`'s contents can be set declaratively or through the GridView's Fields dialog box and Edit Templates interface.</span></span> <span data-ttu-id="b48a5-267">フィールド ダイアログ ボックスが、接続するには、GridView のスマート タグの列の編集リンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-267">To reach the Fields dialog box, click the Edit Columns link in the GridView's Smart Tag.</span></span> <span data-ttu-id="b48a5-268">次に、自動生成を設定するフィールド のチェック ボックスをオフに、`AutoGenerateColumns`プロパティを False に設定、GridView に TemplateField を追加し、その`HeaderText`ロールにプロパティです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-268">Next, uncheck the Auto-generate fields checkbox to set the `AutoGenerateColumns` property to False, and add a TemplateField to the GridView, setting its `HeaderText` property to Role.</span></span> <span data-ttu-id="b48a5-269">定義する、`ItemTemplate`の内容が GridView のスマート タグからテンプレートの編集オプションを選択します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-269">To define the `ItemTemplate`'s contents, choose the Edit Templates option from the GridView's Smart Tag.</span></span> <span data-ttu-id="b48a5-270">上にラベル Web コントロールをドラッグ、`ItemTemplate`設定、その`ID`プロパティを`RoleNameLabel`、し、データ バインド設定を構成できるようにその`Text`プロパティにバインド`Container.DataItem`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-270">Drag a Label Web control onto the `ItemTemplate`, set its `ID` property to `RoleNameLabel`, and configure its databinding settings so that its `Text` property is bound to `Container.DataItem`.</span></span>

<span data-ttu-id="b48a5-271">使用するどのような方法に関係なく、GridView の宣言型マークアップの結果として得られるようになります次が完了したらです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-271">Regardless of what approach you use, the GridView's resulting declarative markup should look similar to the following when you are done.</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample10.aspx)]

> [!NOTE]
> <span data-ttu-id="b48a5-272">データ バインド構文を使用して、配列の内容が表示される`<%# Container.DataItem %>`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-272">The array's contents are displayed using the databinding syntax `<%# Container.DataItem %>`.</span></span> <span data-ttu-id="b48a5-273">配列の内容を表示する GridView にバインドされている場合にこの構文を使用する理由の詳細な説明についてはこのチュートリアルの範囲外です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-273">A thorough description of why this syntax is used when displaying the contents of an array bound to the GridView is beyond the scope of this tutorial.</span></span> <span data-ttu-id="b48a5-274">この問題の詳細についてを参照してください[データ Web コントロールへのスカラー配列のバインド](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-274">For more information on this matter, refer to [Binding a Scalar Array to a Data Web Control](http://aspnet.4guysfromrolla.com/articles/082504-1.aspx).</span></span>


<span data-ttu-id="b48a5-275">現時点では、 `RoleList` GridView は、ページが初めてアクセスしたときに、のみの役割の一覧にバインドします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-275">Currently, the `RoleList` GridView is only bound to the list of roles when the page is first visited.</span></span> <span data-ttu-id="b48a5-276">新しいロールを追加するたびに、グリッドを更新する必要があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-276">We need to refresh the grid whenever a new role is added.</span></span> <span data-ttu-id="b48a5-277">これを実現する、更新、`CreateRoleButton`ボタンの`Click`呼び出すためのイベント ハンドラー、`DisplayRolesInGrid`メソッドの場合は、新しいロールを作成します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-277">To accomplish this, update the `CreateRoleButton` Button's `Click` event handler so that it calls the `DisplayRolesInGrid` method if a new role is created.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample11.cs)]

<span data-ttu-id="b48a5-278">今すぐユーザーが新しいロールを追加すると、`RoleList`視覚的なフィードバック、ロールが正常に作成されたことを提供する GridView ポストバックで単に追加されたロールを示しています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-278">Now when the user adds a new role the `RoleList` GridView shows the just-added role on postback, providing visual feedback that the role was successfully created.</span></span> <span data-ttu-id="b48a5-279">これを示すためには、次を参照してください。、`ManageRoles.aspx`ブラウザー内でページと、監督者をという名前のロールを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-279">To illustrate this, visit the `ManageRoles.aspx` page through a browser and add a role named Supervisors.</span></span> <span data-ttu-id="b48a5-280">ロールの作成 ボタンをクリックすると、ポストバックが発生したりして、グリッドが更新され、新しいロール、監督者と管理者だけが含まれます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-280">Upon clicking the Create Role button, a postback will ensue and the grid will update to include Administrators as well as the new role, Supervisors.</span></span>


<span data-ttu-id="b48a5-281">[![スーパーバイザー ロールが追加されました](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-281">[![The Supervisors Role has Been Added](creating-and-managing-roles-cs/_static/image17.png)](creating-and-managing-roles-cs/_static/image16.png)</span></span>

<span data-ttu-id="b48a5-282">**図 6**: スーパーバイザー ロールが追加されました ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-282">**Figure 6**: The Supervisors Role has Been Added  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image18.png))</span></span>


## <a name="step-6-deleting-roles"></a><span data-ttu-id="b48a5-283">手順 6: ロールを削除します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-283">Step 6: Deleting Roles</span></span>

<span data-ttu-id="b48a5-284">この時点でユーザーを新しいロールを作成してからのすべての既存のロールを表示できます、`ManageRoles.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="b48a5-284">At this point a user can create a new role and view all existing roles from the `ManageRoles.aspx` page.</span></span> <span data-ttu-id="b48a5-285">ロールを削除するユーザーを許可してみましょう。</span><span class="sxs-lookup"><span data-stu-id="b48a5-285">Let's allow users to also delete roles.</span></span> <span data-ttu-id="b48a5-286">`Roles.DeleteRole`メソッドに次の 2 つのオーバー ロードがあります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-286">The `Roles.DeleteRole` method has two overloads:</span></span>

- <span data-ttu-id="b48a5-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) -ロール削除*roleName*です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-287">[`DeleteRole(roleName)`](https://msdn.microsoft.com/library/ek4sywc0.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="b48a5-288">役割には、1 つまたは複数のメンバーが含まれている場合は、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-288">An exception is thrown if the role contains one or more members.</span></span>
- <span data-ttu-id="b48a5-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) -ロール削除*roleName*です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-289">[`DeleteRole(roleName, throwOnPopulatedRole)`](https://msdn.microsoft.com/library/38h6wf59.aspx) - deletes the role *roleName*.</span></span> <span data-ttu-id="b48a5-290">場合*throwOnPopulateRole*は`true`役割には、1 つまたは複数のメンバーが含まれている場合、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-290">If *throwOnPopulateRole* is `true`, then an exception is thrown if the role contains one or more members.</span></span> <span data-ttu-id="b48a5-291">場合*throwOnPopulateRole*は`false`が含まれているすべてのメンバーかどうかどうか、ロールが削除されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-291">If *throwOnPopulateRole* is `false`, then the role is deleted whether it contains any members or not.</span></span> <span data-ttu-id="b48a5-292">内部的には、`DeleteRole(roleName)`メソッド呼び出し`DeleteRole(roleName, true)`です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-292">Internally, the `DeleteRole(roleName)` method calls `DeleteRole(roleName, true)`.</span></span>

<span data-ttu-id="b48a5-293">`DeleteRole`メソッドも例外がスローされる場合*roleName*は`null`または空の文字列または*roleName*コンマが含まれています。</span><span class="sxs-lookup"><span data-stu-id="b48a5-293">The `DeleteRole` method will also throw an exception if *roleName* is `null` or an empty string or if *roleName* contains a comma.</span></span> <span data-ttu-id="b48a5-294">場合*roleName* 、システムに存在しません`DeleteRole`例外を発生させずに自動的に、失敗します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-294">If *roleName* does not exist in the system, `DeleteRole` fails silently, without raising an exception.</span></span>

<span data-ttu-id="b48a5-295">みましょうで GridView を補強`ManageRoles.aspx`に含める、削除のボタンで、クリックすると、選択したロールを削除します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-295">Let's augment the GridView in `ManageRoles.aspx` to include a Delete button that, when clicked, deletes the selected role.</span></span> <span data-ttu-id="b48a5-296">フィールド ダイアログ ボックスに移動しが CommandField オプションである 削除 ボタンを追加する GridView の削除 ボタンを追加することで開始します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-296">Start by adding a Delete button to the GridView by going to the Fields dialog box and adding a Delete button, which is located under the CommandField option.</span></span> <span data-ttu-id="b48a5-297">列の左端のボタンをクリックし、設定の削除を行うその`DeleteText`ロールを削除するプロパティです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-297">Make the Delete button the far left column and set its `DeleteText` property to Delete Role .</span></span>


<span data-ttu-id="b48a5-298">[![RoleList GridView に [削除] ボタンを追加します。](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="b48a5-298">[![Add a Delete Button to the RoleList GridView](creating-and-managing-roles-cs/_static/image20.png)](creating-and-managing-roles-cs/_static/image19.png)</span></span>

<span data-ttu-id="b48a5-299">**図 7**: 削除ボタンを追加して、 `RoleList` GridView ([フルサイズのイメージを表示するをクリックして](creating-and-managing-roles-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="b48a5-299">**Figure 7**: Add a Delete Button to the `RoleList` GridView  ([Click to view full-size image](creating-and-managing-roles-cs/_static/image21.png))</span></span>


<span data-ttu-id="b48a5-300">[削除] ボタンを追加すると、GridView の宣言型マークアップを次のようになります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-300">After adding the Delete button, your GridView's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](creating-and-managing-roles-cs/samples/sample12.aspx)]

<span data-ttu-id="b48a5-301">Gridview のイベント ハンドラーを次に、作成`RowDeleting`イベント。</span><span class="sxs-lookup"><span data-stu-id="b48a5-301">Next, create an event handler for the GridView's `RowDeleting` event.</span></span> <span data-ttu-id="b48a5-302">これは、役割の削除 ボタンがクリックされたときにポストバック時に発生するイベントです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-302">This is the event that is raised on postback when the Delete Role button is clicked.</span></span> <span data-ttu-id="b48a5-303">イベント ハンドラーに次のコードを追加します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-303">Add the following code to the event handler.</span></span>

[!code-csharp[Main](creating-and-managing-roles-cs/samples/sample13.cs)]

<span data-ttu-id="b48a5-304">プログラムで参照することによって、コードの開始、 `RoleNameLabel` Web コントロールの役割の削除ボタンがクリックされた行にします。</span><span class="sxs-lookup"><span data-stu-id="b48a5-304">The code starts by programmatically referencing the `RoleNameLabel` Web control in the row whose Delete Role button was clicked.</span></span> <span data-ttu-id="b48a5-305">`Roles.DeleteRole`メソッドが呼び出されで渡すこと、`Text`の`RoleNameLabel`と`false`、それによってかどうかに関係なく、ロールを削除すると、ロールに関連付けられているすべてのユーザーがあります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-305">The `Roles.DeleteRole` method is then invoked, passing in the `Text` of the `RoleNameLabel` and `false`, thereby deleting the role regardless of whether there are any users associated with the role.</span></span> <span data-ttu-id="b48a5-306">最後に、 `RoleList` GridView が更新されるので、単に削除された役割がグリッドに表示されなくなります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-306">Finally, the `RoleList` GridView is refreshed so that the just-deleted role no longer appears in the grid.</span></span>

> [!NOTE]
> <span data-ttu-id="b48a5-307">役割の削除 ボタンには、あらゆる種類のロールを削除する前に、ユーザーから送信される確認は不要です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-307">The Delete Role button does not require any sort of confirmation from the user before deleting the role.</span></span> <span data-ttu-id="b48a5-308">クライアント側の確認 ダイアログ ボックスで、操作を確認する最も簡単な方法の 1 つです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-308">One of the easiest ways to confirm an action is through a client-side confirm dialog box.</span></span> <span data-ttu-id="b48a5-309">この方法の詳細については、次を参照してください。[削除時にクライアント側の確認を追加する](https://asp.net/learn/data-access/tutorial-42-cs.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-309">For more information on this technique, see [Adding Client-Side Confirmation When Deleting](https://asp.net/learn/data-access/tutorial-42-cs.aspx).</span></span>


## <a name="summary"></a><span data-ttu-id="b48a5-310">まとめ</span><span class="sxs-lookup"><span data-stu-id="b48a5-310">Summary</span></span>

<span data-ttu-id="b48a5-311">多くの web アプリケーションがある特定の承認規則またはページ レベルの機能だけがユーザーの特定のクラスを使用できます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-311">Many web applications have certain authorization rules or page-level functionality that is only available to certain classes of users.</span></span> <span data-ttu-id="b48a5-312">たとえば、管理者のみがアクセスできる web ページのセットが存在する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-312">For example, there may be a set of web pages that only administrators can access.</span></span> <span data-ttu-id="b48a5-313">多くの場合、ユーザー単位のユーザーごとにこれらの承認規則を定義するのではなくは役割に基づいて規則を定義する方が実用的です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-313">Rather than defining these authorization rules on a user-by-user basis, oftentimes it is more useful to define the rules based on a role.</span></span> <span data-ttu-id="b48a5-314">ユーザー管理の web ページにアクセスするには、Scott および Jisun を明示的に許可するではなくより優れた方法は、管理者ロールのメンバーは、これらのページにアクセスを許可するようにし、およびを意味する Scott Jisun に属するユーザーとして、管理者の役割。</span><span class="sxs-lookup"><span data-stu-id="b48a5-314">That is, rather than explicitly allowing users Scott and Jisun to access the administrative web pages, a more maintainable approach is to permit members of the Administrators role to access these pages, and then to denote Scott and Jisun as users belonging to the Administrators role.</span></span>

<span data-ttu-id="b48a5-315">ロール フレームワークでは、簡単に作成し、ロールを管理します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-315">The Roles framework makes it easy to create and manage roles.</span></span> <span data-ttu-id="b48a5-316">このチュートリアルで使用するロールのフレームワークを構成する方法を調べるお、 `SqlRoleProvider`、ロール ストアとして、Microsoft SQL Server データベースを使用します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-316">In this tutorial we examined how to configure the Roles framework to use the `SqlRoleProvider`, which uses a Microsoft SQL Server database as the role store.</span></span> <span data-ttu-id="b48a5-317">システムで既存のロールを一覧表示され、作成する新しいロールのする web ページ、および削除する既存のも作成しました。</span><span class="sxs-lookup"><span data-stu-id="b48a5-317">We also created a web page that lists the existing roles in the system and allows for new roles to be created and existing ones to be deleted.</span></span> <span data-ttu-id="b48a5-318">以降のチュートリアルでロールベースの承認を適用する方法と、ユーザーをロールに割り当てる方法が表示されます。</span><span class="sxs-lookup"><span data-stu-id="b48a5-318">In subsequent tutorials we will see how to assign users to roles and how to apply role-based authorization.</span></span>

<span data-ttu-id="b48a5-319">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="b48a5-319">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="b48a5-320">関連項目</span><span class="sxs-lookup"><span data-stu-id="b48a5-320">Further Reading</span></span>

<span data-ttu-id="b48a5-321">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="b48a5-321">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="b48a5-322">ASP.NET 2.0 を確認するメンバーシップ、ロール、およびプロファイル</span><span class="sxs-lookup"><span data-stu-id="b48a5-322">Examining ASP.NET 2.0's Membership, Roles, and Profile</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="b48a5-323">ASP.NET 2.0 のロール マネージャーを使用する方法</span><span class="sxs-lookup"><span data-stu-id="b48a5-323">How To: Use Role Manager in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998314.aspx)
- [<span data-ttu-id="b48a5-324">ロール プロバイダー</span><span class="sxs-lookup"><span data-stu-id="b48a5-324">Role Providers</span></span>](https://msdn.microsoft.com/library/aa478950.aspx)
- [<span data-ttu-id="b48a5-325">独自の web サイト管理ツールのローリング</span><span class="sxs-lookup"><span data-stu-id="b48a5-325">Rolling Your Own Website Administration Tool</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="b48a5-326">技術ドキュメント、`<roleManager>`要素</span><span class="sxs-lookup"><span data-stu-id="b48a5-326">Technical documentation for the `<roleManager>` Element</span></span>](https://msdn.microsoft.com/library/ms164660.aspx)
- [<span data-ttu-id="b48a5-327">メンバーシップとロール マネージャー Api を使用してください。</span><span class="sxs-lookup"><span data-stu-id="b48a5-327">Using the Membership and Role Manager APIs</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/security/membership.aspx)

### <a name="about-the-author"></a><span data-ttu-id="b48a5-328">作成者について</span><span class="sxs-lookup"><span data-stu-id="b48a5-328">About the Author</span></span>

<span data-ttu-id="b48a5-329">Scott Mitchell、複数の受け取りますブックの作成者と 4GuysFromRolla.com の創設者は、Microsoft の Web テクノロジと 1998 年取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="b48a5-329">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="b48a5-330">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="b48a5-330">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="b48a5-331">最新の著書 *[Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)* です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-331">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="b48a5-332">Scott に到達できる[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)または彼のブログでを介して[ http://ScottOnWriting.NET](http://scottonwriting.net/)です。</span><span class="sxs-lookup"><span data-stu-id="b48a5-332">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="b48a5-333">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="b48a5-333">Special Thanks To</span></span>

<span data-ttu-id="b48a5-334">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="b48a5-334">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="b48a5-335">このチュートリアルの潜在顧客レビュー担当者には、Alicja Maziarz、Suchi Banerjee Teresa マーフィーなどがあります。</span><span class="sxs-lookup"><span data-stu-id="b48a5-335">Lead reviewers for this tutorial include Alicja Maziarz, Suchi Banerjee, and Teresa Murphy.</span></span> <span data-ttu-id="b48a5-336">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="b48a5-336">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="b48a5-337">場合は、ドロップ me 一度に 1 行ずつ [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="b48a5-337">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> [<span data-ttu-id="b48a5-338">次へ</span><span class="sxs-lookup"><span data-stu-id="b48a5-338">Next</span></span>](assigning-roles-to-users-cs.md)
