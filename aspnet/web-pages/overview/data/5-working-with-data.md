---
uid: web-pages/overview/data/5-working-with-data
title: ASP.NET Web でのデータベース操作の概要ページ (Razor) サイト |Microsoft ドキュメント
author: tfitzmac
description: この章では、データベースからデータにアクセスし、ASP.NET Web Pages を使用して表示する方法について説明します。
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/18/2014
ms.topic: article
ms.assetid: 673d502f-2c16-4a6f-bb63-dbfd9a77ef47
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/data/5-working-with-data
msc.type: authoredcontent
ms.openlocfilehash: 563074cf3e60717c2e6c336a2c282b4203f73b8b
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 04/06/2018
ms.locfileid: "30898909"
---
<a name="introduction-to-working-with-a-database-in-aspnet-web-pages-razor-sites"></a>ASP.NET Web でのデータベース操作の概要ページ (Razor) サイト
====================
によって[Tom FitzMacken](https://github.com/tfitzmac)

> この記事では、Microsoft WebMatrix のツールを使用して、ASP.NET Web Pages (Razor) の web サイトでデータベースを作成する方法と表示、追加、編集、およびデータを削除することができるページを作成する方法について説明します。
> 
> **学習する内容。** 
> 
> - データベースを作成する方法。
> - データベースに接続する方法です。
> - Web ページにデータを表示する方法です。
> - 挿入、更新、およびデータベースのレコードを削除する方法。
> 
> これらは、アーティクルで導入された機能です。
> 
> - Microsoft SQL Server Compact Edition データベースで操作します。
> - SQL クエリを使用します。
> - `Database` クラス
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されているソフトウェアのバージョン
> 
> 
> - ASP.NET Web Pages (Razor) 2
> - WebMatrix 2
>   
> 
> このチュートリアルは、WebMatrix 3 でも動作します。 ASP.NET Web Pages 3 と Visual Studio 2013 (または Visual Studio Express 2013 for Web) を使用することができます。ただし、ユーザー インターフェイスは別になります。


## <a name="introduction-to-databases"></a>データベースの概要

通常、アドレス帳を想像してください。 アドレス帳の各エントリについて (つまり、各ユーザーに対して) が複数ある名、姓、名、アドレス、電子メール アドレス、および電話番号などの情報をします。

次のように画像データへの一般的な方法は、行と列を含むテーブルとしてです。 データベース用語では、各行は多くの場合と呼びますレコード。 (フィールドとも呼ばれます) の各列には、データの種類ごとに値が含まれています: 名、姓の名、およびなどです。

| **ID** | **FirstName** | **LastName** | **アドレス** | **電子メール** | **電話** |
| --- | --- | --- | --- | --- | --- |
| 1 | Jim | Abrus | 210 100th St SE Orcas WA 98031 | jim@contoso.com | 555 0100 |
| 2 | Terry | Adams | 1234 Main St. Seattle WA 99011 | terry@cohowinery.com | 555 0101 |

ほとんどのデータベース テーブルの表に、必要と顧客番号、アカウント番号などの一意の識別子を含む列です。これは、テーブルと呼ばれます*主キー*テーブル内の各行の識別に使用するとします。 例では、ID 列は、アドレス帳の主キーがします。

データベースの基本的な理解するおくには、単純なデータベースを作成し、追加、変更、およびデータの削除などの操作を実行する方法を学習する準備ができました。

> [!TIP] 
> 
> **リレーショナル データベース**
> 
> 多数の方法があり、スプレッドシートやテキスト ファイルにデータを格納することができます。 ほとんどのビジネス用途のため、データが保存リレーショナル データベースにします。
> 
> この記事はしないデータベースに非常に密接に移動します。 ただし、する可能性がありますが役に立つそれらについて少し理解します。 リレーショナル データベースでは、個別のテーブルに情報が論理的に分けられます。 たとえば、学校用のデータベースは、受講者とでクラスの内容、個別のテーブルを含めることがします。 データベース (SQL Server) などのソフトウェア サポート強力なコマンドを動的に可能にするには、テーブル間のリレーションシップが確立します。 たとえば、スケジュールを作成するために受講者およびクラス間に論理リレーションシップを確立するために、リレーショナル データベースを使用することができます。 別のテーブルにデータを格納するテーブルの構造の複雑さを軽減し、テーブルに冗長なデータを保持する必要性が軽減します。


## <a name="creating-a-database"></a>データベースを作成します。

この手順では、WebMatrix に含まれている SQL Server Compact データベース デザイン ツールを使用して SmallBakery をという名前のデータベースを作成する方法を示します。 コードを使用してデータベースを作成することができますが、データベースおよび WebMatrix のようにデザイン ツールを使用してデータベース テーブルを作成する一般的なです。

1. WebMatrix を起動し、[クイック スタート] ページで、をクリックして**サイトからテンプレート**です。
2. 選択**空のサイト**、し、、**サイト名**ボックス"SmallBakery"を入力し、をクリックして**OK**です。 サイトが作成され、WebMatrix で表示されます。
3. 左側のウィンドウでをクリックして、**データベース**ワークスペース。
4. リボンで、をクリックして**新しいデータベース**です。 サイトと同じ名前の空のデータベースが作成されます。
5. 左側のウィンドウで、展開、 **SmallBakery.sdf**ノードをクリックして**テーブル**です。
6. リボンで、をクリックして**新しいテーブル**です。 WebMatrix は、テーブル デザイナーを開きます。

    ![[イメージ]](5-working-with-data/_static/image1.jpg)
7. をクリックして、**名前**列と入力&quot;Id&quot;です。
8. **データ型**列をオン**int**です。
9. 設定、**主キーであるですか?** と**を識別するですか?** オプションを**はい**です。

    名前からわかるように、**主キーである**これは、テーブルの主キーであることをデータベースに指示します。 **[Is Identity]** すべての新しいレコードの ID 番号を自動的に作成して (1 から始まります) 次の連番を割り当てるために、データベースに指示します。
10. 次の行をクリックします。 エディターでは、新しい列の定義を開始します。
11. 名前の値を入力してください。&quot;名前&quot;です。
12. **データ型**、選択&quot;nvarchar&quot;し、長さは 50 に設定します。 *Var*の一部`nvarchar`この列のデータがサイズが異なるレコード間を文字列になるデータベースに指示します。 (、 *N*プレフィックスを表す*national*フィールドがすべてアルファベット順を表す文字データを保持できることを示す、または書記体系&#8212;は、フィールドが Unicode データを保持している)。
13. 設定、 **null を許容**オプションを**いいえ**です。 これが適用されます、*名前*列がない空白のままにします。
14. この同じプロセスを使用してという名前の列を作成*説明*です。 設定**データ型**"nvarchar"を長さ、およびセットの 50 **Null を許容**を false に設定します。
15. という名前の列を作成する*価格*です。 設定 **"money"データ型**設定と**Null を許容**を false に設定します。
16. 上部のボックスで、テーブルの名前を&quot;製品&quot;です。

    完了したら、定義は次のようになります。

    ![[イメージ]](5-working-with-data/_static/image2.jpg)
17. テーブルを保存するには、Ctrl + S キーを押します。

## <a name="adding-data-to-the-database"></a>データベースにデータを追加します。

今すぐ演習、記事の後半では、データベースにいくつかサンプル データを追加することができます。

1. 左側のウィンドウで、展開、 **SmallBakery.sdf**ノードをクリックして**テーブル**です。
2. Product テーブルを右クリックし、をクリックして**データ**です。
3. 編集ウィンドウで、次のレコードを入力します。

    | **Name** | **説明** | **価格** |
    | --- | --- | --- |
    | パン | 毎日の焼き立て新鮮です。 | 2.99 |
    | ストロベリー ショート ケーキ | 当社の庭から有機 strawberries で行われます。 | 9.99 |
    | Apple Pie | 母親の円グラフにのみ 2 番目です。 | 12.99 |
    | Pecan 円 | Pecans 場合に、これが役立ちます。 | 10.99 |
    | レモンの円 | 世界中で最適な lemons で行われます。 | 11.99 |
    | すてきなカップケーキ | お子供様たちとするで kid がこれら大好きです。 | 7.99 |

    注意を何も入力する必要はありません、 *Id*列です。 作成したときに、 *Id*設定する列で、その**Is Identity**プロパティを true の場合、これにより、自動的に入力することです。

    データ入力が完了したら、テーブル デザイナーは次のようになります。

    ![[イメージ]](5-working-with-data/_static/image3.jpg)
4. データベースのデータを含むタブを閉じます。

## <a name="displaying-data-from-a-database"></a>データベースからデータを表示します。

データベースにデータを取得したらは、ASP.NET web ページで、データを表示できます。 表示するテーブルの行を選択するには、データベースに渡すコマンドは、SQL ステートメントを使用します。

1. 左側のウィンドウでをクリックして、**ファイル**ワークスペース。
2. Web サイトのルートで、作成という名前の新しい CSHTML ページ*ListProducts.cshtml*です。
3. 既存のマークアップを次のように置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample1.cshtml)]

    最初のコード ブロックで開く、 *SmallBakery.sdf*先ほど作成したファイル (データベース)。 `Database.Open`メソッドを想定する、 *.sdf*ファイルは、web サイトの*アプリ\_データ*フォルダーです。 (ことを指定する必要はありません、 *.sdf*拡張子&#8212;ファクトを指定する場合に、`Open`メソッドは機能しません)。

    > [!NOTE]
    > *アプリ\_データ*フォルダーは、データ ファイルの格納に使用される ASP.NET で特別なフォルダーです。 詳細については、次を参照してください。[データベースへの接続](#SB_ConnectingToADatabase)この記事で後述します。

    次の SQL を使用してデータベースを照会する要求を行う、`Select`ステートメント。

    [!code-sql[Main](5-working-with-data/samples/sample2.sql)]

    ステートメントでは、`Product`クエリにテーブルを識別します。 `*`文字では、クエリが、テーブルからすべての列を返すことを指定します。 (でしたも一覧表示列に個別に、一部の列のみを表示する場合は、コンマで区切る。)`Order By`句では、データの並べ替え方法を示します&#8212;ここでは、によって、*名前*列です。 これは、データがの値に基づいてアルファベット順に並べ替えが意味、*名前*各行の列です。

    ページの本文には、マークアップは、データの表示に使用される HTML テーブルを作成します。 内部、`<tbody>`要素を使用する、`foreach`ループを個別に、クエリによって返される各データ行を取得します。 HTML テーブルの行を作成する各データ行 (`<tr>`要素)。 HTML テーブルのセルを作成してから (`<td>`要素) の各列にします。 ループを通過するたびに、データベースから [次へ]、使用可能な行が、`row`変数 (で設定したこの、`foreach`ステートメント)。 使用することができます、個々 の列の行を取得する`row.Name`または`row.Description`かする列は、任意の名前。
4. ブラウザーでページを実行します。 (ページが選択されて、必ず、**ファイル**ワークスペースを実行する前にします)。ページには、次のような一覧が表示されます。

    ![[イメージ]](5-working-with-data/_static/image4.jpg)

> [!TIP] 
> 
> **構造化照会言語 (SQL)**
> 
> SQL は、データベース内のデータを管理するため、ほとんどのリレーショナル データベースで使用されている言語です。 これには、データを取得し、更新するための作成、変更、およびデータベースのテーブルを管理するためのコマンドが含まれます。 SQL とは異なる (webmatrix を使用しているような) のプログラミング言語、考え方は、データベースを指定すると、目的の動作、データを取得またはタスクを実行する方法を理解するデータベースのジョブは、SQL を使用したためです。 一部の SQL コマンドの例とその実行内容を次に示します。
> 
> `SELECT Id, Name, Price FROM Product WHERE Price > 10.00 ORDER BY Name`
> 
> これをフェッチ、 *Id*、*名前*、および*価格*内のレコードからの列、*製品*場合のテーブルの値*価格*は 10 個を超えると、結果の値に基づいてアルファベット順に返します、*名前*列です。 このコマンドでは、レコードと一致しない場合、条件、または空のセットに一致するレコードを含む結果セットを返します。
> 
> `INSERT INTO Product (Name, Description, Price) VALUES ("Croissant", "A flaky delight", 1.99)`
> 
> 新しいレコードを挿入しますこの、*製品*設定、テーブル、*名前*列を&quot;クロワッサン&quot;、*説明*列。&quot;不安定な楽しめます&quot;とから 1.99 する価格。
> 
> `DELETE FROM Product WHERE ExpirationDate < "01/01/2008"`
> 
> このコマンドは、内のレコードを削除、*製品*有効期限の日付列が含まれるは 2008 年 1 月 1 日より前のテーブルです。 (これが想定する、*製品*テーブルにあるこのような列は、当然のことながら)。/MM/DD/YYYY 形式で日付がここに入力したが、ロケールに使用される形式で入力する必要があります。
> 
> `Insert Into`と`Delete`コマンドの結果セットを返しません。 代わりに、これらは、コマンドの影響を受けたレコードの数を示す番号を返します。
> 
> これらの操作 (挿入して、レコードを削除する) などの一部で、操作を要求しているプロセスの適切なアクセス許可を持つデータベースではします。 これは、実稼働データベースの多くの場合、データベースに接続するときに、ユーザー名とパスワードを指定する必要があるためです。
> 
> 重複除去は、SQL コマンドがありますが、このようなパターンに従うすべて。 SQL コマンドを使用して、データベース テーブルを作成、テーブル内のレコードの数をカウント、価格、計算、および多くの操作を実行することができます。


## <a name="inserting-data-in-a-database"></a>データベースのデータを挿入します。

このセクションでは、ユーザーが新しい製品を追加できるページを作成する方法を示します、*製品*データベース テーブルです。 更新されたテーブルを使用して、新しい製品レコードが挿入されると、ページに表示されます、 *ListProducts.cshtml*前のセクションで作成したページ。

このページには、ユーザーが入力したデータがデータベースに対して有効であるかどうかを確認する検証が含まれます。 たとえば、ページ内のコードは、すべての必要な列の値が入力されていることを確認します。

1. という名前の新しい CSHTML ファイルを作成、web サイトで*InsertProducts.cshtml*です。
2. 既存のマークアップを次のように置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample3.cshtml)]

    ページの本文には、ユーザー名、説明、および価格を入力できるように次の 3 つのテキスト ボックスの HTML フォームが含まれています。 ユーザーがクリックして、**挿入**ボタン、ページの上部にあるコードがへの接続を開きます、 *SmallBakery.sdf*データベース。 使用して、ユーザーが送信する値を取得する、`Request`オブジェクトし、それらの値をローカル変数に割り当てます。

    各ユーザーが必要な各列の値を入力することを検証するには、登録する`<input>`を検証する要素。

    [!code-csharp[Main](5-working-with-data/samples/sample4.cs)]

    `Validation`ヘルパーは、各登録したフィールドの値があることを確認します。 すべてのフィールドをチェックして検証を渡されるかどうかをテストする`Validation.IsValid()`、どのする通常の方法で、ユーザーから取得した情報を処理する前に。

    [!code-csharp[Main](5-working-with-data/samples/sample5.cs)]

    (、`&&`演算子は AND — このテストは*フォームの送信接続が、すべてのフィールドが検証に合格しました*)。

    すべての列が検証された場合 (がなかった空)、データを挿入し、次に示すように実行する SQL ステートメントを作成してください。

    [!code-csharp[Main](5-working-with-data/samples/sample6.cs)]

    挿入する値は、パラメーターのプレース ホルダーを含める (`@0`、 `@1`、 `@2`)。

    > [!NOTE]
    > セキュリティ上の予防措置として常に値を渡すパラメーターを使用して SQL ステートメントにように前の例を参照してください。 これは、方法により、ユーザーのデータを検証すると、悪意のあるコマンドを (SQL インジェクション攻撃とも呼ばれます)、データベースに送信する試行を防ぐのに役立ちます。

    クエリを実行するには、ステートメントを使用するこのプレース ホルダーの代わりに値を含む変数を渡します。

    [!code-csharp[Main](5-working-with-data/samples/sample7.cs)]

    後に、`Insert Into`ステートメントが実行される、行を使用して製品を一覧表示するページへユーザーを送信します。

    [!code-javascript[Main](5-working-with-data/samples/sample8.js)]

    検証が成功しなかった場合は、挿入をスキップします。 代わりに、蓄積されたエラー メッセージ (存在する場合) を表示できるページに、ヘルパーがあります。

    [!code-cshtml[Main](5-working-with-data/samples/sample9.cshtml)]

    マークアップにスタイル ブロックに名前付き CSS クラスの定義が含まれることに注意してください`.validation-summary-errors`です。 これは、既定で使用される CSS クラスの名前、`<div>`検証エラーを含む要素です。 この例では、CSS クラスことを指定検証概要エラーが赤で表示されます、太字には定義することができます、`.validation-summary-errors`か書式を表示するクラス。

### <a name="testing-the-insert-page"></a>Insert ページのテスト

1. ブラウザーでページを表示します。 次の図に示すようにしているフォームを表示します。

    ![[イメージ]](5-working-with-data/_static/image5.jpg)
2. すべての列の値を入力がしておくことを確認してください、*価格*列は空白です。
3. **[挿入]** をクリックします。 ページは、次の図に示すように、エラー メッセージを表示します。 (新しいレコードは作成されません。)

    ![[イメージ]](5-working-with-data/_static/image6.jpg)
4. クリックして、完全にフォームを記入**挿入**です。 このとき、 *ListProducts.cshtml*ページが表示され、新しいレコードを示しています。

## <a name="updating-data-in-a-database"></a>データベース内のデータの更新

テーブルにデータが入力された後は、更新する必要があります。 この手順では、データの挿入先用に作成したものに類似する 2 つのページを作成する方法を示します。 最初のページでは、製品を表示し、ユーザーを変更する 1 つを選択します。 2 番目のページには、実際に編集を行うし、それらを保存、ユーザーが使用できます。

> [!NOTE] 
> 
> **重要な**実稼働 web サイトで通常を制限する、データ変更を許可するユーザー。 メンバーシップを設定する方法の詳細と、サイトでタスクを実行するユーザーを承認する方法について、次を参照してください。[追加のセキュリティと ASP.NET Web Pages サイトにメンバーシップ](https://go.microsoft.com/fwlink/?LinkId=202904)です。


1. という名前の新しい CSHTML ファイルを作成、web サイトで*EditProducts.cshtml*です。
2. 次のように、ファイルの既存のマークアップに置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample10.cshtml)]

    このページの唯一の違い、および*ListProducts.cshtml*ページから前はこのページの HTML テーブルが含まれる、余分な列を表示する、**編集**リンクします。 するにはこのリンクをクリックすると、 *UpdateProducts.cshtml*  ページ (次を作成します)、選択したレコードを編集することができます。

    作成するコードを見て、**編集**リンク。

    [!code-cshtml[Main](5-working-with-data/samples/sample11.cshtml)]

    こうと、HTML`<a>`要素が`href`属性が動的に設定します。 `href`属性は、ユーザーがリンクをクリックしたときに表示するページを指定します。 渡しても、`Id`リンクには、現在の行の値。 ページを実行すると、ページのソースには、上記のようなリンクが含まれます。

    [!code-html[Main](5-working-with-data/samples/sample12.html)]

    注意して、`href`属性に設定されている`UpdateProducts/n`ここで、 *n*製品番号です。 ユーザーをクリックすると、これらのリンクのいずれかが、結果の URL は次のようになります。

    `http://localhost:18816/UpdateProducts/6`

    つまり、製品番号を編集することは、URL で渡されます。
3. ブラウザーでページを表示します。 ページには、次のような形式で、データが表示されます。

    ![[イメージ]](5-working-with-data/_static/image7.jpg)

    次に、ユーザーが実際には、データを更新できるページを作成します。 更新プログラム ページには、ユーザーが入力したデータを検証する検証が含まれています。 たとえば、ページ内のコードは、すべての必要な列の値が入力されていることを確認します。
4. という名前の新しい CSHTML ファイルを作成、web サイトで*UpdateProducts.cshtml*です。
5. 次のファイルの既存のマークアップに置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample13.cshtml)]

    ページの本文には、製品を表示する場所とユーザーが編集できる HTML フォームが含まれています。 表示する製品を取得するには、この SQL ステートメントを使用します。

    [!code-sql[Main](5-working-with-data/samples/sample14.sql)]

    これにより、ID が渡される値に一致する製品を選択、`@0`パラメーター。 (ため*Id*は主キー、したがって必要がありますで一意である、1 つの製品レコードがこの方法を選択するれたことができます)。これに渡す ID 値を取得する`Select`ステートメントに渡されるページの URL の一部として、次の構文を使用して値を読み取ることができます。

    [!code-csharp[Main](5-working-with-data/samples/sample15.cs)]

    製品レコードを実際にフェッチするには、使用する、`QuerySingle`メソッドで、1 つのレコードを返します。

    [!code-csharp[Main](5-working-with-data/samples/sample16.cs)]

    1 つの行が返されます、`row`変数。 各列からデータを取得し、次のようにローカル変数に割り当てることができます。

    [!code-csharp[Main](5-working-with-data/samples/sample17.cs)]

    フォームのマークアップでこれらの値が表示されます自動的に個々 のテキスト ボックスで、次のように埋め込みコードを使用しています。

    [!code-html[Main](5-working-with-data/samples/sample18.html)]

    コードの部分には、更新する製品レコードが表示されます。 レコードが表示された後、ユーザーは、個々 の列を編集できます。

    クリックして、ユーザーがフォームを送信した場合、**更新**ボタン、コード、`if(IsPost)`ブロックが実行されます。 これにより、ユーザーの値が取得、`Request`オブジェクトは、変数値を格納し各列が満杯になったことを検証します。 検証に合格した場合、コードは次の SQL の Update ステートメントを作成します。

    [!code-sql[Main](5-working-with-data/samples/sample19.sql)]

    Sql`Update`ステートメント設定する値で更新するには、各列を指定します。 このコードで、値は、パラメーター プレース ホルダーを使用して`@0`、 `@1`、`@2`のようにします。 (述べたとおり、セキュリティをする必要があります常に値を渡す SQL ステートメントにパラメーターを使用しています。)

    呼び出すと、`db.Execute`メソッド、順番は、SQL ステートメントのパラメーターに対応する値を含む変数を渡します。

    [!code-csharp[Main](5-working-with-data/samples/sample20.cs)]

    後に、`Update`ステートメントが実行される、ユーザーを編集 ページにリダイレクトするために、次のメソッドを呼び出します。

    [!code-cshtml[Main](5-working-with-data/samples/sample21.cshtml)]

    効果は、ユーザーがデータベース内のデータの更新の一覧を表示し、別の製品を編集できます。
6. ページを保存します。
7. 実行、 *EditProducts.cshtml*ページ ([更新] ページではない) をクリックして**編集**を編集する製品を選択します。 *UpdateProducts.cshtml*ページが表示されたら、選択したレコードを表示します。

    ![[イメージ]](5-working-with-data/_static/image8.jpg)
8. 変更を行い、をクリックして**更新**です。 製品一覧が更新されたデータをもう一度表示されます。

## <a name="deleting-data-in-a-database"></a>データベース内のデータを削除します。

このセクションでは、ユーザーから製品を削除できるようにする方法を示します、*製品*データベース テーブルです。 この例は、2 つのページで構成されます。 最初のページでは、ユーザーは、削除するレコードを選択します。 削除するレコードはレコードを削除することを確認することができ、2 番目のページに表示されます。

> [!NOTE] 
> 
> **重要な**実稼働 web サイトで通常を制限する、データ変更を許可するユーザー。 メンバーシップを設定する方法の詳細と、サイトでタスクを実行するユーザーを承認する方法について、次を参照してください。[追加のセキュリティと ASP.NET Web Pages サイトにメンバーシップ](https://go.microsoft.com/fwlink/?LinkId=202904)です。


1. という名前の新しい CSHTML ファイルを作成、web サイトで*ListProductsForDelete.cshtml*です。
2. 既存のマークアップを次のように置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample22.cshtml)]

    このページがに似ていますが、 *EditProducts.cshtml*から前のページです。 表示するのではなく、ただし、**編集**リンクについて、各製品が表示されます、**削除**リンクします。 **削除**マークアップに次の埋め込みコードを使用してリンクを作成します。

    [!code-cshtml[Main](5-working-with-data/samples/sample23.cshtml)]

    これには、ユーザーのリンクをクリックすると、次のような URL を作成します。

    `http://<server>/DeleteProduct/4`

    URL は、という名前のページを呼び出す*DeleteProduct.cshtml* (これは、次を作成します) を削除する、製品の ID を渡します (ここでは、4)。
3. ファイルの保存が開いたままにしておきます。
4. という名前の別の CHTML ファイルを作成する*DeleteProduct.cshtml*です。 次のように、既存のコンテンツを置き換えます。

    [!code-cshtml[Main](5-working-with-data/samples/sample24.cshtml)]

    このページは、によって呼び出されます。 *ListProductsForDelete.cshtml*でき、ユーザーが製品を削除することを確認します。 削除する製品を一覧表示するには、ID を取得した製品の URL から削除する次のコードを使用します。

    [!code-csharp[Main](5-working-with-data/samples/sample25.cs)]

    ページは、ユーザーを実際には、レコードを削除するためのボタンをクリックしてを求めます。 これは、重要なセキュリティ対策: これらの操作を行う常に、web サイトを更新したり、データの削除などの機密性の高い操作を実行するとき、POST 操作、GET 操作ではなくを使用します。 GET 操作で削除操作を行えるように、サイトのセットアップ、すべてのユーザーとのように URL を渡すことができます`http://<server>/DeleteProduct/4`し、必要なものをデータベースから削除します。 追加して、確認のみ POST を使用して、削除を実行できるように、ページをコーディング、サイト セキュリティのメジャーを追加します。

    実際の削除操作は、まず post 操作であるし、ID が空でないことを確認する次のコードを使用して実行されます。

    [!code-csharp[Main](5-working-with-data/samples/sample26.cs)]

    コードでは、指定されたレコードを削除し、一覧のページに戻る、ユーザーをリダイレクトする SQL ステートメントを実行します。
5. 実行*ListProductsForDelete.cshtml*ブラウザーでします。

    ![[イメージ]](5-working-with-data/_static/image9.jpg)
6. クリックして、**削除**製品のいずれかのリンク。 *DeleteProduct.cshtml*そのレコードを削除することを確認ページが表示されます。
7. クリックして、**削除**ボタンをクリックします。 製品レコードが削除され、更新された製品一覧と、ページを更新します。

> [!TIP]
> 
> <a id="SB_ConnectingToADatabase"></a>
> ### <a name="connecting-to-a-database"></a>データベースへの接続
> 
> 2 つの方法でデータベースに接続することができます。 最初は、使用する、`Database.Open`メソッドと、データベース ファイルの名前を指定する (以下、 *.sdf*拡張機能)。
> 
> `var db = Database.Open("SmallBakery");`
> 
> `Open`メソッドでは、いるものとします *。sdf*ファイルは、web サイトの*アプリ\_データ*フォルダーです。 このフォルダーはデータを保持する専用に設計されています。 たとえば、データを読み書きする web サイトを許可する適切なアクセス許可があるし、セキュリティ対策として WebMatrix いないアクセス許可ファイルにこのフォルダーから。
> 
> 2 番目の方法では、接続文字列を使用します。 接続文字列には、データベースに接続する方法に関する情報が含まれています。 これは、ファイルのパスを含めることができます、またはユーザー名とそのサーバーに接続するパスワードと共に、ローカルまたはリモート サーバー上の SQL Server データベースの名前を含めることができます。 (一元管理型のバージョンの SQL Server でデータを保持する場合など、ホスティング プロバイダーのサイトでは、必ず使用する接続文字列、データベース接続情報を指定する。)
> 
> WebMatrix で接続文字列は通常、という名前の XML ファイルに格納*Web.config*です。名前が示すように、使用できます、 *Web.config*サイトが必要となる任意の接続文字列を含む、サイトの構成情報を格納する web サイトのルートにあるファイルです。 内の接続文字列の例、 *Web.config*ファイルは次のようになります。
> 
> [!code-xml[Main](5-working-with-data/samples/sample27.xml)]
> 
> 例では、接続文字列はどこかに、サーバーで実行されている SQL Server のインスタンスにデータベースを指す (ローカルではなく *.sdf*ファイル)。 適切な名前の代わりに使用する必要があります`myServer`と`myDatabase`、SQL Server ログインの値を指定して`username`と`password`です。 (ユーザー名とパスワードの値は必ずしも同じ Windows 資格情報として、または、サーバーへのログインに、ホスティング プロバイダーから提供された値として 管理者に確認する必要がある正確な値にします。)
> 
> `Database.Open`メソッドは、データベースの名前を渡すことができるため、柔軟 *.sdf*ファイルまたはに格納されている接続文字列の名前、 *Web.config*ファイル。 次の例では、前の例に示す接続文字列を使用して、データベースに接続する方法を示します。
> 
> [!code-cshtml[Main](5-working-with-data/samples/sample28.cshtml)]
> 
> 前述のように、`Database.Open`メソッドでは、データベース名または接続文字列を渡すことができ、それを算出を使用します。 これは、展開するときに非常に便利です (公開)、web サイトです。 使用することができます、 *.sdf*ファイルで、*アプリ\_データ*フォルダーの開発およびサイトのテスト時にします。 内の接続文字列を使用して、サイトを実稼働サーバーに移動すると、 *Web.config*ファイルと同じ名前を持つ、 *.sdf* &#8212;せずに、コードを変更します。
> 
> 最後に、接続文字列を直接操作する場合を呼び出すことができます、`Database.OpenConnectionString`メソッドと実際の接続が文字列で 1 つの名前だけではなく、パス、 *Web.config*ファイル。 何らかの理由がない、接続文字列へのアクセス状況で便利なことが考えられます (などの値、または、 *.sdf*ファイル名)、ページが実行されるまでです。 ただし、ほとんどのシナリオで使用できます`Database.Open`ようにこの記事で説明します。


## <a name="additional-resources"></a>その他のリソース

- [SQL Server Compact](https://www.microsoft.com/sqlserver/2008/en/us/compact.aspx)
- [SQL Server または WebMatrix の MySQL データベースへの接続](https://go.microsoft.com/fwlink/?LinkId=208661)
- [ASP.NET Web ページにおけるユーザー入力の検証](https://go.microsoft.com/fwlink/?LinkId=253002)
