---
uid: web-pages/overview/data/working-with-files
title: "ASP.NET Web Pages (Razor) サイト内のファイルの操作 |Microsoft ドキュメント"
author: tfitzmac
description: "この章では、読み取り、書き込み、追加、削除、およびファイルをアップロードする方法について説明します。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: eee916e4-ba4c-439a-a24e-68df7d45a569
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/data/working-with-files
msc.type: authoredcontent
ms.openlocfilehash: 0f119f8fb4873e55292203f21a2efd8f26793ae4
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="working-with-files-in-an-aspnet-web-pages-razor-site"></a>ASP.NET Web Pages (Razor) サイト内のファイルの操作
====================
によって[Tom FitzMacken](https://github.com/tfitzmac)

> この記事では、読み取り、書き込み、追加、削除、および ASP.NET Web Pages (Razor) サイト内のファイルをアップロードする方法について説明します。
> 
> > [!NOTE]
> > イメージをアップロードし、それらの操作をする場合 (反転またはそれらのサイズを変更など) を参照してください[ASP.NET Web Pages サイトでのイメージを操作](https://go.microsoft.com/fwlink/?LinkId=202897)です。
> 
> 
> **学習する内容。** 
> 
> - テキスト ファイルを作成し、データの書き込みにする方法。
> - 既存のファイルにデータを追加する方法。
> - ファイルを読み取り、そこから表示する方法。
> - Web サイトからファイルを削除する方法です。
> - ユーザーが 1 つまたは複数のファイルをアップロードできるようにする方法。
> 
> これらは、ASP.NET のアーティクルで導入された機能をプログラミングします。
> 
> - `File`オブジェクトで、ファイルを管理する方法を提供します。
> - `FileUpload`ヘルパー。
> - `Path`パスとファイル名を操作するのに便利なメソッドを提供するオブジェクト。
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されているソフトウェアのバージョン
> 
> 
> - ASP.NET Web Pages (Razor) 2
> - WebMatrix 2
>   
> 
> このチュートリアルは、WebMatrix 3 でも動作します。


<a id="Creating_a_Text_File"></a>
## <a name="creating-a-text-file-and-writing-data-to-it"></a>テキスト ファイルを作成し、データを書き込む

に加えて、web サイトのデータベースを使用して、ファイルで作業する可能性があります。 たとえば、テキスト ファイルをサイトのデータを格納する簡単な方法として使用する可能性があります。 (データの格納に使用されるテキスト ファイルと呼ぶことが、*フラット ファイル*)。テキスト ファイルに格納できます、さまざまな形式と同様に*.txt*、 *.xml*、または*.csv* (コンマ区切り値)。

テキスト ファイルにデータを格納する場合は、使用、`File.WriteAllText`メソッドを作成するファイルを指定して、データへの書き込みをします。 この手順で 3 つの単純なフォームが含まれるページを作成する`input`要素 (名前、姓、名、および電子メール アドレス) と**送信**ボタンをクリックします。 ユーザーがフォームを送信したときに保存する、ユーザーの入力テキスト ファイルです。

1. という名前の新しいフォルダーを作成する*アプリ\_データ*がまだ存在しない場合は、します。
2. Web サイトのルート ディレクトリにある、という名前の新しいファイルを作成する*UserData.cshtml*です。
3. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample1.cshtml)]

    HTML マークアップでは、3 つのテキスト ボックスで、フォームを作成します。 使用するコードでは、`IsPost`処理を開始する前に、ページが送信されたかどうかを決定するプロパティです。

    最初のタスクは、ユーザー入力を取得し、変数に割り当てることです。 コードは、異なる変数に格納されていますし、1 つのコンマ区切り文字列にし、別々 の変数の値を連結します。 コンマ区切り記号が引用符内に含まれる文字列 (「、」) を作成している大きな文字列にコンマをリテラル埋め込みしているためです。 連結するデータの最後に、追加する`Environment.NewLine`です。 これは、改行 (改行文字) を追加します。 この連結したものを作成しているは、次のような文字列です。

    [!code-css[Main](working-with-files/samples/sample2.css)]

    (、非表示の行区切りによって最後にします。)

    変数を作成し、(`dataFile`) 内のデータを格納するファイルの名前と場所を格納しています。 場所の設定には、いくつかの特別な処理が必要です。 Web サイト ではコードのような絶対パスを参照するには、好ましく*C:\Folder\File.txt* web サーバー上のファイルです。 Web サイトを移動すると、絶対パスが正しくないがあります。 さらに、ホストされるサイトのではなく、自分のコンピューター) 通常もわからない正しいパスが、コードを記述しているときに。

    場合があります (ここでは、ファイルを作成するため) などは、完全なパスする必要があります。 ソリューションは、使用する、`MapPath`のメソッド、`Server`オブジェクト。 Web サイトへの完全なパスが返されます。 ユーザーが、web サイトのルートのパスを取得する、`~`演算子 (represen には、サイトの仮想ルート) に`MapPath`です。 (と同様に、サブフォルダー名を渡すことができますも*~/App\_データ/*、サブフォルダー内のパスを取得します)。その他の情報を完全なパスを作成するためにどのようなメソッドを返します、連結できます。 この例では、ファイル名を追加します。 (詳細でファイルとフォルダーのパスを操作する方法について[ASP.NET Web ページは、Razor 構文を使用プログラミングの概要](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths))。

    ファイルを保存、*アプリ\_データ*フォルダーです。 このフォルダーは」の説明に従って、データ ファイルに格納されている ASP.NET の特別なフォルダー [ASP.NET Web Pages サイトでのデータベース操作の概要](https://go.microsoft.com/fwlink/?LinkId=195209)です。

    `WriteAllText`のメソッド、`File`オブジェクトは、データをファイルに書き込みます。 このメソッドは、2 つのパラメーター: 名 (パス) の書き込み、ファイルと実際のデータを書き込めません。 最初のパラメーターの名前に注意してください、`@`をプレフィックスとして文字です。 これは、ASP.NET などの文字こと、および、逐語的文字列リテラルに提供することを通知「/」の特別な方法で解釈する必要があります。 (詳細については、次を参照してください[Introduction to ASP.NET Web プログラミング構文を使用して、Razor](https://go.microsoft.com/fwlink/?LinkId=195205#ID_WorkingWithFileAndFolderPaths)。)。

    > [!NOTE]
    > コード内のファイルを保存するために、*アプリ\_データ*フォルダー、アプリケーション必要がある読み取り/書き込みそのフォルダーのアクセスを許可します。 開発用コンピューターでこの問題はありません通常です。 ただし、ホスティング プロバイダーの web サーバーにサイトを発行するときは、これらのアクセス許可を明示的に設定する必要があります。 ホスティング プロバイダーのサーバーでこのコードを実行し、エラーが発生する場合にこれらのアクセス許可を設定する方法を見つけて、ホスティング プロバイダーに確認します。

- ブラウザーでページを実行します。 

    ![](working-with-files/_static/image1.jpg)
- フィールドに値を入力し、クリックして**送信**です。
- ブラウザーを閉じます。
- プロジェクトに戻り、ビューを更新します。
- 開く、 *data.txt*ファイル。 形式で送信されたデータは、ファイルにです。 

    ![[イメージ]](working-with-files/_static/image2.jpg)
- 閉じる、 *data.txt*ファイル。

<a id="Appending_Data"></a>
## <a name="appending-data-to-an-existing-file"></a>既存のファイルにデータを追加します。

前の例では使用して`WriteAllText`に 1 つのデータを取得するテキスト ファイルを作成します。 再度メソッドを呼び出すし、同じファイル名を渡す場合は、既存のファイルは完全に上書きされます。 ただし、ファイルを作成した後に多くの場合、ファイルの末尾に新しいデータを追加します。 使用して行うことができます、`AppendAllText`のメソッド、`File`オブジェクト。

1. Web サイトでのコピーを作成、 *UserData.cshtml*ファイルし、コピーの名前を付けます*UserDataMultiple.cshtml*です。
2. 開始する前に、コード ブロックを置き換える`<!DOCTYPE html>`次のコード ブロックを持つタグ。 

    [!code-cshtml[Main](working-with-files/samples/sample3.cshtml)]

    このコードに 1 つの変更が、前の例です。 使用せずに`WriteAllText`を使用して`the AppendAllText`メソッドです。 メソッドは、類似する点を除いて`AppendAllText`データ ファイルの末尾に追加します。 同様に`WriteAllText`、`AppendAllText`が存在しない場合、ファイルを作成します。
3. ブラウザーでページを実行します。
4. フィールドの値を入力し、クリックして**送信**です。
5. 多くのデータを追加し、フォームを再送信します。
6. プロジェクトに戻り、プロジェクト フォルダーを右クリックし、クリックして**更新**です。
7. 開く、 *data.txt*ファイル。 これで、入力した新しいデータが含まれています。 

    ![[イメージ]](working-with-files/_static/image3.jpg)

<a id="Reading_and_Displaying_Data"></a>
## <a name="reading-and-displaying-data-from-a-file"></a>読み取りと、ファイルからデータを表示します。

場合でも、テキスト ファイルにデータを記述する必要はありません、おそらくも 1 つからデータを読み取る必要があります。 これを行うには、もう一度使える、`File`オブジェクト。 使用することができます、`File`オブジェクトを個別に各行を読み取る (改行で区切られた) や、それらの区切る方法に関係なく個々 のアイテムの読み取り。

この手順では、読み取りおよび前の例で作成したデータを表示する方法を示します。

1. Web サイトのルート ディレクトリにある、という名前の新しいファイルを作成する*DisplayData.cshtml*です。
2. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample4.cshtml)]

    という名前の変数に、前の例で作成したファイルを読み取ることでコードが始まる`userData`、このメソッドの呼び出しを使用します。

    [!code-css[Main](working-with-files/samples/sample5.css)]

    これを行うコードは、内部、`if`ステートメントです。 使用することをお勧めはファイルを確認するには、ときに、`File.Exists`最初に、ファイルが使用できるかどうかを確認するメソッド。 また、コードは、ファイルが空かどうかを確認します。

    ページの本文には 2 つ`foreach`ループ、いずれかの他の内部に入れ子にします。 外側`foreach`ループは、データ ファイルから、一度に 1 つの行を取得します。 ファイル &#8212; 内の改行によって行を定義するこの例では、つまり、各データ項目は、独自の行です。 外側のループには、新しい項目が作成されます (`<li>`要素)、順序付きリストの内部 (`<ol>`要素)。

    内側のループは、区切り記号としてコンマを使用して項目 (フィールド) に各データ行を分割します。 (前の例に基づいて、つまり、各行には、3 つのフィールド &#8212;が含まれている、コンマで区切って名、姓、名、および電子メール アドレス)。また、内側のループを作成、`<ul>`データ行の各フィールドの項目リストと 1 つの一覧を表示します。

    コードでは、次の 2 つのデータ型、配列を使用する方法を示しています。 および`char`データ型。 配列が必要な`File.ReadAllLines`メソッドを配列としてデータを返します。 `char`ために、データ型が必要、`Split`メソッドを返します、`array`型の各要素は`char`します。 (配列については、次を参照してください[Introduction to ASP.NET Web プログラミング構文を使用して、Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_CollectionsAndObjects)。)。
3. ブラウザーでページを実行します。 前の例については、入力したデータが表示されます。 

    ![[イメージ]](working-with-files/_static/image4.jpg)

> [!TIP] 
> 
> **Microsoft Excel のコンマ区切りファイルからデータを表示します。**
> 
> コンマ区切りファイルとしてワークシートに含まれるデータを保存する Microsoft Excel を使用することができます (*.csv*ファイル)。 操作を実行すると、ファイルは、Excel 形式ではなく、プレーン テキストで保存されます。 スプレッドシート内の各行は、テキスト ファイル内での改行で区切られているし、各データ項目はコンマで区切られます。 コード内で、データ ファイルの名前を変更するだけで、Excel のコンマ区切りファイルを読み取るには、前の例に示すようにコードを使用できます。


<a id="Deleting_Files"></a>
## <a name="deleting-files"></a>ファイルを削除します。

使用することができます、web サイトからファイルを削除する、`File.Delete`メソッドです。 この手順は、イメージを削除できるようにする方法を示します (*.jpg*ファイル) から、*イメージ*フォルダー、ファイルの名前がわかっている場合。

> [!NOTE] 
> 
> **重要な**実稼働 web サイトで通常を制限する、データ変更を許可するユーザー。 メンバーシップを設定する方法の詳細と、サイトでタスクを実行するユーザーを承認する方法について、次を参照してください。[追加のセキュリティと ASP.NET Web Pages サイトにメンバーシップ](https://go.microsoft.com/fwlink/?LinkId=202904)です。


1. という名前のサブフォルダーを作成、web サイトで*イメージ*です。
2. 1 つまたは複数のコピー *.jpg*へのファイル、*イメージ*フォルダーです。
3. Web サイトのルートで、という名前の新しいファイルを作成する*FileDelete.cshtml*です。
4. 次のように、既存のコンテンツを置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample6.cshtml)]

    このページには、ユーザーが画像ファイルの名前を入力できるフォームが含まれています。 これらを入力しないで、 *.jpg* ; のファイル名拡張子を次のように、ファイル名を制限するには、必要なヘルプできないように、サイト上の任意のファイルを削除します。

    コードは、ファイル名をユーザーが入力した、完全なパスを構築を読み取ります。 コードをパスを作成するには、現在の web サイトのパスを使用して (によって返される、`Server.MapPath`メソッド) では、*イメージ*フォルダー名、ユーザーが指定される名前とリテラル文字列として".jpg"です。

    ファイルをコードの呼び出しを削除する、`File.Delete`メソッドを作成した完全なパスを渡します。 マークアップの最後に、コードには、ファイルが削除されたことの確認メッセージが表示されます。
5. ブラウザーでページを実行します。 

    ![[イメージ]](working-with-files/_static/image5.jpg)
6. 削除し、をクリックし、ファイルの名前を入力**送信**です。 ファイルが削除された場合は、ページの下部にあるファイルの名前が表示されます。

<a id="Letting_Users_Upload_a_File"></a>
## <a name="letting-users-upload-a-file"></a>ユーザー アップロード ファイル

`FileUpload`ヘルパーのできますが、web サイトにファイルをアップロードします。 次の手順では、ユーザーが 1 つのファイルをアップロードできるようにする方法を示します。

1. 説明に従って、ASP.NET Web Helpers Library を web サイトに追加[ASP.NET Web Pages サイトをインストールするヘルパー](https://go.microsoft.com/fwlink/?LinkId=252372)以前追加しなかった場合、します。
2. *アプリ\_データ*フォルダーで、新しいフォルダーを作成し、名前を付けます*UploadedFiles*です。
3. ルートで、という名前の新しいファイルを作成する*FileUpload.cshtml*です。
4. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](working-with-files/samples/sample7.cshtml)]

    ページの本文部分を使用して、`FileUpload`アップロード ボックスとボタンに慣れている可能性がありますを作成するためのヘルパー。

    ![[イメージ]](working-with-files/_static/image6.jpg)

    プロパティの設定を`FileUpload`ヘルパーをアップロードするファイルの 1 つの箱をすることと読み取りに送信 ボタンをすることを指定**アップロード**です。 (複数のボックスは記事の後半で追加されます)。

    ユーザーがクリックしたとき**アップロード**ページの上部にあるコード ファイルを取得し、保存します。 `Request`フォーム フィールドから値を取得するために通常使用オブジェクトもあります、`Files`ファイル (複数可) を格納する配列をアップロードされています。 配列 &#8212; 内の特定の位置からの個々 のファイルを取得することができます。たとえば、最初のアップロードされたファイルを取得するには、取得する`Request.Files[0]`、2 番目のファイルを取得するを取得する`Request.Files[1]`のようにします。 (前に説明をプログラミングでは、通常のカウントは 0 から始まります。

    変数に格納する、アップロードされたファイルをフェッチするときに (ここでは、 `uploadedFile`) それを操作することができるようにします。 取得するだけのアップロードされたファイルの名前を確認するには、その`FileName`プロパティです。 ただし、ユーザーが、ファイルをアップロードすると`FileName`全体のパスを含む、ユーザーの元名が含まれています。 これは、次のようになります可能性があります。

    *C:\Users\Public\Sample.txt*

    たくない、すべてのパス情報は、サーバーは、ユーザーのコンピューター上のパスであるためです。 実際のファイル名をするだけ (*Sample.txt*)。 パスからファイルだけを除去するを使用して、`Path.GetFileName`メソッドは、次のようにします。

    [!code-csharp[Main](working-with-files/samples/sample8.cs)]

    `Path`オブジェクトがパスの除去、パスの結合に表示されを使用できる次のようにメソッドの数を持つユーティリティです。

    アップロードされたファイルの名前を取得した後、は、web サイトにアップロードされたファイルを格納する新しいパスを構築できます。 この場合を結合する`Server.MapPath`、フォルダーの名前 (*アプリ\_データ/UploadedFiles*)、および新しいパスを作成する新しく除去されたファイル名。 アップロードされたファイルを呼び出すことができますし、`SaveAs`メソッドを実際には、ファイルを保存します。
5. ブラウザーでページを実行します。 

    ![[イメージ]](working-with-files/_static/image7.jpg)
6. をクリックして**参照**しアップロードするファイルを選択します。 

    ![[イメージ]](working-with-files/_static/image8.jpg)

    テキスト ボックスの隣に、**参照**ボタンは、パスとファイルの場所が含まれます。

    ![[イメージ]](working-with-files/_static/image9.jpg)
7. **[アップロード]**をクリックします。
8. Web サイトで、プロジェクト フォルダーを右クリックしをクリックして**更新**です。
9. 開く、 *UploadedFiles*フォルダーです。 アップロードしたファイルは、フォルダーにです。 

    ![[イメージ]](working-with-files/_static/image10.jpg)

<a id="Letting_Users_Upload_Multiple_Files"></a>
## <a name="letting-users-upload-multiple-files"></a>通知ユーザーは、複数のファイルをアップロードします。

前の例では、1 つのファイルをアップロードするユーザーを使用できます。 使用することができますが、`FileUpload`一度に 1 つ以上のファイルをアップロードするためのヘルパー。 これは、面倒ここでは、一度に 1 つのファイルをアップロードする写真をアップロードするようなシナリオに便利です。 (写真のアップロードについて[ASP.NET Web Pages サイトでのイメージを操作](https://go.microsoft.com/fwlink/?LinkId=202897))。この例では、以上のことをアップロードすると同じ手法を使用できますが、ユーザーが、一度に 2 つのアップロードを通知する方法を示します。

1. 説明に従って、ASP.NET Web Helpers Library を web サイトに追加[ASP.NET Web Pages サイトをインストールするヘルパー](https://go.microsoft.com/fwlink/?LinkId=252372)まだ行っていない場合は、します。
2. という名前の新しいページを作成する*FileUploadMultiple.cshtml*です。
3. ページで、既存のコンテンツを次のように置き換えます。  

    [!code-cshtml[Main](working-with-files/samples/sample9.cshtml)]

    この例では、`FileUpload`ヘルパー ページの本文には既定でユーザーが 2 つのファイルをアップロードできるように構成されます。 `allowMoreFilesToBeAdded`に設定されている`true`ヘルパーがユーザーが複数のアップロード ボックスを追加できるリンクを表示します。

    ![[イメージ]](working-with-files/_static/image11.jpg)

    コードをユーザーにアップロードするファイルを処理するには、前の例 &#8212; で使用したのと同じ基本的な手法を使用してください。ファイルを取得`Request.Files`し、保存します。 (さまざまな項目を含む必要があります、正しいファイル名とパスを取得するためです。)イノベーションこの時間は、ユーザーが複数のファイルをアップロードする可能性があります多くかわからないです。 取得することができますを調べるに`Request.Files.Count`です。

    手の形でこの番号をループできます`Request.Files`、さらに、各ファイルをフェッチし、保存します。 コレクションを既知回数をループするには、ときに行うこともできます、`for`ループは、次のようにします。

    [!code-csharp[Main](working-with-files/samples/sample10.cs)]

    変数`i`一時カウンターは、どのような上限を設定するには 0 からあるだけです。 ここでは、数の上限は、ファイルの数です。 1 つ未満のファイルの数に上限値を実際には、カウンターは、0 の場合は ASP.NET でのシナリオのカウントの一般的なことから開始するためです。 (次の 3 つのファイルをアップロードすると場合、カウントは 2 にゼロ) です。

    `uploadedCount`変数が正常にアップロードされ、保存されているすべてのファイルを合計します。 このコードでは、必要なファイルをアップロードすることができない可能性がある可能性が優先されます。
4. ブラウザーでページを実行します。 ブラウザーでは、ページと 2 つのアップロード ボックスが表示されます。
5. アップロードする 2 つのファイルを選択します。
6. をクリックして**別のファイル追加**です。 ページには、新しいアップロードのボックスが表示されます。 

    ![[イメージ]](working-with-files/_static/image12.jpg)
7. **[アップロード]**をクリックします。
8. Web サイトで、プロジェクト フォルダーを右クリックしをクリックして**更新**です。
9. 開く、 *UploadedFiles*フォルダーを正常にアップロードされたファイルを参照してください。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース


[ASP.NET Web Pages サイトでの画像の操作](https://go.microsoft.com/fwlink/?LinkId=202897)

[CSV ファイルにエクスポートします。](https://msdn.microsoft.com/library/ms155919.aspx)
