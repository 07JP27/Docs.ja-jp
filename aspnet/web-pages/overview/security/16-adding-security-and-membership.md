---
uid: web-pages/overview/security/16-adding-security-and-membership
title: "ページ (Razor) サイトの ASP.NET Web へのセキュリティとメンバーシップの追加 |Microsoft ドキュメント"
author: tfitzmac
description: "この章では、一部のページがログインするユーザーにのみ使用できるように、web サイトをセキュリティで保護する方法を示します。 (もわかりますページ tha... を作成する方法"
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/24/2014
ms.topic: article
ms.assetid: 7a77c2c0-deea-4290-a9c3-97958891758e
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/security/16-adding-security-and-membership
msc.type: authoredcontent
ms.openlocfilehash: af2eeb128cff554e7ae3d903e2117861087344e9
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="adding-security-and-membership-to-an-aspnet-web-pages-razor-site"></a><span data-ttu-id="45259-104">ASP.NET Web Pages (Razor) サイトへのセキュリティとメンバーシップの追加</span><span class="sxs-lookup"><span data-stu-id="45259-104">Adding Security and Membership to an ASP.NET Web Pages (Razor) Site</span></span>
====================
<span data-ttu-id="45259-105">によって[Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="45259-105">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="45259-106">この記事では、ASP.NET Web Pages (Razor) の web サイトをセキュリティで保護するページの一部がログインするユーザーにのみ使用できるようにする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45259-106">This article explains how to secure an ASP.NET Web Pages (Razor) website so that some of the pages are available only to people who log in.</span></span> <span data-ttu-id="45259-107">(もわかりますだれでもアクセスできるページを作成する方法。)</span><span class="sxs-lookup"><span data-stu-id="45259-107">(You'll also see how to create pages that anyone can access.)</span></span>
> 
> <span data-ttu-id="45259-108">**学習する内容。**</span><span class="sxs-lookup"><span data-stu-id="45259-108">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="45259-109">できるように、一部のページのみのメンバーへのアクセスを制限することができます、登録ページ、およびログイン ページを持つ web サイトを作成する方法。</span><span class="sxs-lookup"><span data-stu-id="45259-109">How to create a website that has a registration page and a login page so that for some pages you can limit access to only members.</span></span>
> - <span data-ttu-id="45259-110">パブリックおよびメンバー専用のページを作成する方法。</span><span class="sxs-lookup"><span data-stu-id="45259-110">How to create public and member-only pages.</span></span>
> - <span data-ttu-id="45259-111">サイトでさまざまなセキュリティ アクセス許可を持つグループのロールを定義する方法と、ロールにユーザーを割り当てる方法です。</span><span class="sxs-lookup"><span data-stu-id="45259-111">How to define roles, which are groups that have different security permissions on your site, and how to assign users to a role.</span></span>
> - <span data-ttu-id="45259-112">CAPTCHA を使用して自動プログラム (bot) がメンバーのアカウントを作成することを防止する方法です。</span><span class="sxs-lookup"><span data-stu-id="45259-112">How to use CAPTCHA to prevent automated programs (bots) from creating member accounts.</span></span>
>   
> 
> <span data-ttu-id="45259-113">アーティクルで導入された ASP.NET 機能を次に示します。</span><span class="sxs-lookup"><span data-stu-id="45259-113">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="45259-114">WebMatrix**スターター サイト**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-114">The WebMatrix **Starter Site** template.</span></span>
> - <span data-ttu-id="45259-115">`WebSecurity`ヘルパーと`Roles`クラスです。</span><span class="sxs-lookup"><span data-stu-id="45259-115">The `WebSecurity` helper and `Roles` class.</span></span>
> - <span data-ttu-id="45259-116">`ReCaptcha`ヘルパー。</span><span class="sxs-lookup"><span data-stu-id="45259-116">The `ReCaptcha` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="45259-117">このチュートリアルで使用されているソフトウェアのバージョン</span><span class="sxs-lookup"><span data-stu-id="45259-117">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="45259-118">ASP.NET Web Pages (Razor) 2</span><span class="sxs-lookup"><span data-stu-id="45259-118">ASP.NET Web Pages (Razor) 2</span></span>
> - <span data-ttu-id="45259-119">WebMatrix 3</span><span class="sxs-lookup"><span data-stu-id="45259-119">WebMatrix 3</span></span>
> - <span data-ttu-id="45259-120">ASP.NET Web Helpers Library</span><span class="sxs-lookup"><span data-stu-id="45259-120">ASP.NET Web Helpers Library</span></span>


<span data-ttu-id="45259-121">ユーザーがその &#8212; にログインできるように、web サイトを設定することができます。つまり、サイトをサポートするよう*メンバーシップ*です。</span><span class="sxs-lookup"><span data-stu-id="45259-121">You can set up your website so that users can log into it &#8212; that is, so that the site supports *membership*.</span></span> <span data-ttu-id="45259-122">これができます、さまざまな理由です。</span><span class="sxs-lookup"><span data-stu-id="45259-122">This can be useful for many reasons.</span></span> <span data-ttu-id="45259-123">たとえば、サイトには、メンバーにのみ利用できるようにページがあります。</span><span class="sxs-lookup"><span data-stu-id="45259-123">For example, your site might have pages that should be available only to members.</span></span> <span data-ttu-id="45259-124">場合によっては、ユーザーにフィードバックを送信するか、コメントのままにするためにログインが求められます。</span><span class="sxs-lookup"><span data-stu-id="45259-124">In some cases, you might require users to log in in order to send you feedback or leave a comment.</span></span>

<span data-ttu-id="45259-125">ユーザーが web サイトにメンバーシップをサポートしている場合でも、サイトの一部のページを使用する前にログインする必要があります。</span><span class="sxs-lookup"><span data-stu-id="45259-125">Even if your website supports membership, users aren't necessarily required to log in before they use some of the pages on the site.</span></span> <span data-ttu-id="45259-126">ログインしていないユーザーと呼ばれる*匿名ユーザー*です。</span><span class="sxs-lookup"><span data-stu-id="45259-126">Users who aren't logged in are known as *anonymous users*.</span></span>

<span data-ttu-id="45259-127">ユーザーは、web サイトに登録できますをことができますし、サイトにログインします。</span><span class="sxs-lookup"><span data-stu-id="45259-127">A user can register on your website and can then log in to the site.</span></span> <span data-ttu-id="45259-128">Web サイトでは、ユーザー名 (電子メール アドレス) とユーザーがユーザー本人であることを確認するためのパスワードが必要です。</span><span class="sxs-lookup"><span data-stu-id="45259-128">The website requires a user name (an email address) and a password to confirm that users are who they claim to be.</span></span> <span data-ttu-id="45259-129">ログインおよびユーザーの身元を確認するには、このプロセスと呼ばれる*認証*です。</span><span class="sxs-lookup"><span data-stu-id="45259-129">This process of logging in and confirming a user's identity is known as *authentication*.</span></span>

<span data-ttu-id="45259-130">さまざまな方法でセキュリティとメンバーシップを設定することができます。</span><span class="sxs-lookup"><span data-stu-id="45259-130">You can set up security and membership in different ways:</span></span>

- <span data-ttu-id="45259-131">基に新しいサイトを作成する簡単な方法は、WebMatrix を使用している場合、**スターター サイト**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-131">If you're using WebMatrix, an easy way is to create as new site based on the **Starter Site** template.</span></span> <span data-ttu-id="45259-132">このテンプレートは、セキュリティおよびメンバーシップは既に構成されており、既に登録ページ、ログイン ページとなど。</span><span class="sxs-lookup"><span data-stu-id="45259-132">This template is already configured for security and membership and already has a registration page, a login page, and so on.</span></span>

    <span data-ttu-id="45259-133">テンプレートによって作成されたサイトでは、ユーザーが Twitter または Facebook、Google などの外部のサイトを使用してログインできるようにするオプションもあります。</span><span class="sxs-lookup"><span data-stu-id="45259-133">The site created by the template also has an option to let users log in using an external site like Facebook, Google, or Twitter.</span></span>
- <span data-ttu-id="45259-134">既存のサイトにセキュリティを追加する場合、または使用しない場合、**スターター サイト**テンプレート、独自の登録 ページ、ログイン ページおよびなどを作成できます。</span><span class="sxs-lookup"><span data-stu-id="45259-134">If you want to add security to an existing site, or if you don't want to use the **Starter Site** template, you can create your own registration page, login page, and so on.</span></span>

<span data-ttu-id="45259-135">この記事は、最初のオプションの焦点を当てています&mdash;を使用してセキュリティを追加する方法、**スターター サイト**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-135">This article focuses on the first option &mdash; how to add security by using the **Starter Site** template.</span></span> <span data-ttu-id="45259-136">独自のセキュリティを実装する方法に関する基本的な情報を提供しを実行する方法に関する詳細情報へのリンクを提供します。</span><span class="sxs-lookup"><span data-stu-id="45259-136">It also provides some basic information about how to implement your own security and then provides links to more information about how to do that.</span></span> <span data-ttu-id="45259-137">別の記事で詳しく説明されている外部のログインを有効にする方法に関する情報もあります。</span><span class="sxs-lookup"><span data-stu-id="45259-137">There is also information about how to enable external logins, which is described in more detail in a separate article.</span></span>

## <a name="creating-website-security-using-the-starter-site-template"></a><span data-ttu-id="45259-138">スターター サイト テンプレートを使用して web サイトのセキュリティを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-138">Creating Website Security Using the Starter Site Template</span></span>

<span data-ttu-id="45259-139">WebMatrix で使用することができます、**スターター サイト**以下を含む web サイトを作成するテンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-139">In WebMatrix, you can use the **Starter Site** template to create a website that contains the following:</span></span>

- <span data-ttu-id="45259-140">メンバー用のユーザー名とパスワードの格納に使用されるデータベースです。</span><span class="sxs-lookup"><span data-stu-id="45259-140">A database that's used to store user names and passwords for your members.</span></span>
- <span data-ttu-id="45259-141">登録ページ (新しい) の匿名ユーザーを登録できます。</span><span class="sxs-lookup"><span data-stu-id="45259-141">A registration page where anonymous (new) users can register.</span></span>
- <span data-ttu-id="45259-142">ログインとログアウト ページです。</span><span class="sxs-lookup"><span data-stu-id="45259-142">A login and logout page.</span></span>
- <span data-ttu-id="45259-143">パスワードの回復とリセット ページです。</span><span class="sxs-lookup"><span data-stu-id="45259-143">A password recovery and reset page.</span></span>

<span data-ttu-id="45259-144">次の手順では、サイトを作成し、構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45259-144">The following procedure describes how to create the site and configure it.</span></span>

1. <span data-ttu-id="45259-145">WebMatrix を開始し、、**クイック スタート** ページで、**サイトからテンプレート**です。</span><span class="sxs-lookup"><span data-stu-id="45259-145">Start WebMatrix and in the **Quick Start** page, select **Site From Template**.</span></span>
2. <span data-ttu-id="45259-146">選択、**スターター サイト**テンプレートをクリックして**OK**です。</span><span class="sxs-lookup"><span data-stu-id="45259-146">Select the **Starter Site** template and then click **OK**.</span></span> <span data-ttu-id="45259-147">WebMatrix では、新しいサイトを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-147">WebMatrix creates a new site.</span></span>
3. <span data-ttu-id="45259-148">左側のウィンドウでをクリックして、**ファイル**ワークスペース セレクター。</span><span class="sxs-lookup"><span data-stu-id="45259-148">In the left pane, click the **Files** workspace selector.</span></span>
4. <span data-ttu-id="45259-149">Web サイトのルート フォルダーで開く、  *\_AppStart.cshtml*ファイル。 これはグローバル設定を格納するために使用される特別なファイルです。</span><span class="sxs-lookup"><span data-stu-id="45259-149">In the root folder of your website, open the *\_AppStart.cshtml* file, which is a special file that's used to contain global settings.</span></span> <span data-ttu-id="45259-150">コメント アウトを使用していくつかのステートメントが含まれている、`//`文字。</span><span class="sxs-lookup"><span data-stu-id="45259-150">It contains some statements that are commented out using the `//` characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample1.cs)]

    <span data-ttu-id="45259-151">これらのステートメントを構成、`WebMail`ヘルパーに渡し、電子メールを送信するために使用できます。</span><span class="sxs-lookup"><span data-stu-id="45259-151">These statements configure the `WebMail` helper, which can be used to send email.</span></span> <span data-ttu-id="45259-152">メンバーシップ システムは、ユーザーが登録時に、またはパスワードを変更するときに確認メッセージを送信するのに電子メールを使用できます。</span><span class="sxs-lookup"><span data-stu-id="45259-152">The membership system can use email to send confirmation messages when users register or when they want to change their passwords.</span></span> <span data-ttu-id="45259-153">(たとえば、ユーザーが登録した後、取得、登録プロセスを完了するためをクリックしてリンクを含む電子メールです。)</span><span class="sxs-lookup"><span data-stu-id="45259-153">(For example, after users register, they get an email that includes a link that they can click in order to finish the registration process.)</span></span>

    <span data-ttu-id="45259-154">」の説明に従って、SMTP サーバーへのアクセスを要求する電子メールを送信する[ASP.NET Web Pages サイトを追加する電子メール](https://go.microsoft.com/fwlink/?LinkId=202899)です。</span><span class="sxs-lookup"><span data-stu-id="45259-154">Sending email requires access to an SMTP server, as described in [Adding Email to an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=202899).</span></span> <span data-ttu-id="45259-155">電子メールの設定この部に保存する *\_AppStart.cshtml*ファイルの電子メールを送信する各ページに繰り返しにコーディングする必要があるないようにします。</span><span class="sxs-lookup"><span data-stu-id="45259-155">You'll store the email settings in this central *\_AppStart.cshtml* file so that you don't have to code them repeatedly into each page that can send email.</span></span> <span data-ttu-id="45259-156">(登録データベースを設定する SMTP 設定を構成する必要はありません。 電子メールのエイリアスからユーザーを検証し、忘れたパスワードをリセットできるようにする場合にのみ、SMTP の設定が必要)</span><span class="sxs-lookup"><span data-stu-id="45259-156">(You don't need to configure SMTP settings to set up a registration database; you only need SMTP settings if you want to validate users from their email alias and let users reset a forgotten password.)</span></span>
5. <span data-ttu-id="45259-157">削除することで、ステートメントのコメントを解除`//`前にある 1 つずつです。</span><span class="sxs-lookup"><span data-stu-id="45259-157">Uncomment the statements by removing `//` from in front of each one.</span></span>

    <span data-ttu-id="45259-158">確認の電子メールを設定しない場合は、この手順と次の手順を省略できます。</span><span class="sxs-lookup"><span data-stu-id="45259-158">If you do not want to set up email confirmation, you can skip this step and the next step.</span></span> <span data-ttu-id="45259-159">SMTP の値が設定されていない場合、新しいアカウントが確認の電子メールなしですぐに利用できます。</span><span class="sxs-lookup"><span data-stu-id="45259-159">If the SMTP values are not set, the new account is immediately available without a confirmation email.</span></span>
6. <span data-ttu-id="45259-160">コードの次の電子メールに関連する設定を変更します。</span><span class="sxs-lookup"><span data-stu-id="45259-160">Modify the following email-related settings in the code:</span></span>

    - <span data-ttu-id="45259-161">設定`WebMail.SmtpServer`へのアクセスが SMTP サーバーの名前にします。</span><span class="sxs-lookup"><span data-stu-id="45259-161">Set `WebMail.SmtpServer` to the name of the SMTP server that you have access to.</span></span>
    - <span data-ttu-id="45259-162">ままにして`WebMail.EnableSsl`'éý'`true`です。</span><span class="sxs-lookup"><span data-stu-id="45259-162">Leave `WebMail.EnableSsl` set to `true`.</span></span> <span data-ttu-id="45259-163">この設定は、暗号化して、SMTP サーバーに送信される資格情報を保護します。</span><span class="sxs-lookup"><span data-stu-id="45259-163">This setting secures the credentials that are sent to the SMTP server by encrypting them.</span></span>
    - <span data-ttu-id="45259-164">設定`WebMail.UserName`SMTP サーバーのアカウントのユーザー名にします。</span><span class="sxs-lookup"><span data-stu-id="45259-164">Set `WebMail.UserName` to the user name for your SMTP server account.</span></span>
    - <span data-ttu-id="45259-165">設定`WebMail.Password`SMTP サーバーのアカウントのパスワードにします。</span><span class="sxs-lookup"><span data-stu-id="45259-165">Set `WebMail.Password` to the password for your SMTP server account.</span></span>
    - <span data-ttu-id="45259-166">設定`WebMail.From`の電子メール アドレス。</span><span class="sxs-lookup"><span data-stu-id="45259-166">Set `WebMail.From` to your own email address.</span></span> <span data-ttu-id="45259-167">これは、メッセージの送信元電子メール アドレスです。</span><span class="sxs-lookup"><span data-stu-id="45259-167">This is the email address that the message is sent from.</span></span>

    > [!NOTE] 
    > 
    > <span data-ttu-id="45259-168">**ヒント:**これらのプロパティの値についての詳細については、次を参照してください。[電子メール設定を構成する](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings)で[サイト全体の動作をカスタマイズする ASP.NET Web Pages の](https://go.microsoft.com/fwlink/?LinkID=202906)します。</span><span class="sxs-lookup"><span data-stu-id="45259-168">**Tip** For additional information about the values for these properties, see [Configuring Email Settings](https://go.microsoft.com/fwlink/?LinkID=202906#configuring_email_settings) in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkID=202906).</span></span>
7. <span data-ttu-id="45259-169">保存して閉じる *\_AppStart.cshtml*です。</span><span class="sxs-lookup"><span data-stu-id="45259-169">Save and close *\_AppStart.cshtml*.</span></span>
8. <span data-ttu-id="45259-170">実行、 *Default.cshtml*ブラウザーのページです。</span><span class="sxs-lookup"><span data-stu-id="45259-170">Run the *Default.cshtml* page in a browser.</span></span>

    ![security-membership-2](16-adding-security-and-membership/_static/image1.png)

    > [!NOTE]
    > <span data-ttu-id="45259-172">プロパティのインスタンスである必要があることを示すエラーが発生する場合`ExtendedMembershipProvider`サイトが ASP.NET Web Pages のメンバーシップ システム (SimpleMembership) を使用して構成されていない可能性があります。</span><span class="sxs-lookup"><span data-stu-id="45259-172">If you see an error that tells you that a property must be an instance of `ExtendedMembershipProvider`, the site might not be configured to use the ASP.NET Web Pages membership system (SimpleMembership).</span></span> <span data-ttu-id="45259-173">ホスティング プロバイダーのサーバーの構成は、ローカル サーバーとは異なる場合があることができます。</span><span class="sxs-lookup"><span data-stu-id="45259-173">This can sometimes occur if a hosting provider's server is configured differently than your local server.</span></span> <span data-ttu-id="45259-174">この問題を解決するをサイトの次の要素を追加*Web.config*ファイル。</span><span class="sxs-lookup"><span data-stu-id="45259-174">To fix this, add the following element to the site's *Web.config* file:</span></span>
    > 
    > [!code-xml[Main](16-adding-security-and-membership/samples/sample2.xml)]
    > 
    > <span data-ttu-id="45259-175">この要素の子として追加、`<configuration>`要素とのピアとして、`<system.web>`要素。</span><span class="sxs-lookup"><span data-stu-id="45259-175">Add this element as a child of the `<configuration>` element and as a peer of the `<system.web>` element.</span></span>
9. <span data-ttu-id="45259-176">ページの右上隅で、クリックして、**登録**リンクします。</span><span class="sxs-lookup"><span data-stu-id="45259-176">In the upper-right corner of the page, click the **Register** link.</span></span> <span data-ttu-id="45259-177">*Register.cshtml*ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45259-177">The *Register.cshtml* page is displayed.</span></span>
10. <span data-ttu-id="45259-178">ユーザー名とパスワードを入力し、クリックして**登録**です。</span><span class="sxs-lookup"><span data-stu-id="45259-178">Enter a user name and password and then click **Register**.</span></span>

    ![security-membership-3](16-adding-security-and-membership/_static/image2.png)

    <span data-ttu-id="45259-180">Web サイトを作成したときに、**スターター サイト**テンプレート、という名前のデータベース*StarterSite.sdf* 、サイトで作成された*アプリ\_データ*フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="45259-180">When you created the website from the **Starter Site** template, a database named *StarterSite.sdf* was created in the site's *App\_Data* folder.</span></span> <span data-ttu-id="45259-181">登録の際に、ユーザー情報がデータベースに追加されます。</span><span class="sxs-lookup"><span data-stu-id="45259-181">During registration, your user information is added to the database.</span></span> <span data-ttu-id="45259-182">SMTP 値を設定すると、メッセージは、登録を完了するために使用する電子メール アドレスに送信します。</span><span class="sxs-lookup"><span data-stu-id="45259-182">If you set the SMTP values, a message is sent to the email address you used so you can finish registering.</span></span>

    ![security-membership-4](16-adding-security-and-membership/_static/image3.png)
11. <span data-ttu-id="45259-184">電子メール プログラムに移動し、サイトに、確認コードとハイパーリンクを持つメッセージを検索します。</span><span class="sxs-lookup"><span data-stu-id="45259-184">Go to your email program and find the message, which will have your confirmation code and a hyperlink to the site.</span></span>
12. <span data-ttu-id="45259-185">自分のアカウントをアクティブ化するハイパーリンクをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45259-185">Click the hyperlink to activate your account.</span></span> <span data-ttu-id="45259-186">確認のハイパーリンクは、登録の確認 ページを開きます。</span><span class="sxs-lookup"><span data-stu-id="45259-186">The confirmation hyperlink opens a registration confirmation page.</span></span>

    ![security-membership-5](16-adding-security-and-membership/_static/image4.png)
- <span data-ttu-id="45259-188">クリックして、**ログイン**リンク、および登録したアカウントを使用してサインインします。</span><span class="sxs-lookup"><span data-stu-id="45259-188">Click the **Login** link, and then log in using the account that you registered.</span></span>

    <span data-ttu-id="45259-189">ログインした後、**ログイン**と**登録**はリンクに置き換え、**ログアウト**リンク。</span><span class="sxs-lookup"><span data-stu-id="45259-189">After you log in, the **Login** and **Register** links are replaced by a **Logout** link.</span></span> <span data-ttu-id="45259-190">ユーザーのログイン名は、リンクとして表示されます。</span><span class="sxs-lookup"><span data-stu-id="45259-190">Your login name is displayed as a link.</span></span> <span data-ttu-id="45259-191">(リンクできますページに移動するパスワードを変更することができます。)</span><span class="sxs-lookup"><span data-stu-id="45259-191">(The link lets you go to a page where you can change your password.)</span></span>

    ![security-membership-6](16-adding-security-and-membership/_static/image5.png)

    > [!NOTE]
    > <span data-ttu-id="45259-193">既定では、ASP.NET web ページの資格情報をサーバーにクリア テキストで (として送信人間が判読できるテキスト)。</span><span class="sxs-lookup"><span data-stu-id="45259-193">By default, ASP.NET web pages send credentials to the server in clear text (as human-readable text).</span></span> <span data-ttu-id="45259-194">運用サイトは、セキュリティで保護された HTTP を使用する必要があります (https://とも呼ばれる、 *secure socket layer*または SSL) サーバーと交換される機密情報を暗号化します。</span><span class="sxs-lookup"><span data-stu-id="45259-194">A production site should use secure HTTP (https://, also known as the *secure sockets layer* or SSL) to encrypt sensitive information that's exchanged with the server.</span></span> <span data-ttu-id="45259-195">必要な電子メールを作成することができます送信されるメッセージを設定して SSL を使用して`WebMail.EnableSsl=true`前の例に示すようにします。</span><span class="sxs-lookup"><span data-stu-id="45259-195">You can required email messages to be sent using SSL by setting `WebMail.EnableSsl=true` as in the previous example.</span></span> <span data-ttu-id="45259-196">SSL の詳細については、次を参照してください。 [Web 通信のセキュリティ保護: 証明書、SSL、および https://](https://go.microsoft.com/fwlink/?LinkId=208660)です。</span><span class="sxs-lookup"><span data-stu-id="45259-196">For more information about SSL, see [Securing Web Communications: Certificates, SSL, and https://](https://go.microsoft.com/fwlink/?LinkId=208660).</span></span>

## <a name="additional-membership-functionality-in-the-site"></a><span data-ttu-id="45259-197">サイトの追加のメンバーシップ機能</span><span class="sxs-lookup"><span data-stu-id="45259-197">Additional Membership Functionality in the Site</span></span>

<span data-ttu-id="45259-198">サイトには、ユーザーがそのアカウントを管理できるその他の機能が含まれています。</span><span class="sxs-lookup"><span data-stu-id="45259-198">Your site contains other functionality that lets users manage their accounts.</span></span> <span data-ttu-id="45259-199">ユーザーは、次の操作を行うことができます。</span><span class="sxs-lookup"><span data-stu-id="45259-199">Users can do the following:</span></span>

- <span data-ttu-id="45259-200">自分のパスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="45259-200">Change their passwords.</span></span> <span data-ttu-id="45259-201">ログイン後、ユーザー名 (リンク) をクリックしています。</span><span class="sxs-lookup"><span data-stu-id="45259-201">After logging in, they can click the user name (which is a link).</span></span> <span data-ttu-id="45259-202">これは、ページに、新しいパスワードを作成することができます (*Account/ChangePassword.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="45259-202">This takes them to a page where they can create a new password (*Account/ChangePassword.cshtml*).</span></span>
- <span data-ttu-id="45259-203">パスワードを忘れても回復します。</span><span class="sxs-lookup"><span data-stu-id="45259-203">Recover a forgotten password.</span></span> <span data-ttu-id="45259-204">[ログイン] ページでは、リンク (**するパスワードを忘れましたしますか?**) ページにユーザーを受け取る (*Account/ForgotPassword.cshtml*)、電子メール アドレスを入力することができます。</span><span class="sxs-lookup"><span data-stu-id="45259-204">On the login page, there's a link (**Did you forget your password?**) that takes users to a page (*Account/ForgotPassword.cshtml*) where they can enter an email address.</span></span> <span data-ttu-id="45259-205">サイトには新しいパスワードを設定するためをクリックしてリンクを含む電子メール メッセージを送信して (*Account/PasswordReset.cshtml*)。</span><span class="sxs-lookup"><span data-stu-id="45259-205">The site sends them an email message that has a link that they can click in order to set a new password (*Account/PasswordReset.cshtml*).</span></span>

<span data-ttu-id="45259-206">後で説明するよう、外部のサイトを使用してログインできますもユーザーを指定することもできます。</span><span class="sxs-lookup"><span data-stu-id="45259-206">You can also let users can also log in using an external site, as explained later.</span></span>

<a id="Creating_a_Members-Only_Page"></a>
## <a name="creating-a-members-only-page"></a><span data-ttu-id="45259-207">メンバー専用のページを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-207">Creating a Members-Only Page</span></span>

<span data-ttu-id="45259-208">当面の web サイト内の任意のページに誰でも参照できます。</span><span class="sxs-lookup"><span data-stu-id="45259-208">For the time being, anyone can browse to any page in your website.</span></span> <span data-ttu-id="45259-209">ログインしている人にのみ使用するページがあることができますが、(つまり、メンバーに)。</span><span class="sxs-lookup"><span data-stu-id="45259-209">But you might want to have pages that are available only to people who have logged in (that is, to members).</span></span> <span data-ttu-id="45259-210">ASP.NET では、ログインのメンバーでのみアクセスできるページを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="45259-210">ASP.NET lets you create pages that can be accessed only by logged-in members.</span></span> <span data-ttu-id="45259-211">通常、匿名ユーザーは、メンバーだけがページにアクセスすると、リダイレクトすることにログイン ページに。</span><span class="sxs-lookup"><span data-stu-id="45259-211">Typically, if anonymous users try to access a members-only page, you redirect them to the login page.</span></span>

<span data-ttu-id="45259-212">この手順では、ログインしているユーザーにのみ使用可能なページを格納するフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-212">In this procedure, you'll create a folder that will contain pages that are available only to logged-in users.</span></span>

1. <span data-ttu-id="45259-213">サイトのルート ディレクトリにある新しいフォルダーを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-213">At the root of the site, create a new folder.</span></span> <span data-ttu-id="45259-214">(、リボンの下にある矢印をクリックして**新規**を選択し**新しいフォルダー**)。</span><span class="sxs-lookup"><span data-stu-id="45259-214">(In the ribbon, click the arrow underneath **New** and then choose **New Folder**.)</span></span>
2. <span data-ttu-id="45259-215">新しいフォルダーの名前を付けます*メンバー*です。</span><span class="sxs-lookup"><span data-stu-id="45259-215">Name the new folder *Members*.</span></span>
3. <span data-ttu-id="45259-216">内部、*メンバー*フォルダーで、新しいページを作成し、という名前が*MembersInformation.cshtml*です。</span><span class="sxs-lookup"><span data-stu-id="45259-216">Inside the *Members* folder, create a new page and named it *MembersInformation.cshtml*.</span></span>
4. <span data-ttu-id="45259-217">既存のコンテンツを次のコードとマークアップに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45259-217">Replace the existing content with the following code and markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample3.cshtml)]

    <span data-ttu-id="45259-218">このコードはテスト、`IsAuthenticated`のプロパティ、`WebSecurity`オブジェクトを返します`true`ユーザー ログインしている場合。</span><span class="sxs-lookup"><span data-stu-id="45259-218">This code tests the `IsAuthenticated` property of the `WebSecurity` object, which returns `true` if the user has logged in.</span></span> <span data-ttu-id="45259-219">コードの呼び出しで、ユーザーがログオンしていない場合`Response.Redirect`をユーザーに送信する、 *Login.cshtml*  ページで、*アカウント*フォルダーです。</span><span class="sxs-lookup"><span data-stu-id="45259-219">If the user is not logged in, the code calls `Response.Redirect` to send the user to the *Login.cshtml* page in the *Account* folder.</span></span>

    <span data-ttu-id="45259-220">リダイレクトの URL が含まれています、`returnUrl`クエリ文字列の値を使用する`Request.Url.LocalPath`を現在のページのパスを設定します。</span><span class="sxs-lookup"><span data-stu-id="45259-220">The URL of the redirection includes a `returnUrl` query string value that uses `Request.Url.LocalPath` to set the path of the current page.</span></span> <span data-ttu-id="45259-221">設定した場合、`returnUrl`次のようにクエリ文字列内の値 (およびかどうか、戻り先 URL はローカル パス)、ログイン ページはユーザーに戻りますこのページにログインした後にします。</span><span class="sxs-lookup"><span data-stu-id="45259-221">If you set the `returnUrl` value in the query string like this (and if the return URL is a local path), the login page will return users to this page after they log in.</span></span>

    <span data-ttu-id="45259-222">コードにも設定 *\_SiteLayout.cshtml*ページとしてそのページをレイアウトします。</span><span class="sxs-lookup"><span data-stu-id="45259-222">The code also sets *\_SiteLayout.cshtml* page as its layout page.</span></span> <span data-ttu-id="45259-223">(詳細については、レイアウト ページは、次を参照してください[ASP.NET Web Pages サイトで一貫したレイアウトを作成する](https://go.microsoft.com/fwlink/?LinkId=202891)。)。</span><span class="sxs-lookup"><span data-stu-id="45259-223">(For more about layout pages, see [Creating a Consistent Layout in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202891).)</span></span>
5. <span data-ttu-id="45259-224">サイトを実行します。</span><span class="sxs-lookup"><span data-stu-id="45259-224">Run the site.</span></span> <span data-ttu-id="45259-225">ログインしていますが、クリックして、**ログアウト**ページの上部にあるボタンをクリックします。</span><span class="sxs-lookup"><span data-stu-id="45259-225">If you're still logged in, click the **Logout** button at the top of the page.</span></span>
6. <span data-ttu-id="45259-226">ブラウザーで、ページの要求*メンバー/MembersInformation*です。</span><span class="sxs-lookup"><span data-stu-id="45259-226">In the browser, request the page */Members/MembersInformation*.</span></span> <span data-ttu-id="45259-227">たとえば、URL は、次のようになります。</span><span class="sxs-lookup"><span data-stu-id="45259-227">For example, the URL might look like this:</span></span>

    `http://localhost:38366/Members/MembersInformation`

    <span data-ttu-id="45259-228">(ポート番号 (38366) は、URL の異なる.)</span><span class="sxs-lookup"><span data-stu-id="45259-228">(The port number (38366) will probably be different in your URL.)</span></span>

    <span data-ttu-id="45259-229">リダイレクトしている、 *Login.cshtml*ページで、ログインしていないためです。</span><span class="sxs-lookup"><span data-stu-id="45259-229">You're redirected to the *Login.cshtml* page, because you aren't logged in.</span></span>
- <span data-ttu-id="45259-230">以前に作成したアカウントを使用してをログインします。</span><span class="sxs-lookup"><span data-stu-id="45259-230">Log in using the account you created earlier.</span></span> <span data-ttu-id="45259-231">リダイレクトしている、 *MembersInformation*ページ。</span><span class="sxs-lookup"><span data-stu-id="45259-231">You're redirected back to the *MembersInformation* page.</span></span> <span data-ttu-id="45259-232">ログに記録しているため現時点表示ページの内容。</span><span class="sxs-lookup"><span data-stu-id="45259-232">Because you're logged in, this time you see the page contents.</span></span>

<span data-ttu-id="45259-233">保護するには複数のページへのアクセスは、これを行うことができます。</span><span class="sxs-lookup"><span data-stu-id="45259-233">To secure access to multiple pages, you can do this:</span></span>

- <span data-ttu-id="45259-234">各ページに、セキュリティ チェックを追加します。</span><span class="sxs-lookup"><span data-stu-id="45259-234">Add the security check to each page.</span></span>
- <span data-ttu-id="45259-235">作成、  *\_PageStart.cshtml*  ページで、フォルダー、保護対象のページを保存し、追加セキュリティ チェックがあります。</span><span class="sxs-lookup"><span data-stu-id="45259-235">Create a *\_PageStart.cshtml* page in the folder where you keep protected pages, and add the security check there.</span></span> <span data-ttu-id="45259-236">*\_PageStart.cshtml*ページはフォルダー内のすべてのページの [グローバル] ページの種類として機能します。</span><span class="sxs-lookup"><span data-stu-id="45259-236">The *\_PageStart.cshtml* page acts as a kind of global page for all the pages in the folder.</span></span> <span data-ttu-id="45259-237">この手法がで詳しく説明されている[サイト全体の動作をカスタマイズする ASP.NET Web Pages の](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access)します。</span><span class="sxs-lookup"><span data-stu-id="45259-237">This technique is explained in more detail in [Customizing Site-Wide Behavior for ASP.NET Web Pages](https://go.microsoft.com/fwlink/?LinkId=202906#Using__PageStart.cshtml_to_Restrict_Folder_Access).</span></span>

## <a name="creating-security-for-groups-of-users-roles"></a><span data-ttu-id="45259-238">ユーザー (ロール) のグループのセキュリティを作成します。</span><span class="sxs-lookup"><span data-stu-id="45259-238">Creating Security for Groups of Users (Roles)</span></span>

<span data-ttu-id="45259-239">サイトに多数のメンバーがある場合は、ページを参照してください。 それらを許可する前に各ユーザーのアクセス許可を個別にチェックする効率的ではありません。</span><span class="sxs-lookup"><span data-stu-id="45259-239">If your site has a lot of members, it's not efficient to check permission for each user individually before you let them see a page.</span></span> <span data-ttu-id="45259-240">グループを作成する代わりに、何ができるまたは*ロール*、個々 のメンバーに属していること。</span><span class="sxs-lookup"><span data-stu-id="45259-240">What you can do instead is to create groups, or *roles*, that individual members belong to.</span></span> <span data-ttu-id="45259-241">役割に基づいたのアクセス許可を確認し、できます。</span><span class="sxs-lookup"><span data-stu-id="45259-241">You can then check permissions based on role.</span></span> <span data-ttu-id="45259-242">このセクションで作成、&quot;管理者&quot;ロールであるユーザーにアクセス可能なページを作成し、(に属している) でそのロール。</span><span class="sxs-lookup"><span data-stu-id="45259-242">In this section, you'll create an &quot;admin&quot; role and then create a page that's accessible to users who are in (who belong to) that role.</span></span>

<span data-ttu-id="45259-243">ASP.NET メンバーシップ システムは、役割をサポートするを設定します。</span><span class="sxs-lookup"><span data-stu-id="45259-243">The ASP.NET membership system is set up to support roles.</span></span> <span data-ttu-id="45259-244">ただしとは異なりとログインのメンバーシップの登録、**スターター サイト**テンプレートが含まれていないできるページは、ロールを管理します。</span><span class="sxs-lookup"><span data-stu-id="45259-244">However, unlike membership registration and login, the **Starter Site** template does not contain pages that help you manage roles.</span></span> <span data-ttu-id="45259-245">(ロールの管理は、ユーザーのタスクではなく、管理タスクです。)ただし、WebMatrix で、メンバーシップ データベースに直接、グループを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="45259-245">(Managing roles is an administrative task rather than a user task.) However, you can add groups directly in the membership database in WebMatrix.</span></span>

1. <span data-ttu-id="45259-246">WebMatrix でをクリックして、**データベース**ワークスペース セレクター。</span><span class="sxs-lookup"><span data-stu-id="45259-246">In WebMatrix, click the **Databases** workspace selector.</span></span>
2. <span data-ttu-id="45259-247">左側のウィンドウで開く、 *StarterSite.sdf*ノード、開いている、**テーブル**ノードを展開し、ダブルクリック、 *web ページ\_ロール*テーブル。</span><span class="sxs-lookup"><span data-stu-id="45259-247">In the left pane, open the *StarterSite.sdf* node, open the **Tables** node, and then double-click the *webpages\_Roles* table.</span></span>

    ![security-membership-7](16-adding-security-and-membership/_static/image6.png)
3. <span data-ttu-id="45259-249">という名前のロールを追加&quot;admin&quot;です。</span><span class="sxs-lookup"><span data-stu-id="45259-249">Add a role named &quot;admin&quot;.</span></span> <span data-ttu-id="45259-250">*RoleId*フィールドが自動的に入力します。</span><span class="sxs-lookup"><span data-stu-id="45259-250">The *RoleId* field is filled in automatically.</span></span> <span data-ttu-id="45259-251">(主キーであるし、で説明したように、識別フィールドに設定されている[ASP.NET Web Pages サイトでのデータベース操作の概要](https://go.microsoft.com/fwlink/?LinkId=202893))。</span><span class="sxs-lookup"><span data-stu-id="45259-251">(It's the primary key and has been set to be an identify field, as explained in [Introduction to Working with a Database in ASP.NET Web Pages Sites](https://go.microsoft.com/fwlink/?LinkId=202893).)</span></span>
4. <span data-ttu-id="45259-252">新機能の値を書き留めて、 *RoleId*フィールドです。</span><span class="sxs-lookup"><span data-stu-id="45259-252">Take note of what the value is for the *RoleId* field.</span></span> <span data-ttu-id="45259-253">(最初のロールを定義している場合は、その 1 なります。)</span><span class="sxs-lookup"><span data-stu-id="45259-253">(If this is the first role you're defining, it will be 1.)</span></span>

    ![security-membership-8](16-adding-security-and-membership/_static/image7.png)
5. <span data-ttu-id="45259-255">閉じる、 *web ページ\_ロール*テーブル。</span><span class="sxs-lookup"><span data-stu-id="45259-255">Close the *webpages\_Roles* table.</span></span>
6. <span data-ttu-id="45259-256">開く、 *UserProfile*テーブル。</span><span class="sxs-lookup"><span data-stu-id="45259-256">Open the *UserProfile* table.</span></span>
7. <span data-ttu-id="45259-257">メモ、 *UserId*閉じ、テーブル、テーブル内のユーザーの 1 つ以上の値。</span><span class="sxs-lookup"><span data-stu-id="45259-257">Make a note of the *UserId* value of one or more of the users in the table and then close the table.</span></span>
8. <span data-ttu-id="45259-258">開く、 *web ページ\_UserInRoles*テーブルし、入力、 *UserID*と*RoleID*テーブルに値。</span><span class="sxs-lookup"><span data-stu-id="45259-258">Open the *webpages\_UserInRoles* table and enter a *UserID* and a *RoleID* value into the table.</span></span> <span data-ttu-id="45259-259">たとえば、ユーザー 2 にするため、 &quot;admin&quot;ロール、これらの値を入力します。</span><span class="sxs-lookup"><span data-stu-id="45259-259">For example, to put user 2 into the &quot;admin&quot; role, you'd enter these values:</span></span>

    ![security-membership-9](16-adding-security-and-membership/_static/image8.png)
9. <span data-ttu-id="45259-261">閉じる、 *web ページ\_UsersInRoles*テーブル。</span><span class="sxs-lookup"><span data-stu-id="45259-261">Close the *webpages\_UsersInRoles* table.</span></span>

    <span data-ttu-id="45259-262">これで定義されたロールがある場合は、そのロールにユーザーにアクセス可能なページを構成できます。</span><span class="sxs-lookup"><span data-stu-id="45259-262">Now that you have roles defined, you can configure a page that's accessible to users who are in that role.</span></span>
10. <span data-ttu-id="45259-263">という名前の新しいページを作成、web サイトのルート フォルダーで*AdminError.cshtml*し、既存のコンテンツを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45259-263">In the website root folder, create a new page named *AdminError.cshtml* and replace the existing content with the following code.</span></span> <span data-ttu-id="45259-264">これらのページへのアクセスが許可されていない場合にユーザーがリダイレクトされるページになります。</span><span class="sxs-lookup"><span data-stu-id="45259-264">This will be the page that users are redirected to if they aren't allowed access to a page.</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample4.cshtml)]
11. <span data-ttu-id="45259-265">という名前の新しいページを作成、web サイトのルート フォルダーで*AdminOnly.cshtml*し、既存のコードを次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="45259-265">In the website root folder, create a new page named *AdminOnly.cshtml* and replace the existing code with the following code:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample5.cshtml)]

    <span data-ttu-id="45259-266">`Roles.IsUserInRole`メソッドを返します。`true`場合、現在のユーザーは (この場合は、"admin"ロール) を指定したロールのメンバーです。</span><span class="sxs-lookup"><span data-stu-id="45259-266">The `Roles.IsUserInRole` method returns `true` if the current user is a member of the specified role (in this case, the "admin" role).</span></span>
12. <span data-ttu-id="45259-267">実行*Default.cshtml*ブラウザーでログインしないが、します。</span><span class="sxs-lookup"><span data-stu-id="45259-267">Run *Default.cshtml* in a browser, but don't log in.</span></span> <span data-ttu-id="45259-268">(既にログオンしている場合をログアウトします。)</span><span class="sxs-lookup"><span data-stu-id="45259-268">(If you're already logged in, log out.)</span></span>
13. <span data-ttu-id="45259-269">ブラウザーのアドレス バーに追加*AdminOnly* URL にします。</span><span class="sxs-lookup"><span data-stu-id="45259-269">In the browser's address bar, add *AdminOnly* in the URL.</span></span> <span data-ttu-id="45259-270">(つまり、要求、 *AdminOnly.cshtml*ファイルです)。リダイレクトしている、 *AdminError.cshtml*ページ、ログインしていない現在のユーザーとして、 &quot;admin&quot;ロール。</span><span class="sxs-lookup"><span data-stu-id="45259-270">(In other words, request the *AdminOnly.cshtml* file.) You're redirected to the *AdminError.cshtml* page, because you aren't currently logged in as a user in the &quot;admin&quot; role.</span></span>
14. <span data-ttu-id="45259-271">戻る*Default.cshtml*に追加したユーザーとしてログインし、 &quot;admin&quot;ロール。</span><span class="sxs-lookup"><span data-stu-id="45259-271">Return to *Default.cshtml* and log in as the user you added to the &quot;admin&quot; role.</span></span>
15. <span data-ttu-id="45259-272">参照*AdminOnly.cshtml*ページ。</span><span class="sxs-lookup"><span data-stu-id="45259-272">Browse to *AdminOnly.cshtml* page.</span></span> <span data-ttu-id="45259-273">この時間ページが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45259-273">This time you see the page.</span></span>

## <a name="preventing-automated-programs-from-joining-your-website"></a><span data-ttu-id="45259-274">Web サイトに参加したり、自動プログラムの防止</span><span class="sxs-lookup"><span data-stu-id="45259-274">Preventing Automated Programs from Joining Your Website</span></span>

<span data-ttu-id="45259-275">[ログイン] ページでは自動プログラムは停止しません (とも呼ば*ロボットを web*または*bot*) から web サイトに登録することです。</span><span class="sxs-lookup"><span data-stu-id="45259-275">The login page will not stop automated programs (sometimes referred to as *web robots* or *bots*) from registering with your website.</span></span> <span data-ttu-id="45259-276">この手順では、[登録] ページの ReCaptcha テストを有効にする方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="45259-276">This procedure describes how to enable a ReCaptcha test for the registration page.</span></span>

![/media/38777/ch16securitymembership-18.jpg](16-adding-security-and-membership/_static/image1.jpg)

1. <span data-ttu-id="45259-278">ReCaptcha.Net で web サイトを登録 ([http://recaptcha.net](http://recaptcha.net))。</span><span class="sxs-lookup"><span data-stu-id="45259-278">Register your website at ReCaptcha.Net ([http://recaptcha.net](http://recaptcha.net)).</span></span> <span data-ttu-id="45259-279">登録が完了したら、公開キーと秘密キーが表示されます。</span><span class="sxs-lookup"><span data-stu-id="45259-279">When you've completed registration, you'll get a public key and a private key.</span></span>
2. <span data-ttu-id="45259-280">説明に従って、ASP.NET Web Helpers Library を web サイトに追加[ASP.NET Web Pages サイトをインストールするヘルパー](https://go.microsoft.com/fwlink/?LinkId=252372)まだ行っていない場合は、します。</span><span class="sxs-lookup"><span data-stu-id="45259-280">Add the ASP.NET Web Helpers Library to your website as described in [Installing Helpers in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=252372), if you haven't already.</span></span>
3. <span data-ttu-id="45259-281">*アカウント*、開いているフォルダー、ファイルの名前*Register.cshtml*です。</span><span class="sxs-lookup"><span data-stu-id="45259-281">In the *Account* folder, open the file named *Register.cshtml*.</span></span>
4. <span data-ttu-id="45259-282">コードでは、ページの上部にある、次の行を見つけて削除することでそれらのコメントを解除、`//`コメント文字。</span><span class="sxs-lookup"><span data-stu-id="45259-282">In the code at the top of the page, find the following lines and uncomment them by removing the `//` comment characters:</span></span>

    [!code-csharp[Main](16-adding-security-and-membership/samples/sample6.cs)]
5. <span data-ttu-id="45259-283">置き換える`PRIVATE_KEY`ReCaptcha 秘密キーにします。</span><span class="sxs-lookup"><span data-stu-id="45259-283">Replace `PRIVATE_KEY` with your own ReCaptcha private key.</span></span>
6. <span data-ttu-id="45259-284">ページのマークアップでは、削除、`@*`と`*@`ページ マークアップの次の行の周りからコメント文字。</span><span class="sxs-lookup"><span data-stu-id="45259-284">In the markup of the page, remove the `@*` and `*@` commenting characters from around the following lines in the page markup:</span></span>

    [!code-cshtml[Main](16-adding-security-and-membership/samples/sample7.cshtml)]
7. <span data-ttu-id="45259-285">置き換える`PUBLIC_KEY`キーを使用します。</span><span class="sxs-lookup"><span data-stu-id="45259-285">Replace `PUBLIC_KEY` with your key.</span></span>
8. <span data-ttu-id="45259-286">削除まだしていない場合は、削除、 `<div>` 「には、CAPTCHA の確認 を有効にする」で始まるテキストが含まれる要素です。</span><span class="sxs-lookup"><span data-stu-id="45259-286">If you haven't removed it already, remove the `<div>` element that contains text that starts with "To enable CAPTCHA verification ...".</span></span> <span data-ttu-id="45259-287">(全体を削除`<div>`要素とその内容です)。</span><span class="sxs-lookup"><span data-stu-id="45259-287">(Remove the entire `<div>` element and its contents.)</span></span>

1. <span data-ttu-id="45259-288">実行*Default.cshtml*ブラウザーでします。</span><span class="sxs-lookup"><span data-stu-id="45259-288">Run *Default.cshtml* in a browser.</span></span> <span data-ttu-id="45259-289">クリックして、サイトにログインする場合、**ログアウト**リンクします。</span><span class="sxs-lookup"><span data-stu-id="45259-289">If you're logged into the site, click the **Logout** link.</span></span>
2. <span data-ttu-id="45259-290">クリックして、**登録**リンクし、CAPTCHA テストを使用して登録をテストします。</span><span class="sxs-lookup"><span data-stu-id="45259-290">Click the **Register** link and test the registration using the CAPTCHA test.</span></span>

    ![security-membership-10](16-adding-security-and-membership/_static/image9.png)

<span data-ttu-id="45259-292">詳細については、`ReCaptcha`ヘルパーに渡しを参照してください[自動プログラムを防ぐ (Bot) を使用して、ASP.NET Web サイトから、CATPCHA を使用して](https://go.microsoft.com/fwlink/?LinkId=251967)です。</span><span class="sxs-lookup"><span data-stu-id="45259-292">For more information about the `ReCaptcha` helper, see [Using a CATPCHA to Prevent Automated Programs (Bots) from Using Your ASP.NET Web Site](https://go.microsoft.com/fwlink/?LinkId=251967).</span></span>

<a id="Additional_Resources"></a>
## <a name="letting-users-log-in-using-an-external-site"></a><span data-ttu-id="45259-293">ユーザが外部のサイトを使用してログイン</span><span class="sxs-lookup"><span data-stu-id="45259-293">Letting Users Log In Using an External Site</span></span>

<span data-ttu-id="45259-294">**スターター サイト**テンプレートには、コードとユーザーができるマークアップが含まれています。 これには、Facebook、Windows Live、Twitter、Google、または yahoo を使用してログインします。</span><span class="sxs-lookup"><span data-stu-id="45259-294">The **Starter Site** template includes code and markup that lets users log in using Facebook, Windows Live, Twitter, Google, or Yahoo.</span></span> <span data-ttu-id="45259-295">既定では、この機能は無効です。</span><span class="sxs-lookup"><span data-stu-id="45259-295">By default, this functionality is not enabled.</span></span> <span data-ttu-id="45259-296">一般的な手順ことユーザーを使用してこれらの外部プロバイダーを使用してログはこの。</span><span class="sxs-lookup"><span data-stu-id="45259-296">The general procedure for using letting users log in using these external providers is this:</span></span>

- <span data-ttu-id="45259-297">サポートする外部サイトのどれを決定します。</span><span class="sxs-lookup"><span data-stu-id="45259-297">Decide which of the external sites you want to support.</span></span>
- <span data-ttu-id="45259-298">必要に応じて、そのサイトに移動し、ログインのアプリをセットアップします。</span><span class="sxs-lookup"><span data-stu-id="45259-298">If required, go to that site and set up a login app.</span></span> <span data-ttu-id="45259-299">(などを行う必要があるこの Facebook ログインを許可するためにします。)</span><span class="sxs-lookup"><span data-stu-id="45259-299">(For example, you have to do this in order to allow Facebook logins.)</span></span>
- <span data-ttu-id="45259-300">サイトでは、プロバイダーを構成します。</span><span class="sxs-lookup"><span data-stu-id="45259-300">In your site, configure the provider.</span></span> <span data-ttu-id="45259-301">ほとんどの場合だけがあるの一部のコードのコメントを解除する、  *\_AppStart.cshtml*ファイル。</span><span class="sxs-lookup"><span data-stu-id="45259-301">In most cases, you just have to uncomment some code in the *\_AppStart.cshtml* file.</span></span>
- <span data-ttu-id="45259-302">ユーザー登録ページ マークアップに追加のログインに外部サイトへのリンク。</span><span class="sxs-lookup"><span data-stu-id="45259-302">Add markup to the registration page that lets people link to the external site for logging in.</span></span> <span data-ttu-id="45259-303">通常、テキストがわずかに変化し、必要とするマークアップをコピーできます。</span><span class="sxs-lookup"><span data-stu-id="45259-303">You can usually copy the markup you need and change the text slightly.</span></span>

<span data-ttu-id="45259-304">トピックのステップ バイ ステップの説明を参照して[ASP.NET Web Pages サイト内の外部のサイトからのログインを有効にすると](https://go.microsoft.com/fwlink/?LinkId=251969)です。</span><span class="sxs-lookup"><span data-stu-id="45259-304">You can find step-by-step instructions in the topic [Enabling Login from External Sites in an ASP.NET Web Pages Site](https://go.microsoft.com/fwlink/?LinkId=251969).</span></span>

<span data-ttu-id="45259-305">ユーザーが、サイトに戻った後、別のサイトからユーザーがログイン、および*関連付けます*で、サイトにログインします。</span><span class="sxs-lookup"><span data-stu-id="45259-305">After a user logs in from another site, the user returns to your site and *associates* that login with your site.</span></span> <span data-ttu-id="45259-306">実際には、ユーザーの外部ログインについて、サイト メンバーシップ エントリが作成されます。</span><span class="sxs-lookup"><span data-stu-id="45259-306">In effect, this creates a membership entry in your site for the user's external login.</span></span> <span data-ttu-id="45259-307">外部ログインを持つメンバーシップ (ロール) などの標準機能を使用できます。</span><span class="sxs-lookup"><span data-stu-id="45259-307">This lets you use the normal facilities of membership (such as roles) with the external login.</span></span>

## <a name="adding-security-to-an-existing-website"></a><span data-ttu-id="45259-308">既存の web サイトへのセキュリティの追加</span><span class="sxs-lookup"><span data-stu-id="45259-308">Adding Security to an Existing Website</span></span>

<span data-ttu-id="45259-309">この記事の前の手順を使用してに依存しています、**スターター サイト**web サイトのセキュリティの基礎としてテンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-309">The procedure earlier in this article relies on using the **Starter Site** template as the basis for website security.</span></span> <span data-ttu-id="45259-310">起動するための実際的でない場合、**スターター サイト**テンプレートか、そのテンプレートに基づくサイトから、関連ページをコピーを実装できます、同じ種類のセキュリティ、自分のサイトで、自分でコーディングします。</span><span class="sxs-lookup"><span data-stu-id="45259-310">If it isn't practical for you to start from the **Starter Site** template or to copy the relevant pages from a site based on that template, you can implement the same type of security in your own site by coding it yourself.</span></span> <span data-ttu-id="45259-311">同じ種類のページを作成する — 登録、ログイン、およびなど — およびメンバーシップを設定するヘルパー クラスとクラスを使用します。</span><span class="sxs-lookup"><span data-stu-id="45259-311">You create the same types of pages — registration, login, and so on — and then use helpers and classes to set up membership.</span></span>

<span data-ttu-id="45259-312">基本的なプロセスは、ブログの投稿に記載されて[ASP.NET Razor のセキュリティを実装する最も簡単な方法](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)です。</span><span class="sxs-lookup"><span data-stu-id="45259-312">The basic process is described in the blog post [THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240).</span></span> <span data-ttu-id="45259-313">ほとんどの作業を行う、次のメソッドとプロパティを使用して、`WebSecurity`ヘルパー。</span><span class="sxs-lookup"><span data-stu-id="45259-313">Most of the work is done using the following methods and properties of the `WebSecurity` helper:</span></span>

- <span data-ttu-id="45259-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="45259-314">[WebSecurty.UserExists](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.userexists(v=vs.99).aspx), [WebSecurity.CreateUserAndAccount](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.createuserandaccount(v=vs.99).aspx).</span></span> <span data-ttu-id="45259-315">これらのメソッドを使用して、他のユーザーは既に登録されているかどうかを判別できると、それらを登録します。</span><span class="sxs-lookup"><span data-stu-id="45259-315">These methods let you determine whether someone is already registered and to register them.</span></span>
- <span data-ttu-id="45259-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="45259-316">[WebSecurty.IsAuthenticated](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.isauthenticated(v=vs.99).aspx).</span></span> <span data-ttu-id="45259-317">このプロパティでは、現在のユーザーがログインしているかどうかを確認できます。</span><span class="sxs-lookup"><span data-stu-id="45259-317">This property lets you determine whether the current user is logged in.</span></span> <span data-ttu-id="45259-318">これは、ユーザーをリダイレクトするログイン ページへログインがない場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="45259-318">This is useful to redirect users to a login page if they have not already logged in.</span></span>
- <span data-ttu-id="45259-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="45259-319">[WebSecurity.Login](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.login(v=vs.99).aspx), [WebSecurity.Logout](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.logout(v=vs.99).aspx).</span></span> <span data-ttu-id="45259-320">これらのメソッドは、in または out にユーザーをログインします。</span><span class="sxs-lookup"><span data-stu-id="45259-320">These methods log a user in or out.</span></span>
- <span data-ttu-id="45259-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="45259-321">[WebSecurity.CurrentUserName](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity.currentusername(v=vs.99).aspx).</span></span> <span data-ttu-id="45259-322">このプロパティは、(この場合、ユーザーがログインして)、現在のユーザーのログイン名を表示するため便利です。</span><span class="sxs-lookup"><span data-stu-id="45259-322">This property is useful for displaying the current user's logged-in name (if the user is logged in).</span></span>
- <span data-ttu-id="45259-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span><span class="sxs-lookup"><span data-stu-id="45259-323">[WebSecurity.ConfirmAccount](https://msdn.microsoft.com/library/gg569286(v=vs.99).aspx).</span></span> <span data-ttu-id="45259-324">このメソッドは、登録の確認の電子メールを設定する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="45259-324">This method is useful if you set up email confirmation for registration.</span></span> <span data-ttu-id="45259-325">(詳細については、ブログの投稿で説明[ASP.NET Web Pages のセキュリティの確認機能を使用して](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267))。</span><span class="sxs-lookup"><span data-stu-id="45259-325">(Details are described in the blog post [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).)</span></span>

<span data-ttu-id="45259-326">ロールを管理するには、使用することができます、[ロール](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx)と[メンバーシップ](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx)クラス、ブログ記事で説明されているようです。</span><span class="sxs-lookup"><span data-stu-id="45259-326">To manage roles, you can use the [Roles](https://msdn.microsoft.com/library/gg538398(v=vs.99).aspx) and [Membership](https://msdn.microsoft.com/library/gg569035(v=vs.99).aspx) classes, as described in the blog entry.</span></span>

## <a name="additional-resources"></a><span data-ttu-id="45259-327">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="45259-327">Additional Resources</span></span>

- [<span data-ttu-id="45259-328">サイト全体の動作をカスタマイズする</span><span class="sxs-lookup"><span data-stu-id="45259-328">Customizing Site-Wide Behavior</span></span>](https://go.microsoft.com/fwlink/?LinkId=202906)
- [<span data-ttu-id="45259-329">Web 通信の保護: 証明書、SSL、および https://</span><span class="sxs-lookup"><span data-stu-id="45259-329">Securing Web Communications: Certificates, SSL, and https://</span></span>](https://go.microsoft.com/fwlink/?LinkId=208660)
- <span data-ttu-id="45259-330">[ASP.NET Razor のセキュリティを実装する最も簡単な方法](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240)と[ASP.NET Web Pages のセキュリティの確認機能を使用して](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267)です。</span><span class="sxs-lookup"><span data-stu-id="45259-330">[THE most basic way to implement ASP.NET Razor security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2240) and [Using the confirmation feature for ASP.NET Web Pages security](http://mikepope.com/blog/DisplayBlog.aspx?permalink=2267).</span></span> <span data-ttu-id="45259-331">これらを使用せずに ASP.NET メンバーシップ機能を実装する方法を説明するブログの投稿、**スターター サイト**テンプレート。</span><span class="sxs-lookup"><span data-stu-id="45259-331">These are blog posts that describe how to implement ASP.NET membership features without using the **Starter Site** template.</span></span>
- [<span data-ttu-id="45259-332">ASP.NET Web ページ サイトで外部サイトからのログインを有効にする</span><span class="sxs-lookup"><span data-stu-id="45259-332">Enabling Login from External Sites in an ASP.NET Web Pages Site</span></span>](https://go.microsoft.com/fwlink/?LinkId=251969)
- <span data-ttu-id="45259-333">[WebSecurity クラスの API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="45259-333">[WebSecurity Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.websecurity(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="45259-334">[SimpleRoleProvider クラスの API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="45259-334">[SimpleRoleProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simpleroleprovider(v=vs.99)) (MSDN)</span></span>
- <span data-ttu-id="45259-335">[に関する SimpleMembershipProvider クラスの API リファレンス](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99))(MSDN)</span><span class="sxs-lookup"><span data-stu-id="45259-335">[SimpleMembershipProvider Class API reference](https://msdn.microsoft.com/library/webmatrix.webdata.simplemembershipprovider(v=vs.99)) (MSDN)</span></span>
