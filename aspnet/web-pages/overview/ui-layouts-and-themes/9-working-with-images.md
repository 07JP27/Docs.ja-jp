---
uid: web-pages/overview/ui-layouts-and-themes/9-working-with-images
title: ASP.NET Web Pages (Razor) サイトに画像の操作 |Microsoft ドキュメント
author: tfitzmac
description: この章で説明する追加、表示、およびイメージを操作する方法 (サイズ変更、反転、およびウォーターマークの追加)、web サイトにします。
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2014
ms.topic: article
ms.assetid: 778c4e58-4372-4d25-bab9-aec4a8d8e38d
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/ui-layouts-and-themes/9-working-with-images
msc.type: authoredcontent
ms.openlocfilehash: 74838dd364a43f3f4c966c1417d0f0b2cc242f28
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="working-with-images-in-an-aspnet-web-pages-razor-site"></a>ASP.NET Web Pages (Razor) サイトに画像の操作
====================
によって[Tom FitzMacken](https://github.com/tfitzmac)

> この記事は、追加、表示、およびイメージを操作する方法を示します (サイズ変更、反転、およびウォーターマークの追加) の ASP.NET Web Pages (Razor) web サイトです。
> 
> 学習する内容。
> 
> - イメージをページに動的に追加する方法。
> - ユーザー イメージをアップロードできるようにする方法。
> - イメージのサイズを変更する方法。
> - 反転するか、またはイメージを回転する方法です。
> - ウォーターマーク イメージに追加する方法。
> - ウォーターマークとしてイメージを使用する方法。
> 
> これらは、ASP.NET のアーティクルで導入された機能をプログラミングします。
> 
> - `WebImage`ヘルパー。
> - `Path`パスとファイル名を操作するのに便利なメソッドを提供するオブジェクト。
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a>このチュートリアルで使用されているソフトウェアのバージョン
> 
> 
> - ASP.NET Web Pages (Razor) 2
> - WebMatrix 2
>   
> 
> このチュートリアルは、WebMatrix 3 でも動作します。


<a id="Adding_an_Image"></a>
## <a name="adding-an-image-to-a-web-page-dynamically"></a>Web ページにイメージを動的に追加します。

Web サイトの開発中は、web サイトに、個々 のページにイメージを追加することができます。 ユーザー プロファイル写真を追加するそのようなタスクに役立つ可能性のあるイメージをアップロードすることもできます。

HTML を使用するイメージとは、サイトで既に使用可能なページに表示する場合は、`<img>`次のような要素。

[!code-html[Main](9-working-with-images/samples/sample1.html)]

イメージを動的に表示できるようにする必要がありますただし、場合によっては、& #8212 です。つまり、わからない場合、ページまで表示するには、どのようなイメージを実行しています。

このセクションの手順では、ユーザーがイメージ名の一覧からイメージのファイル名を指定して実行時にイメージを表示する方法を示します。 を、ドロップダウン リストから、イメージの名前を選択して、ページを送信すると、選択したイメージが表示されます。

![[イメージ]] (9-working-with-images/_static/image1.jpg "ch9images 1.jpg")

1. WebMatrix では、新しい web サイトを作成します。
2. という名前の新しいページを追加*DynamicImage.cshtml*です。
3. Web サイトのルート フォルダーに新しいフォルダーを追加し、名前*イメージ*です。
4. 次の 4 つのイメージを追加、*イメージ*作成したフォルダーです。 (イメージがあるためには、便利なは、それらをページに適合する必要があります)。イメージの名前を変更*Photo1.jpg*、 *Photo2.jpg*、 *Photo3.jpg*、および*Photo4.jpg*です。 (使用しない*Photo4.jpg*これには、プロシージャ、テーブルを使用して、記事の後半)。
5. 4 つのイメージでは読み取り専用でをマークされていないことを確認します。
6. ページで、既存のコンテンツを次のように置き換えます。

    [!code-cshtml[Main](9-working-with-images/samples/sample2.cshtml)]

    ページの本文がドロップダウン リスト (、`<select>`要素) という`photoChoice`です。 リストが 3 つのオプション、および`value`各リストのオプションの属性に格納されているイメージの 1 つの名前が指定されて、*イメージ*フォルダーです。 一覧でのようなわかりやすい名前を選択して、ユーザーは基本的に、&quot;フォト 1&quot;、しを渡しますが、 *.jpg*ページが送信されるときに、ファイル名。

    コードから取得できます (つまり、イメージ ファイル名) のユーザーの選択リストを読み取って`Request["photoChoice"]`です。 まずがあるかどうか、選択範囲で参照してください。 ある場合、イメージの場合、フォルダーの名前と、ユーザーのイメージのファイル名で構成されるイメージのパスを構築します。 (パスを作成しようとしましたでは nothing を使用する必要があるかどうか`Request["photoChoice"]`エラーが発生したとします)。これは、結果は、次のように相対パスになります。

    *イメージ/Photo1.jpg*

    パスがという名前の変数に格納されている`imagePath`必要があるページの後半。

    本文にも、`<img>`ユーザーが取得されたイメージを表示するための要素です。 `src`属性は、静的な要素を表示するための作業と同じようにファイル名または URL に設定されていません。 代わりに設定されている`@imagePath`コードで設定したパスからその値を取得ことを意味します。

    ページを実行する最初の時間は、画像がない表示するには、ユーザーには、何も選択していないためです。 これは通常からといって、`src`属性は空にして、イメージが赤いとして示されます&quot;x&quot; (または、どのブラウザーが、イメージが見つからない場合)。 これを回避するには、配置する、`<img>`内の要素、`if`を調べ、ブロックするかどうか、`imagePath`変数が含まれるものです。 ユーザーが、選択を行った場合`imagePath`パスが含まれています。 ユーザーは、イメージを選択していないか、これが初めての場合、ページが表示されたら場合、`<img>`要素は表示もされません。
7. ファイルを保存し、ブラウザーでページを実行します。 (ページが選択されて、必ず、**ファイル**ワークスペースを実行する前にします)。
8. ドロップダウン リストからイメージを選択し、をクリックして**サンプル イメージ**です。 さまざまな選択肢ごとに異なるイメージが表示されることを確認してください。

<a id="Uploading_an_Image"></a>
## <a name="uploading-an-image"></a>イメージをアップロードします。

前の例は、イメージを動的に表示する方法を示しましたが、web サイトに存在したイメージでのみ機能しました。 この手順では、ユーザーがページに表示されるイメージをアップロードできるようにする方法を示します。 ASP.NET を使用して、実行時にイメージを操作することができます、`WebImage`ヘルパーで、作成、操作、および画像を保存できるメソッドがあります。 `WebImage`ヘルパーは、すべて共通 web イメージ ファイルの種類を含むをサポートしている *.jpg*、 *.png*、および *.bmp*です。 この記事全体で使用する *.jpg*が、イメージはイメージの種類のいずれかで使用できます。

![[イメージ]] (9-working-with-images/_static/image2.jpg "ch9images 2.jpg")

1. 新しいページを追加し、名前を付けます*UploadImage.cshtml*です。
2. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample3.cshtml)]

    テキストの本文には、`<input type="file">`要素は、アップロードするファイルを選択できます。 クリックすると**送信**、フォームと共に選択、ファイルを送信します。

    アップロードしたイメージを取得するには、使用して、`WebImage`ヘルパーに渡し、あらゆる種類のイメージを操作するための便利なメソッドを持つ。 具体的を使用する`WebImage.GetImageFromRequest`(存在する場合) にアップロードされたイメージを取得し、という名前の変数に格納する`photo`です。

    この例では、作業の多くでは、取得およびファイル名とパス名を設定する必要があります。 この問題は、ユーザーがアップロードされると、イメージの名前 (と名前のみ) を取得し、どこで、イメージを格納する新しいパスを作成することです。 ユーザーは、同じ名前を持つ複数のイメージをアップロード可能性がある可能性があります、ため余分なコードのビットを使用する一意の名前を作成し、ユーザーが既存の画像を上書きしないことを確認してください。

    イメージ実際にアップロードされている場合 (テスト`if (photo != null)`) からイメージのイメージの名前を取得する`FileName`プロパティです。 ユーザーが、イメージをアップロードする`FileName`ユーザーのコンピューターからのパスを含む、ユーザーの元名が含まれています。 これは、次のようになります可能性があります。

    *C:\Users\Joe\Pictures\SamplePhoto1.jpg*

    そのすべてのパス情報をただしたくない & #8212 です。実際のファイル名をするだけ (*SamplePhoto1.jpg*)。 パスからファイルだけを除去するを使用して、`Path.GetFileName`メソッドは、次のようにします。

    [!code-csharp[Main](9-working-with-images/samples/sample4.cs)]

    元の名前に GUID を追加することによって新しい一意のファイル名を作成します。 (詳細については、Guid は、次を参照してください[に関する Guid](#SB_AboutGUIDs)この記事で後述します。)。イメージの保存に使用できる、完全なパスを作成します。 保存パスで構成された、新しいファイル名、フォルダー (イメージ)、および現在の web サイトの場所。

    > [!NOTE]
    > コード内のファイルを保存するために、*イメージ*フォルダー、アプリケーション必要がある読み取り/書き込みそのフォルダーのアクセスを許可します。 開発用コンピューターでこの問題はありません通常です。 ただし、ホスティング プロバイダーの web サーバーにサイトを発行するときは、これらのアクセス許可を明示的に設定する必要があります。 ホスティング プロバイダーのサーバーでこのコードを実行し、エラーが発生する場合にこれらのアクセス許可を設定する方法を見つけて、ホスティング プロバイダーに確認します。

    最後に、保存を渡すへのパス、`Save`のメソッド、`WebImage`ヘルパー。 これは、新しい名前でアップロードされたイメージを格納します。 Save メソッドは、次のようになります:`photo.Save(@"~\" + imagePath)`です。 完全なパスが追加されます`@"~\"`、これは、現在の web サイトの場所。 (については、`~`演算子を参照してください[Introduction to ASP.NET Web プログラミング構文を使用して、Razor](https://go.microsoft.com/fwlink/?LinkId=202890#ID_WorkingWithFileAndFolderPaths))。

    前の例では、ページの本文に含まれる、`<img>`イメージを表示する要素。 場合`imagePath`が設定されている、`<img>`要素が表示されると、その`src`属性に設定されている、`imagePath`値。
3. ブラウザーでページを実行します。
4. イメージをアップロードし、ページに表示されるかどうかを確認します。
5. サイトで開く、*イメージ*フォルダーです。 ファイルの名前が次のように、新しいファイルを追加されていることを参照してください。 

    *45ea4527-7ddd-4965-b9ca-c6444982b342\_MyPhoto.png*

    これは、名前にプレフィックスの GUID でアップロードしたイメージです。 (独自ファイル別の GUID を持つし、おそらくは名前とは異なるもの*MyPhoto.png*)。

> [!TIP] 
> 
> <a id="SB_AboutGUIDs"></a>
> ### <a name="about-guids"></a>Guid は
> 
> GUID (グローバルに一意の ID) は、次のような形式で表示される通常識別子:`936DA01F-9ABD-4d9d-80C7-02AF85C822A8`です。 数字と文字 (A ~ F) から、GUID ごとに異なりますが、それらはすべて 8-4-4-4-12 文字のグループを使用するパターン。 (技術的には、GUID は 16 バイト/128 ビット数) です。GUID が必要なときは、GUID を生成する専用のコードを呼び出すことができます。 Guid の考え方は膨大な数のサイズとの違い (3.4 x 10<sup>38</sup>) し、生成するためのアルゴリズム、結果の数が事実上保証の種類のいずれかを指定します。 したがって Guid は、名前を生成するものと同じ名前を 2 回使用しないことを保証する必要があります良い方法です。 という欠点は、名前がコードでのみ使用されるときに使用される傾向があるために、Guid でユーザー フレンドリ、特にをいないことをもちろんです。


<a id="Resizing_an_Image"></a>
## <a name="resizing-an-image"></a>イメージのサイズ変更

Web サイトがユーザーからのイメージを受け入れる場合は、表示、保存したりする前に、イメージのサイズを変更することができます。 もう一度使用することができます、`WebImage`このヘルパー。

この手順では、サムネイルを作成し、web サイトの縮小版および元のイメージを保存するアップロードされたイメージのサイズを変更する方法を示します。 ページのサムネイルを表示し、ハイパーリンクを使用して、フルサイズのイメージにユーザーをリダイレクトします。

![[イメージ]] (9-working-with-images/_static/image3.jpg "ch9images 3.jpg")

1. という名前の新しいページを追加*Thumbnail.cshtml*です。
2. *イメージ*フォルダー、という名前のサブフォルダーを作成する*親指*です。
3. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample5.cshtml)]

    このコードは、前の例のコードに似ています。 違いは、このコードのイメージは、2 回、1 回正常に保存して、サムネイル、イメージのコピーを作成した後に 1 回です。 まず、アップロードされたイメージを取得し、保存、*イメージ*フォルダーです。 サムネイル イメージの新しいパスを作成します。 サムネイルを実際に作成するを呼び出す、`WebImage`ヘルパーの`Resize`60 によって 60 ピクセル イメージを作成するメソッド。 この例では、縦横比を維持する方法と (この場合、新しいサイズが実際には、画像を拡大) に拡大されてから、イメージを防止する方法を示します。 サイズを変更したイメージを保存し、*親指*サブフォルダーです。

    同一のマークアップの最後に、使用する`<img>`、動的な要素`src`条件付きでイメージを表示する前の例で示した属性。 この場合、サムネイルを表示します。 使用することも、`<a>`大きなバージョンのイメージへのハイパーリンクを作成する要素。 同様、`src`の属性、`<img>`要素を設定する、`href`の属性、`<a>`要素は動的に`imagePath`です。 Url パスを操作できることを確認に合格する`imagePath`を`Html.AttributeEncode`メソッドで、パス内の予約文字を URL で [ok] は、文字に変換します。
4. ブラウザーでページを実行します。
5. 写真をアップロードし、サムネイルが表示されていることを確認します。
6. サムネイルをクリックして、フルサイズの画像を参照してください。
7. *イメージ*と*イメージ/親指*、新しいファイルが追加されたことに注意してください。

<a id="Rotating_and_Flipping"></a>
## <a name="rotating-and-flipping-an-image"></a>回転とイメージの回転

`WebImage`ヘルパーすることもできます反転と回転イメージ。 この手順では、サーバーから取得して、イメージ、イメージを上下 (垂直方向に反転、保存し、ページに反転イメージを表示する方法を示します。 この例では、サーバーに既にあるファイルを使用しているだけ (*Photo2.jpg*)。 実際のアプリケーションでは、前の例で行ったように、動的に取得する名前を持つイメージを反転させるは可能性があります。

![[イメージ]] (9-working-with-images/_static/image4.jpg "ch9images 4.jpg")

1. という名前の新しいページを追加*FlipImage.cshtml*です。
2. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample6.cshtml)]

    コードを使用して、`WebImage`サーバーからイメージを取得するためのヘルパー。 前の例で、イメージを保存するために使用される同じ手法を使用するイメージへのパスを作成してを使用して、イメージを作成するときにそのパスを渡す`WebImage`:

    [!code-javascript[Main](9-working-with-images/samples/sample7.js)]

    イメージが見つかった場合は、新しいパスとファイル名、前の例で行ったようを作成します。 呼び出すのイメージを反転するのには、`FlipVertical`メソッド、および、もう一度画像を保存します。

    使用して、イメージが再度表示 ページで、`<img>`を持つ要素、`src`属性に設定`imagePath`です。
3. ブラウザーでページを実行します。 画像を*Photo2.jpg*上下逆に表示されます。
4. ページを更新またはイメージが反転した右側をもう一度を表示するには、もう一度ページを要求します。

イメージを回転するには、呼び出し元ではなく点を除いて、同じコードを使用、`FlipVertical`または`FlipHorizontal`、呼び出す`RotateLeft`または`RotateRight`です。

<a id="Adding_a_Watermark"></a>
## <a name="adding-a-watermark-to-an-image"></a>ウォーターマークは、イメージへの追加

Web サイトにイメージを追加するときに保存したり、ページ上に表示する前に、イメージに透かしを追加する場合があります。 ユーザーは、著作権情報をイメージに追加するか、ビジネス名を提供する多くの場合、ウォーターマークを使用します。

![[イメージ]] (9-working-with-images/_static/image5.jpg "ch9images 5.jpg")

1. という名前の新しいページを追加*Watermark.cshtml*です。
2. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample8.cshtml)]

    このコードは、コードのように、 *FlipImage.cshtml*から前のページ (使用時間がこれが、 *Photo3.jpg*ファイル)。 呼び出すウォーターマークを追加する、`WebImage`ヘルパーの`AddTextWatermark`メソッド、イメージを保存する前にします。 呼び出しで`AddTextWatermark`、テキストを渡す&quot;マイ ウォーターマーク&quot;、黄、フォントの色を設定および arial フォント ファミリを設定します。 (ここでは、表示されませんが、`WebImage`ヘルパーでは不透明度、フォント ファミリとフォント サイズ、およびウォーターマーク テキストの位置を指定することもできます)。イメージを保存すると、読み取り専用にする必要がありますできません。

    使用して、イメージが、ページに表示される前に説明したよう、 `<img>` src 属性を持つ要素に設定`@imagePath`です。
3. ブラウザーでページを実行します。 画像の右下隅には、"My Watermark"のテキストに注意してください。

<a id="Using_an_Image_as_a_Watermark"></a>
## <a name="using-an-image-as-a-watermark"></a>ウォーターマークとしてイメージを使用します。

透かしのテキストではなく、別のイメージを使用することができます。 ユーザーは、透かしとして会社のロゴのようにイメージを使用することがあります。 または著作権情報のテキストではなくウォーターマークの画像を使用します。

![[イメージ]] (9-working-with-images/_static/image6.jpg "ch9images 6.jpg")

1. という名前の新しいページを追加*ImageWatermark.cshtml*です。
2. イメージの追加、*イメージ*フォルダーのロゴとして使用して、イメージの名前を変更できます*MyCompanyLogo.jpg*です。 このイメージは、表示されていることが明確に 20 ピクセル、高さ、幅 80 ピクセルに設定されているときにイメージを使用する必要があります。
3. ページで、既存のコンテンツを次のように置き換えます。 

    [!code-cshtml[Main](9-working-with-images/samples/sample9.cshtml)]

    これは、前の例からのコードに別のバリエーションです。 この例を呼び出す`AddImageWatermark`ウォーターマークのイメージをターゲットのイメージに追加する (*Photo3.jpg*) イメージを保存する前にします。 呼び出すと`AddImageWatermark`、80 ピクセルを 20 ピクセル、高さ、幅を設定します。 *MyCompanyLogo.jpg*イメージが水平方向に中央に配置され、ターゲットのイメージの下部にある垂直方向に揃えます。 不透明度が 100% に設定されているし、10 ピクセルに余白が設定されています。 ウォーターマーク イメージが、ターゲットのイメージよりも大きい場合は、何も起こりません。 ウォーターマーク イメージが、ターゲットのイメージよりも大きい、ゼロに透かしの画像の埋め込みを設定すると、レベルのウォーターマークは無視されます。

    使用してイメージを表示する前に、として、`<img>`要素と、動的な`src`属性。
4. ブラウザーでページを実行します。 ウォーターマーク イメージが画像の下に表示されることに注意してください。

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a>その他のリソース


[ASP.NET Web Pages サイトでファイルの操作](https://go.microsoft.com/fwlink/?LinkId=202896)

[ASP.NET Web ページの Razor 構文を使用するプログラミングの概要](https://go.microsoft.com/fwlink/?LinkID=251587)
