---
uid: whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
title: "方法: ASP.NET Web フォームにモバイル ページを追加する/MVC アプリケーション |Microsoft ドキュメント"
author: rick-anderson
description: "ここで説明するページ、ASP.NET Web フォームからのモバイル デバイス用に最適化に提供するさまざまな方法を説明します/MVC アプリケーション、アーキテクチャを提案してとしています。"
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/20/2011
ms.topic: article
ms.assetid: 3124f28e-cc32-418a-afe3-519fa56f4c36
ms.technology: 
ms.prod: .net-framework
msc.legacyurl: /whitepapers/add-mobile-pages-to-your-aspnet-web-forms-mvc-application
msc.type: content
ms.openlocfilehash: aac359b26c508784793a67260dc2e65c30db687a
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
<a name="how-to-add-mobile-pages-to-your-aspnet-web-forms--mvc-application"></a><span data-ttu-id="e2cb8-103">方法: ASP.NET Web フォームにモバイル ページを追加する/MVC アプリケーション</span><span class="sxs-lookup"><span data-stu-id="e2cb8-103">How To: Add Mobile Pages to Your ASP.NET Web Forms / MVC Application</span></span>
====================
> <span data-ttu-id="e2cb8-104">**適用されます。**</span><span class="sxs-lookup"><span data-stu-id="e2cb8-104">**Applies To**</span></span>
> 
> - <span data-ttu-id="e2cb8-105">ASP.NET Web フォームのバージョン 4.0</span><span class="sxs-lookup"><span data-stu-id="e2cb8-105">ASP.NET Web Forms version 4.0</span></span>
> - <span data-ttu-id="e2cb8-106">ASP.NET MVC version 3.0</span><span class="sxs-lookup"><span data-stu-id="e2cb8-106">ASP.NET MVC version 3.0</span></span>
> 
> <span data-ttu-id="e2cb8-107">**まとめ**</span><span class="sxs-lookup"><span data-stu-id="e2cb8-107">**Summary**</span></span>
> 
> <span data-ttu-id="e2cb8-108">ここで説明するページ、ASP.NET Web フォームからのモバイル デバイス用に最適化に提供するさまざまな方法を説明します。/MVC アプリケーション アーキテクチャを提案し、幅広い種類のデバイスを対象とする場合を考慮する問題をデザインします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-108">This How To describes various ways to serve pages optimized for mobile devices from your ASP.NET Web Forms / MVC application, and suggests architectural and design issues to consider when targeting a broad range of devices.</span></span> <span data-ttu-id="e2cb8-109">このドキュメントについても説明します 3.5 に ASP.NET 2.0 から ASP.NET モバイル コントロールの旧式である理由といくつかの最新の代替案について説明します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-109">This document also explains why the ASP.NET Mobile Controls from ASP.NET 2.0 to 3.5 are now obsolete, and discusses some modern alternatives.</span></span>


## <a name="contents"></a><span data-ttu-id="e2cb8-110">目次</span><span class="sxs-lookup"><span data-stu-id="e2cb8-110">Contents</span></span>

- <span data-ttu-id="e2cb8-111">概要</span><span class="sxs-lookup"><span data-stu-id="e2cb8-111">Overview</span></span>
- <span data-ttu-id="e2cb8-112">アーキテクチャ上のオプション</span><span class="sxs-lookup"><span data-stu-id="e2cb8-112">Architectural options</span></span>
- <span data-ttu-id="e2cb8-113">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="e2cb8-113">Browser and device detection</span></span>
- <span data-ttu-id="e2cb8-114">ASP.NET Web フォーム アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="e2cb8-114">How ASP.NET Web Forms applications can present mobile-specific pages</span></span>
- <span data-ttu-id="e2cb8-115">ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="e2cb8-115">How ASP.NET MVC applications can present mobile-specific pages</span></span>
- <span data-ttu-id="e2cb8-116">その他の技術情報</span><span class="sxs-lookup"><span data-stu-id="e2cb8-116">Additional resources</span></span>

<span data-ttu-id="e2cb8-117">ASP.NET Web フォームと MVC の両方のこのホワイト ペーパーの手法を示すダウンロード可能なコード サンプルでは、次を参照してください。 [Mobile Apps と ASP.NET を使用したサイト](https://docs.microsoft.com/aspnet/mobile/overview)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-117">For downloadable code samples demonstrating this white paper's techniques for both ASP.NET Web Forms and MVC, see [Mobile Apps & Sites with ASP.NET](https://docs.microsoft.com/aspnet/mobile/overview).</span></span>

## <a name="overview"></a><span data-ttu-id="e2cb8-118">概要</span><span class="sxs-lookup"><span data-stu-id="e2cb8-118">Overview</span></span>

<span data-ttu-id="e2cb8-119">– スマート フォン、機能の携帯電話およびタブレット – モバイル デバイスは、Web にアクセスするための手段として人気を拡張し続けます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-119">Mobile devices – smartphones, feature phones, and tablets – continue to grow in popularity as a means to access the Web.</span></span> <span data-ttu-id="e2cb8-120">多くの web 開発者および企業の web 指向、つまりすることがますます重要これらのデバイスを使用する訪問者の閲覧エクスペリエンスを向上します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-120">For many web developers and web-oriented businesses, this means it's increasingly important to provide a great browsing experience for visitors using those devices.</span></span>

### <a name="how-earlier-versions-of-aspnet-supported-mobile-browsers"></a><span data-ttu-id="e2cb8-121">どの以前のバージョンの ASP.NET がサポートされているモバイル ブラウザー</span><span class="sxs-lookup"><span data-stu-id="e2cb8-121">How earlier versions of ASP.NET supported mobile browsers</span></span>

<span data-ttu-id="e2cb8-122">ASP.NET のバージョン 2.0 に 3.5 は含まれている*ASP.NET モバイル コントロール*: でのモバイル デバイス用のサーバー コントロールのセット、 *System.Web.Mobile.dll*アセンブリおよび*System.Web.UI.MobileControls*名前空間。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-122">ASP.NET versions 2.0 to 3.5 included *ASP.NET Mobile Controls*: a set of server controls for mobile devices in the *System.Web.Mobile.dll* assembly and the *System.Web.UI.MobileControls* namespace.</span></span> <span data-ttu-id="e2cb8-123">ASP.NET 4 のアセンブリが掲載されていますが、推奨されていません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-123">The assembly is still included in ASP.NET 4, but it is deprecated.</span></span> <span data-ttu-id="e2cb8-124">開発者は、このホワイト ペーパーに記載されているなどのより新しいアプローチに移行することをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-124">Developers are advised to migrate to more modern approaches, such as those described in this paper.</span></span>

<span data-ttu-id="e2cb8-125">ASP.NET モバイル コントロールをなぜ廃止としてマークされている理由が 2005 およびそれ以前の周囲に共通する携帯電話の周囲のデザインを指向することです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-125">The reason why ASP.NET Mobile Controls have been marked as obsolete is that their design is oriented around the mobile phones that were common around 2005 and earlier.</span></span> <span data-ttu-id="e2cb8-126">主に、コントロールはその時代 (年号) の WAP ブラウザーの (通常の HTML) ではなく WML または cHTML のマークアップを表示するために設計されています。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-126">The controls are mainly designed to render WML or cHTML markup (instead of regular HTML) for the WAP browsers of that era.</span></span> <span data-ttu-id="e2cb8-127">WAP を WML および cHTML が不要ほとんどのプロジェクトに関連する HTML がモバイルとデスクトップ ブラウザーと同様の場所を問わずマークアップ言語になるようになりました。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-127">But WAP, WML, and cHTML are no longer relevant for most projects, because HTML has now become the ubiquitous markup language for mobile and desktop browsers alike.</span></span>

### <a name="the-challenges-of-supporting-mobile-devices-today"></a><span data-ttu-id="e2cb8-128">今日のモバイル デバイスをサポートするという課題</span><span class="sxs-lookup"><span data-stu-id="e2cb8-128">The challenges of supporting mobile devices today</span></span>

<span data-ttu-id="e2cb8-129">モバイル ブラウザーほぼ例外なくサポート HTML、場合でも優れたモバイル ブラウジング エクスペリエンスを作成するときに、多くの課題が直面します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-129">Even though mobile browsers now almost universally support HTML, you will still face many challenges when aiming to create great mobile browsing experiences:</span></span>

- <span data-ttu-id="e2cb8-130">***画面のサイズ***- フォームで、モバイル デバイスが大きく変化し、その画面は、多くの場合と非常デスクトップ モニターよりも小さいです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-130">***Screen size*** - Mobile devices vary dramatically in form, and their screens are often much smaller than desktop monitors.</span></span> <span data-ttu-id="e2cb8-131">そのため、完全に別のページ レイアウトをデザインする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-131">So, you may need to design completely different page layouts for them.</span></span>
- <span data-ttu-id="e2cb8-132">***入力方式***– 一部のデバイスがあるキーパッド、いくつか styluses、タッチを使用するものです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-132">***Input methods*** – Some devices have keypads, some have styluses, others use touch.</span></span> <span data-ttu-id="e2cb8-133">複数のナビゲーション方法とデータの入力方法を考慮する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-133">You may need to consider multiple navigation mechanisms and data input methods.</span></span>
- <span data-ttu-id="e2cb8-134">***標準への準拠***– 多くのモバイル ブラウザーは、最新の HTML、CSS、または JavaScript の標準をサポートしていません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-134">***Standards compliance*** – Many mobile browsers do not support the latest HTML, CSS, or JavaScript standards.</span></span>
- <span data-ttu-id="e2cb8-135">***帯域幅***– 携帯データ ネットワークのパフォーマンスは、こうした見通しは異なります、エンド ユーザーがいるメガバイト単位で課金される関税率。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-135">***Bandwidth*** – Cellular data network performance varies wildly, and some end users are on tariffs that charge by the megabyte.</span></span>

<span data-ttu-id="e2cb8-136">汎用型のソリューションはありません。アプリケーションは、外観し、動作が異なるに従って、デバイスにアクセスする必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-136">There's no one-size-fits-all solution; your application will have to look and behave differently according to the device accessing it.</span></span> <span data-ttu-id="e2cb8-137">モバイル デバイスのサポートのレベルを指定、に応じて入れ替えて web 開発者用デスクトップ「ブラウザー戦争」に変わりはよりも指定できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-137">Depending on what level of mobile support you want, this can be a bigger challenge for web developers than the desktop "browser wars" ever was.</span></span>

<span data-ttu-id="e2cb8-138">初めてのモバイル ブラウザー サポートを多くの場合、最初に近づいている開発者は、のみであるため、開発者が多くの場合、個人所有など、おそらく、最新で最も高度なスマート フォン (Windows Phone 7、iPhone や Android など) をサポートするために重要と思われるデバイス。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-138">Developers approaching mobile browser support for the first time often initially think it's only important to support the latest and most sophisticated smartphones (e.g., Windows Phone 7, iPhone, or Android), perhaps because developers often personally own such devices.</span></span> <span data-ttu-id="e2cb8-139">ただし、安い電話は非常に人気の高いも、その所有者が携帯電話がブロード バンド接続よりも簡単に取得する場所の国で特に – web の閲覧に使用しないでください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-139">However, cheaper phones are still extremely popular, and their owners do use them to browse the web – especially in countries where mobile phones are easier to get than a broadband connection.</span></span> <span data-ttu-id="e2cb8-140">お客様のビジネスは、その可能性の高い顧客を考慮してサポートするためにデバイスの範囲を決定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-140">Your business will need to decide what range of devices to support by considering its likely customers.</span></span> <span data-ttu-id="e2cb8-141">おそらく小さい強力な機能によって、訪問者に対応する必要があるの映画のチケット予約システムを作成する場合、高度なスマート フォンをターゲットにのみビジネスの意思決定を行う可能性があります luxury ヘルス spa のオンラインのパンフレットを作成する場合携帯電話します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-141">If you're building an online brochure for a luxury health spa, you might make a business decision only to target advanced smartphones, whereas if you're creating a ticket booking system for a cinema, you probably need to account for visitors with less powerful feature phones.</span></span>

## <a name="architectural-options"></a><span data-ttu-id="e2cb8-142">アーキテクチャ上のオプション</span><span class="sxs-lookup"><span data-stu-id="e2cb8-142">Architectural options</span></span>

<span data-ttu-id="e2cb8-143">ASP.NET Web フォームまたは MVC の特定の技術的な詳細を始める前に、web 開発者に一般的にモバイル ブラウザーをサポートするための 3 つの主な可能なオプションがあることに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-143">Before we get to the specific technical details of ASP.NET Web Forms or MVC, note that web developers in general have three main possible options for supporting mobile browsers:</span></span>

1. <span data-ttu-id="e2cb8-144">***何もしない –***だけで、デスクトップ指向の標準的な web アプリケーションを作成して許容可能な表示にするためにモバイル ブラウザーに依存します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-144">***Do nothing –*** You can simply create a standard, desktop-oriented web application, and rely on mobile browsers to render it acceptably.</span></span> 

    - <span data-ttu-id="e2cb8-145">**利点**: これは最も安価なオプションが実装と管理作業は必要ありません</span><span class="sxs-lookup"><span data-stu-id="e2cb8-145">**Advantage**: It's the cheapest option to implement and maintain – no extra work</span></span>
    - <span data-ttu-id="e2cb8-146">**欠点**: 最悪のエンド ユーザー エクスペリエンスを提供します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-146">**Disadvantage**: Gives the worst end-user experience:</span></span> 

        - <span data-ttu-id="e2cb8-147">最新のスマート フォンがデスクトップのブラウザーと同様、HTML を表示することがありますが、ユーザーがズームおよび水平方向にスクロールし、垂直方向に小さな画面上で、コンテンツを使用するが強制されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-147">The latest smartphones may render your HTML just as well as a desktop browser, but users will still be forced to zoom and scroll horizontally and vertically to consume your content on a small screen.</span></span> <span data-ttu-id="e2cb8-148">これは最適なかけ離れていることです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-148">This is far from optimal.</span></span>
        - <span data-ttu-id="e2cb8-149">満足のいく方法で、マークアップを表示するために古いデバイスと機能の携帯電話があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-149">Older devices and feature phones may fail to render your markup in a satisfactory way.</span></span>
        - <span data-ttu-id="e2cb8-150">でも、最新のタブレット デバイス上 (の画面はラップトップの画面サイズで使用できます)、さまざまな相互作用の規則が適用されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-150">Even on the latest tablet devices (whose screens can be as big as laptop screens), different interaction rules apply.</span></span> <span data-ttu-id="e2cb8-151">タッチ入力はボタン サイズの拡大に最適スプレッドさらに、間隔のリンクし、ポップアップ メニューにマウス カーソルをポイントする方法はありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-151">Touch-based input works best with larger buttons and links spread further apart, and there's no way to hover a mouse cursor over a fly-out menu.</span></span>
2. <span data-ttu-id="e2cb8-152">***クライアントで問題を解決*–** CSS を使用することで、[段階的な強化](http://en.wikipedia.org/wiki/Progressive_enhancement)マークアップ、スタイル、およびどのようなブラウザーでは、それらが実行を調整するスクリプトを作成することができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-152">***Solve the problem on the client* –** With careful use of CSS and [progressive enhancement](http://en.wikipedia.org/wiki/Progressive_enhancement) you can create markup, styles, and scripts that adapt to whatever browser is running them.</span></span> <span data-ttu-id="e2cb8-153">たとえば、 [CSS 3 メディア クエリ](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/)デバイスの画面が選択されたしきい値よりも幅の狭いで 1 つの列のレイアウトに変換する複数列のレイアウトを作成する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-153">For example, with [CSS 3 media queries](http://www.w3.org/TR/2010/CR-css3-mediaqueries-20100727/), you could create a multi-column layout that turns into a single column layout on devices whose screens are narrower than a chosen threshold.</span></span> 

    - <span data-ttu-id="e2cb8-154">**利点**: に従って、どのような画面および入力の特性がある不明な将来のデバイスであっても、使用中で特定のデバイスのレンダリングを最適化</span><span class="sxs-lookup"><span data-stu-id="e2cb8-154">**Advantage**: Optimizes rendering for the specific device in use, even for unknown future devices according to whatever screen and input characteristics they have</span></span>
    - <span data-ttu-id="e2cb8-155">**利点**: 簡単にすべてのデバイスの種類 – コードまたは作業量を最小限に抑える複製サーバー側ロジックを共有することができます</span><span class="sxs-lookup"><span data-stu-id="e2cb8-155">**Advantage**: Easily lets you share server-side logic across all device types – minimal duplication of code or effort</span></span>
    - <span data-ttu-id="e2cb8-156">**欠点**: モバイル デバイスが可能性があること、モバイル ページで、デスクトップのページから完全に異なるさまざまな情報を示すデスクトップ デバイスとは異なるためです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-156">**Disadvantage**: Mobile devices are so different from desktop devices that you may really want your mobile pages to be completely different from your desktop pages, showing different information.</span></span> <span data-ttu-id="e2cb8-157">このようなバリエーションが効率にすることがやを確実に実現不可能なだけでも、CSS から方法一貫性特に考慮すると古いデバイスの解釈 CSS 規則。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-157">Such variations can be inefficient or impossible to achieve robustly through CSS alone, especially considering how inconsistently older devices interpret CSS rules.</span></span> <span data-ttu-id="e2cb8-158">これは特に、CSS 3 属性です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-158">This is particularly true of CSS 3 attributes.</span></span>
    - <span data-ttu-id="e2cb8-159">**欠点**: さまざまなサーバー側ロジックおよび各種デバイス用のワークフローのサポートはありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-159">**Disadvantage**: Provides no support for varying server-side logic and workflows for different devices.</span></span> <span data-ttu-id="e2cb8-160">CSS のみで使用してモバイル ユーザーの簡略化されたショッピング カート チェック アウト ワークフローを実装することはできませんなど。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-160">You can't, for example, implement a simplified shopping cart checkout workflow for mobile users by means of CSS alone.</span></span>
    - <span data-ttu-id="e2cb8-161">**欠点**: 非効率的な帯域幅の使用。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-161">**Disadvantage**: Inefficient bandwidth use.</span></span> <span data-ttu-id="e2cb8-162">サーバーは、ターゲット デバイスはその情報のサブセットのみを使用しても、マークアップとすべての可能なデバイスに適用されるスタイルを送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-162">You server may have to transmit the markup and styles that apply to all possible devices, even though the target device will only use a subset of that information.</span></span>
3. <span data-ttu-id="e2cb8-163">***サーバー上の問題を解決*–** – どのデバイスがアクセスして、サーバーが認識されている場合または入力方式は、その画面サイズなど、デバイスの最低限の特性と別のロジックを実行できます: モバイル デバイスであるかどうかと異なる HTML マークアップを出力します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-163">***Solve the problem on the server* –** If your server knows what device is accessing it – or at least the characteristics of that device, such as its screen size and input method, and whether it's a mobile device – it can run different logic and output different HTML markup.</span></span> 

    - <span data-ttu-id="e2cb8-164">**利点:**最大柔軟性です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-164">**Advantage:** Maximum flexibility.</span></span> <span data-ttu-id="e2cb8-165">モバイルのサーバー側ロジックを変更したり、必要なデバイスに固有のレイアウトのマークアップを最適化する作業がどの程度の制限はありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-165">There's no limit to how much you can vary your server-side logic for mobiles or optimize your markup for the desired, device-specific layout.</span></span>
    - <span data-ttu-id="e2cb8-166">**利点:**効率的な帯域幅の使用。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-166">**Advantage:** Efficient bandwidth use.</span></span> <span data-ttu-id="e2cb8-167">のみのマークアップとターゲット デバイスを使用する予定のスタイル情報を送信する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-167">You only need to transmit the markup and styling information that the target device is going to use.</span></span>
    - <span data-ttu-id="e2cb8-168">**短所:**強制的残存作業時間またはコードの繰り返しになることがあります (などを行う Web フォーム ページまたは MVC ビューの似ていますが、若干異なるコピーを作成する)。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-168">**Disadvantage:** Sometimes forces repetition of effort or code (e.g., making you create similar but slightly different copies of your Web Forms pages or MVC views).</span></span> <span data-ttu-id="e2cb8-169">ここで基になるレイヤーまたはサービスですが、まだ、UI コードまたはマークアップの一部に共通のロジックをファクタリングが可能な限りを複製し、並列で管理し、必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-169">Where possible you will factor out common logic into an underlying layer or service, but still, some parts of your UI code or markup may have to be duplicated and then maintained in parallel.</span></span>
    - <span data-ttu-id="e2cb8-170">**短所:**デバイスの検出が容易ではありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-170">**Disadvantage:** Device detection is not trivial.</span></span> <span data-ttu-id="e2cb8-171">リストまたは既知のデバイスの種類とその特性 (できない可能性があります常に完全に最新の状態) のデータベースが必要ですし、すべての受信要求を正確に一致する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-171">It requires a list or database of known device types and their characteristics (which may not always be perfectly up-to-date) and isn't guaranteed to accurately match every incoming request.</span></span> <span data-ttu-id="e2cb8-172">このドキュメントでは、いくつかのオプションとその問題点を後でについて説明します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-172">This document describes some options and their pitfalls later.</span></span>

<span data-ttu-id="e2cb8-173">最良の結果を得るには、ほとんどの開発者は、オプション (2) と (3) を結合する必要があるを検索します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-173">To get the best results, most developers find they need to combine options (2) and (3).</span></span> <span data-ttu-id="e2cb8-174">データ、ワークフロー、またはマークアップの主な相違点がサーバー側コードで実装が最も効果的に対し、で始め、多少異なるは CSS または偶数の JavaScript を使用して、クライアントで対応最適。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-174">Minor stylistic differences are best accommodated on the client using CSS or even JavaScript, whereas major differences in data, workflow, or markup are most effectively implemented in server-side code.</span></span>

### <a name="this-paper-focuses-on-server-side-techniques"></a><span data-ttu-id="e2cb8-175">このホワイト ペーパーは、サーバー側の技法に焦点を当てています</span><span class="sxs-lookup"><span data-stu-id="e2cb8-175">This paper focuses on server-side techniques</span></span>

<span data-ttu-id="e2cb8-176">ASP.NET Web フォームと MVC は、主にサーバー側の両方のテクノロジであるため、このホワイト ペーパーは異なるマークアップとモバイル ブラウザーのロジックを作成するのに便利なサーバー側技法に説明します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-176">Since ASP.NET Web Forms and MVC are both primarily server-side technologies, this white paper will focus on server-side techniques that let you produce different markup and logic for mobile browsers.</span></span> <span data-ttu-id="e2cb8-177">もちろん、任意のクライアント側手法 (たとえば、CSS 3 メディア クエリ、プログレッシブ拡張 JavaScript)、これも組み合わせることができますが、ASP.NET 開発するよりも web デザインの問題より。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-177">Of course, you can also combine this with any client-side technique (e.g., CSS 3 media queries, progressive-enhancement JavaScript), but that's more a matter of web design than ASP.NET development.</span></span>

## <a name="browser-and-device-detection"></a><span data-ttu-id="e2cb8-178">ブラウザーとデバイスの検出</span><span class="sxs-lookup"><span data-stu-id="e2cb8-178">Browser and device detection</span></span>

<span data-ttu-id="e2cb8-179">モバイル デバイスをサポートするためのすべてのサーバー側手法のキーの前提条件を知り、ビジターを使用してどのようなデバイスです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-179">The key prerequisite for all server-side techniques for supporting mobile devices is to know what device your visitor is using.</span></span> <span data-ttu-id="e2cb8-180">実際には、そのデバイスの製造元とモデルの数を知ることがわからないより良いもので、*特性*デバイスのです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-180">In fact, even better than knowing the manufacturer and model number of that device is knowing the *characteristics* of the device.</span></span> <span data-ttu-id="e2cb8-181">特性があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-181">Characteristics may include:</span></span>

- <span data-ttu-id="e2cb8-182">モバイル デバイスですか。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-182">Is it a mobile device?</span></span>
- <span data-ttu-id="e2cb8-183">入力方式 (マウスまたはキーボード、タッチ、キーパッド、ジョイスティック、...)</span><span class="sxs-lookup"><span data-stu-id="e2cb8-183">Input method (mouse/keyboard, touch, keypad, joystick, …)</span></span>
- <span data-ttu-id="e2cb8-184">画面のサイズ (物理的と (ピクセル単位))</span><span class="sxs-lookup"><span data-stu-id="e2cb8-184">Screen size (physically and in pixels)</span></span>
- <span data-ttu-id="e2cb8-185">サポートされているメディアとデータの形式</span><span class="sxs-lookup"><span data-stu-id="e2cb8-185">Supported media and data formats</span></span>
- <span data-ttu-id="e2cb8-186">などです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-186">Etc.</span></span>

<span data-ttu-id="e2cb8-187">意思決定を行うモデル番号より特性に基づくためことをお勧めしてより設備が将来のデバイスの処理ができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-187">It's better to make decisions based on characteristics than model number, because then you'll be better equipped to handle future devices.</span></span>

### <a name="using-aspnets-built-in-browser-detection-support"></a><span data-ttu-id="e2cb8-188">ASP を使用します。NET の組み込みブラウザー検出のサポート</span><span class="sxs-lookup"><span data-stu-id="e2cb8-188">Using ASP.NET's built-in browser detection support</span></span>

<span data-ttu-id="e2cb8-189">プロパティを調べることで ASP.NET Web フォームと MVC の開発者が訪問ブラウザーの重要な特性をすぐに検出、 *Request.Browser*オブジェクト。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-189">ASP.NET Web Forms and MVC developers can immediately discover important characteristics of a visiting browser by inspecting properties of the *Request.Browser* object.</span></span> <span data-ttu-id="e2cb8-190">たとえばを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-190">For example, see</span></span>

- <span data-ttu-id="e2cb8-191">Request.Browser.IsMobileDevice</span><span class="sxs-lookup"><span data-stu-id="e2cb8-191">Request.Browser.IsMobileDevice</span></span>
- <span data-ttu-id="e2cb8-192">Request.Browser.MobileDeviceManufacturer、Request.Browser.MobileDeviceModel</span><span class="sxs-lookup"><span data-stu-id="e2cb8-192">Request.Browser.MobileDeviceManufacturer, Request.Browser.MobileDeviceModel</span></span>
- <span data-ttu-id="e2cb8-193">Request.Browser.ScreenPixelsWidth</span><span class="sxs-lookup"><span data-stu-id="e2cb8-193">Request.Browser.ScreenPixelsWidth</span></span>
- <span data-ttu-id="e2cb8-194">Request.Browser.SupportsXmlHttp</span><span class="sxs-lookup"><span data-stu-id="e2cb8-194">Request.Browser.SupportsXmlHttp</span></span>
- <span data-ttu-id="e2cb8-195">.. 参照できます他の多くのユーザー</span><span class="sxs-lookup"><span data-stu-id="e2cb8-195">…and many others</span></span>

<span data-ttu-id="e2cb8-196">背後では、ASP.NET プラットフォームには、入力方向が一致する*User-agent*に対して一連のブラウザーの定義 XML ファイルでの正規表現 (UA) HTTP ヘッダー。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-196">Behind the scenes, the ASP.NET platform matches the incoming *User-Agent* (UA) HTTP header against regular expressions in a set of Browser Definition XML files.</span></span> <span data-ttu-id="e2cb8-197">既定では、プラットフォームには、多くの一般的なモバイル デバイスの定義が含まれます、他のユーザーが認識するカスタムのブラウザー定義ファイルを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-197">By default the platform includes definitions for many common mobile devices, and you can add custom Browser Definition files for others you wish to recognize.</span></span> <span data-ttu-id="e2cb8-198">詳細については、MSDN のページを参照してください。 [ASP.NET Web サーバー コントロールとブラウザーの機能](https://msdn.microsoft.com/library/x3k2ssx2.aspx)します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-198">For more details, see the MSDN page [ASP.NET Web Server Controls and Browser Capabilities](https://msdn.microsoft.com/library/x3k2ssx2.aspx).</span></span>

### <a name="using-the-wurfl-device-database-via-51degreesmobi-foundation"></a><span data-ttu-id="e2cb8-199">データベースを使用してください、WURFL デバイス 51Degrees.mobi Foundation を使用して</span><span class="sxs-lookup"><span data-stu-id="e2cb8-199">Using the WURFL device database via 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="e2cb8-200">ASP の中にします。できない可能性があるのに十分な場合に 2 つの主要なケースがある NET の組み込みブラウザー検出のサポートは、多くのアプリケーションのための十分なされます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-200">While ASP.NET's built-in browser detection support will be sufficient for many applications, there are two main cases when it might not be enough:</span></span>

- <span data-ttu-id="e2cb8-201">***最新のデバイスを認識する***(なし、それらのブラウザー定義ファイルを手動で作成) します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-201">***You want to recognize the latest devices***(without manually creating Browser Definition files for them).</span></span> <span data-ttu-id="e2cb8-202">.NET 4 のブラウザー定義ファイルが Windows Phone 7、Android フォン、Opera Mobile ブラウザーの場合、または Apple Ipad を認識するのに十分な最新でないことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-202">Note that .NET 4's Browser Definition files are not recent enough to recognize Windows Phone 7, Android phones, Opera Mobile browsers, or Apple iPads.</span></span>
- <span data-ttu-id="e2cb8-203">***デバイスの機能の詳細な情報が必要な***します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-203">***You need more detailed information about device capabilities***.</span></span> <span data-ttu-id="e2cb8-204">デバイスの入力方式 (タッチ vs キーパッドなど) について知っておく必要がありますか、どのようなオーディオ形式のブラウザーをサポートしています。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-204">You may need to know about a device's input method (e.g., touch vs keypad), or what audio formats the browser supports.</span></span> <span data-ttu-id="e2cb8-205">この情報は、標準のブラウザー定義ファイルでは使用できません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-205">This information isn't available in the standard Browser Definition files.</span></span>

<span data-ttu-id="e2cb8-206">[*ワイヤレス ユニバーサル リソース ファイル*(WURFL) プロジェクト](http://wurfl.sourceforge.net/)はるかに最新の状態と詳細に関する情報を保持使用しているモバイル デバイス今日です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-206">The [*Wireless Universal Resource File* (WURFL) project](http://wurfl.sourceforge.net/) maintains much more up-to-date and detailed information about mobile devices in use today.</span></span>

<span data-ttu-id="e2cb8-207">.NET 開発者向けのすばらしいは、その ASP です。NET のブラウザーの検出機能は、ため機能を拡張してこれらの問題を解決することは、拡張可能です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-207">The great news for .NET developers is that ASP.NET's browser detection feature is extensible, so it's possible to enhance it to overcome these problems.</span></span> <span data-ttu-id="e2cb8-208">たとえば、オープン ソースを追加することができます[ *51Degrees.mobi Foundation* ](https://github.com/51Degrees/dotNET-Device-Detection)をプロジェクトにライブラリです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-208">For example, you can add the open source [*51Degrees.mobi Foundation*](https://github.com/51Degrees/dotNET-Device-Detection) library to your project.</span></span> <span data-ttu-id="e2cb8-209">ASP.NET IHttpModule またはブラウザー機能プロバイダー (Web フォームと MVC アプリケーションの両方で使用できる)、直接 WURFL データを読み取り、ASP にフックするをお勧めします。NET の組み込みブラウザー検出メカニズムです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-209">It's an ASP.NET IHttpModule or Browser Capabilities Provider (usable on both Web Forms and MVC applications), that directly reads WURFL data and hooks it into ASP.NET's built-in browser detection mechanism.</span></span> <span data-ttu-id="e2cb8-210">モジュールをインストールしたら*Request.Browser*もっと正確かつ詳細な情報が含まれます突然: 正しくの前に説明したデバイスの多くが認識され、(などの機能を一覧表示されます追加機能の入力方法など)。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-210">Once you've installed the module, *Request.Browser* will suddenly contain a lot more accurate and detailed information: it will correctly recognize many of the devices previously mentioned and list their capabilities (including additional capabilities such as input method).</span></span> <span data-ttu-id="e2cb8-211">詳細については、プロジェクトのドキュメントを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-211">See the project's documentation for more details.</span></span>

## <a name="how-web-forms-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="e2cb8-212">Web フォーム アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="e2cb8-212">How Web Forms applications can present mobile-specific pages</span></span>

<span data-ttu-id="e2cb8-213">既定では、次に一般的なモバイル デバイスで新しい Web フォーム アプリケーションを表示する方法を示します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-213">By default, here's how a brand new Web Forms application displays on common mobile devices:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image1.png)

<span data-ttu-id="e2cb8-214">明確に、どちらもレイアウトは非常にモバイル対応 – このページは、縦向きで小さな画面ではなく、規模が大きく、横向きのモニター用に設計されました。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-214">Clearly, neither layout looks very mobile-friendly – this page was designed for a large, landscape-oriented monitor, not for a small portrait-oriented screen.</span></span> <span data-ttu-id="e2cb8-215">したがって何を実行できることについてしますか。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-215">So what can you do about it?</span></span>

<span data-ttu-id="e2cb8-216">この記事で前述したよう、モバイル デバイスの場合、ページを調整するためのさまざまな方法があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-216">As discussed earlier in this paper, there are many ways to tailor your pages for mobile devices.</span></span> <span data-ttu-id="e2cb8-217">一部のテクニックは、サーバー ベースで、他のユーザーがクライアントで実行します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-217">Some techniques are server-based, others run on the client.</span></span>

### <a name="creating-a-mobile-specific-master-page"></a><span data-ttu-id="e2cb8-218">特定のモバイル マスター ページを作成します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-218">Creating a mobile-specific master page</span></span>

<span data-ttu-id="e2cb8-219">要件に応じて、ことができますを同じ Web フォームを使用して、すべてのビジターに対しては、2 つのマスター ページを異なる: デスクトップ訪問者の 1 つは、モバイル ユーザー用に別のです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-219">Depending on your requirements, you may be able to use the same Web Forms for all visitors, but have two separate master pages: one for desktop visitors, another for mobile visitors.</span></span> <span data-ttu-id="e2cb8-220">これは、ビューでは、柔軟、CSS スタイル シート、またはページ、任意のロジックを複製することを強制することがなく、モバイル デバイスに合わせて、最上位の HTML マークアップを変更したことができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-220">This gives you the flexibility of changing the CSS stylesheet or your top-level HTML markup to suit mobile devices, without forcing you to duplicate any page logic.</span></span>

<span data-ttu-id="e2cb8-221">これは簡単に行えます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-221">This is easy to do.</span></span> <span data-ttu-id="e2cb8-222">たとえば、Web フォームに、次のよう PreInit ハンドラーを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-222">For example, you can add a PreInit handler such as the following to a Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample1.cs)]

<span data-ttu-id="e2cb8-223">ここで、アプリケーションの最上位のフォルダーで Mobile.Master と呼ばれるマスター ページを作成し、モバイル デバイスが検出されたときに使用されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-223">Now, create a master page called Mobile.Master in the top-level folder of your application, and it will be used when a mobile device is detected.</span></span> <span data-ttu-id="e2cb8-224">モバイル マスター ページには、必要な場合、mobile に固有の CSS スタイル シートを参照できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-224">Your mobile master page can reference a mobile-specific CSS stylesheet if necessary.</span></span> <span data-ttu-id="e2cb8-225">デスクトップの訪問者が、既定のマスター ページ、モバイルのものではなく表示されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-225">Desktop visitors will still see your default master page, not the mobile one.</span></span>

### <a name="creating-independent-mobile-specific-web-forms"></a><span data-ttu-id="e2cb8-226">独立した特定のモバイル Web フォームを作成します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-226">Creating independent mobile-specific Web Forms</span></span>

<span data-ttu-id="e2cb8-227">柔軟性を最大限に高めることができます移動するさまざまなデバイスの種類別のマスター ページを単にない場合に比べてはるかにさらに。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-227">For maximum flexibility, you can go much further than just having separate master pages for different device types.</span></span> <span data-ttu-id="e2cb8-228">2 つを実装することができます*Web フォーム ページのセットを完全に分離*– 1 つ別デスクトップ ブラウザーの設定、モバイルの設定。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-228">You can implement two *totally separate sets of Web Forms pages* – one set for desktop browsers, another set for mobiles.</span></span> <span data-ttu-id="e2cb8-229">これは最適をモバイル閲覧者に非常に異なる情報またはワークフローを表示する場合です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-229">This works best if you want to present very different information or workflows to mobile visitors.</span></span> <span data-ttu-id="e2cb8-230">このセクションの残りの部分では、この方法の詳細について説明します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-230">The rest of this section describes this approach in detail.</span></span>

<span data-ttu-id="e2cb8-231">デスクトップ ブラウザー用に設計された Web フォーム アプリケーションが既にあると仮定した場合、続行する最も簡単な方法をプロジェクト内で「モバイル」をという名前のサブフォルダーを作成し、モバイル ページがありますを構築します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-231">Assuming you already have a Web Forms application designed for desktop browsers, the easiest way to proceed is to create a subfolder called "Mobile" within your project, and build your mobile pages there.</span></span> <span data-ttu-id="e2cb8-232">すべてが同じ他の Web フォーム アプリケーションで使用する手法を使用して、独自のマスター ページ、スタイル シート、およびページで、全体のサブ サイトを構築できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-232">You can construct an entire sub-site, with its own master pages, style sheets, and pages, using all the same techniques that you'd use for any other Web Forms application.</span></span> <span data-ttu-id="e2cb8-233">モバイルに相当するを生成するために必ずしも必要*すべて*デスクトップ サイトのページ以外の場合はどのような機能のサブセットが納得できるモバイル閲覧者を選択できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-233">You don't necessarily need to produce a mobile equivalent for *every* page in your desktop site; you can choose what subset of functionality makes sense for mobile visitors.</span></span>

<span data-ttu-id="e2cb8-234">モバイル ページは、共通の静的なリソースを共有できます (イメージ、JavaScript、CSS などのファイル) とする場合、通常のページ。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-234">Your mobile pages can share common static resources (such as images, JavaScript, or CSS files) with your regular pages if you wish.</span></span> <span data-ttu-id="e2cb8-235">「モバイル」フォルダー*いない*マークする、別のアプリケーションとして (Web フォーム ページの単純なサブフォルダーだけである)、IIS でホストされている場合は共有もすべてが同じ構成、セッション データ、およびその他のインフラストラクチャとして、デスクトップのページです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-235">Since your "Mobile" folder will *not* be marked as a separate application when hosted in IIS (it's just a simple subfolder of Web Forms pages), it will also share all the same configuration, Session data, and other infrastructure as your desktop pages.</span></span>

> [!NOTE]
> <span data-ttu-id="e2cb8-236">このアプローチには、通常のコードの一部の重複が含まれているので (モバイル ページにはデスクトップ ページといくつかの類似点を共有する可能性の高い、)、一般的なビジネス ロジックまたはデータ アクセス コード共有の基になるレイヤーまたはサービスに排除することが重要です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-236">Since this approach usually involves some duplication of code (mobile pages are likely to share some similarities with desktop pages), it's important to factor out any common business logic or data access code into a shared underlying layer or service.</span></span> <span data-ttu-id="e2cb8-237">それ以外の場合、倍精度浮動小数点を作成して、アプリケーションの保守作業があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-237">Otherwise, you'll double the effort of creating and maintaining your application.</span></span>


#### <a name="redirecting-mobile-visitors-to-your-mobile-pages"></a><span data-ttu-id="e2cb8-238">モバイル ページをモバイル閲覧者のリダイレクト</span><span class="sxs-lookup"><span data-stu-id="e2cb8-238">Redirecting mobile visitors to your mobile pages</span></span>

<span data-ttu-id="e2cb8-239">のみモバイル ページをモバイル閲覧者をリダイレクトすると便利なことがよくあります、*最初*のために、参照しているセッションで、自身のセッションですべての要求ではなく) を要求します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-239">It's often convenient to redirect mobile visitors to the mobile pages only on the *first* request in their browsing session (and not on every request in their session), because:</span></span>

- <span data-ttu-id="e2cb8-240">リンクを「デスクトップ バージョン」に移動するマスター ページだけ置く – 希望する場合、デスクトップのページにアクセスするモバイル訪問者を簡単に許可できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-240">You can then easily allow mobile visitors to access your desktop pages if they wish – just put a link on your master page that goes to "Desktop version".</span></span> <span data-ttu-id="e2cb8-241">訪問者は、ことがなくなったため、最初の要求自身のセッションで、モバイル ページにリダイレクトされません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-241">The visitor won't be redirected back to a mobile page, because it's no longer the first request in their session.</span></span>
- <span data-ttu-id="e2cb8-242">(IFRAME、または特定の Ajax ハンドラーに、サイトのデスクトップとモバイルの両方のパーツを表示する一般的な Web フォームがある) 場合などに、サイトのデスクトップおよびモバイルの部分の間で共有するすべての動的なリソースに対する要求に干渉することのリスクを回避できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-242">It avoids the risk of interfering with requests for any dynamic resources shared between desktop and mobile parts of your site (e.g., if you have a common Web Form that both desktop and mobile parts of your site display in an IFRAME, or certain Ajax handlers)</span></span>

<span data-ttu-id="e2cb8-243">これを行うには、リダイレクト ロジックを配置することができます、**セッション\_開始**メソッドです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-243">To do this, you can place your redirection logic in a **Session\_Start** method.</span></span> <span data-ttu-id="e2cb8-244">たとえば、Global.asax.cs ファイルに次のメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-244">For example, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample2.cs)]

#### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="e2cb8-245">モバイル ページを尊重するフォーム認証を構成します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-245">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="e2cb8-246">訪問者をリダイレクトと、認証プロセスの中に、場所に関する仮定がフォーム認証を行うことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-246">Note that Forms Authentication makes certain assumptions about where it can redirect visitors during and after the authentication process:</span></span>

- <span data-ttu-id="e2cb8-247">ユーザーを認証する場合、フォーム認証をリダイレクトするそれらデスクトップまたはモバイル ユーザーいるかどうかに関係なく、デスクトップ ログイン ページ (だけの概念があるため*1*ログイン URL)。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-247">When a user needs to be authenticated, Forms Authentication will redirect them to your desktop login page, regardless of whether they're a desktop or mobile user (because it only has a concept of *one* login URL).</span></span> <span data-ttu-id="e2cb8-248">モバイル ユーザーを別のモバイル ログイン ページにリダイレクトできるように、デスクトップのログイン ページを強化するために、モバイルのログイン ページを異なる方法でスタイルを設定すると仮定すると、必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-248">Assuming you want to style your mobile login page differently, you need to enhance your desktop login page so that it redirects mobile users to a separate mobile login page.</span></span> <span data-ttu-id="e2cb8-249">たとえば、次のコードを追加、**デスクトップ**ログイン ページのコード ビハインド。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-249">For example, add the following code to your **desktop** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample3.cs)]
- <span data-ttu-id="e2cb8-250">ユーザーがログインに成功、フォーム認証は既定ではリダイレクトに、デスクトップのホーム ページに (だけの概念があるため*1*既定のページ)。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-250">After a user successfully logs in, Forms Authentication will by default redirect them to your desktop home page (because it only has a concept of *one* default page).</span></span> <span data-ttu-id="e2cb8-251">成功したログの後に、モバイルのホーム ページにリダイレクトできるように、モバイルのログイン ページを強化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-251">You need to enhance your mobile login page so that it redirects to the mobile home page after a successful log-in.</span></span> <span data-ttu-id="e2cb8-252">たとえば、次のコードを追加、**モバイル**ログイン ページのコード ビハインド。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-252">For example, add the following code to your **mobile** login page code-behind:</span></span> 

    [!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample4.cs)]
  
 <span data-ttu-id="e2cb8-253">このコードでは、ページに既定のプロジェクト テンプレートと同様に、LoginUser と呼ばれるログイン サーバー コントロールが前提としています。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-253">This code assumes your page has a Login server control called LoginUser, as in the default project template.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="e2cb8-254">出力キャッシュの使用</span><span class="sxs-lookup"><span data-stu-id="e2cb8-254">Working with Output Caching</span></span>

<span data-ttu-id="e2cb8-255">出力キャッシュを使用している場合は、キャッシュされたデスクトップの出力を受信するモバイル ユーザー続く既定ではデスクトップのユーザー (キャッシュに保存するには、その出力の原因と)、特定の URL に移動することも可能である、ことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-255">If you're using output caching, beware that by default it's possible for a desktop user to visit a certain URL (causing its output to be cached), followed by a mobile user who then receives the cached desktop output.</span></span> <span data-ttu-id="e2cb8-256">この警告は、さまざまなデバイスの種類で、マスター ページまたはデバイスの種類ごとにまったく別の Web フォームを実装しているだけかどうかを適用します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-256">This warning applies whether you're just varying your master page by device type, or implementing totally separate Web Forms per device type.</span></span>

<span data-ttu-id="e2cb8-257">この問題を避けるためには、訪問者がモバイル デバイスを使用しているかどうかに従って、キャッシュ エントリを変更するための ASP.NET に指示できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-257">To avoid the problem, you can instruct ASP.NET to vary the cache entry according to whether the visitor is using a mobile device.</span></span> <span data-ttu-id="e2cb8-258">ページの OutputCache 宣言によう VaryByCustom パラメーターを追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-258">Add a VaryByCustom parameter to your page's OutputCache declaration as follows:</span></span>

[!code-aspx[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample5.aspx)]

<span data-ttu-id="e2cb8-259">次に、定義*isMobileDevice* Global.asax.cs ファイルに次のメソッドを追加することでパラメーターを上書きするカスタム キャッシュとして。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-259">Next, define *isMobileDevice* as a custom cache parameter by adding the following method override to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample6.cs)]

<span data-ttu-id="e2cb8-260">ページのモバイル訪問者がデスクトップの訪問者によってキャッシュに格納した出力を受信しないようになります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-260">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="e2cb8-261">実際の例</span><span class="sxs-lookup"><span data-stu-id="e2cb8-261">A working example</span></span>

<span data-ttu-id="e2cb8-262">これらの手法の動作を表示するには、ダウンロード[このホワイト ペーパーのコード サンプル](https://docs.microsoft.com/aspnet/mobile/overview)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-262">To see these techniques in action, download [this white paper's code samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="e2cb8-263">Web フォーム サンプル アプリケーションは、Mobile をという名前のサブフォルダー内の特定のモバイル ページのセットにモバイル ユーザーを自動的にリダイレクトします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-263">The Web Forms sample application automatically redirects mobile users to a set of mobile-specific pages in a subfolder called Mobile.</span></span> <span data-ttu-id="e2cb8-264">マークアップとそれらのページのスタイルがより適切に最適化モバイル ブラウザーは、次のスクリーン ショットからわかることができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-264">The markup and styling of those pages is better optimized for mobile browsers, as you can see from the following screenshots:</span></span>

![](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/_static/image2.png)

<span data-ttu-id="e2cb8-265">モバイル ブラウザー用のマークアップと CSS の最適化に関する詳細については、「スタイリング モバイル ページ モバイル ブラウザーの」このドキュメントの後半のセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-265">For more tips about optimizing your markup and CSS for mobile browsers, see the section "Styling mobile pages for mobile browsers" later in this document.</span></span>

## <a name="how-aspnet-mvc-applications-can-present-mobile-specific-pages"></a><span data-ttu-id="e2cb8-266">ASP.NET MVC アプリケーションがモバイル固有のページを表示する方法</span><span class="sxs-lookup"><span data-stu-id="e2cb8-266">How ASP.NET MVC applications can present mobile-specific pages</span></span>

<span data-ttu-id="e2cb8-267">モデル ビュー コント ローラー パターンでは、アプリケーション ロジックを (コント ローラー) (ビュー) でのプレゼンテーション ロジックからを切り離して、ために、サーバー側コードでモバイル デバイスのサポートを処理するように、次のアプローチのいずれかから選択できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-267">Since the Model-View-Controller pattern decouples application logic (in controllers) from presentation logic (in views), you can choose from any of the following approaches to handling mobile support in server-side code:</span></span>

1. <span data-ttu-id="e2cb8-268">***デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーとビューを使用してが、デバイスの種類 * に応じてさまざまな Razor レイアウトでビューをレンダリングします。**</span><span class="sxs-lookup"><span data-stu-id="e2cb8-268">***Use the same controllers and views for both desktop and mobile browsers, but render the views with different Razor layouts depending on the device type*.**</span></span> <span data-ttu-id="e2cb8-269">このオプションは、単に別の CSS スタイル シートを指定するか、モバイルの最上位の HTML 要素をいくつかを変更する場合、すべてのデバイス上の同一のデータを表示している場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-269">This option works best if you're displaying identical data on all devices, but simply want to supply different CSS stylesheets or change a few top-level HTML elements for mobiles.</span></span>
2. <span data-ttu-id="e2cb8-270">***デスクトップとモバイルの両方のブラウザーでは、同じコント ローラーを使用して、デバイスの種類に応じて異なるビューをレンダリング***です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-270">***Use the same controllers for both desktop and mobile browsers, but render different views depending on the device type***.</span></span> <span data-ttu-id="e2cb8-271">ほぼ同じデータを表示するエンドユーザーのため、同じワークフローを提供する場合、このオプションは最適が使用されているデバイスに合わせて、非常に異なる HTML マークアップを表示するためにします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-271">This option works best if you're displaying roughly the same data and providing the same workflows for end users, but want to render very different HTML markup to suit the device being used.</span></span>
3. <span data-ttu-id="e2cb8-272">***デスクトップとモバイル ブラウザーは、それぞれを独立したコント ローラーとビューを実装する独立した領域の作成 * です。**</span><span class="sxs-lookup"><span data-stu-id="e2cb8-272">***Create separate areas for desktop and mobile browsers, implementing independent controllers and views for each*.**</span></span> <span data-ttu-id="e2cb8-273">このオプションは、非常にさまざまな画面を表示する、さまざまな情報を含むおよび先頭のユーザー、デバイスの種類用に最適化されたさまざまなワークフローを実行している場合に最適です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-273">This option works best if you're displaying very different screens, containing different information and leading the user through different workflows optimized for their device type.</span></span> <span data-ttu-id="e2cb8-274">コードの一部の繰り返しがありますが、基になるレイヤーまたはサービスを一般的なロジックをファクタリングする最小化できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-274">It may mean some repetition of code, but you can minimize that by factoring out common logic into an underlying layer or service.</span></span>

<span data-ttu-id="e2cb8-275">実行する場合、**最初**オプションを選択し、Razor レイアウトのみを異なるデバイスの種類、あたりは非常に簡単です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-275">If you want to take the **first** option and vary only the Razor layout per device type, it's very easy.</span></span> <span data-ttu-id="e2cb8-276">変更するだけ、 \_ViewStart.cshtml ファイルの次のようにします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-276">Just modify your \_ViewStart.cshtml file as follows:</span></span>

[!code-cshtml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample7.cshtml)]

<span data-ttu-id="e2cb8-277">呼ばれるモバイル固有のレイアウトを作成できるようになりました\_ページ構造を持つ LayoutMobile.cshtml と CSS 規則をモバイル デバイス用に最適化します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-277">Now you can create a mobile-specific layout called \_LayoutMobile.cshtml with a page structure and CSS rules optimized for mobile devices.</span></span>

<span data-ttu-id="e2cb8-278">実行する場合、 **2 番目**訪問者のデバイスの種類に応じてまったく異なるビューをレンダリングをオプションを参照してください[Scott Hanselman のブログの投稿](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-278">If you want to take the **second** option render totally different views according to the visitor's device type, see [Scott Hanselman's blog post](http://www.hanselman.com/blog/ABetterASPNETMVCMobileDeviceCapabilitiesViewEngine.aspx).</span></span>

<span data-ttu-id="e2cb8-279">このホワイト ペーパーの残りの部分に焦点、 **3 番目**オプション – 別のコント ローラーを作成する*と*正確にどのような機能のサブセットが表示されます。 モバイル閲覧者を管理することがモバイル デバイスのビューです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-279">The rest of this paper focuses on the **third** option – creating separate controllers *and* views for mobile devices – so you can control exactly what subset of functionality is offered for mobile visitors.</span></span>

### <a name="setting-up-a-mobile-area-within-your-aspnet-mvc-application"></a><span data-ttu-id="e2cb8-280">ASP.NET MVC アプリケーション内でのモバイル領域の設定</span><span class="sxs-lookup"><span data-stu-id="e2cb8-280">Setting up a Mobile area within your ASP.NET MVC application</span></span>

<span data-ttu-id="e2cb8-281">通常の方法で既存の ASP.NET MVC アプリケーションには、「モバイル」と呼ばれる部分を追加することができます。 ソリューション エクスプ ローラーでプロジェクト名を右クリックし、追加 à 領域を選択します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-281">You can add an area called "Mobile" to an existing ASP.NET MVC application in the normal way: right-click on your project name in Solution Explorer, then choose Add à Area.</span></span> <span data-ttu-id="e2cb8-282">ASP.NET MVC アプリケーション内の他の任意の領域の場合と同様、し、コント ローラーとビューを追加することができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-282">You can then add controllers and views as you would for any other area within an ASP.NET MVC application.</span></span> <span data-ttu-id="e2cb8-283">モバイル閲覧者のホームページとしてテンプレートを使用すると呼ばれる新しいコント ローラーをモバイル領域など、追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-283">For example, add to your Mobile area a new controller called HomeController to act as a homepage for mobile visitors.</span></span>

### <a name="ensuring-the-url-mobile-reaches-the-mobile-homepage"></a><span data-ttu-id="e2cb8-284">モバイルのホームページに達すると URL/Mobile を確保します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-284">Ensuring the URL /Mobile reaches the mobile homepage</span></span>

<span data-ttu-id="e2cb8-285">URL/Mobile HomeController のインデックスの操作をモバイルの領域の内側に到達する場合は、ルーティング構成に次の 2 つの小さな変更を加える必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-285">If you want the URL /Mobile to reach the Index action on HomeController inside your Mobile area, you will need to make two small changes to your routing configuration.</span></span> <span data-ttu-id="e2cb8-286">最初に、更新、MobileAreaRegistration クラス テンプレートを使用するが、モバイル領域で、既定のコント ローラーになるよう、次のコードに示すように。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-286">First, update your MobileAreaRegistration class so that HomeController is the default controller in your Mobile area, as shown in the following code:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample8.cs)]

<span data-ttu-id="e2cb8-287">つまり、モバイルのホーム ページは今すぐに配置される家庭用/Mobile ではなく/Mobile、「ホーム」がであるため、モバイル ページ コント ローラー名を暗黙的に既定値です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-287">This means the mobile homepage will now be located at /Mobile, rather than /Mobile/Home, because "Home" is now the implicitly default controller name for mobile pages.</span></span>

<span data-ttu-id="e2cb8-288">次に、こと、2 番目のテンプレートを使用するアプリケーション (つまり、モバイルもの、既存のデスクトップ 1 つだけでなく) に追加すると、ありますが破損した正規デスクトップ ブラウザーのホーム ページに注意してください。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-288">Next, note that by adding a second HomeController to your application (i.e., the mobile one, in addition to the existing desktop one), you'll have broken your regular desktop homepage.</span></span> <span data-ttu-id="e2cb8-289">これは、エラーで失敗"*'Home' という名前のコント ローラーに一致する複数の種類が見つかりました*"です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-289">It will fail with the error "*Multiple types were found that match the controller named 'Home'*".</span></span> <span data-ttu-id="e2cb8-290">これを解決するには、優先を指定する、デスクトップ テンプレートを使用する必要がありますあいまいさがある場合に (Global.asax.cs) で、最上位レベルのルーティングの構成を更新します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-290">To resolve this, update your top-level routing configuration (in Global.asax.cs) to specify that your desktop HomeController should take priority when there's ambiguity:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample9.cs)]

<span data-ttu-id="e2cb8-291">退席中、および URL http:// エラーになるようになりました*目的のサイト*http://、デスクトップのホーム ページに到達/*目的のサイト*/mobile/はモバイルのホーム ページにアクセスされます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-291">Now the error will go away, and the URL http://*yoursite*/ will reach the desktop homepage, and http://*yoursite*/mobile/ will reach the mobile homepage.</span></span>

### <a name="redirecting-mobile-visitors-to-your-mobile-area"></a><span data-ttu-id="e2cb8-292">モバイルお住まいの地域をモバイル閲覧者のリダイレクト</span><span class="sxs-lookup"><span data-stu-id="e2cb8-292">Redirecting mobile visitors to your mobile area</span></span>

<span data-ttu-id="e2cb8-293">多くのさまざまな機能拡張ポイントがある ASP.NET mvc でリダイレクト ロジックを組み込む可能な方法はたくさんありますようにします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-293">There are many different extensibility points in ASP.NET MVC, so there are many possible ways to inject redirection logic.</span></span> <span data-ttu-id="e2cb8-294">1 つの便利なオプションは、属性を作成するフィルターを [RedirectMobileDevicesToMobileArea]、次の条件が満たされた場合、リダイレクトを実行するには。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-294">One neat option is to create a filter attribute, [RedirectMobileDevicesToMobileArea], that performs a redirection if the following conditions are met:</span></span>

1. <span data-ttu-id="e2cb8-295">ユーザーのセッションでは最初の要求 (つまり、Session.IsNewSession が true に等しい)</span><span class="sxs-lookup"><span data-stu-id="e2cb8-295">It's the first request in the user's session (i.e., Session.IsNewSession equals true)</span></span>
2. <span data-ttu-id="e2cb8-296">モバイル ブラウザーから、要求を受け取った (つまり、Request.Browser.IsMobileDevice が true に等しい)</span><span class="sxs-lookup"><span data-stu-id="e2cb8-296">The request comes from a mobile browser (i.e., Request.Browser.IsMobileDevice equals true)</span></span>
3. <span data-ttu-id="e2cb8-297">ユーザー、モバイルの領域内のリソースが既に要求されていない (つまり、*パス*URL の一部で始まらない/Mobile)</span><span class="sxs-lookup"><span data-stu-id="e2cb8-297">The user is not already requesting a resource in the mobile area (i.e., the *path* part of the URL does not begin with /Mobile)</span></span>

<span data-ttu-id="e2cb8-298">このホワイト ペーパーに含まれているダウンロード可能なサンプルには、このロジックの実装が含まれています。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-298">The downloadable sample included with this white paper includes an implementation of this logic.</span></span> <span data-ttu-id="e2cb8-299">(それ以外の場合場合デスクトップ ビジター最初アクセス特定の URL、デスクトップの出力をキャッシュおよびに提供し、可能性がありますも出力キャッシュが使用している場合でもに正しく処理できることを意味する AuthorizeAttribute から派生した、承認フィルターとして実装されます。その後モバイル ユーザーの場合)。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-299">It's implemented as an authorization filter, derived from AuthorizeAttribute, which means it can work correctly even if you are using output caching (otherwise, if a desktop visitor first accesses a certain URL, the desktop output might be cached and then served to subsequent mobile visitors).</span></span>

<span data-ttu-id="e2cb8-300">フィルターは、ことができますに特定のコント ローラーとアクションを適用するいずれかの例。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-300">As it's a filter, you can choose either to apply it to specific controllers and actions, e.g.,</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample10.cs)]

<span data-ttu-id="e2cb8-301">…</span><span class="sxs-lookup"><span data-stu-id="e2cb8-301">…</span></span> <span data-ttu-id="e2cb8-302">MVC 3 としてすべてのコント ローラーとアクションに適用できるまたは*グローバル フィルター* Global.asax.cs ファイルに。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-302">or you can apply it to all controllers and actions as an MVC 3 *global filter* in your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample11.cs)]

<span data-ttu-id="e2cb8-303">ダウンロード可能なサンプルでは、モバイル、領域内の特定の場所にリダイレクトする、この属性のサブクラスを作成する方法も示します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-303">The downloadable sample also demonstrates how you can create subclasses of this attribute that redirect to specific locations within your mobile area.</span></span> <span data-ttu-id="e2cb8-304">つまり、たとえば、することができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-304">This means, for example, you can:</span></span>

- <span data-ttu-id="e2cb8-305">グローバル フィルターとして表示されている上記を既定では、モバイルのホームページをモバイル閲覧者に送信を登録します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-305">Register a global filter as shown above that sends mobile visitors to the mobile homepage by default.</span></span>
- <span data-ttu-id="e2cb8-306">特殊な [RedirectMobileDevicesToMobileProductPage] フィルターをモバイル閲覧者が要求した任意の製品ページのモバイル バージョンには、"ビュー product"アクションにも適用されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-306">Also apply a special [RedirectMobileDevicesToMobileProductPage] filter to a "view product" action that takes mobile visitors to the mobile version of whatever product page they had requested.</span></span>
- <span data-ttu-id="e2cb8-307">フィルターの他の特殊なサブクラスをモバイル閲覧者と同じモバイル ページにリダイレクトする、特定の操作にも適用します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-307">Also apply other special subclasses of the filter to specific actions, redirecting mobile visitors to the equivalent mobile page</span></span>

### <a name="configuring-forms-authentication-to-respect-your-mobile-pages"></a><span data-ttu-id="e2cb8-308">モバイル ページを尊重するフォーム認証を構成します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-308">Configuring Forms Authentication to respect your mobile pages</span></span>

<span data-ttu-id="e2cb8-309">フォーム認証を使用している場合、ことのログインに、ユーザーに必要なときに、自動的にはユーザーをリダイレクト、1 つ特定「ログオン」の URL、既定では注意してください**/アカウント/ログオン**です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-309">If you're using Forms Authentication, you should note that when a user needs to log in, it automatically redirects the user to a single specific "log on" URL, which by default is **/Account/LogOn**.</span></span> <span data-ttu-id="e2cb8-310">つまり、デスクトップ「ログオン」アクションにモバイル ユーザーをリダイレクトする場合があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-310">This means that mobile users may be redirected to your desktop "log on" action.</span></span>

<span data-ttu-id="e2cb8-311">この問題を回避するには、モバイル「ログオン」アクションをモバイル ユーザーに再びリダイレクトできるように、デスクトップのログオン アクションにロジックを追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-311">To avoid this problem, add logic to your desktop "log on" action so that it redirects mobile users again to a mobile "log on" action.</span></span> <span data-ttu-id="e2cb8-312">既定の ASP.NET MVC アプリケーション テンプレートを使用している場合は、次のように AccountController のログオン操作を更新します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-312">If you're using the default ASP.NET MVC application template, update AccountController's LogOn action as follows:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample12.cs)]

<span data-ttu-id="e2cb8-313">…</span><span class="sxs-lookup"><span data-stu-id="e2cb8-313">…</span></span> <span data-ttu-id="e2cb8-314">モバイルお住まいの地域で AccountController と呼ばれるコント ローラーで適切なモバイル固有「ログオン」アクションを実装します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-314">and then implement a suitable mobile-specific "log on" action on a controller called AccountController in your Mobile area.</span></span>

### <a name="working-with-output-caching"></a><span data-ttu-id="e2cb8-315">出力キャッシュの使用</span><span class="sxs-lookup"><span data-stu-id="e2cb8-315">Working with Output Caching</span></span>

<span data-ttu-id="e2cb8-316">[OutputCache] フィルターを使用している場合は、デバイスの種類によって異なるキャッシュ エントリを強制する必要があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-316">If you're using the [OutputCache] filter, you must force the cache entry to vary by device type.</span></span> <span data-ttu-id="e2cb8-317">たとえば、次のように記述します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-317">For example, write:</span></span>

[!code-javascript[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample13.js)]

<span data-ttu-id="e2cb8-318">その後、Global.asax.cs ファイルに次のメソッドを追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-318">Then, add the following method to your Global.asax.cs file:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample14.cs)]

<span data-ttu-id="e2cb8-319">ページのモバイル訪問者がデスクトップの訪問者によってキャッシュに格納した出力を受信しないようになります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-319">This will ensure that mobile visitors to the page don't receive output previously put into the cache by a desktop visitor.</span></span>

### <a name="a-working-example"></a><span data-ttu-id="e2cb8-320">実際の例</span><span class="sxs-lookup"><span data-stu-id="e2cb8-320">A working example</span></span>

<span data-ttu-id="e2cb8-321">これらの手法の動作を表示するには、ダウンロード[このホワイト ペーパーのコードには、サンプルが関連付けられている](https://docs.microsoft.com/aspnet/mobile/overview)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-321">To see these techniques in action, download [this white paper's code associated samples](https://docs.microsoft.com/aspnet/mobile/overview).</span></span> <span data-ttu-id="e2cb8-322">このサンプルには、上記の方法を使用してモバイル デバイスをサポートするために強化された ASP.NET MVC 3 (リリース候補) アプリケーションが含まれています。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-322">The sample includes an ASP.NET MVC 3 (Release Candidate) application enhanced to support mobile devices using the methods described above.</span></span>

## <a name="further-guidance-and-suggestions"></a><span data-ttu-id="e2cb8-323">さらにガイダンスと推奨事項</span><span class="sxs-lookup"><span data-stu-id="e2cb8-323">Further guidance and suggestions</span></span>

<span data-ttu-id="e2cb8-324">次の説明には、Web フォームと MVC の開発者がこのドキュメントで説明する方法を使用している両方が適用されます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-324">The following discussion applies both to Web Forms and MVC developers who are using the techniques covered in this document.</span></span>

### <a name="enhancing-your-redirection-logic-using-51degreesmobi-foundation"></a><span data-ttu-id="e2cb8-325">51Degrees.mobi Foundation を使用して、リダイレクトのロジックを強化</span><span class="sxs-lookup"><span data-stu-id="e2cb8-325">Enhancing your redirection logic using 51Degrees.mobi Foundation</span></span>

<span data-ttu-id="e2cb8-326">このドキュメントで示すリダイレクト ロジックは、アプリケーションの完全に十分な可能性がありますが、セッションを無効にする必要がある場合は機能しませんか、または特定の要求かどうかがわかりません (これらは、セッションを持つことはできません)、cookie を却下するモバイル ブラウザーでは、そのビジターから最初の 1 つ。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-326">The redirection logic shown in this document may be perfectly sufficient for your application, but it won't work if you need to disable sessions, or with mobile browsers that reject cookies (these can't have sessions), because it won't know whether a given request is the first one from that visitor.</span></span>

<span data-ttu-id="e2cb8-327">既に、オープン ソース 51Degrees.mobi Foundation が ASP の精度を向上する方法について説明しました。NET のブラウザーの検出。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-327">You already learned how the open source 51Degrees.mobi Foundation can improve the accuracy of ASP.NET's browser detection.</span></span> <span data-ttu-id="e2cb8-328">Web.config で構成されている特定の場所をモバイル閲覧者のリダイレクトを使用できる、組み込みの機能もあります。によっては、ASP.NET セッションがないと機能することができます (つまり cookie) 訪問者の HTTP ヘッダーと IP アドレスのハッシュの一時的なログを保存すると、それが認識できるように各要求に指定された vistor から最初の 1 つがかどうか。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-328">It also has a built-in ability to redirect mobile visitors to specific locations configured in Web.config. It's able to work without depending on ASP.NET Sessions (and hence cookies) by storing a temporary log of hashes of visitors' HTTP headers and IP addresses, so it knows whether or not each request is the first one from a given vistor.</span></span>

<span data-ttu-id="e2cb8-329">次の要素を web.config ファイルの fiftyOne セクションに追加のページに検出されたモバイル デバイスから、最初の要求がリダイレクト ~/Mobile/Default.aspx です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-329">The following element added to the fiftyOne section of the web.config file will redirect the first request from a detected mobile device to the page ~/Mobile/Default.aspx.</span></span> <span data-ttu-id="e2cb8-330">モバイルのフォルダーの下のページへの要求は*いない*デバイスの種類に関係なく、リダイレクトされます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-330">Any requests to pages under the Mobile folder will *not* be redirected, regardless of device type.</span></span> <span data-ttu-id="e2cb8-331">モバイル デバイスが非アクティブの状態期間忘れては 20 分または複数のデバイスのし、後続の要求がリダイレクトのために新しいものとして扱われます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-331">If the mobile device has been inactive for a period of 20 minutes or more the device will be forgotten and subsequent requests will be treated as new ones for the purposes of redirection.</span></span>

[!code-xml[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample15.xml)]

<span data-ttu-id="e2cb8-332">詳細については、次を参照してください。 [51degrees.mobi Foundation ドキュメント](https://github.com/51Degrees/dotNET-Device-Detection)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-332">For more details, see [51degrees.mobi Foundation documentation](https://github.com/51Degrees/dotNET-Device-Detection).</span></span>

> [!NOTE]
> <span data-ttu-id="e2cb8-333">*できます*51Degrees.mobi Foundation のリダイレクト機能が ASP.NET MVC アプリケーションではプレーンな Url、ルーティングのパラメーターは使用しませんか、または配置 MVC フィルターの観点から、リダイレクトの構成を定義する必要がありますで操作します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-333">You *can* use 51Degrees.mobi Foundation's redirection feature on ASP.NET MVC applications, but you will need to define your redirection configuration in terms of plain URLs, not in terms of routing parameters or by putting MVC filters on actions.</span></span> <span data-ttu-id="e2cb8-334">これは、ため (ドキュメントの執筆時) フィルターまたはルーティング 51Degrees.mobi Foundation が認識されません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-334">This is because (at the time of writing) 51Degrees.mobi Foundation does not recognize filters or routing.</span></span>


### <a name="disabling-transcoders-and-proxy-servers"></a><span data-ttu-id="e2cb8-335">各トランスコーダーとプロキシ サーバーを無効にします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-335">Disabling Transcoders and Proxy Servers</span></span>

<span data-ttu-id="e2cb8-336">モバイルのインターネットへのアプローチで 2 つの広範な目標があるモバイル ネットワーク オペレーター。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-336">Mobile network operators have two broad objectives in their approach to the mobile internet:</span></span>

1. <span data-ttu-id="e2cb8-337">できるだけはるかに関連するコンテンツとして提供します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-337">Provide as much relevant content as possible</span></span>
2. <span data-ttu-id="e2cb8-338">制限付きの無線ネットワークの帯域幅を共有する顧客の数を最大化します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-338">Maximize the number of customers who can share the limited radio network bandwidth</span></span>

<span data-ttu-id="e2cb8-339">ほとんどの web ページは、デスクトップ サイズの大きな画面と固定行高速ブロード バンド接続用に設計された、ため演算子の多くを使用して*トランスコーダーが*または*プロキシ サーバー* web コンテンツを動的に変更します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-339">Since most web pages were designed for large desktop-sized screens and fast fixed-line broadband connections, many operators use *transcoders* or *proxy servers* that dynamically alter web content.</span></span> <span data-ttu-id="e2cb8-340">小さい画面に合わせて (特に"機能フォン用"複雑なレイアウトを処理する処理能力がない)、CSS、HTML マークアップに変更される可能性があり、イメージを (それらの品質を大幅に下げること) を再圧縮 ページの配信速度を向上させるために、可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-340">They may modify your HTML markup or CSS to suit smaller screens (especially for "feature phones" that lack the processing power to handle complex layouts), and they may recompress your images (significantly reducing their quality) to improve page delivery speeds.</span></span>

<span data-ttu-id="e2cb8-341">サイトのモバイルに最適化されたバージョンを生成するために努力を取得できたので、おそらくたくない場合に干渉すること、さらに、ネットワーク演算子。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-341">But if you've taken the effort to produce a mobile-optimized version of your site, you probably don't want the network operator to interfere with it any further.</span></span> <span data-ttu-id="e2cb8-342">次の行を追加するには、ページに\_ASP.NET Web フォームでの Load イベント。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-342">You can add the following line to the Page\_Load event in any ASP.NET Web Form:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample16.cs)]

<span data-ttu-id="e2cb8-343">または、そのコント ローラー上のすべてのアクションに適用されるように ASP.NET MVC のコント ローラーに次のメソッドのオーバーライドを追加する可能性があります。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-343">Or, for an ASP.NET MVC controller, you could add the following method override so that it applies to all actions on that controller:</span></span>

[!code-csharp[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample17.cs)]

<span data-ttu-id="e2cb8-344">結果の HTTP メッセージは、W3C トランスコーダーが準拠しているとコンテンツを変更するには、いないプロキシに通知します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-344">The resulting HTTP message informs W3C compliant transcoders and proxies not to alter content.</span></span> <span data-ttu-id="e2cb8-345">もちろん、モバイル ネットワーク オペレーターがこのメッセージを尊重する保証はありません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-345">Of course, there is no guarantee that mobile network operators will respect this message.</span></span>

### <a name="styling-mobile-pages-for-mobile-browsers"></a><span data-ttu-id="e2cb8-346">モバイル ブラウザー用にモバイル ページのスタイルを設定</span><span class="sxs-lookup"><span data-stu-id="e2cb8-346">Styling mobile pages for mobile browsers</span></span>

<span data-ttu-id="e2cb8-347">詳しく説明するには、このドキュメントの範囲外の HTML マークアップの作業の種類正しくやな web デザインの手法は、特定のデバイスでの操作性を最大化です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-347">It's beyond the scope of this document to describe in great detail what kinds of HTML markup work correctly or which web design techniques maximize usability on particular devices.</span></span> <span data-ttu-id="e2cb8-348">十分に簡単なレイアウトを検索するために用に最適化 mobile サイズの画面では、信頼性の低いを使用せず HTML または CSS トリックを配置します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-348">It's up to you to find a sufficiently simple layout, optimized for a mobile-sized screen, without using unreliable HTML or CSS positioning tricks.</span></span> <span data-ttu-id="e2cb8-349">留意、1 つの重要な手法が、*ビューポートのメタ タグ*です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-349">One important technique worth mentioning, however, is the *viewport meta tag*.</span></span>

<span data-ttu-id="e2cb8-350">ブラウザーによっては最近モバイル、デスクトップのモニタのことを意図した工数表示 web ページで「ビューポート」とも呼ばれる仮想キャンバス上のページを表示する (たとえば、仮想ビューポートは 850 ピクセル Opera Mobile で既定では、iphone、幅 980 ピクセル) し、画面の物理的なピクセルに合わせて、結果のスケール ダウンします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-350">Certain modern mobile browsers, in an effort display web pages meant for desktop monitors, render the page on a virtual canvas, also called "viewport" (e.g., the virtual viewport is 980 pixels wide on iPhone, and 850 pixels wide on Opera Mobile by default) and then scale the result down to fit onto the screen's physical pixels.</span></span> <span data-ttu-id="e2cb8-351">ユーザー ズーム インし、そのビューポート パンします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-351">The user can then zoom in and pan around that viewport.</span></span> <span data-ttu-id="e2cb8-352">これは、利点は、ブラウザーのレイアウトでは、意図した、ページを表示できますも欠点も強制的ズームとパン、ユーザーにとって便利ではないです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-352">This has the advantage that it lets the browser display the page in its intended layout, but it's also has the disadvantage that it forces zooming and panning, which is inconvenient for the user.</span></span> <span data-ttu-id="e2cb8-353">Mobile をデザインする場合お勧めデザインに狭い画面のズームまたは水平方向にスクロールは必要ありませんようにします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-353">If you're designing for mobile, it's better to design for a narrow screen so that no zooming or horizontal scrolling is necessary.</span></span>

<span data-ttu-id="e2cb8-354">ビューポートは幅べきモバイル ブラウザーに指示する方法は、非標準*ビューポート*メタ タグ。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-354">A way to tell the mobile browser how wide the viewport should be is through the nonstandard *viewport* meta tag.</span></span> <span data-ttu-id="e2cb8-355">たとえば、ページの先頭のセクションに、次を追加します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-355">For example, if you add the following to your page's HEAD section,</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample18.html)]

<span data-ttu-id="e2cb8-356">…</span><span class="sxs-lookup"><span data-stu-id="e2cb8-356">…</span></span> <span data-ttu-id="e2cb8-357">480 ピクセル全体の仮想キャンバス上のページをレイアウトは smartphone ブラウザーをサポートします。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-357">then supporting smartphone browsers will lay out the page on a 480-pixel wide virtual canvas.</span></span> <span data-ttu-id="e2cb8-358">これは、HTML 要素は、割合の幅を定義する場合、割合はこの 480 ピクセル幅、既定のビューポートの幅されませんに関して解釈することを意味します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-358">This means that if your HTML elements define their widths in percentage terms, the percentages will be interpreted with respect to this 480-pixel width, not the default viewport width.</span></span> <span data-ttu-id="e2cb8-359">その結果、ユーザーはズームとパン水平方向に – かなりモバイル ブラウザー エクスペリエンスを向上する可能性は低くです。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-359">As a result, the user is less likely to have to zoom and pan horizontally – considerably improving the mobile browsing experience.</span></span>

<span data-ttu-id="e2cb8-360">ビューポートの幅、デバイスの物理的なピクセルに一致する場合は、次を指定できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-360">If you want the viewport width to match the device's physical pixels, you can specify the following:</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample19.html)]

<span data-ttu-id="e2cb8-361">これが正しく機能するには、する必要があります明示的に強制しませんをその幅を超える要素 (などを使用して、*幅*属性または CSS プロパティ)、それ以外の場合、ブラウザーが強制されるようにに関係なく大きいビューポートを使用します。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-361">For this to work correctly, you must not explicitly force elements to exceed that width (e.g., using a *width* attribute or CSS property), otherwise the browser will be forced to use a larger viewport regardless.</span></span> <span data-ttu-id="e2cb8-362">関連項目:[の詳細については、非標準のビューポート タグ](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-362">See also: [more details about the nonstandard viewport tag](https://developer.apple.com/library/safari/#documentation/AppleApplications/Reference/SafariHTMLRef/Articles/MetaTags.html).</span></span>

<span data-ttu-id="e2cb8-363">最近のほとんどのスマート フォンのサポート*デュアル向き*: 縦または横モードではそれらを保持できます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-363">Most modern smartphones support *dual orientation*: they can be held in either portrait or landscape mode.</span></span> <span data-ttu-id="e2cb8-364">そのため、することが重要いないようにについて想定する画面の幅 (ピクセル単位) です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-364">So, it's important not to make assumptions about the screen width in pixels.</span></span> <span data-ttu-id="e2cb8-365">でもと仮定しないで画面の幅が固定されているため、ページになっている間に、ユーザーは自分のデバイスを回転再ことができます。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-365">Don't even assume that the screen width is fixed, because the user can re-orient their device while they are on your page.</span></span>

<span data-ttu-id="e2cb8-366">また場合があります古い Windows Mobile および Blackberry デバイスを使用するは、それらのコンテンツを通知するために、ページ ヘッダーには、次のメタ タグ mobile に対して最適化されているし、したがっては変換されません。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-366">Older Windows Mobile and Blackberry devices may also accept the following meta tags in the page header to inform them content has been optimized for mobile and therefore should not be transformed.</span></span>

[!code-html[Main](add-mobile-pages-to-your-aspnet-web-forms-mvc-application/samples/sample20.html)]

## <a name="additional-resources"></a><span data-ttu-id="e2cb8-367">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="e2cb8-367">Additional Resources</span></span>

<span data-ttu-id="e2cb8-368">モバイル デバイス エミュレーターやシミュレーターのモバイルの ASP.NET web アプリケーションをテストに使用できるの一覧は、ページを参照してください。[テスト用の一般的なモバイル デバイスをシミュレート](../mobile/device-simulators.md)です。</span><span class="sxs-lookup"><span data-stu-id="e2cb8-368">For a list of mobile device emulators and simulators you can use to test your mobile ASP.NET web application, see the page [Simulate popular mobile devices for testing](../mobile/device-simulators.md).</span></span>

## <a name="credits"></a><span data-ttu-id="e2cb8-369">謝辞</span><span class="sxs-lookup"><span data-stu-id="e2cb8-369">Credits</span></span>

- <span data-ttu-id="e2cb8-370">プライマリ作成者: Steven Sanderson</span><span class="sxs-lookup"><span data-stu-id="e2cb8-370">Primary author: Steven Sanderson</span></span>
- <span data-ttu-id="e2cb8-371">レビュー担当者/追加コンテンツの作成者: James Rosewell、Mikael Söderström、Scott Hanselman、Scott ハンター</span><span class="sxs-lookup"><span data-stu-id="e2cb8-371">Reviewers / additional content writers: James Rosewell, Mikael Söderström, Scott Hanselman, Scott Hunter</span></span>
