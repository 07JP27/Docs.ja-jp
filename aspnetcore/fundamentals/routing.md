---
title: "ASP.NET Core のルーティング"
author: ardalis
description: "ASP.NET Core のルーティング機能が受信要求をルート ハンドラーにマッピングするしくみについて説明します。"
manager: wpickett
ms.author: riande
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: fundamentals/routing
ms.openlocfilehash: 2897eb3a756654c61e38e847f5a8e1f8ca4f0b7c
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: HT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/30/2018
---
# <a name="routing-in-aspnet-core"></a><span data-ttu-id="834e3-103">ASP.NET Core のルーティング</span><span class="sxs-lookup"><span data-stu-id="834e3-103">Routing in ASP.NET Core</span></span>

<span data-ttu-id="834e3-104">[Ryan Nowak](https://github.com/rynowak)、[Steve Smith](https://ardalis.com/)、[Rick Anderson](https://twitter.com/RickAndMSFT) 作</span><span class="sxs-lookup"><span data-stu-id="834e3-104">By [Ryan Nowak](https://github.com/rynowak), [Steve Smith](https://ardalis.com/), and [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="834e3-105">ルーティング機能は受信要求をルート ハンドラーにマッピングします。</span><span class="sxs-lookup"><span data-stu-id="834e3-105">Routing functionality is responsible for mapping an incoming request to a route handler.</span></span> <span data-ttu-id="834e3-106">ルートは ASP.NET アプリに定義され、アプリの起動時に構成されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-106">Routes are defined in the ASP.NET app and configured when the app starts up.</span></span> <span data-ttu-id="834e3-107">ルートは、要求に含まれている URL から値を任意で抽出できます。その値を要求処理に利用できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-107">A route can optionally extract values from the URL contained in the request, and these values can then be used for request processing.</span></span> <span data-ttu-id="834e3-108">ルーティング機能は、ASP.NET アプリからのルート情報を利用し、ルート ハンドラーにマッピングする URL を生成することもできます。</span><span class="sxs-lookup"><span data-stu-id="834e3-108">Using route information from the ASP.NET app, the routing functionality is also able to generate URLs that map to route handlers.</span></span> <span data-ttu-id="834e3-109">そのため、ルーティングでは URL に基づいて、つまり、ルート ハンドラー情報によって指定されるルート ハンドラーに対応する URL に基づいてルート ハンドラーを見つけることができます。</span><span class="sxs-lookup"><span data-stu-id="834e3-109">Therefore, routing can find a route handler based on a URL, or the URL corresponding to a given route handler based on route handler information.</span></span>

>[!IMPORTANT]
> <span data-ttu-id="834e3-110">本文では、ASP.NET Core ルーティングについて詳しく取り上げます。</span><span class="sxs-lookup"><span data-stu-id="834e3-110">This document covers the low level ASP.NET Core routing.</span></span> <span data-ttu-id="834e3-111">ASP.NET Core MVC ルーティングについては、「[コントローラー アクションへのルーティング](../mvc/controllers/routing.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-111">For ASP.NET Core MVC routing, see [Routing to Controller Actions](../mvc/controllers/routing.md)</span></span>

<span data-ttu-id="834e3-112">[サンプル コードを表示またはダウンロード](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/sample)します ([ダウンロード方法](xref:tutorials/index#how-to-download-a-sample))。</span><span class="sxs-lookup"><span data-stu-id="834e3-112">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/routing/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="routing-basics"></a><span data-ttu-id="834e3-113">ルーティングの基本</span><span class="sxs-lookup"><span data-stu-id="834e3-113">Routing basics</span></span>

<span data-ttu-id="834e3-114">ルーティングにおける*ルート* ([IRouter](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.routing.irouter) の実装) の利用目的:</span><span class="sxs-lookup"><span data-stu-id="834e3-114">Routing uses *routes* (implementations of [IRouter](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.routing.irouter)) to:</span></span>

* <span data-ttu-id="834e3-115">受信要求を*ルート ハンドラー*にマッピングする</span><span class="sxs-lookup"><span data-stu-id="834e3-115">map incoming requests to *route handlers*</span></span>

* <span data-ttu-id="834e3-116">応答で使用される URL を生成する</span><span class="sxs-lookup"><span data-stu-id="834e3-116">generate URLs used in responses</span></span>

<span data-ttu-id="834e3-117">一般的に、アプリにはルート コレクションが 1 つ与えられます。</span><span class="sxs-lookup"><span data-stu-id="834e3-117">Generally, an app has a single collection of routes.</span></span> <span data-ttu-id="834e3-118">要求が届くと、そのルート コレクションが順を追って処理されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-118">When a request arrives, the route collection is processed in order.</span></span> <span data-ttu-id="834e3-119">受信要求は、ルート コレクションのルートごとに `RouteAsync` メソッドを呼び出し、要求 URL に一致するルートを探します。</span><span class="sxs-lookup"><span data-stu-id="834e3-119">The incoming request looks for a route that matches the request URL by calling the `RouteAsync` method on each available route in the route collection.</span></span> <span data-ttu-id="834e3-120">それに対し、応答はルーティングを利用し、ルート情報に基づいて URL (リダイレクションやリンクの URL など) を生成できます。そのため、URL をハードコーディングする必要がなく、保守管理が楽になります。</span><span class="sxs-lookup"><span data-stu-id="834e3-120">By contrast, a response can use routing to generate URLs (for example, for redirection or links) based on route information, and thus avoid having to hard-code URLs, which helps maintainability.</span></span>

<span data-ttu-id="834e3-121">ルーティングは `RouterMiddleware` クラスにより[ミドルウェア](middleware.md) パイプラインに接続されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-121">Routing is connected to the [middleware](middleware.md) pipeline by the `RouterMiddleware` class.</span></span> <span data-ttu-id="834e3-122">[ASP.NET MVC](../mvc/overview.md) は、ミドルウェア パイプラインにその構成の一部としてルーティングを追加します。</span><span class="sxs-lookup"><span data-stu-id="834e3-122">[ASP.NET MVC](../mvc/overview.md) adds routing to the middleware pipeline as part of its configuration.</span></span> <span data-ttu-id="834e3-123">スタンドアロン コンポーネントとしてルーティングを利用する方法については、「[using-routing-middleware](#using-routing-middleware)」(ルーティング ミドルウェアを使用する) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-123">To learn about using routing as a standalone component, see [using-routing-middleware](#using-routing-middleware).</span></span>

<a name="url-matching-ref"></a>

### <a name="url-matching"></a><span data-ttu-id="834e3-124">URL 一致</span><span class="sxs-lookup"><span data-stu-id="834e3-124">URL matching</span></span>

<span data-ttu-id="834e3-125">URL 一致というプロセスでは、ルーティングによって、受信要求が*ハンドラー*に配布されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-125">URL matching is the process by which routing dispatches an incoming request to a *handler*.</span></span> <span data-ttu-id="834e3-126">このプロセスは通常、URL パスのデータに基づきますが、要求内のあらゆるデータを考慮することもできます。</span><span class="sxs-lookup"><span data-stu-id="834e3-126">This process is generally based on data in the URL path, but can be extended to consider any data in the request.</span></span> <span data-ttu-id="834e3-127">アプリケーションの規模を大きくしたり、より複雑にしたりするとき、要求を個別のハンドラーに配布する機能が鍵となります。</span><span class="sxs-lookup"><span data-stu-id="834e3-127">The ability to dispatch requests to separate handlers is key to scaling the size and complexity of an application.</span></span>

<span data-ttu-id="834e3-128">受信要求は `RouterMiddleware` に入ります。これが各ルートで順に `RouteAsync` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="834e3-128">Incoming requests enter the `RouterMiddleware`, which calls the `RouteAsync` method on each route in sequence.</span></span> <span data-ttu-id="834e3-129">`IRouter` インスタンスは、`RouteContext.Handler` を非 null の `RequestDelegate` に設定することで、要求を*処理する*かどうかを選択します。</span><span class="sxs-lookup"><span data-stu-id="834e3-129">The `IRouter` instance chooses whether to *handle* the request by setting the `RouteContext.Handler` to a non-null `RequestDelegate`.</span></span> <span data-ttu-id="834e3-130">要求に適したハンドラーがルートに見つかると、ルート処理が停止します。ハンドラーが呼び出され、要求を処理します。</span><span class="sxs-lookup"><span data-stu-id="834e3-130">If a route sets a handler for the request, route processing stops and the handler will be invoked to process the request.</span></span> <span data-ttu-id="834e3-131">すべてのルートが試され、要求に適したハンドラーが見つからなかった場合、ミドルウェアは*次*を呼び出し、要求パイプラインの次のミドルウェアが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-131">If all routes are tried and no handler is found for the request, the middleware calls *next* and the next middleware in the request pipeline is invoked.</span></span>

<span data-ttu-id="834e3-132">`RouteAsync` に最初に入力されるのが、現在の要求に関連付けられている `RouteContext.HttpContext` です。</span><span class="sxs-lookup"><span data-stu-id="834e3-132">The primary input to `RouteAsync` is the `RouteContext.HttpContext` associated with the current request.</span></span> <span data-ttu-id="834e3-133">`RouteContext.Handler` と `RouteContext.RouteData` は、ルート一致後に設定される出力です。</span><span class="sxs-lookup"><span data-stu-id="834e3-133">The `RouteContext.Handler` and `RouteContext.RouteData` are outputs that will be set after a route matches.</span></span>

<span data-ttu-id="834e3-134">また、`RouteAsync` で一致が見つかると、それまでに完了した要求処理に基づき、`RouteContext.RouteData` のプロパティが適切な値に設定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-134">A match during `RouteAsync` will also set the properties of the `RouteContext.RouteData` to appropriate values based on the request processing done so far.</span></span> <span data-ttu-id="834e3-135">ルートが要求に一致すると、`RouteContext.RouteData` に*結果*に関する重要なステータス情報が追加されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-135">If a route matches a request, the `RouteContext.RouteData` will contain important state information about the *result*.</span></span>

<span data-ttu-id="834e3-136">`RouteData.Values` は、ルートから生成された*ルート値*のディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="834e3-136">`RouteData.Values` is a dictionary of *route values* produced from the route.</span></span> <span data-ttu-id="834e3-137">この値は通常、URL のトークン化で決定されます。この値を利用してユーザー入力を受け取ったり、アプリケーション内で決定をさらに配布したりできます。</span><span class="sxs-lookup"><span data-stu-id="834e3-137">These values are usually determined by tokenizing the URL, and can be used to accept user input, or to make further dispatching decisions inside the application.</span></span>

<span data-ttu-id="834e3-138">`RouteData.DataTokens` は、一致したルートに関連する追加データのプロパティ バッグです。</span><span class="sxs-lookup"><span data-stu-id="834e3-138">`RouteData.DataTokens`  is a property bag of additional data related to the matched route.</span></span> <span data-ttu-id="834e3-139">一致したルートに基づいてアプリケーションが後で決定を行えるように、`DataTokens` が与えられます。これがステータス データと各ルートの関連付けを支援します。</span><span class="sxs-lookup"><span data-stu-id="834e3-139">`DataTokens` are provided to support associating state data with each route so the application can make decisions later based on which route matched.</span></span> <span data-ttu-id="834e3-140">この値は開発者が定義するものです。ルーティングの動作に影響を与えることは**ありません**。</span><span class="sxs-lookup"><span data-stu-id="834e3-140">These values are developer-defined and do **not** affect the behavior of routing in any way.</span></span> <span data-ttu-id="834e3-141">また、データ トークンに格納された値はどのような種類でも構いません。一方、ルート値は文字列に簡単に変換できる種類でなければなりません。</span><span class="sxs-lookup"><span data-stu-id="834e3-141">Additionally, values stashed in data tokens can be of any type, in contrast to route values, which must be easily convertible to and from strings.</span></span>

<span data-ttu-id="834e3-142">`RouteData.Routers` は、過去に要求に一致したルートの一覧です。</span><span class="sxs-lookup"><span data-stu-id="834e3-142">`RouteData.Routers` is a list of the routes that took part in successfully matching the request.</span></span> <span data-ttu-id="834e3-143">ルートはルートの中に入れ子にすることができます。`Routers` プロパティは、結果的に一致をもたらしたルートの論理ツリーを通るパスを表します。</span><span class="sxs-lookup"><span data-stu-id="834e3-143">Routes can be nested inside one another, and the `Routers` property reflects the path through the logical tree of routes that resulted in a match.</span></span> <span data-ttu-id="834e3-144">一般的に、`Routers` の最初の項目はルート コレクションであり、これは URL 生成に使用するものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-144">Generally the first item in `Routers` is the route collection, and should be used for URL generation.</span></span> <span data-ttu-id="834e3-145">`Routers` の最後の項目は、一致したルート ハンドラーです。</span><span class="sxs-lookup"><span data-stu-id="834e3-145">The last item in `Routers` is the route handler that matched.</span></span>

### <a name="url-generation"></a><span data-ttu-id="834e3-146">URL 生成</span><span class="sxs-lookup"><span data-stu-id="834e3-146">URL generation</span></span>

<span data-ttu-id="834e3-147">URL 生成は、ルーティングにおいて、一連のルート値に基づいて URL パスを作成するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="834e3-147">URL generation is the process by which routing can create a URL path based on a set of route values.</span></span> <span data-ttu-id="834e3-148">これにより、ハンドラーとそれにアクセスする URL が論理的に分離します。</span><span class="sxs-lookup"><span data-stu-id="834e3-148">This allows for a logical separation between your handlers and the URLs that access them.</span></span>

<span data-ttu-id="834e3-149">URL 生成は同様の繰り返しプロセスに従いますが、最初にユーザーまたはフレームワーク コードでルート コレクションの `GetVirtualPath` メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="834e3-149">URL generation follows a similar iterative process, but starts with user or framework code calling into the `GetVirtualPath` method of the route collection.</span></span> <span data-ttu-id="834e3-150">その結果、非 null の `VirtualPathData` が返されるまで各*ルート*で順番に `GetVirtualPath` メソッドが呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-150">Each *route* will then have its `GetVirtualPath` method called in sequence until a non-null `VirtualPathData` is returned.</span></span>

<span data-ttu-id="834e3-151">`GetVirtualPath` の第一入力:</span><span class="sxs-lookup"><span data-stu-id="834e3-151">The primary inputs to `GetVirtualPath` are:</span></span>

* `VirtualPathContext.HttpContext`

* `VirtualPathContext.Values`

* `VirtualPathContext.AmbientValues`

<span data-ttu-id="834e3-152">ルートは `Values` と `AmbientValues` が与えるルート値を第一に利用し、どこで URL を生成できるか、どの値を含めるかを決定します。</span><span class="sxs-lookup"><span data-stu-id="834e3-152">Routes primarily use the route values provided by the `Values` and `AmbientValues` to decide where it's possible to generate a URL and what values to include.</span></span> <span data-ttu-id="834e3-153">`AmbientValues` は、現在の要求をルーティング システムと照合することで生成された一連のルート値です。</span><span class="sxs-lookup"><span data-stu-id="834e3-153">The `AmbientValues` are the set of route values that were produced from matching the current request with the routing system.</span></span> <span data-ttu-id="834e3-154">対照的に、`Values` は、現在の操作に適した URL の生成方法を指定するルート値です。</span><span class="sxs-lookup"><span data-stu-id="834e3-154">In contrast, `Values` are the route values that specify how to generate the desired URL for the current operation.</span></span> <span data-ttu-id="834e3-155">ルートに現在のコンテキストに関連付けられているサービスまたは追加データを指定する必要がある場合、`HttpContext` が指定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-155">The `HttpContext` is provided in case a route needs to get services or additional data associated with the current context.</span></span>

<span data-ttu-id="834e3-156">ヒント: `Values` は、`AmbientValues` のオーバーライド セットであると考えてください。</span><span class="sxs-lookup"><span data-stu-id="834e3-156">Tip: Think of `Values` as being a set of overrides for the `AmbientValues`.</span></span> <span data-ttu-id="834e3-157">URL 生成では、現在の要求からのルート値を再利用するように試行されます。同じルートまたはルート値を利用することで、リンクの URL 生成を簡単にするのが目的です。</span><span class="sxs-lookup"><span data-stu-id="834e3-157">URL generation tries to reuse route values from the current request to make it easy to generate URLs for links using the same route or route values.</span></span>

<span data-ttu-id="834e3-158">`GetVirtualPath` の出力は `VirtualPathData` です。</span><span class="sxs-lookup"><span data-stu-id="834e3-158">The output of `GetVirtualPath` is a `VirtualPathData`.</span></span> <span data-ttu-id="834e3-159">`VirtualPathData` は `RouteData` の並列です。これには出力 URL として `VirtualPath` が含まれ、また、ルートで設定する追加プロパティがいくつか含まれます。</span><span class="sxs-lookup"><span data-stu-id="834e3-159">`VirtualPathData` is a parallel of `RouteData`; it contains the `VirtualPath` for the output URL as well as the some additional properties that should be set by the route.</span></span>

<span data-ttu-id="834e3-160">`VirtualPathData.VirtualPath` プロパティには、ルートによって生成された*仮想パス*が含まれます。</span><span class="sxs-lookup"><span data-stu-id="834e3-160">The `VirtualPathData.VirtualPath` property contains the *virtual path* produced by the route.</span></span> <span data-ttu-id="834e3-161">必要に応じて、パスをさらに処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-161">Depending on your needs you may need to process the path further.</span></span> <span data-ttu-id="834e3-162">たとえば、生成された URL を HTML で表示するには、アプリケーションの基礎パスを先頭に追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-162">For instance, if you want to render the generated URL in HTML you need to prepend the base path of the application.</span></span>

<span data-ttu-id="834e3-163">`VirtualPathData.Router` は URL を正常に生成したルートの参照です。</span><span class="sxs-lookup"><span data-stu-id="834e3-163">The `VirtualPathData.Router` is a reference to the route that successfully generated the URL.</span></span>

<span data-ttu-id="834e3-164">`VirtualPathData.DataTokens` プロパティは、URL を生成したルートに関連する追加データのディクショナリです。</span><span class="sxs-lookup"><span data-stu-id="834e3-164">The `VirtualPathData.DataTokens` properties is a dictionary of additional data related to the route that generated the URL.</span></span> <span data-ttu-id="834e3-165">これは `RouteData.DataTokens` の並列です。</span><span class="sxs-lookup"><span data-stu-id="834e3-165">This is the parallel of `RouteData.DataTokens`.</span></span>

### <a name="creating-routes"></a><span data-ttu-id="834e3-166">ルートの作成</span><span class="sxs-lookup"><span data-stu-id="834e3-166">Creating routes</span></span>

<span data-ttu-id="834e3-167">ルーティングにより、`IRouter` の標準実装として `Route` クラスが与えられます。</span><span class="sxs-lookup"><span data-stu-id="834e3-167">Routing provides the `Route` class as the standard implementation of `IRouter`.</span></span> <span data-ttu-id="834e3-168">`Route` は*ルート テンプレート*構文を利用し、`RouteAsync` の呼び出し時に URL パスに対して照合するパターンを定義します。</span><span class="sxs-lookup"><span data-stu-id="834e3-168">`Route` uses the *route template* syntax to define patterns that will match against the URL path when `RouteAsync` is called.</span></span> <span data-ttu-id="834e3-169">`Route` は同じルート テンプレートを利用し、`GetVirtualPath` の呼び出し時に URL を生成します。</span><span class="sxs-lookup"><span data-stu-id="834e3-169">`Route` will use the same route template to generate a URL when `GetVirtualPath` is called.</span></span>

<span data-ttu-id="834e3-170">ほとんどのアプリケーションは、`MapRoute` を呼び出すか、`IRouteBuilder` で定義されている同様の拡張メソッドの 1 つを呼び出してルートを作成します。</span><span class="sxs-lookup"><span data-stu-id="834e3-170">Most applications will create routes by calling `MapRoute` or one of the similar extension methods defined on `IRouteBuilder`.</span></span> <span data-ttu-id="834e3-171">これらのメソッドはいずれも、`Route` のインスタンスを作成し、それをルート コレクションに追加します。</span><span class="sxs-lookup"><span data-stu-id="834e3-171">All of these methods will create an instance of `Route` and add it to the route collection.</span></span>

<span data-ttu-id="834e3-172">注: `MapRoute` はルート ハンドラー パラメーターを受け取りません。`DefaultHandler` によって処理されるルートを追加するだけです。</span><span class="sxs-lookup"><span data-stu-id="834e3-172">Note: `MapRoute` doesn't take a route handler parameter - it only adds routes that will be handled by the `DefaultHandler`.</span></span> <span data-ttu-id="834e3-173">既定のハンドラーは `IRouter` であるため、要求を処理しないように決定されることがあります。</span><span class="sxs-lookup"><span data-stu-id="834e3-173">Since the default handler is an `IRouter`, it may decide not to handle the request.</span></span> <span data-ttu-id="834e3-174">たとえば、ASP.NET MVC は通常、利用できるコントローラーやアクションに一致する要求のみを処理する既定のハンドラーとして構成されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-174">For example, ASP.NET MVC is typically configured as a default handler that only handles requests that match an available controller and action.</span></span> <span data-ttu-id="834e3-175">MVC にルーティングする方法については、「[コントローラー アクションへのルーティング](../mvc/controllers/routing.md)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-175">To learn more about routing to MVC, see [Routing to Controller Actions](../mvc/controllers/routing.md).</span></span>

<span data-ttu-id="834e3-176">一般的な ASP.NET MVC ルート定義によって使用される `MapRoute` 呼び出しの例:</span><span class="sxs-lookup"><span data-stu-id="834e3-176">This is an example of a `MapRoute` call used by a typical ASP.NET MVC route definition:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="834e3-177">このテンプレートは `/Products/Details/17` のような URL パスを照合し、ルート値 `{ controller = Products, action = Details, id = 17 }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="834e3-177">This template will match a URL path like `/Products/Details/17` and extract the route values `{ controller = Products, action = Details, id = 17 }`.</span></span> <span data-ttu-id="834e3-178">ルート値は、URL パスをセグメントに分割し、各セグメントとルート テンプレートの*ルート パラメーター*を照合することで決定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-178">The route values are determined by splitting the URL path into segments, and matching each segment with the *route parameter* name in the route template.</span></span> <span data-ttu-id="834e3-179">ルート パラメーターが指定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-179">Route parameters are named.</span></span> <span data-ttu-id="834e3-180">括弧 `{ }` でパラメーターを囲むことで定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-180">They're defined by enclosing the parameter name in braces `{ }`.</span></span>

<span data-ttu-id="834e3-181">上のテンプレートは URL パス `/` を照合し、値 `{ controller = Home, action = Index }` を生成します。</span><span class="sxs-lookup"><span data-stu-id="834e3-181">The template above could also match the URL path `/` and would produce the values `{ controller = Home, action = Index }`.</span></span> <span data-ttu-id="834e3-182">これは、ルート パラメーターの `{controller}` と `{action}` に既定値が与えられ、`id` ルート パラメーターが任意であるためです。</span><span class="sxs-lookup"><span data-stu-id="834e3-182">This happens because the `{controller}` and `{action}` route parameters have default values, and the `id` route parameter is optional.</span></span> <span data-ttu-id="834e3-183">ルート パラメーター名の後の等号 `=` とそれに続く値により、パラメーターの既定値が定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-183">An equals `=` sign followed by a value after the route parameter name defines a default value for the parameter.</span></span> <span data-ttu-id="834e3-184">ルート パラメーター名の後の疑問符 `?` により、パラメーターがオプションとして定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-184">A question mark `?` after the route parameter name defines the parameter as optional.</span></span> <span data-ttu-id="834e3-185">既定値のルート パラメーターはルートが一致すると、ルート値を*常に*生成します。オプションのパラメーターは、対応する URL パス セグメントがなかった場合、ルート値を生成しません。</span><span class="sxs-lookup"><span data-stu-id="834e3-185">Route parameters with a default value *always* produce a route value when the route matches - optional parameters won't produce a route value if there was no corresponding URL path segment.</span></span>

<span data-ttu-id="834e3-186">ルート テンプレートの機能と構文については、「[route-template-reference](#route-template-reference)」(ルート テンプレート参照) に詳しい説明があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-186">See [route-template-reference](#route-template-reference) for a thorough description of route template features and syntax.</span></span>

<span data-ttu-id="834e3-187">*ルート制約*が含まれる例:</span><span class="sxs-lookup"><span data-stu-id="834e3-187">This example includes a *route constraint*:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id:int}");
```

<span data-ttu-id="834e3-188">このテンプレートは `/Products/Details/Apples` ではなく、`/Products/Details/17` のような URL パスを照合します。</span><span class="sxs-lookup"><span data-stu-id="834e3-188">This template will match a URL path like `/Products/Details/17`, but not `/Products/Details/Apples`.</span></span> <span data-ttu-id="834e3-189">ルート パラメーター定義 `{id:int}` により、`id` ルート パラメーターの*ルート制約*が定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-189">The route parameter definition `{id:int}` defines a *route constraint* for the `id` route parameter.</span></span> <span data-ttu-id="834e3-190">ルート制約は `IRouteConstraint` を実装し、ルート値を調べて正しいことを確認します。</span><span class="sxs-lookup"><span data-stu-id="834e3-190">Route constraints implement `IRouteConstraint` and inspect route values to verify them.</span></span> <span data-ttu-id="834e3-191">この例では、ルート値 `id` は整数に変換できなければなりません。</span><span class="sxs-lookup"><span data-stu-id="834e3-191">In this example the route value `id` must be convertible to an integer.</span></span> <span data-ttu-id="834e3-192">フレームワークによって提供されるルート制約については、「[ルート制約参照](#route-constraint-reference)」に詳しい説明があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-192">See [route-constraint-reference](#route-constraint-reference) for a more detailed explanation of route constraints that are provided by the framework.</span></span>

<span data-ttu-id="834e3-193">`MapRoute` の追加オーバーロードは、`constraints`、`dataTokens`、`defaults` の値を受け取ります。</span><span class="sxs-lookup"><span data-stu-id="834e3-193">Additional overloads of `MapRoute` accept values for `constraints`, `dataTokens`, and `defaults`.</span></span> <span data-ttu-id="834e3-194">`MapRoute` のこのような追加パラメーターは `object` 型として定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-194">These additional parameters of `MapRoute` are defined as type `object`.</span></span> <span data-ttu-id="834e3-195">このようなパラメーターは一般的に、匿名型のオブジェクトを渡し、匿名型のプロパティ名がルート パラメーター名と一致するというような使われ方をします。</span><span class="sxs-lookup"><span data-stu-id="834e3-195">The typical usage of these parameters is to pass an anonymously typed object, where the property names of the anonymous type match route parameter names.</span></span>

<span data-ttu-id="834e3-196">同等のルートを作成する 2 つの例:</span><span class="sxs-lookup"><span data-stu-id="834e3-196">The following two examples create equivalent routes:</span></span>

```csharp
routes.MapRoute(
    name: "default_route",
    template: "{controller}/{action}/{id?}",
    defaults: new { controller = "Home", action = "Index" });

routes.MapRoute(
    name: "default_route",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="834e3-197">ヒント: 制約と既定値を定義するインライン構文は単純なルートの場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="834e3-197">Tip: The inline syntax for defining constraints and defaults can be more convenient for simple routes.</span></span> <span data-ttu-id="834e3-198">ただし、インライン構文でサポートされないデータ トークンなどの機能があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-198">However, there are features such as data tokens which are not supported by inline syntax.</span></span>

<span data-ttu-id="834e3-199">その他の機能を示す例:</span><span class="sxs-lookup"><span data-stu-id="834e3-199">This example demonstrates a few more features:</span></span>

```csharp
routes.MapRoute(
  name: "blog",
  template: "Blog/{*article}",
  defaults: new { controller = "Blog", action = "ReadArticle" });
```

<span data-ttu-id="834e3-200">このテンプレートは `/Blog/All-About-Routing/Introduction` のような URL パスを照合し、値 `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="834e3-200">This template will match a URL path like `/Blog/All-About-Routing/Introduction` and will extract the values `{ controller = Blog, action = ReadArticle, article = All-About-Routing/Introduction }`.</span></span> <span data-ttu-id="834e3-201">`controller` と `action` の既定のルート値は、テンプレートに対応するルート パラメーターがなくても、ルートにより生成されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-201">The default route values for `controller` and `action` are produced by the route even though there are no corresponding route parameters in the template.</span></span> <span data-ttu-id="834e3-202">既定値はルート テンプレートで指定できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-202">Default values can be specified in the route template.</span></span> <span data-ttu-id="834e3-203">`article` ルート パラメーターは、ルート パラメーター名の前にアスタリスク `*` があるとき、*キャッチオール*として定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-203">The `article` route parameter is defined as a *catch-all* by the appearance of an asterisk `*` before the route parameter name.</span></span> <span data-ttu-id="834e3-204">キャッチオール ルート パラメーターは、URL パスの残りの部分をキャプチャします。空の文字列も照合できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-204">Catch-all route parameters capture the remainder of the URL path, and can also match the empty string.</span></span>

<span data-ttu-id="834e3-205">ルート制約とデータ トークンを追加する例:</span><span class="sxs-lookup"><span data-stu-id="834e3-205">This example adds route constraints and data tokens:</span></span>

```csharp
routes.MapRoute(
    name: "us_english_products",
    template: "en-US/Products/{id}",
    defaults: new { controller = "Products", action = "Details" },
    constraints: new { id = new IntRouteConstraint() },
    dataTokens: new { locale = "en-US" });
```

<span data-ttu-id="834e3-206">このテンプレートは `/Products/5` のような URL パスを照合し、値 `{ controller = Products, action = Details, id = 5 }` とデータ トークン `{ locale = en-US }` を抽出します。</span><span class="sxs-lookup"><span data-stu-id="834e3-206">This template will match a URL path like `/Products/5` and will extract the values `{ controller = Products, action = Details, id = 5 }` and the data tokens `{ locale = en-US }`.</span></span>

![ローカル変数ウィンドウ トークン](routing/_static/tokens.png)

<a name="id1"></a>

### <a name="url-generation"></a><span data-ttu-id="834e3-208">URL 生成</span><span class="sxs-lookup"><span data-stu-id="834e3-208">URL generation</span></span>

<span data-ttu-id="834e3-209">`Route` クラスは、一連のルート値をそのルート テンプレートと組み合わせる方法でも URL を生成できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-209">The `Route` class can also perform URL generation by combining a set of route values with its route template.</span></span> <span data-ttu-id="834e3-210">論理的には、URL パスの照合とは逆のプロセスになります。</span><span class="sxs-lookup"><span data-stu-id="834e3-210">This is logically the reverse process of matching the URL path.</span></span>

<span data-ttu-id="834e3-211">ヒント: URL 生成を理解する方法として、どのような URL を生成したいのか考えてください。そして、ルート テンプレートがその URL にどのように照合されるのか考えてください。</span><span class="sxs-lookup"><span data-stu-id="834e3-211">Tip: To better understand URL generation, imagine what URL you want to generate and then think about how a route template would match that URL.</span></span> <span data-ttu-id="834e3-212">どのような値が生成されるでしょうか。</span><span class="sxs-lookup"><span data-stu-id="834e3-212">What values would be produced?</span></span> <span data-ttu-id="834e3-213">`Route` クラスにおける URL 生成のしくみと大体同じになります。</span><span class="sxs-lookup"><span data-stu-id="834e3-213">This is the rough equivalent of how URL generation works in the `Route` class.</span></span>

<span data-ttu-id="834e3-214">基本的な ASP.NET MVC スタイルのルートの使用例:</span><span class="sxs-lookup"><span data-stu-id="834e3-214">This example uses a basic ASP.NET MVC style route:</span></span>

```csharp
routes.MapRoute(
    name: "default",
    template: "{controller=Home}/{action=Index}/{id?}");
```

<span data-ttu-id="834e3-215">ルート値が `{ controller = Products, action = List }` のとき、このルートは URL `/Products/List` を生成します。</span><span class="sxs-lookup"><span data-stu-id="834e3-215">With the route values `{ controller = Products, action = List }`, this route will generate the URL `/Products/List`.</span></span> <span data-ttu-id="834e3-216">ルート値が対応ルート パラメーターの代替となり、URL パスが作られます。</span><span class="sxs-lookup"><span data-stu-id="834e3-216">The route values are substituted for the corresponding route parameters to form the URL path.</span></span> <span data-ttu-id="834e3-217">`id` は任意のルート パラメーターであるため、値がなくても問題ありません。</span><span class="sxs-lookup"><span data-stu-id="834e3-217">Since `id` is an optional route parameter, it's no problem that it doesn't have a value.</span></span>

<span data-ttu-id="834e3-218">ルート値が `{ controller = Home, action = Index }` のとき、このルートは URL `/` を生成します。</span><span class="sxs-lookup"><span data-stu-id="834e3-218">With the route values `{ controller = Home, action = Index }`, this route will generate the URL `/`.</span></span> <span data-ttu-id="834e3-219">与えられたルート値が既定値に一致することで、その値に対応するセグメントを省略しても問題が発生しません。</span><span class="sxs-lookup"><span data-stu-id="834e3-219">The route values that were provided match the default values so the segments corresponding to those values can be safely omitted.</span></span> <span data-ttu-id="834e3-220">生成されたいずれの URL もこのルート定義でラウンドトリップし、URL の生成に利用された同じルート値を生成することに注意してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-220">Note that both URLs generated would round-trip with this route definition and produce the same route values that were used to generate the URL.</span></span>

<span data-ttu-id="834e3-221">ヒント: アプリで ASP.NET MVC が使用される場合、ルーティングを直接呼び出す代わりに、`UrlHelper` を使用して URL を生成する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-221">Tip: An app using ASP.NET MVC should use `UrlHelper` to generate URLs instead of calling into routing directly.</span></span>

<span data-ttu-id="834e3-222">URL 生成処理の詳細については、「[URL 生成参照](#url-generation-reference)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-222">For more details about the URL generation process, see [url-generation-reference](#url-generation-reference).</span></span>

## <a name="using-routing-middleware"></a><span data-ttu-id="834e3-223">ルーティング ミドルウェアの使用</span><span class="sxs-lookup"><span data-stu-id="834e3-223">Using Routing Middleware</span></span>

<span data-ttu-id="834e3-224">NuGet パッケージ "Microsoft.AspNetCore.Routing" を追加します。</span><span class="sxs-lookup"><span data-stu-id="834e3-224">Add the NuGet package "Microsoft.AspNetCore.Routing".</span></span>

<span data-ttu-id="834e3-225">*Startup.cs* でサービス コンテナーにルーティングを追加した例:</span><span class="sxs-lookup"><span data-stu-id="834e3-225">Add routing to the service container in *Startup.cs*:</span></span>

[!code-csharp[Main](../fundamentals/routing/sample/RoutingSample/Startup.cs?highlight=3&start=11&end=14)]

<span data-ttu-id="834e3-226">ルートは `Startup` クラスの `Configure` メソッドに設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-226">Routes must be configured in the `Configure` method in the `Startup` class.</span></span> <span data-ttu-id="834e3-227">下のサンプルで使用されている API:</span><span class="sxs-lookup"><span data-stu-id="834e3-227">The sample below uses these APIs:</span></span>

* `RouteBuilder`
* `Build`
* <span data-ttu-id="834e3-228">`MapGet` HTTP GET 要求のみを照合</span><span class="sxs-lookup"><span data-stu-id="834e3-228">`MapGet`  Matches only HTTP GET requests</span></span>
* `UseRouter`

```csharp
public void Configure(IApplicationBuilder app, ILoggerFactory loggerFactory)
{
    var trackPackageRouteHandler = new RouteHandler(context =>
    {
        var routeValues = context.GetRouteData().Values;
        return context.Response.WriteAsync(
            $"Hello! Route values: {string.Join(", ", routeValues)}");
    });

    var routeBuilder = new RouteBuilder(app, trackPackageRouteHandler);

    routeBuilder.MapRoute(
        "Track Package Route",
        "package/{operation:regex(^(track|create|detonate)$)}/{id:int}");

    routeBuilder.MapGet("hello/{name}", context =>
    {
        var name = context.GetRouteValue("name");
        // This is the route handler when HTTP GET "hello/<anything>"  matches
        // To match HTTP GET "hello/<anything>/<anything>,
        // use routeBuilder.MapGet("hello/{*name}"
        return context.Response.WriteAsync($"Hi, {name}!");
    });

    var routes = routeBuilder.Build();
    app.UseRouter(routes);
}
```

<span data-ttu-id="834e3-229">下の表は、応答と所与の URI をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-229">The table below shows the responses with the given URIs.</span></span>

| <span data-ttu-id="834e3-230">URI</span><span class="sxs-lookup"><span data-stu-id="834e3-230">URI</span></span> | <span data-ttu-id="834e3-231">応答</span><span class="sxs-lookup"><span data-stu-id="834e3-231">Response</span></span>  |
| ------- | -------- |
| <span data-ttu-id="834e3-232">/package/create/3</span><span class="sxs-lookup"><span data-stu-id="834e3-232">/package/create/3</span></span>  | <span data-ttu-id="834e3-233">Hello!</span><span class="sxs-lookup"><span data-stu-id="834e3-233">Hello!</span></span> <span data-ttu-id="834e3-234">Route values: [operation, create], [id, 3]</span><span class="sxs-lookup"><span data-stu-id="834e3-234">Route values: [operation, create], [id, 3]</span></span> |
| <span data-ttu-id="834e3-235">/package/track/-3</span><span class="sxs-lookup"><span data-stu-id="834e3-235">/package/track/-3</span></span>  | <span data-ttu-id="834e3-236">Hello!</span><span class="sxs-lookup"><span data-stu-id="834e3-236">Hello!</span></span> <span data-ttu-id="834e3-237">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="834e3-237">Route values: [operation, track], [id, -3]</span></span> |
| <span data-ttu-id="834e3-238">/package/track/-3/</span><span class="sxs-lookup"><span data-stu-id="834e3-238">/package/track/-3/</span></span> | <span data-ttu-id="834e3-239">Hello!</span><span class="sxs-lookup"><span data-stu-id="834e3-239">Hello!</span></span> <span data-ttu-id="834e3-240">Route values: [operation, track], [id, -3]</span><span class="sxs-lookup"><span data-stu-id="834e3-240">Route values: [operation, track], [id, -3]</span></span>  |
| <span data-ttu-id="834e3-241">/package/track/</span><span class="sxs-lookup"><span data-stu-id="834e3-241">/package/track/</span></span> | <span data-ttu-id="834e3-242">\<Fall through, no match></span><span class="sxs-lookup"><span data-stu-id="834e3-242">\<Fall through, no match></span></span> |
| <span data-ttu-id="834e3-243">GET /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="834e3-243">GET /hello/Joe</span></span> | <span data-ttu-id="834e3-244">Hi, Joe!</span><span class="sxs-lookup"><span data-stu-id="834e3-244">Hi, Joe!</span></span> |
| <span data-ttu-id="834e3-245">POST /hello/Joe</span><span class="sxs-lookup"><span data-stu-id="834e3-245">POST /hello/Joe</span></span> | <span data-ttu-id="834e3-246">\<Fall through, matches HTTP GET only></span><span class="sxs-lookup"><span data-stu-id="834e3-246">\<Fall through, matches HTTP GET only></span></span> |
| <span data-ttu-id="834e3-247">GET /hello/Joe/Smith</span><span class="sxs-lookup"><span data-stu-id="834e3-247">GET /hello/Joe/Smith</span></span> | <span data-ttu-id="834e3-248">\<Fall through, no match></span><span class="sxs-lookup"><span data-stu-id="834e3-248">\<Fall through, no match></span></span> |

<span data-ttu-id="834e3-249">ルートを 1 つ構成する場合、`app.UseRouter` を呼び出し、`IRouter` インスタンスを渡します。</span><span class="sxs-lookup"><span data-stu-id="834e3-249">If you are configuring a single route, call `app.UseRouter` passing in an `IRouter` instance.</span></span> <span data-ttu-id="834e3-250">`RouteBuilder` を呼び出す必要はありません。</span><span class="sxs-lookup"><span data-stu-id="834e3-250">You won't need to call `RouteBuilder`.</span></span>

<span data-ttu-id="834e3-251">このフレームワークは、ルートを作成するために次のような拡張メソッドを提供します。</span><span class="sxs-lookup"><span data-stu-id="834e3-251">The framework provides a set of extension methods for creating routes such as:</span></span>

* `MapRoute`
* `MapGet`
* `MapPost`
* `MapPut`
* `MapDelete`
* `MapVerb`

<span data-ttu-id="834e3-252">`MapGet` など、メソッドの一部は `RequestDelegate` を必要とします。</span><span class="sxs-lookup"><span data-stu-id="834e3-252">Some of these methods such as `MapGet` require a `RequestDelegate` to be provided.</span></span> <span data-ttu-id="834e3-253">`RequestDelegate` は、ルートが一致したとき、*ルート ハンドラー*として使用されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-253">The `RequestDelegate` will be used as the *route handler* when the route matches.</span></span> <span data-ttu-id="834e3-254">この仲間の他のメソッドでは、ルート ハンドラーとして使用されるミドルウェア パイプラインを構成できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-254">Other methods in this family allow configuring a middleware pipeline which will be used as the route handler.</span></span> <span data-ttu-id="834e3-255">*Map* メソッドが `MapRoute` のようなハンドラーを受け取らない場合、`DefaultHandler` が使用されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-255">If the *Map* method doesn't accept a handler, such as `MapRoute`, then it will use the `DefaultHandler`.</span></span>

<span data-ttu-id="834e3-256">`Map[Verb]` メソッドは制約を利用し、メソッド名の HTTP Verb にルートを制限します。</span><span class="sxs-lookup"><span data-stu-id="834e3-256">The `Map[Verb]` methods use constraints to limit the route to the HTTP Verb in the method name.</span></span> <span data-ttu-id="834e3-257">例が必要な場合、「[MapGet](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L85-L88)」や「[MapVerb](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L156-L180)」をご覧ください。</span><span class="sxs-lookup"><span data-stu-id="834e3-257">For example, see [MapGet](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L85-L88) and [MapVerb](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/RequestDelegateRouteBuilderExtensions.cs#L156-L180).</span></span>

## <a name="route-template-reference"></a><span data-ttu-id="834e3-258">ルート テンプレート参照</span><span class="sxs-lookup"><span data-stu-id="834e3-258">Route Template Reference</span></span>

<span data-ttu-id="834e3-259">中括弧 (`{ }`) 内のトークンは*ルート パラメーター*を定義します。ルートが一致した場合、これがバインドされます。</span><span class="sxs-lookup"><span data-stu-id="834e3-259">Tokens within curly braces (`{ }`) define *route parameters* which will be bound if the route is matched.</span></span> <span data-ttu-id="834e3-260">1 つのルート セグメントで複数のルート パラメーターを定義できますが、リテラル値で区切る必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-260">You can define more than one route parameter in a route segment, but they must be separated by a literal value.</span></span> <span data-ttu-id="834e3-261">たとえば、`{controller=Home}{action=Index}` は有効なルートになりません。`{controller}` と `{action}` の間にリテラル値がないためです。</span><span class="sxs-lookup"><span data-stu-id="834e3-261">For example `{controller=Home}{action=Index}` wouldn't be a valid route, since there's no literal value between `{controller}` and `{action}`.</span></span> <span data-ttu-id="834e3-262">このようなルート パラメーターには名前を付ける必要があります。付加的な属性を指定することもあります。</span><span class="sxs-lookup"><span data-stu-id="834e3-262">These route parameters must have a name, and may have additional attributes specified.</span></span>

<span data-ttu-id="834e3-263">ルート パラメーター以外のリテラル テキスト (`{id}` など) とパス区切り `/` は URL のテキストに一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-263">Literal text other than route parameters (for example, `{id}`) and the path separator `/` must match the text in the URL.</span></span> <span data-ttu-id="834e3-264">テキスト照合は復号された URL パスを基盤とし、大文字と小文字が区別されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-264">Text matching is case-insensitive and based on the decoded representation of the URLs path.</span></span> <span data-ttu-id="834e3-265">リテラル ルート パラメーターの区切り `{` または `}` を照合するには、その文字を繰り返すことでエスケープします (`{{` や `}}`)。</span><span class="sxs-lookup"><span data-stu-id="834e3-265">To match the literal route parameter delimiter `{` or  `}`, escape it by repeating the character (`{{` or `}}`).</span></span>

<span data-ttu-id="834e3-266">URL パターンで任意のファイル拡張子が付いたファイル名をキャプチャするとき、追加の考慮事項があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-266">URL patterns that attempt to capture a filename with an optional file extension have additional considerations.</span></span> <span data-ttu-id="834e3-267">たとえば、テンプレート `files/{filename}.{ext?}` の使用です。`filename` と `ext` が両方存在するとき、両方の値が入力されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-267">For example, using the template `files/{filename}.{ext?}` - When both `filename` and `ext` exist, both values will be populated.</span></span> <span data-ttu-id="834e3-268">URL に `filename` だけが存在する場合、末尾のピリオド `.` は任意のため、このルートは一致となります。</span><span class="sxs-lookup"><span data-stu-id="834e3-268">If only `filename` exists in the URL, the route matches because the trailing period `.` is  optional.</span></span> <span data-ttu-id="834e3-269">次の URL はこのルートに一致します。</span><span class="sxs-lookup"><span data-stu-id="834e3-269">The following URLs would match this route:</span></span>

* `/files/myFile.txt`
* `/files/myFile.`
* `/files/myFile`

<span data-ttu-id="834e3-270">ルート パラメーターのプレフィックスとして `*` 文字を使用し、URI の残りの部分にバインドできます。これは*キャッチオール* パラメーターと呼ばれています。</span><span class="sxs-lookup"><span data-stu-id="834e3-270">You can use the `*` character as a prefix to a route parameter to bind to the rest of the URI - this is called a *catch-all* parameter.</span></span> <span data-ttu-id="834e3-271">たとえば、`blog/{*slug}` は、`/blog` で始まり、その後に (ルート値 `slug` に割り当てられる) 任意の値が続くあらゆる URI に一致します。</span><span class="sxs-lookup"><span data-stu-id="834e3-271">For example, `blog/{*slug}` would match any URI that started with `/blog` and had any value following it (which would be assigned to the `slug` route value).</span></span> <span data-ttu-id="834e3-272">キャッチオール パラメーターは空の文字列に一致することもあります。</span><span class="sxs-lookup"><span data-stu-id="834e3-272">Catch-all parameters can also match the empty string.</span></span>

<span data-ttu-id="834e3-273">ルート パラメーターには、*既定値*が含まれることがあります。パラメーター名の後に既定値を指定し、`=` で区切ることで指名されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-273">Route parameters may have *default values*, designated by specifying the default after the parameter name, separated by an `=`.</span></span> <span data-ttu-id="834e3-274">たとえば、`{controller=Home}` では、`controller` の既定値として `Home` が定義されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-274">For example, `{controller=Home}` would define `Home` as the default value for `controller`.</span></span> <span data-ttu-id="834e3-275">パラメーターの URL に値がない場合、既定値が使用されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-275">The default value is used if no value is present in the URL for the parameter.</span></span> <span data-ttu-id="834e3-276">既定値だけでなく、ルート パラメーターもオプションになることがあります (`id?` のように、パラメーター名の終わりに `?` を追加して指定します)。</span><span class="sxs-lookup"><span data-stu-id="834e3-276">In addition to default values, route parameters may be optional (specified by appending a `?` to the end of the parameter name, as in `id?`).</span></span> <span data-ttu-id="834e3-277">オプションと "既定値がある" ことの違いは、既定値を含むルート パラメーターは常に値を生成するのに対し、オプションのパラメーターには値が指定されたときにのみ値が与えられることにあります。</span><span class="sxs-lookup"><span data-stu-id="834e3-277">The difference between optional and "has default" is that a route parameter with a default value always produces a value; an optional parameter has a value only when one is provided.</span></span>

<span data-ttu-id="834e3-278">ルート パラメーターには、URL からバインドされるルート値に一致しなければならないという制約も含まれることがあります。</span><span class="sxs-lookup"><span data-stu-id="834e3-278">Route parameters may also have constraints, which must match the route value bound from the URL.</span></span> <span data-ttu-id="834e3-279">コロン `:` と制約名をルート パラメーター名の後に追加すると、ルート パラメーターの*インライン制約*が指定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-279">Adding a colon `:` and constraint name after the route parameter name specifies an *inline constraint* on a route parameter.</span></span> <span data-ttu-id="834e3-280">その制約で引数が要求される場合、制約名の後に括弧 `( )` で指定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-280">If the constraint requires arguments those are provided enclosed in parentheses `( )` after the constraint name.</span></span> <span data-ttu-id="834e3-281">別のコロン `:` と制約名を追加することで、複数のインライン制約を指定できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-281">Multiple inline constraints can be specified by appending another colon `:` and constraint name.</span></span> <span data-ttu-id="834e3-282">制約名が `IInlineConstraintResolver` サービスに渡され、URL 処理で使用する `IRouteConstraint` のインスタンスが作成されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-282">The constraint name is passed to the `IInlineConstraintResolver` service to create an instance of `IRouteConstraint` to use in URL processing.</span></span> <span data-ttu-id="834e3-283">たとえば、ルート テンプレート `blog/{article:minlength(10)}` によって、制約 `minlength` と引数 `10` が指定されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-283">For example, the route template `blog/{article:minlength(10)}` specifies the `minlength` constraint with the argument `10`.</span></span> <span data-ttu-id="834e3-284">ルート制約の詳細とこのフレームワークで与えられる制約の一覧については、「[ルート制約参照](#route-constraint-reference)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-284">For more description route constraints, and a listing of the constraints provided by the framework, see [route-constraint-reference](#route-constraint-reference).</span></span>

<span data-ttu-id="834e3-285">次の表は、一部のルート テンプレートとその動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-285">The following table demonstrates some route templates and their behavior.</span></span>

| <span data-ttu-id="834e3-286">ルート テンプレート</span><span class="sxs-lookup"><span data-stu-id="834e3-286">Route Template</span></span> | <span data-ttu-id="834e3-287">一致する URL の例</span><span class="sxs-lookup"><span data-stu-id="834e3-287">Example Matching URL</span></span> | <span data-ttu-id="834e3-288">メモ</span><span class="sxs-lookup"><span data-stu-id="834e3-288">Notes</span></span> |
| -------- | -------- | ------- |
| <span data-ttu-id="834e3-289">hello</span><span class="sxs-lookup"><span data-stu-id="834e3-289">hello</span></span>  | <span data-ttu-id="834e3-290">/hello</span><span class="sxs-lookup"><span data-stu-id="834e3-290">/hello</span></span>  | <span data-ttu-id="834e3-291">パス `/hello` にのみ一致</span><span class="sxs-lookup"><span data-stu-id="834e3-291">Only matches the single path `/hello`</span></span> |
| <span data-ttu-id="834e3-292">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="834e3-292">{Page=Home}</span></span> | / | <span data-ttu-id="834e3-293">一致し、`Page` が `Home` に設定される</span><span class="sxs-lookup"><span data-stu-id="834e3-293">Matches and sets `Page` to `Home`</span></span> |
| <span data-ttu-id="834e3-294">{Page=Home}</span><span class="sxs-lookup"><span data-stu-id="834e3-294">{Page=Home}</span></span>  | <span data-ttu-id="834e3-295">/Contact</span><span class="sxs-lookup"><span data-stu-id="834e3-295">/Contact</span></span>  | <span data-ttu-id="834e3-296">一致し、`Page` が `Contact` に設定される</span><span class="sxs-lookup"><span data-stu-id="834e3-296">Matches and sets `Page` to `Contact`</span></span> |
| <span data-ttu-id="834e3-297">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="834e3-297">{controller}/{action}/{id?}</span></span> | <span data-ttu-id="834e3-298">/Products/List</span><span class="sxs-lookup"><span data-stu-id="834e3-298">/Products/List</span></span> | <span data-ttu-id="834e3-299">コントローラー `Products` とアクション `List` にマッピングされる</span><span class="sxs-lookup"><span data-stu-id="834e3-299">Maps to `Products` controller and `List`  action</span></span> |
| <span data-ttu-id="834e3-300">{controller}/{action}/{id?}</span><span class="sxs-lookup"><span data-stu-id="834e3-300">{controller}/{action}/{id?}</span></span> | <span data-ttu-id="834e3-301">/Products/Details/123</span><span class="sxs-lookup"><span data-stu-id="834e3-301">/Products/Details/123</span></span>  |  <span data-ttu-id="834e3-302">コントローラー `Products` とアクション `Details` にマッピングされ、</span><span class="sxs-lookup"><span data-stu-id="834e3-302">Maps to `Products` controller and  `Details` action.</span></span>  <span data-ttu-id="834e3-303">`id` が 123 に設定される</span><span class="sxs-lookup"><span data-stu-id="834e3-303">`id` set to 123</span></span> |
| <span data-ttu-id="834e3-304">{controller=Home}/{action=Index}/{id?}</span><span class="sxs-lookup"><span data-stu-id="834e3-304">{controller=Home}/{action=Index}/{id?}</span></span> | /  |  <span data-ttu-id="834e3-305">コントローラー `Home` とメソッド `Index` にマッピングされ、`id` が無視される</span><span class="sxs-lookup"><span data-stu-id="834e3-305">Maps to `Home` controller and `Index`  method; `id` is ignored.</span></span> |

<span data-ttu-id="834e3-306">一般的に、テンプレートの利用が最も簡単なルーティングの手法となります。</span><span class="sxs-lookup"><span data-stu-id="834e3-306">Using a template is generally the simplest approach to routing.</span></span> <span data-ttu-id="834e3-307">ルート テンプレート以外では、制約と既定値も指定できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-307">Constraints and defaults can also be specified outside the route template.</span></span>

<span data-ttu-id="834e3-308">ヒント: [ログ](xref:fundamentals/logging/index) を有効にすると、`Route` など、組み込みのルーティング実装が要求を照合するしくみを確認できます。</span><span class="sxs-lookup"><span data-stu-id="834e3-308">Tip: Enable [Logging](xref:fundamentals/logging/index) to see how the built in routing implementations, such as `Route`, match requests.</span></span>

## <a name="route-constraint-reference"></a><span data-ttu-id="834e3-309">ルート制約参照</span><span class="sxs-lookup"><span data-stu-id="834e3-309">Route Constraint Reference</span></span>

<span data-ttu-id="834e3-310">ルート制約は、`Route` が入ってきた URL の構文に一致し、URL パスをルート値にトークン化したときに実行されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-310">Route constraints execute when a `Route` has matched the syntax of the incoming URL and tokenized the URL path into route values.</span></span> <span data-ttu-id="834e3-311">ルート制約では、通常、ルート テンプレート経由で関連付けらるルート値を調べ、値が許容できるかどうかを単純な「はい/いいえ」で決定します。</span><span class="sxs-lookup"><span data-stu-id="834e3-311">Route constraints generally inspect the route value associated via the route template and make a simple yes/no decision about whether or not the value is acceptable.</span></span> <span data-ttu-id="834e3-312">一部のルート制約では、ルート値以外のデータを使用し、要求をルーティングできるかどうかが考慮されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-312">Some route constraints use data outside the route value to consider whether the request can be routed.</span></span> <span data-ttu-id="834e3-313">たとえば、`HttpMethodRouteConstraint` はその HTTP Verb に基づいて要求を承認または却下します。</span><span class="sxs-lookup"><span data-stu-id="834e3-313">For example, the `HttpMethodRouteConstraint` can accept or reject a request based on its HTTP verb.</span></span>

>[!WARNING]
> <span data-ttu-id="834e3-314">**入力検証**には制約を使用しないでください。無効な入力に起因し、400 と適切なエラー メッセージではなく、404 (Not Found) が表示されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-314">Avoid using constraints for **input validation**, because doing so means that invalid input will result in a 404 (Not Found) instead of a 400 with an appropriate error message.</span></span> <span data-ttu-id="834e3-315">ルート制約は、特定のルートに対する入力の妥当性を検証するためではなく、似たようなルートの**違いを明らかにする**ために使用してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-315">Route constraints should be used to **disambiguate** between similar routes, not to validate the inputs for a particular route.</span></span>

<span data-ttu-id="834e3-316">次の表は、一部のルート制約とそれに求められる動作をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-316">The following table demonstrates some route constraints and their expected behavior.</span></span>

| <span data-ttu-id="834e3-317">制約</span><span class="sxs-lookup"><span data-stu-id="834e3-317">constraint</span></span> | <span data-ttu-id="834e3-318">例</span><span class="sxs-lookup"><span data-stu-id="834e3-318">Example</span></span> | <span data-ttu-id="834e3-319">一致の例</span><span class="sxs-lookup"><span data-stu-id="834e3-319">Example Matches</span></span> | <span data-ttu-id="834e3-320">メモ</span><span class="sxs-lookup"><span data-stu-id="834e3-320">Notes</span></span> |
| --------   | ------- | ------------- | ----- |
| `int` | `{id:int}` | <span data-ttu-id="834e3-321">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="834e3-321">`123456789`, `-123456789`</span></span>  | <span data-ttu-id="834e3-322">あらゆる整数に一致する</span><span class="sxs-lookup"><span data-stu-id="834e3-322">Matches any integer</span></span> |
| `bool`  | `{active:bool}` | <span data-ttu-id="834e3-323">`true`, `FALSE`</span><span class="sxs-lookup"><span data-stu-id="834e3-323">`true`, `FALSE`</span></span> | <span data-ttu-id="834e3-324">`true` または `false` に一致する (大文字と小文字が区別されます)</span><span class="sxs-lookup"><span data-stu-id="834e3-324">Matches `true` or `false` (case-insensitive)</span></span> |
| `datetime` | `{dob:datetime}` | <span data-ttu-id="834e3-325">`2016-12-31`, `2016-12-31 7:32pm`</span><span class="sxs-lookup"><span data-stu-id="834e3-325">`2016-12-31`, `2016-12-31 7:32pm`</span></span>  | <span data-ttu-id="834e3-326">有効な `DateTime` 値に一致する (インバリアント カルチャで - 警告参照)</span><span class="sxs-lookup"><span data-stu-id="834e3-326">Matches a valid `DateTime` value (in the invariant culture - see warning)</span></span> |
| `decimal` | `{price:decimal}` | <span data-ttu-id="834e3-327">`49.99`, `-1,000.01`</span><span class="sxs-lookup"><span data-stu-id="834e3-327">`49.99`, `-1,000.01`</span></span> | <span data-ttu-id="834e3-328">有効な `decimal` 値に一致する (インバリアント カルチャで - 警告参照)</span><span class="sxs-lookup"><span data-stu-id="834e3-328">Matches a valid `decimal` value (in the invariant culture - see warning)</span></span> |
| `double`  | `{weight:double}` | <span data-ttu-id="834e3-329">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="834e3-329">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="834e3-330">有効な `double` 値に一致する (インバリアント カルチャで - 警告参照)</span><span class="sxs-lookup"><span data-stu-id="834e3-330">Matches a valid `double` value (in the invariant culture - see warning)</span></span> |
| `float`  | `{weight:float}` | <span data-ttu-id="834e3-331">`1.234`, `-1,001.01e8`</span><span class="sxs-lookup"><span data-stu-id="834e3-331">`1.234`, `-1,001.01e8`</span></span> | <span data-ttu-id="834e3-332">有効な `float` 値に一致する (インバリアント カルチャで - 警告参照)</span><span class="sxs-lookup"><span data-stu-id="834e3-332">Matches a valid `float` value (in the invariant culture - see warning)</span></span> |
| `guid`  | `{id:guid}` | <span data-ttu-id="834e3-333">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span><span class="sxs-lookup"><span data-stu-id="834e3-333">`CD2C1638-1638-72D5-1638-DEADBEEF1638`, `{CD2C1638-1638-72D5-1638-DEADBEEF1638}`</span></span> | <span data-ttu-id="834e3-334">有効な `Guid` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="834e3-334">Matches a valid `Guid` value</span></span> |
| `long` | `{ticks:long}` | <span data-ttu-id="834e3-335">`123456789`, `-123456789`</span><span class="sxs-lookup"><span data-stu-id="834e3-335">`123456789`, `-123456789`</span></span> | <span data-ttu-id="834e3-336">有効な `long` 値に一致する</span><span class="sxs-lookup"><span data-stu-id="834e3-336">Matches a valid `long` value</span></span> |
| `minlength(value)` | `{username:minlength(4)}` | `Rick` | <span data-ttu-id="834e3-337">4 文字以上の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-337">String must be at least 4 characters</span></span> |
| `maxlength(value)` | `{filename:maxlength(8)}` | `Richard` | <span data-ttu-id="834e3-338">8 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-338">String must be no more than 8 characters</span></span> |
| `length(length)` | `{filename:length(12)}` | `somefile.txt` | <span data-ttu-id="834e3-339">厳密に 12 文字の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-339">String must be exactly 12 characters long</span></span> |
| `length(min,max)` | `{filename:length(8,16)}` | `somefile.txt` | <span data-ttu-id="834e3-340">8 文字以上、16 文字以内の文字列であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-340">String must be at least 8 and no more than 16 characters long</span></span> |
| `min(value)` | `{age:min(18)}` | `19` | <span data-ttu-id="834e3-341">18 以上の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-341">Integer value must be at least 18</span></span> |
| `max(value)` | `{age:max(120)}` |  `91` | <span data-ttu-id="834e3-342">120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-342">Integer value must be no more than 120</span></span> |
| `range(min,max)` | `{age:range(18,120)}` | `91` | <span data-ttu-id="834e3-343">18 以上、120 以下の整数値であることが必要</span><span class="sxs-lookup"><span data-stu-id="834e3-343">Integer value must be at least 18 but no more than 120</span></span> |
| `alpha` | `{name:alpha}` | `Rick` | <span data-ttu-id="834e3-344">1 つまたは複数のアルファベット文字で構成される文字列が必要 (`a`-`z`、大文字と小文字を区別)</span><span class="sxs-lookup"><span data-stu-id="834e3-344">String must consist of one or more alphabetical characters (`a`-`z`, case-insensitive)</span></span> |
| `regex(expression)` | `{ssn:regex(^\\d{{3}}-\\d{{2}}-\\d{{4}}$)}` | `123-45-6789` | <span data-ttu-id="834e3-345">正規表現に一致する文字列が必要 (正規表現の定義についてはヒントを参照)</span><span class="sxs-lookup"><span data-stu-id="834e3-345">String must match the regular expression (see tips about defining a regular expression)</span></span> |
| `required`  | `{name:required}` | `Rick` |  <span data-ttu-id="834e3-346">URL 生成中、非パラメーターが提示されるように強制する</span><span class="sxs-lookup"><span data-stu-id="834e3-346">Used to enforce that a non-parameter value is present during URL generation</span></span> |

>[!WARNING]
> <span data-ttu-id="834e3-347">URL の妥当性を検証するルート制約は、CLR 型 (`int` や `DateTime` など) に変換できます。常にインバリアント カルチャを使用してください。URL がローカライズ不可であると見なされます。</span><span class="sxs-lookup"><span data-stu-id="834e3-347">Route constraints that verify the URL can be converted to a CLR type (such as `int` or `DateTime`) always use the invariant culture - they assume the URL is non-localizable.</span></span> <span data-ttu-id="834e3-348">フレームワークから提供されるルート制約がルート値に格納されている値を変更することはありません。</span><span class="sxs-lookup"><span data-stu-id="834e3-348">The framework-provided route constraints don't modify the values stored in route values.</span></span> <span data-ttu-id="834e3-349">URL から解析されたルート値はすべて文字列として格納されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-349">All route values parsed from the URL will be stored as strings.</span></span> <span data-ttu-id="834e3-350">たとえば、[浮動小数ルート制約](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/Constraints/FloatRouteConstraint.cs#L44-L60)はルート値を浮動小数に変換しますが、変換された値は、浮動小数に変換できることを検証するためにだけ利用されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-350">For example, the [Float route constraint](https://github.com/aspnet/Routing/blob/1.0.0/src/Microsoft.AspNetCore.Routing/Constraints/FloatRouteConstraint.cs#L44-L60) will attempt to convert the route value to a float, but the converted value is used only to verify it can be converted to a float.</span></span>

## <a name="regular-expressions"></a><span data-ttu-id="834e3-351">正規表現</span><span class="sxs-lookup"><span data-stu-id="834e3-351">Regular expressions</span></span> 

<span data-ttu-id="834e3-352">ASP.NET Core フレームワークでは、正規表現コンストラクターに `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` が追加されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-352">The ASP.NET Core framework adds `RegexOptions.IgnoreCase | RegexOptions.Compiled | RegexOptions.CultureInvariant` to the regular expression constructor.</span></span> <span data-ttu-id="834e3-353">これらのメンバーの説明については、「[RegexOptions Enumeration](https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions)」(RegexOptions 列挙) を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-353">See [RegexOptions Enumeration](https://docs.microsoft.com/dotnet/api/system.text.regularexpressions.regexoptions) for a description of these members.</span></span>

<span data-ttu-id="834e3-354">正規表現では、ルーティングや C# 言語で使用されるものに似た区切り記号とトークンが使用されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-354">Regular expressions use delimiters and tokens similar to those used by Routing and the C# language.</span></span> <span data-ttu-id="834e3-355">正規表現トークンはエスケープする必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-355">Regular expression tokens must be escaped.</span></span> <span data-ttu-id="834e3-356">たとえば、ルーティングで正規表現 `^\d{3}-\d{2}-\d{4}$` を使用するには、C# ソース ファイルで `\` 文字を `\\` のように入力し、文字列エスケープ文字である `\` をエスケープする必要があります ([逐語的な文字列リテラル](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/string)を使用しない限り)。</span><span class="sxs-lookup"><span data-stu-id="834e3-356">For example, to use the regular expression `^\d{3}-\d{2}-\d{4}$` in Routing, it needs to have the `\` characters typed in as `\\` in the C# source file to escape the `\` string escape character (unless using [verbatim string literals](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/string).</span></span> <span data-ttu-id="834e3-357">`{`、`}`、'['、']' 文字は、二回入力することでエスケープし、ルーティング パラメーター区切り文字をエスケープする必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-357">The `{` , `}` , '[' and ']' characters need to be escaped by doubling them to escape the Routing parameter delimiter characters.</span></span>  <span data-ttu-id="834e3-358">次の表は、正規表現とエスケープ適用後の表示をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-358">The table below shows a regular expression and the escaped version.</span></span>

| <span data-ttu-id="834e3-359">正規表現</span><span class="sxs-lookup"><span data-stu-id="834e3-359">Expression</span></span>               | <span data-ttu-id="834e3-360">メモ</span><span class="sxs-lookup"><span data-stu-id="834e3-360">Note</span></span> |
| ----------------- | ------------ | 
| `^\d{3}-\d{2}-\d{4}$` | <span data-ttu-id="834e3-361">正規表現</span><span class="sxs-lookup"><span data-stu-id="834e3-361">Regular expression</span></span> |
| `^\\d{{3}}-\\d{{2}}-\\d{{4}}$` | <span data-ttu-id="834e3-362">エスケープ適用後</span><span class="sxs-lookup"><span data-stu-id="834e3-362">Escaped</span></span>  |
| `^[a-z]{2}$` | <span data-ttu-id="834e3-363">正規表現</span><span class="sxs-lookup"><span data-stu-id="834e3-363">Regular expression</span></span> |
| `^[[a-z]]{{2}}$` | <span data-ttu-id="834e3-364">エスケープ適用後</span><span class="sxs-lookup"><span data-stu-id="834e3-364">Escaped</span></span>  |

<span data-ttu-id="834e3-365">ルーティングで使用される正規表現は、多くの場合、`^` 文字で始まり (文字列の開始位置に一致)、`$` 文字で終わります (文字列の終了文字に一致)。</span><span class="sxs-lookup"><span data-stu-id="834e3-365">Regular expressions used in routing will often start with the `^` character (match starting position of the string) and end with the `$` character (match ending position of the string).</span></span> <span data-ttu-id="834e3-366">`^` 文字と `$` 文字により、正規表現はルート パラメーター値全体に一致します。</span><span class="sxs-lookup"><span data-stu-id="834e3-366">The `^` and `$` characters ensure that the regular expression match the entire route parameter value.</span></span> <span data-ttu-id="834e3-367">`^` 文字と `$` 文字がなければ、正規表現は意図に反して文字列内のあらゆるサブ文字列に一致します。</span><span class="sxs-lookup"><span data-stu-id="834e3-367">Without the `^` and `$` characters the regular expression will match any sub-string within the string, which is often not what you want.</span></span> <span data-ttu-id="834e3-368">下の表では例をいくつか挙げ、それが一致する/一致しない理由をまとめています。</span><span class="sxs-lookup"><span data-stu-id="834e3-368">The table below shows some examples and explains why they match or fail to match.</span></span>

| <span data-ttu-id="834e3-369">正規表現</span><span class="sxs-lookup"><span data-stu-id="834e3-369">Expression</span></span>               | <span data-ttu-id="834e3-370">String</span><span class="sxs-lookup"><span data-stu-id="834e3-370">String</span></span> | <span data-ttu-id="834e3-371">一致したもの</span><span class="sxs-lookup"><span data-stu-id="834e3-371">Match</span></span> | <span data-ttu-id="834e3-372">コメント</span><span class="sxs-lookup"><span data-stu-id="834e3-372">Comment</span></span> |
| ----------------- | ------------ |  ------------ |  ------------ | 
| `[a-z]{2}` | <span data-ttu-id="834e3-373">hello</span><span class="sxs-lookup"><span data-stu-id="834e3-373">hello</span></span> | <span data-ttu-id="834e3-374">可</span><span class="sxs-lookup"><span data-stu-id="834e3-374">yes</span></span> | <span data-ttu-id="834e3-375">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="834e3-375">substring matches</span></span> |
| `[a-z]{2}` | <span data-ttu-id="834e3-376">123abc456</span><span class="sxs-lookup"><span data-stu-id="834e3-376">123abc456</span></span> | <span data-ttu-id="834e3-377">可</span><span class="sxs-lookup"><span data-stu-id="834e3-377">yes</span></span> | <span data-ttu-id="834e3-378">サブ文字列の一致</span><span class="sxs-lookup"><span data-stu-id="834e3-378">substring matches</span></span> |
| `[a-z]{2}` | <span data-ttu-id="834e3-379">mz</span><span class="sxs-lookup"><span data-stu-id="834e3-379">mz</span></span> | <span data-ttu-id="834e3-380">可</span><span class="sxs-lookup"><span data-stu-id="834e3-380">yes</span></span> | <span data-ttu-id="834e3-381">一致する表現</span><span class="sxs-lookup"><span data-stu-id="834e3-381">matches expression</span></span> |
| `[a-z]{2}` | <span data-ttu-id="834e3-382">MZ</span><span class="sxs-lookup"><span data-stu-id="834e3-382">MZ</span></span> | <span data-ttu-id="834e3-383">可</span><span class="sxs-lookup"><span data-stu-id="834e3-383">yes</span></span> | <span data-ttu-id="834e3-384">大文字と小文字の使い方が違う</span><span class="sxs-lookup"><span data-stu-id="834e3-384">not case sensitive</span></span> |
| `^[a-z]{2}$` |  <span data-ttu-id="834e3-385">hello</span><span class="sxs-lookup"><span data-stu-id="834e3-385">hello</span></span> | <span data-ttu-id="834e3-386">Ｘ</span><span class="sxs-lookup"><span data-stu-id="834e3-386">no</span></span> | <span data-ttu-id="834e3-387">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="834e3-387">see `^` and `$` above</span></span> |
| `^[a-z]{2}$` |  <span data-ttu-id="834e3-388">123abc456</span><span class="sxs-lookup"><span data-stu-id="834e3-388">123abc456</span></span> | <span data-ttu-id="834e3-389">Ｘ</span><span class="sxs-lookup"><span data-stu-id="834e3-389">no</span></span> | <span data-ttu-id="834e3-390">上の `^` と `$` を参照</span><span class="sxs-lookup"><span data-stu-id="834e3-390">see `^` and `$` above</span></span> |

<span data-ttu-id="834e3-391">正規表現構文の詳細については、「[.NET Framework 正規表現](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="834e3-391">Refer to [.NET Framework Regular Expressions](https://docs.microsoft.com/dotnet/standard/base-types/regular-expression-language-quick-reference) for more information on regular expression syntax.</span></span>

<span data-ttu-id="834e3-392">既知の入力可能値の集まりにパラメーターを制限するには、正規表現を使用します。</span><span class="sxs-lookup"><span data-stu-id="834e3-392">To constrain a parameter to a known set of possible values, use a regular expression.</span></span> <span data-ttu-id="834e3-393">たとえば、`{action:regex(^(list|get|create)$)}` の場合、`action` ルート値は `list`、`get`、`create` とのみ照合されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-393">For example `{action:regex(^(list|get|create)$)}` only matches the `action` route value to `list`, `get`, or `create`.</span></span> <span data-ttu-id="834e3-394">制約ディクショナリに渡された場合、文字列 "^(list|get|create)$" で同じものになります。</span><span class="sxs-lookup"><span data-stu-id="834e3-394">If passed into the constraints dictionary, the string "^(list|get|create)$" would be equivalent.</span></span> <span data-ttu-id="834e3-395">(テンプレート内でインラインではなく) 制約ディクショナリに渡された制約が既知の制約に一致しない場合も、正規表現として扱われます。</span><span class="sxs-lookup"><span data-stu-id="834e3-395">Constraints that are passed in the constraints dictionary (not inline within a template) that don't match one of the known constraints are also treated as regular expressions.</span></span>

## <a name="url-generation-reference"></a><span data-ttu-id="834e3-396">URL 生成参照</span><span class="sxs-lookup"><span data-stu-id="834e3-396">URL Generation Reference</span></span>

<span data-ttu-id="834e3-397">下の例では、ルートのリンクを生成する方法を確認できます。ルート値のディクショナリと `RouteCollection` が指定されています。</span><span class="sxs-lookup"><span data-stu-id="834e3-397">The example below shows how to generate a link to a route given a dictionary of route values and a `RouteCollection`.</span></span>

[!code-csharp[Main](../fundamentals/routing/sample/RoutingSample/Startup.cs?range=45-59)]

<span data-ttu-id="834e3-398">上のサンプルの終わりで生成された `VirtualPath` は `/package/create/123` です。</span><span class="sxs-lookup"><span data-stu-id="834e3-398">The `VirtualPath` generated at the end of the sample above is `/package/create/123`.</span></span>

<span data-ttu-id="834e3-399">`VirtualPathContext` コンストラクターの 2 番目のパラメーターは*アンビエント値*の集合です。</span><span class="sxs-lookup"><span data-stu-id="834e3-399">The second parameter to the `VirtualPathContext` constructor is a collection of *ambient values*.</span></span> <span data-ttu-id="834e3-400">アンビエント値は、開発者が特定の文脈で要求における値を指定しなければならないよう、値の数を制限するので便利です。</span><span class="sxs-lookup"><span data-stu-id="834e3-400">Ambient values provide convenience by limiting the number of values a developer must specify within a certain request context.</span></span> <span data-ttu-id="834e3-401">現在の要求の現在のルート値は、リンク生成の場合、アンビエント値として見なされます。</span><span class="sxs-lookup"><span data-stu-id="834e3-401">The current route values of the current request are considered ambient values for link generation.</span></span> <span data-ttu-id="834e3-402">たとえば、ASP.NET MVC アプリで `HomeController` の `About` アクション中、コントローラー ルート値を指定し、`Index` アクションにリンクする必要はありません (`Home` のアンビエント値が使用されます)。</span><span class="sxs-lookup"><span data-stu-id="834e3-402">For example, in an ASP.NET MVC app if you are in the `About` action of the `HomeController`, you don't need to specify the controller route value to link to the `Index` action (the ambient value of `Home` will be used).</span></span>

<span data-ttu-id="834e3-403">パラメーターに一致しないアンビエント値は無視されます。明示的に指定された値によりオーバーライドされるときもアンビエント値は無視されます (URL の左から右へ)。</span><span class="sxs-lookup"><span data-stu-id="834e3-403">Ambient values that don't match a parameter are ignored, and ambient values are also ignored when an explicitly-provided value overrides it, going from left to right in the URL.</span></span>

<span data-ttu-id="834e3-404">明示的に指定されているが何も一致しない値はクエリ文字列に追加されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-404">Values that are explicitly provided but which don't match anything are added to the query string.</span></span> <span data-ttu-id="834e3-405">次の表は、ルート テンプレート `{controller}/{action}/{id?}` の使用時の結果をまとめたものです。</span><span class="sxs-lookup"><span data-stu-id="834e3-405">The following table shows the result when using the route template `{controller}/{action}/{id?}`.</span></span>

| <span data-ttu-id="834e3-406">アンビエント値</span><span class="sxs-lookup"><span data-stu-id="834e3-406">Ambient Values</span></span> | <span data-ttu-id="834e3-407">明示的な値</span><span class="sxs-lookup"><span data-stu-id="834e3-407">Explicit Values</span></span> | <span data-ttu-id="834e3-408">結果</span><span class="sxs-lookup"><span data-stu-id="834e3-408">Result</span></span> |
| -------------   | -------------- | ------ |
| <span data-ttu-id="834e3-409">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="834e3-409">controller="Home"</span></span> | <span data-ttu-id="834e3-410">action="About"</span><span class="sxs-lookup"><span data-stu-id="834e3-410">action="About"</span></span> | `/Home/About` |
| <span data-ttu-id="834e3-411">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="834e3-411">controller="Home"</span></span> | <span data-ttu-id="834e3-412">controller="Order",action="About"</span><span class="sxs-lookup"><span data-stu-id="834e3-412">controller="Order",action="About"</span></span> | `/Order/About` |
| <span data-ttu-id="834e3-413">controller="Home",color="Red"</span><span class="sxs-lookup"><span data-stu-id="834e3-413">controller="Home",color="Red"</span></span> | <span data-ttu-id="834e3-414">action="About"</span><span class="sxs-lookup"><span data-stu-id="834e3-414">action="About"</span></span> | `/Home/About` |
| <span data-ttu-id="834e3-415">controller="Home"</span><span class="sxs-lookup"><span data-stu-id="834e3-415">controller="Home"</span></span> | <span data-ttu-id="834e3-416">action="About",color="Red"</span><span class="sxs-lookup"><span data-stu-id="834e3-416">action="About",color="Red"</span></span> | `/Home/About?color=Red`

<span data-ttu-id="834e3-417">パラメーターに対応しない既定値がルートにあり、その値が明示的に指定される場合、それは既定値に一致する必要があります。</span><span class="sxs-lookup"><span data-stu-id="834e3-417">If a route has a default value that doesn't correspond to a parameter and that value is explicitly provided, it must match the default value.</span></span> <span data-ttu-id="834e3-418">例:</span><span class="sxs-lookup"><span data-stu-id="834e3-418">For example:</span></span>

```csharp
routes.MapRoute("blog_route", "blog/{*slug}",
  defaults: new { controller = "Blog", action = "ReadPost" });
```

<span data-ttu-id="834e3-419">リンク生成では、コントローラーとアクションについて一致する値が指定されるとき、このルートのリンクのみが生成されます。</span><span class="sxs-lookup"><span data-stu-id="834e3-419">Link generation would only generate a link for this route when the matching values for controller and action are provided.</span></span>
