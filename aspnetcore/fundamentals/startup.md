---
title: "ASP.NET Core でのアプリケーションの起動"
author: ardalis
description: "ASP.NET Core でスタートアップ クラスがサービスとアプリケーションの要求パイプラインを構成する方法を検出します。"
keywords: "ASP.NET Core、スタートアップ時に、構成する方法、ConfigureServices メソッド"
ms.author: tdykstra
manager: wpickett
ms.date: 02/29/2017
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/startup
ms.openlocfilehash: 83b2647df8beec1feae33400224dacf9823be9b4
ms.sourcegitcommit: 8f42ab93402c1b8044815e1e48d0bb84c81f8b59
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/29/2017
---
# <a name="application-startup-in-aspnet-core"></a><span data-ttu-id="7b40d-104">ASP.NET Core でのアプリケーションの起動</span><span class="sxs-lookup"><span data-stu-id="7b40d-104">Application Startup in ASP.NET Core</span></span>

<span data-ttu-id="7b40d-105">によって[Steve Smith](https://ardalis.com/)と[Tom Dykstra](https://github.com/tdykstra/)</span><span class="sxs-lookup"><span data-stu-id="7b40d-105">By [Steve Smith](https://ardalis.com/) and [Tom Dykstra](https://github.com/tdykstra/)</span></span>

<span data-ttu-id="7b40d-106">`Startup`クラスは、サービスとアプリケーションの要求パイプラインを構成します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-106">The `Startup` class configures services and the application's request pipeline.</span></span>

## <a name="the-startup-class"></a><span data-ttu-id="7b40d-107">スタートアップ クラス</span><span class="sxs-lookup"><span data-stu-id="7b40d-107">The Startup class</span></span>

<span data-ttu-id="7b40d-108">ASP.NET Core アプリケーションが必要な`Startup`というクラス`Startup`慣例です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-108">ASP.NET Core apps require a `Startup` class, which is named `Startup` by convention.</span></span> <span data-ttu-id="7b40d-109">スタートアップ クラス名を指定する、`Main`プログラムの[WebHostBuilderExtensions](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilderextensions) [ `UseStartup<TStartup>` ](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilderextensions#Microsoft_AspNetCore_Hosting_WebHostBuilderExtensions_UseStartup__1_Microsoft_AspNetCore_Hosting_IWebHostBuilder_)メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7b40d-109">You specify the startup class name in the `Main` program's [WebHostBuilderExtensions](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilderextensions) [`UseStartup<TStartup>`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilderextensions#Microsoft_AspNetCore_Hosting_WebHostBuilderExtensions_UseStartup__1_Microsoft_AspNetCore_Hosting_IWebHostBuilder_) method.</span></span> <span data-ttu-id="7b40d-110">参照してください[ホスティング](xref:fundamentals/hosting)について詳しく学習する`WebHostBuilder`、前に実行される`Startup`です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-110">See [Hosting](xref:fundamentals/hosting) to learn more about `WebHostBuilder`, which runs before `Startup`.</span></span>

<span data-ttu-id="7b40d-111">独立したを定義することができます`Startup`クラスのさまざまな環境、および適切ないずれかが実行時に選択されます。</span><span class="sxs-lookup"><span data-stu-id="7b40d-111">You can define separate `Startup` classes for different environments, and the appropriate one will be selected at runtime.</span></span> <span data-ttu-id="7b40d-112">指定した場合`startupAssembly`で、 [WebHost 構成](https://docs.microsoft.com/aspnet/core/fundamentals/hosting?tabs=aspnetcore2x#configuring-a-host)オプション をホストしているか、またはそのスタートアップ アセンブリの読み込みおよび検索、`Startup`または`Startup[Environment]`型です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-112">If you specify `startupAssembly` in the [WebHost configuration](https://docs.microsoft.com/aspnet/core/fundamentals/hosting?tabs=aspnetcore2x#configuring-a-host) or options, hosting will load that startup assembly and search for a `Startup` or `Startup[Environment]` type.</span></span> <span data-ttu-id="7b40d-113">クラスを名前サフィックスと一致する現在の環境は優先順位を付けるために、アプリを実行、*開発*環境では、両方が含まれると、`Startup`と`StartupDevelopment`クラス、`StartupDevelopment`クラスになります使用されます。</span><span class="sxs-lookup"><span data-stu-id="7b40d-113">The class whose name suffix matches the current environment will be prioritized, so if the app is run in the *Development* environment, and includes both a `Startup` and a `StartupDevelopment` class, the `StartupDevelopment` class will be used.</span></span> <span data-ttu-id="7b40d-114">参照してください[FindStartupType](https://github.com/aspnet/Hosting/blob/rel/1.1.0/src/Microsoft.AspNetCore.Hosting/Internal/StartupLoader.cs)で`StartupLoader`と[複数の環境で作業](environments.md#startup-conventions)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-114">See [FindStartupType](https://github.com/aspnet/Hosting/blob/rel/1.1.0/src/Microsoft.AspNetCore.Hosting/Internal/StartupLoader.cs) in `StartupLoader` and [Working with multiple environments](environments.md#startup-conventions).</span></span>

<span data-ttu-id="7b40d-115">またを定義し、固定`Startup`呼び出すことにより、環境に関係なく使用されるクラス`UseStartup<TStartup>`です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-115">Alternatively, you can define a fixed `Startup` class that will be used regardless of the environment by calling `UseStartup<TStartup>`.</span></span> <span data-ttu-id="7b40d-116">この方法をお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7b40d-116">This is the recommended approach.</span></span>

<span data-ttu-id="7b40d-117">`Startup`クラスのコンス トラクターがから提供される依存関係を受け入れることができる[依存性の注入](xref:fundamentals/dependency-injection)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-117">The `Startup` class constructor can accept dependencies that are provided through [dependency injection](xref:fundamentals/dependency-injection).</span></span> <span data-ttu-id="7b40d-118">一般的な方法は、使用する`IHostingEnvironment`を設定する[構成](xref:fundamentals/configuration/index)ソース。</span><span class="sxs-lookup"><span data-stu-id="7b40d-118">A common approach is to use `IHostingEnvironment` to set up [configuration](xref:fundamentals/configuration/index) sources.</span></span>

<span data-ttu-id="7b40d-119">`Startup`クラスを含める必要があります、`Configure`メソッドを必要に応じて含めることができます、`ConfigureServices`メソッド、アプリケーションの起動時にどちらもと呼ばれます。</span><span class="sxs-lookup"><span data-stu-id="7b40d-119">The `Startup` class must include a `Configure` method and can optionally include a `ConfigureServices` method, both of which are called when the application starts.</span></span> <span data-ttu-id="7b40d-120">クラスを含めることも[環境固有のバージョンをこれらのメソッドの](xref:fundamentals/environments#startup-conventions)します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-120">The class can also include [environment-specific versions of these methods](xref:fundamentals/environments#startup-conventions).</span></span> <span data-ttu-id="7b40d-121">`ConfigureServices`、存在する場合は、前に呼び出されます`Configure`です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-121">`ConfigureServices`, if present, is called before `Configure`.</span></span>

<span data-ttu-id="7b40d-122">について学習[アプリケーションの起動中に例外を処理](xref:fundamentals/error-handling#startup-exception-handling)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-122">Learn about [handling exceptions during application startup](xref:fundamentals/error-handling#startup-exception-handling).</span></span>

## <a name="the-configureservices-method"></a><span data-ttu-id="7b40d-123">ConfigureServices メソッド</span><span class="sxs-lookup"><span data-stu-id="7b40d-123">The ConfigureServices method</span></span>

<span data-ttu-id="7b40d-124">[ConfigureServices](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.startupbase#Microsoft_AspNetCore_Hosting_StartupBase_ConfigureServices_Microsoft_Extensions_DependencyInjection_IServiceCollection_)メソッドは省略可能です。 が、このオプションを使用すると、関数が呼び出される前に、 `Configure` web ホストでのメソッドです。</span><span class="sxs-lookup"><span data-stu-id="7b40d-124">The [ConfigureServices](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.startupbase#Microsoft_AspNetCore_Hosting_StartupBase_ConfigureServices_Microsoft_Extensions_DependencyInjection_IServiceCollection_) method is optional; but if used, it's called before the `Configure` method by the web host.</span></span> <span data-ttu-id="7b40d-125">Web ホストが前にいくつかのサービスを構成することがあります``Startup``メソッドが呼び出される (を参照してください[ホスト](xref:fundamentals/hosting))。</span><span class="sxs-lookup"><span data-stu-id="7b40d-125">The web host may configure some services before ``Startup`` methods are called (see [hosting](xref:fundamentals/hosting)).</span></span> <span data-ttu-id="7b40d-126">慣例により、[構成オプション](xref:fundamentals/configuration/index)はこのメソッドで設定します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-126">By convention, [Configuration options](xref:fundamentals/configuration/index) are set in this method.</span></span>

<span data-ttu-id="7b40d-127">大量のセットアップが必要な機能がある`Add[Service]`拡張メソッド[IServiceCollection](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.dependencyinjection.iservicecollection)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-127">For features that require substantial setup there are `Add[Service]` extension methods on [IServiceCollection](https://docs.microsoft.com/aspnet/core/api/microsoft.extensions.dependencyinjection.iservicecollection).</span></span> <span data-ttu-id="7b40d-128">既定の web サイト テンプレートからこの例は、Entity Framework、Id、および MVC 用のサービスを使用するアプリを構成します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-128">This example from the default web site template configures the app to use services for Entity Framework, Identity, and MVC:</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?highlight=4,7,11&start=40&end=55)]

<span data-ttu-id="7b40d-129">サービスをサービス コンテナーに追加することが可能になります経由でのアプリケーション内で[依存性の注入](xref:fundamentals/dependency-injection)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-129">Adding services to the services container makes them available within your application via [dependency injection](xref:fundamentals/dependency-injection).</span></span>

## <a name="services-available-in-startup"></a><span data-ttu-id="7b40d-130">スタートアップで使用できるサービス</span><span class="sxs-lookup"><span data-stu-id="7b40d-130">Services Available in Startup</span></span>

<span data-ttu-id="7b40d-131">ASP.NET Core 依存関係の挿入は、アプリケーションの起動中にサービスを提供します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-131">ASP.NET Core dependency injection provides services during an application's startup.</span></span> <span data-ttu-id="7b40d-132">パラメーターとして、適切なインターフェイスを含めることによってこれらのサービスを要求することができます、`Startup`クラスのコンス トラクターまたはその`Configure`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7b40d-132">You can request these services by including the appropriate interface as a parameter on your `Startup` class's constructor or its `Configure` method.</span></span> <span data-ttu-id="7b40d-133">`ConfigureServices`メソッドはわずかな`IServiceCollection`パラメーター (ただし、追加のパラメーターは必要ありませんので、このコレクションから取得するサービスが登録されていることができます)。</span><span class="sxs-lookup"><span data-stu-id="7b40d-133">The `ConfigureServices` method only takes an `IServiceCollection` parameter (but any registered service can be retrieved from this collection, so additional parameters are not necessary).</span></span>

<span data-ttu-id="7b40d-134">によって要求された通常のサービスの一部を次に示します`Startup`メソッド。</span><span class="sxs-lookup"><span data-stu-id="7b40d-134">Below are some of the services typically requested by `Startup` methods:</span></span>

* <span data-ttu-id="7b40d-135">コンス トラクターで: `IHostingEnvironment`、`ILogger<Startup>`</span><span class="sxs-lookup"><span data-stu-id="7b40d-135">In the constructor:  `IHostingEnvironment`, `ILogger<Startup>`</span></span>
* <span data-ttu-id="7b40d-136">`ConfigureServices`:`IServiceCollection`</span><span class="sxs-lookup"><span data-stu-id="7b40d-136">In `ConfigureServices`:  `IServiceCollection`</span></span>
* <span data-ttu-id="7b40d-137">`Configure`: `IApplicationBuilder`、 `IHostingEnvironment`、`ILoggerFactory`</span><span class="sxs-lookup"><span data-stu-id="7b40d-137">In `Configure`:  `IApplicationBuilder`, `IHostingEnvironment`, `ILoggerFactory`</span></span>

<span data-ttu-id="7b40d-138">によって追加されたすべてのサービス、 ``WebHostBuilder`` ``ConfigureServices``によって要求されるメソッド、``Startup``クラスのコンス トラクターまたはその``Configure``メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7b40d-138">Any services added by the ``WebHostBuilder`` ``ConfigureServices`` method may be requested by the ``Startup`` class constructor or its ``Configure`` method.</span></span> <span data-ttu-id="7b40d-139">使用して`WebHostBuilder`中にいずれかのサービスを提供する必要がある`Startup`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7b40d-139">Use `WebHostBuilder` to provide any services you need during `Startup` methods.</span></span>

## <a name="the-configure-method"></a><span data-ttu-id="7b40d-140">Configure メソッド</span><span class="sxs-lookup"><span data-stu-id="7b40d-140">The Configure method</span></span>

<span data-ttu-id="7b40d-141">`Configure`メソッドは、ASP.NET アプリケーションが HTTP 要求に応答する方法を指定するために使用します。</span><span class="sxs-lookup"><span data-stu-id="7b40d-141">The `Configure` method is used to specify how the ASP.NET application will respond to HTTP requests.</span></span> <span data-ttu-id="7b40d-142">追加することで、要求パイプラインが構成されている[ミドルウェア](middleware.md)コンポーネントを`IApplicationBuilder`依存性の注入が提供するインスタンス。</span><span class="sxs-lookup"><span data-stu-id="7b40d-142">The request pipeline is configured by adding [middleware](middleware.md) components to an `IApplicationBuilder` instance that is provided by dependency injection.</span></span>

<span data-ttu-id="7b40d-143">既定の web サイト テンプレートから次の例でいくつかの拡張メソッドを使用して、サポート、パイプラインを構成する[BrowserLink](http://vswebessentials.com/features/browserlink)、エラー ページ、静的なファイル、ASP.NET MVC、および Id。</span><span class="sxs-lookup"><span data-stu-id="7b40d-143">In the following example from the default web site template, several extension methods are used to configure the pipeline with support for [BrowserLink](http://vswebessentials.com/features/browserlink), error pages, static files, ASP.NET MVC, and Identity.</span></span>

[!code-csharp[Main](../common/samples/WebApplication1/Startup.cs?highlight=8,9,10,14,17,19,21&start=58&end=84)]

<span data-ttu-id="7b40d-144">各`Use`拡張メソッドを追加、[ミドルウェア](xref:fundamentals/middleware)コンポーネントを要求パイプライン。</span><span class="sxs-lookup"><span data-stu-id="7b40d-144">Each `Use` extension method adds a [middleware](xref:fundamentals/middleware) component to the request pipeline.</span></span> <span data-ttu-id="7b40d-145">インスタンス、`UseMvc`拡張メソッドを追加、[ルーティング](routing.md)要求パイプラインにミドルウェアを構成および[MVC](xref:mvc/overview)既定のハンドラーとして。</span><span class="sxs-lookup"><span data-stu-id="7b40d-145">For instance, the `UseMvc` extension method adds the [routing](routing.md) middleware to the request pipeline and configures [MVC](xref:mvc/overview) as the default handler.</span></span>

<span data-ttu-id="7b40d-146">使用する方法の詳細についての`IApplicationBuilder`を参照してください[ミドルウェア](xref:fundamentals/middleware)です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-146">For more information about how to use `IApplicationBuilder`, see [Middleware](xref:fundamentals/middleware).</span></span>

<span data-ttu-id="7b40d-147">などの他のサービス`IHostingEnvironment`と`ILoggerFactory`メソッド シグネチャ内で指定することもありますいる場合にこれらのサービスが表示されます[挿入](dependency-injection.md)可能な場合です。</span><span class="sxs-lookup"><span data-stu-id="7b40d-147">Additional services, like `IHostingEnvironment` and `ILoggerFactory` may also be specified in the method signature, in which case these services will be [injected](dependency-injection.md) if they are available.</span></span> 

## <a name="additional-resources"></a><span data-ttu-id="7b40d-148">その他のリソース</span><span class="sxs-lookup"><span data-stu-id="7b40d-148">Additional Resources</span></span>

* [<span data-ttu-id="7b40d-149">複数の環境の使用</span><span class="sxs-lookup"><span data-stu-id="7b40d-149">Working with Multiple Environments</span></span>](xref:fundamentals/environments)
* [<span data-ttu-id="7b40d-150">ミドルウェア</span><span class="sxs-lookup"><span data-stu-id="7b40d-150">Middleware</span></span>](xref:fundamentals/middleware)
* [<span data-ttu-id="7b40d-151">ログ</span><span class="sxs-lookup"><span data-stu-id="7b40d-151">Logging</span></span>](xref:fundamentals/logging/index)
* [<span data-ttu-id="7b40d-152">構成</span><span class="sxs-lookup"><span data-stu-id="7b40d-152">Configuration</span></span>](xref:fundamentals/configuration/index)
