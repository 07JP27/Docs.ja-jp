---
title: "IIS で ASP.NET Core をトラブルシューティングします。"
author: guardrex
description: "ASP.NET Core アプリケーションの IIS の展開に関する問題を診断する方法を説明します。"
ms.author: riande
manager: wpickett
ms.custom: mvc
ms.date: 03/13/2017
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: host-and-deploy/iis/troubleshoot
ms.openlocfilehash: 2e42d5904e2be8c031c5c6d4bbc104a251b699f2
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/11/2018
---
# <a name="troubleshoot-aspnet-core-on-iis"></a><span data-ttu-id="8a222-103">IIS で ASP.NET Core をトラブルシューティングします。</span><span class="sxs-lookup"><span data-stu-id="8a222-103">Troubleshoot ASP.NET Core on IIS</span></span>

<span data-ttu-id="8a222-104">作成者: [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="8a222-104">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="8a222-105">問題を診断する IIS を展開します。</span><span class="sxs-lookup"><span data-stu-id="8a222-105">To diagnose issues with IIS deployments:</span></span>

* <span data-ttu-id="8a222-106">ブラウザーの出力を調べます。</span><span class="sxs-lookup"><span data-stu-id="8a222-106">Study browser output.</span></span>
* <span data-ttu-id="8a222-107">**イベント ビューアー**でシステムの**アプリケーション** ログを調べます。</span><span class="sxs-lookup"><span data-stu-id="8a222-107">Examine the system's **Application** log through **Event Viewer**.</span></span>
* <span data-ttu-id="8a222-108">`stdout` ログを有効にします。</span><span class="sxs-lookup"><span data-stu-id="8a222-108">Enable `stdout` logging.</span></span> <span data-ttu-id="8a222-109">**ASP.NET Core モジュール**のログは、*web.config*で `<aspNetCore>`要素の *stdoutLogFile* 属性に指定したパスにあります。この属性の値で指定されたパスにあるすべてのフォルダーが、展開環境に存在する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a222-109">The **ASP.NET Core Module** log is found on the path provided in the *stdoutLogFile* attribute of the `<aspNetCore>` element in *web.config*. Any folders on the path provided in the attribute value must exist in the deployment.</span></span> <span data-ttu-id="8a222-110">設定*stdoutLogEnabled*に`true`です。</span><span class="sxs-lookup"><span data-stu-id="8a222-110">Set *stdoutLogEnabled* to `true`.</span></span> <span data-ttu-id="8a222-111">使用するアプリ、 `Microsoft.NET.Sdk.Web` SDK を作成する、 *web.config*既定のファイル、 *stdoutLogEnabled*設定`false`、手動で提供、 *web.config*ファイルまたは有効にするために、ファイルを変更する`stdout`ログ記録します。</span><span class="sxs-lookup"><span data-stu-id="8a222-111">Apps that use the the `Microsoft.NET.Sdk.Web` SDK to create the *web.config* file default the *stdoutLogEnabled* setting to `false`, so manually provide the *web.config* file or modify the file in order to enable `stdout` logging.</span></span>

<span data-ttu-id="8a222-112">これら 3 つのソースから情報を使用して、[一般的なエラー リファレンス トピック](xref:host-and-deploy/azure-iis-errors-reference)問題を特定します。</span><span class="sxs-lookup"><span data-stu-id="8a222-112">Use information from those three sources with the [common errors reference topic](xref:host-and-deploy/azure-iis-errors-reference) to determine the problem.</span></span> <span data-ttu-id="8a222-113">問題を解決するのには提供されるトラブルシューティング アドバイスに従います。</span><span class="sxs-lookup"><span data-stu-id="8a222-113">Follow the troubleshooting advice provided to resolve the issue.</span></span>

<span data-ttu-id="8a222-114">一般的なエラーのいくつかは、*startupTimeLimit* (既定値: 120 秒) と *startupRetryCount* (既定値: 2) が経過するまで、ブラウザー、アプリケーション ログ、ASP.NET Core モジュールのログに表示されません。</span><span class="sxs-lookup"><span data-stu-id="8a222-114">Several of the common errors don't appear in the browser, Application Log, and ASP.NET Core Module Log until the module *startupTimeLimit* (default: 120 seconds) and *startupRetryCount* (default: 2) have passed.</span></span> <span data-ttu-id="8a222-115">したがって、モジュールがアプリのプロセスを開始できなかったと判断する前に、完全に 6 分が経過するまで待ってください。</span><span class="sxs-lookup"><span data-stu-id="8a222-115">Therefore, wait a full six minutes before deducing that the module has failed to start a process for the app.</span></span>

<span data-ttu-id="8a222-116">アプリが正常に動作しているかどうかを決定する 1 つの簡単な方法は、アプリを Kestrel で直接実行することです。</span><span class="sxs-lookup"><span data-stu-id="8a222-116">One quick way to determine if the app is working properly is to run the app directly on Kestrel.</span></span> <span data-ttu-id="8a222-117">として、アプリが発行された場合、[フレームワークに依存する展開](/dotnet/core/deploying/#framework-dependent-deployments-fdd)、実行`dotnet <assembly_name>.dll`配置フォルダーでは、アプリへの IIS の物理パス。</span><span class="sxs-lookup"><span data-stu-id="8a222-117">If the app was published as a [framework-dependent deployment](/dotnet/core/deploying/#framework-dependent-deployments-fdd), execute `dotnet <assembly_name>.dll` in the deployment folder, which is the IIS physical path to the app.</span></span> <span data-ttu-id="8a222-118">として、アプリが発行された場合、[自己完結型の配置](/dotnet/core/deploying/#self-contained-deployments-scd)、実行、アプリのコマンド プロンプトから直接実行可能ファイル`<assembly_name>.exe`、配置フォルダーでします。</span><span class="sxs-lookup"><span data-stu-id="8a222-118">If the app was published as a [self-contained deployment](/dotnet/core/deploying/#self-contained-deployments-scd), run the app's executable directly from a command prompt, `<assembly_name>.exe`, in the deployment folder.</span></span> <span data-ttu-id="8a222-119">アプリを入手する必要があります Kestrel が 5000 の既定のポートでリッスンしている場合`http://localhost:5000/`です。</span><span class="sxs-lookup"><span data-stu-id="8a222-119">If Kestrel is listening on default port 5000, the app should be available at `http://localhost:5000/`.</span></span> <span data-ttu-id="8a222-120">応答した場合、アプリ通常 Kestrel エンドポイント アドレスで、問題がより多く関連のリバース プロキシの構成、およびアプリ内可能性が低い。</span><span class="sxs-lookup"><span data-stu-id="8a222-120">If the app responds normally at the Kestrel endpoint address, the problem is more likely related to the reverse proxy configuration and less likely within the app.</span></span>

<span data-ttu-id="8a222-121">スタイル シート、スクリプト、またはイメージ内のアプリの静的ファイルからの静的ファイルの簡単な要求を実行するかどうかは、リバース プロキシが正常に動作を決定する方法の 1 つは、 *wwwroot*を使用して[静的ファイル ミドルウェア](xref:fundamentals/static-files).</span><span class="sxs-lookup"><span data-stu-id="8a222-121">One way to determine if the reverse proxy is working properly is to perform a simple static file request for a stylesheet, script, or image from the app's static files in *wwwroot* using [Static File Middleware](xref:fundamentals/static-files).</span></span> <span data-ttu-id="8a222-122">アプリは、静的なファイルを使用できる MVC ビューおよびその他のエンドポイントが失敗している場合は、問題には、リバース プロキシの構成に関連する可能性が低い (例、MVC ルーティングまたは 500 Internal Server Error) 用のアプリ内で可能性が高くなります。</span><span class="sxs-lookup"><span data-stu-id="8a222-122">If the app can serve static files but MVC Views and other endpoints are failing, the problem is less likely related to the reverse proxy configuration and more likely within the app (for example, MVC routing or 500 Internal Server Error).</span></span>

<span data-ttu-id="8a222-123">環境変数を一時的に追加 Kestrel が正常に起動 IIS の背後にあるが、正常にローカルに実行した後、システムで、アプリは実行できません、 *web.config*を設定する、`ASPNETCORE_ENVIRONMENT`に`Development`です。</span><span class="sxs-lookup"><span data-stu-id="8a222-123">When Kestrel starts normally behind IIS but the app won't run on the system after successfully running locally, an environment variable can be temporarily added to *web.config* to set the `ASPNETCORE_ENVIRONMENT` to `Development`.</span></span> <span data-ttu-id="8a222-124">環境がアプリの起動時にオーバーライドされると、されていない限り、環境変数を設定できます、[開発者例外ページ](xref:fundamentals/error-handling)に表示されるときに、アプリを実行します。</span><span class="sxs-lookup"><span data-stu-id="8a222-124">As long as the environment isn't overridden in app startup, setting the environment variable allows the [developer exception page](xref:fundamentals/error-handling) to appear when the app is run.</span></span> <span data-ttu-id="8a222-125">環境変数を設定`ASPNETCORE_ENVIRONMENT`この方法でのみに対して推奨は公開されませんステージング/テスト サーバーをインターネットにします。</span><span class="sxs-lookup"><span data-stu-id="8a222-125">Setting the environment variable for `ASPNETCORE_ENVIRONMENT` in this way is only recommended for staging/testing servers that aren't exposed to the Internet.</span></span> <span data-ttu-id="8a222-126">環境変数を削除してください、 *web.config*ファイルが完了します。</span><span class="sxs-lookup"><span data-stu-id="8a222-126">Be sure to remove the environment variable from the *web.config* file when finished.</span></span> <span data-ttu-id="8a222-127">使用して環境変数の設定の詳細について*web.config*を参照してください[aspNetCore の子要素を environmentVariables](xref:host-and-deploy/aspnet-core-module#setting-environment-variables)です。</span><span class="sxs-lookup"><span data-stu-id="8a222-127">For information on setting environment variables via *web.config*, see [environmentVariables child element of aspNetCore](xref:host-and-deploy/aspnet-core-module#setting-environment-variables).</span></span>

<span data-ttu-id="8a222-128">ほとんどの場合、アプリケーションのログ記録を有効にすると、アプリまたはリバース プロキシに関する問題のトラブルシューティングに役立ちます。</span><span class="sxs-lookup"><span data-stu-id="8a222-128">In most cases, enabling application logging assists in troubleshooting problems with the app or the reverse proxy.</span></span> <span data-ttu-id="8a222-129">詳細については、[ログ記録](xref:fundamentals/logging/index)に関する説明を参照してください。</span><span class="sxs-lookup"><span data-stu-id="8a222-129">See [Logging](xref:fundamentals/logging/index) for more information.</span></span>

<span data-ttu-id="8a222-130">最後のトラブルシューティングのヒントでは、.NET Core SDK が、開発コンピューターまたはパッケージのバージョンで、アプリ内のいずれかのアップグレード後の実行に失敗するアプリに関連します。</span><span class="sxs-lookup"><span data-stu-id="8a222-130">The last troubleshooting tip pertains to apps that fail to run after upgrading either the .NET Core SDK on the development machine or package versions within the app.</span></span> <span data-ttu-id="8a222-131">場合によっては、パッケージに統一性がないと、メジャー アップグレード実行時にアプリが破壊されることがあります。</span><span class="sxs-lookup"><span data-stu-id="8a222-131">In some cases, incoherent packages may break an app when performing major upgrades.</span></span> <span data-ttu-id="8a222-132">これらの問題のほとんどは、によりを修正できます。</span><span class="sxs-lookup"><span data-stu-id="8a222-132">Most of these issues can be fixed by:</span></span>

* <span data-ttu-id="8a222-133">削除すると、`bin`と`obj`のプロジェクトのフォルダーです。</span><span class="sxs-lookup"><span data-stu-id="8a222-133">Deleting the `bin` and `obj` folders in the project.</span></span>
* <span data-ttu-id="8a222-134">キャッシュの消去パッケージ`%UserProfile%\.nuget\packages\`と`%LocalAppData%\Nuget\v3-cache`です。</span><span class="sxs-lookup"><span data-stu-id="8a222-134">Clearing package caches at `%UserProfile%\.nuget\packages\` and `%LocalAppData%\Nuget\v3-cache`.</span></span>
* <span data-ttu-id="8a222-135">復元して、プロジェクトを再構築します。</span><span class="sxs-lookup"><span data-stu-id="8a222-135">Restoring and rebuilding the project.</span></span>
* <span data-ttu-id="8a222-136">アプリを再展開する前に、サーバー上の以前の展開が完全に削除されたことを確認します。</span><span class="sxs-lookup"><span data-stu-id="8a222-136">Confirming that the prior deployment on the server has been completely deleted prior to re-deploying the app.</span></span>

> [!TIP]
> <span data-ttu-id="8a222-137">パッケージのキャッシュを消去する便利な方法は、実行する`dotnet nuget locals all --clear`コマンド プロンプトからです。</span><span class="sxs-lookup"><span data-stu-id="8a222-137">A convenient way to clear package caches is to execute `dotnet nuget locals all --clear` from a command prompt.</span></span>
> 
> <span data-ttu-id="8a222-138">パッケージのキャッシュをクリアする行うこともできますを使用して、 [nuget.exe](https://www.nuget.org/downloads)ツールとコマンドを実行する`nuget locals all -clear`です。</span><span class="sxs-lookup"><span data-stu-id="8a222-138">Clearing package caches can also be accomplished by using the [nuget.exe](https://www.nuget.org/downloads) tool and executing the command `nuget locals all -clear`.</span></span> <span data-ttu-id="8a222-139">*nuget.exe* Windows 10 とバンドルがインストールされていないし、NuGet の web サイトから個別に取得する必要があります。</span><span class="sxs-lookup"><span data-stu-id="8a222-139">*nuget.exe* isn't a bundled install with Windows 10 and must be obtained separately from the NuGet website.</span></span>
<!--
> [!TIP]
> A convenient way to clear package caches is to:
>
> * Obtain the *NuGet.exe* tool from [NuGet.org](https://www.nuget.org/).
> * Add the path to *NuGet.exe* to the system PATH.
> * Execute `nuget locals all -clear` from a command prompt.
>
> Alternatively, execute `dotnet nuget locals all --clear` from a command prompt without obtaining *NuGet.exe*. -->

## <a name="additional-resources"></a><span data-ttu-id="8a222-140">その他の技術情報</span><span class="sxs-lookup"><span data-stu-id="8a222-140">Additional resources</span></span>

* [<span data-ttu-id="8a222-141">Azure App Service および IIS と ASP.NET Core の一般的なエラーのリファレンス</span><span class="sxs-lookup"><span data-stu-id="8a222-141">Common errors reference for Azure App Service and IIS with ASP.NET Core</span></span>](xref:host-and-deploy/azure-iis-errors-reference)
* [<span data-ttu-id="8a222-142">ASP.NET Core モジュール構成リファレンス</span><span class="sxs-lookup"><span data-stu-id="8a222-142">ASP.NET Core Module configuration reference</span></span>](xref:host-and-deploy/aspnet-core-module)
