## <a name="call-the-web-api-with-jquery"></a><span data-ttu-id="66946-101">jQuery での Web API の呼び出し</span><span class="sxs-lookup"><span data-stu-id="66946-101">Call the Web API with jQuery</span></span>

<span data-ttu-id="66946-102">このセクションでは、jQuery を使用して Web API を呼び出す、HTML ページが追加されます。</span><span class="sxs-lookup"><span data-stu-id="66946-102">In this section, an HTML page is added that uses jQuery to call the Web API.</span></span> <span data-ttu-id="66946-103">jQuery で要求を開始し、API の応答からの詳細を含むページを更新します。</span><span class="sxs-lookup"><span data-stu-id="66946-103">jQuery initiates the request and updates the page with the details from the API's response.</span></span>

<span data-ttu-id="66946-104">静的ファイルを提供し、既定のファイル マッピングを有効にするようにプロジェクトを構成します。</span><span class="sxs-lookup"><span data-stu-id="66946-104">Configure the project to serve static files and to enable default file mapping.</span></span> <span data-ttu-id="66946-105">これには、*Startup.Configure* で [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) と [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) 拡張メソッドを呼び出します。</span><span class="sxs-lookup"><span data-stu-id="66946-105">This is accomplished by invoking the [UseStaticFiles](/dotnet/api/microsoft.aspnetcore.builder.staticfileextensions.usestaticfiles#Microsoft_AspNetCore_Builder_StaticFileExtensions_UseStaticFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) and [UseDefaultFiles](/dotnet/api/microsoft.aspnetcore.builder.defaultfilesextensions.usedefaultfiles#Microsoft_AspNetCore_Builder_DefaultFilesExtensions_UseDefaultFiles_Microsoft_AspNetCore_Builder_IApplicationBuilder_) extension methods in *Startup.Configure*.</span></span> <span data-ttu-id="66946-106">詳細については、「[ASP.NET Core の静的ファイルの使用](xref:fundamentals/static-files)」を参照してください。</span><span class="sxs-lookup"><span data-stu-id="66946-106">For more information, see [Work with static files in ASP.NET Core](xref:fundamentals/static-files).</span></span>

[!code-csharp[](../../tutorials/first-web-api/samples/2.0/TodoApi/Startup2.cs?name=snippet_Configure&highlight=3-4)]

<span data-ttu-id="66946-107">*index.html* という名前の HTML ファイルをプロジェクトの *wwwroot* ディレクトリに追加します。</span><span class="sxs-lookup"><span data-stu-id="66946-107">Add an HTML file, named *index.html*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="66946-108">その内容を次のマークアップに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="66946-108">Replace its contents with the following markup:</span></span>

[!code-html[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/index.html)]

<span data-ttu-id="66946-109">*site.js* という名前の JavaScript ファイルをプロジェクトの *wwwroot* ディレクトリに追加します。</span><span class="sxs-lookup"><span data-stu-id="66946-109">Add a JavaScript file, named *site.js*, to the project's *wwwroot* directory.</span></span> <span data-ttu-id="66946-110">その内容を次のコードに置き換えます。</span><span class="sxs-lookup"><span data-stu-id="66946-110">Replace its contents with the following code:</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_SiteJs)]

<span data-ttu-id="66946-111">ローカルで HTML ページをテストするために、ASP.NET Core プロジェクトの起動設定への変更が要求される場合があります。</span><span class="sxs-lookup"><span data-stu-id="66946-111">A change to the ASP.NET Core project's launch settings may be required to test the HTML page locally.</span></span> <span data-ttu-id="66946-112">プロジェクトの *Properties* ディレクトリの *launchSettings.json* を開きます。</span><span class="sxs-lookup"><span data-stu-id="66946-112">Open *launchSettings.json* in the *Properties* directory of the project.</span></span> <span data-ttu-id="66946-113">アプリが強制的に *index.html*&mdash;プロジェクトの既定ファイルで開くようにするには、`launchUrl` プロパティを削除します。</span><span class="sxs-lookup"><span data-stu-id="66946-113">Remove the `launchUrl` property to force the app to open at *index.html*&mdash;the project's default file.</span></span>

<span data-ttu-id="66946-114">jQuery を取得するには、いくつかの方法があります。</span><span class="sxs-lookup"><span data-stu-id="66946-114">There are several ways to get jQuery.</span></span> <span data-ttu-id="66946-115">前のスニペットでは、ライブラリは CDN から読み込まれます。</span><span class="sxs-lookup"><span data-stu-id="66946-115">In the preceding snippet, the library is loaded from a CDN.</span></span> <span data-ttu-id="66946-116">このサンプルは、jQuery で API を呼び出す完全な CRUD の例です。</span><span class="sxs-lookup"><span data-stu-id="66946-116">This sample is a complete CRUD example of calling the API with jQuery.</span></span> <span data-ttu-id="66946-117">豊富な体験ができるように、このサンプルには追加の機能が用意されています。</span><span class="sxs-lookup"><span data-stu-id="66946-117">There are additional features in this sample to make the experience richer.</span></span> <span data-ttu-id="66946-118">API の呼び出しを中心にした説明を次に示します。</span><span class="sxs-lookup"><span data-stu-id="66946-118">Below are explanations around the calls to the API.</span></span>

### <a name="get-a-list-of-to-do-items"></a><span data-ttu-id="66946-119">To Do アイテムのリストの取得</span><span class="sxs-lookup"><span data-stu-id="66946-119">Get a list of to-do items</span></span>

<span data-ttu-id="66946-120">To Do アイテムのリストを取得するには、HTTP GET 要求を */api/todo* に送信します。</span><span class="sxs-lookup"><span data-stu-id="66946-120">To get a list of to-do items, send an HTTP GET request to */api/todo*.</span></span>

<span data-ttu-id="66946-121">jQuery [ajax](https://api.jquery.com/jquery.ajax/) 関数は、AJAX 要求を API に送信します。この API はオブジェクトまたは配列を表す JSON を返します。</span><span class="sxs-lookup"><span data-stu-id="66946-121">The jQuery [ajax](https://api.jquery.com/jquery.ajax/) function sends an AJAX request to the API, which returns JSON representing an object or array.</span></span> <span data-ttu-id="66946-122">この関数では、HTTP 要求を指定した `url` に送信して、HTTP の対話式操作のすべてのフォームを処理できます。</span><span class="sxs-lookup"><span data-stu-id="66946-122">This function can handle all forms of HTTP interaction, sending an HTTP request to the specified `url`.</span></span> <span data-ttu-id="66946-123">`GET` は `type` として使用されます。</span><span class="sxs-lookup"><span data-stu-id="66946-123">`GET` is used as the `type`.</span></span> <span data-ttu-id="66946-124">要求が成功した場合、`success` コールバック関数が呼び出されます。</span><span class="sxs-lookup"><span data-stu-id="66946-124">The `success` callback function is invoked if the request succeeds.</span></span> <span data-ttu-id="66946-125">コールバックでは、DOM は To Do 情報で更新されます。</span><span class="sxs-lookup"><span data-stu-id="66946-125">In the callback, the DOM is updated with the to-do information.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_GetData)]

### <a name="add-a-to-do-item"></a><span data-ttu-id="66946-126">To Do アイテムの追加</span><span class="sxs-lookup"><span data-stu-id="66946-126">Add a to-do item</span></span>

<span data-ttu-id="66946-127">To Do アイテムを追加するには、HTTP POST 要求を */api/todo/* に送信します。</span><span class="sxs-lookup"><span data-stu-id="66946-127">To add a to-do item, send an HTTP POST request to */api/todo/*.</span></span> <span data-ttu-id="66946-128">要求本文に To Do オブジェクトを含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="66946-128">The request body should contain a to-do object.</span></span> <span data-ttu-id="66946-129">[ajax](https://api.jquery.com/jquery.ajax/) 関数は、`POST` を使用して API を呼び出しています。</span><span class="sxs-lookup"><span data-stu-id="66946-129">The [ajax](https://api.jquery.com/jquery.ajax/) function is using `POST` to call the API.</span></span> <span data-ttu-id="66946-130">`POST` と `PUT` の要求では、要求本文は API に送信されたデータを表します。</span><span class="sxs-lookup"><span data-stu-id="66946-130">For `POST` and `PUT` requests, the request body represents the data sent to the API.</span></span> <span data-ttu-id="66946-131">API は JSON 要求本文を必要としています。</span><span class="sxs-lookup"><span data-stu-id="66946-131">The API is expecting a JSON request body.</span></span> <span data-ttu-id="66946-132">`accepts` と `contentType` オプションは `application/json` に設定され、それぞれ送受信されるメディアの種類を分類します。</span><span class="sxs-lookup"><span data-stu-id="66946-132">The `accepts` and `contentType` options are set to `application/json` to classify the media type being received and sent, respectively.</span></span> <span data-ttu-id="66946-133">このデータは、[`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify) を使用して、JSON オブジェクトに変換されます。</span><span class="sxs-lookup"><span data-stu-id="66946-133">The data is converted to a JSON object using [`JSON.stringify`](https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/JSON/stringify).</span></span> <span data-ttu-id="66946-134">API で正常な状況コードが返された場合、`getData` 関数が呼び出され、HTML テーブルを更新します。</span><span class="sxs-lookup"><span data-stu-id="66946-134">When the API returns a successful status code, the `getData` function is invoked to update the HTML table.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AddItem)]

### <a name="update-a-to-do-item"></a><span data-ttu-id="66946-135">To Do アイテムの更新</span><span class="sxs-lookup"><span data-stu-id="66946-135">Update a to-do item</span></span>

<span data-ttu-id="66946-136">To Do アイテムの更新も追加も要求本文に依存するため、この 2 つはよく似ています。</span><span class="sxs-lookup"><span data-stu-id="66946-136">Updating a to-do item is very similar to adding one, since both rely on a request body.</span></span> <span data-ttu-id="66946-137">この場合の更新と追加の唯一の違いは、`url` がアイテムの一意識別子を追加するために変更され、`type` が `PUT` になるということです。</span><span class="sxs-lookup"><span data-stu-id="66946-137">The only real difference between the two in this case is that the `url` changes to add the unique identifier of the item, and the `type` is `PUT`.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxPut)]

### <a name="delete-a-to-do-item"></a><span data-ttu-id="66946-138">To Do アイテムの削除</span><span class="sxs-lookup"><span data-stu-id="66946-138">Delete a to-do item</span></span>

<span data-ttu-id="66946-139">To Do アイテムを削除するには、`DELETE` への AJAX 呼び出しで `type` を設定して、URL でアイテムの一意識別子を指定します。</span><span class="sxs-lookup"><span data-stu-id="66946-139">Deleting a to-do item is accomplished by setting the `type` on the AJAX call to `DELETE` and specifing the item's unique identifier in the URL.</span></span>

[!code-javascript[](../../tutorials/first-web-api/samples/2.0/TodoApi/wwwroot/site.js?name=snippet_AjaxDelete)]
