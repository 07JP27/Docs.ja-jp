---
title: "データ保護の概要"
author: rick-anderson
description: "このドキュメントでは、データ保護の概念を紹介し、関連する ASP.NET Core Api の設計原則の概要を示します。"
ms.author: riande
manager: wpickett
ms.date: 10/14/2016
ms.topic: article
ms.technology: aspnet
ms.prod: asp.net-core
uid: security/data-protection/introduction
ms.openlocfilehash: b02ef9121e50ab9d9f24032d32f1e65fe73049c0
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 01/24/2018
---
# <a name="introduction-to-data-protection"></a><span data-ttu-id="67a52-103">データ保護の概要</span><span class="sxs-lookup"><span data-stu-id="67a52-103">Introduction to Data Protection</span></span>

<span data-ttu-id="67a52-104">多くの場合、web アプリケーションは、セキュリティ上重要なデータを格納する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-104">Web applications often need to store security-sensitive data.</span></span> <span data-ttu-id="67a52-105">Windows では、デスクトップ アプリケーションの DPAPI が用意されていますが、これは web アプリケーションに適していません。</span><span class="sxs-lookup"><span data-stu-id="67a52-105">Windows provides DPAPI for desktop applications but this is unsuitable for web applications.</span></span> <span data-ttu-id="67a52-106">ASP.NET Core データ保護スタックは、開発者は、キー管理と回転をなど、データの保護を使用して単純で使いやすい暗号化 API を提供します。</span><span class="sxs-lookup"><span data-stu-id="67a52-106">The ASP.NET Core data protection stack provide a simple, easy to use cryptographic API a developer can use to protect data, including key management and rotation.</span></span>

<span data-ttu-id="67a52-107">ASP.NET Core データ保護スタックの代わりの長期的なとして使用するものでは、 <machineKey> ASP.NET 内の要素 1.x - 4.x です。</span><span class="sxs-lookup"><span data-stu-id="67a52-107">The ASP.NET Core data protection stack is designed to serve as the long-term replacement for the <machineKey> element in ASP.NET 1.x - 4.x.</span></span> <span data-ttu-id="67a52-108">大部分の最新のアプリケーションが発生する可能性の高いユース ケースのボックスのソリューションを提供しつつ、古い暗号化スタックの欠点の多くに対処することがあります。</span><span class="sxs-lookup"><span data-stu-id="67a52-108">It was designed to address many of the shortcomings of the old cryptographic stack while providing an out-of-the-box solution for the majority of use cases modern applications are likely to encounter.</span></span>

## <a name="problem-statement"></a><span data-ttu-id="67a52-109">問題の説明</span><span class="sxs-lookup"><span data-stu-id="67a52-109">Problem statement</span></span>

<span data-ttu-id="67a52-110">1 文では、全体的な問題の説明を簡潔に記述できます。 後で取得は、信頼されている情報を保持する必要がありますが、永続化メカニズムを信頼しません。</span><span class="sxs-lookup"><span data-stu-id="67a52-110">The overall problem statement can be succinctly stated in a single sentence: I need to persist trusted information for later retrieval, but I don't trust the persistence mechanism.</span></span> <span data-ttu-id="67a52-111">Web には、この記述できます「必要な信頼されていないクライアントを介してラウンド トリップの信頼された状態にします」</span><span class="sxs-lookup"><span data-stu-id="67a52-111">In web terms, this might be written as "I need to round-trip trusted state via an untrusted client."</span></span>

<span data-ttu-id="67a52-112">この典型的な例は、認証 cookie、またはベアラー トークン。</span><span class="sxs-lookup"><span data-stu-id="67a52-112">The canonical example of this is an authentication cookie or bearer token.</span></span> <span data-ttu-id="67a52-113">サーバーは、生成、「I Groot am し、"xyz"のアクセス許可を持って」トークンし、クライアントに渡します。</span><span class="sxs-lookup"><span data-stu-id="67a52-113">The server generates an "I am Groot and have xyz permissions" token and hands it to the client.</span></span> <span data-ttu-id="67a52-114">今後、クライアントは現時点では、サーバーにそのトークンが、サーバーには、ある種のクライアントがトークンを偽造していないことを保証が必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-114">At some future date the client will present that token back to the server, but the server needs some kind of assurance that the client hasn't forged the token.</span></span> <span data-ttu-id="67a52-115">したがって、最初の要件: 信頼性 (ルール サブタイプ)</span><span class="sxs-lookup"><span data-stu-id="67a52-115">Thus the first requirement: authenticity (a.k.a.</span></span> <span data-ttu-id="67a52-116">保全性、不正使用防止機能校正)。</span><span class="sxs-lookup"><span data-stu-id="67a52-116">integrity, tamper-proofing).</span></span>

<span data-ttu-id="67a52-117">永続化された状態がサーバーによって信頼されているために、この状態では、この運用環境に固有の情報を含む可能性があるが予想されます。</span><span class="sxs-lookup"><span data-stu-id="67a52-117">Since the persisted state is trusted by the server, we anticipate that this state might contain information that's specific to the operating environment.</span></span> <span data-ttu-id="67a52-118">これは、ファイルのパス、アクセス許可、ハンドル、またはその他の間接参照のフォームまたはその他の一部のサーバーに固有のデータになっている可能性があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-118">This could be in the form of a file path, a permission, a handle or other indirect reference, or some other piece of server-specific data.</span></span> <span data-ttu-id="67a52-119">このような情報一般に公開すべき信頼されていないクライアントにします。</span><span class="sxs-lookup"><span data-stu-id="67a52-119">Such information should generally not be disclosed to an untrusted client.</span></span> <span data-ttu-id="67a52-120">したがって、2 番目の要件: 機密性です。</span><span class="sxs-lookup"><span data-stu-id="67a52-120">Thus the second requirement: confidentiality.</span></span>

<span data-ttu-id="67a52-121">最後に、最新のアプリケーションは、コンポーネント ベースから見てきましたは個々 のコンポーネントは、システムの他のコンポーネントに関係なく、このシステムの利用します。</span><span class="sxs-lookup"><span data-stu-id="67a52-121">Finally, since modern applications are componentized, what we've seen is that individual components will want to take advantage of this system without regard to other components in the system.</span></span> <span data-ttu-id="67a52-122">たとえば、ベアラー トークン コンポーネントは、このスタックで使用されている場合は可能性があります、同じスタックを使用するもあるアンチ CSRF 機構から干渉なし動作必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-122">For instance, if a bearer token component is using this stack, it should operate without interference from an anti-CSRF mechanism that might also be using the same stack.</span></span> <span data-ttu-id="67a52-123">最後の要件したがって: 分離します。</span><span class="sxs-lookup"><span data-stu-id="67a52-123">Thus the final requirement: isolation.</span></span>

<span data-ttu-id="67a52-124">提供できますさらに制約要件の範囲を絞り込むためにします。</span><span class="sxs-lookup"><span data-stu-id="67a52-124">We can provide further constraints in order to narrow the scope of our requirements.</span></span> <span data-ttu-id="67a52-125">内の暗号方式で動作するすべてのサービスが均等に信頼されていること、およびデータが生成または、直接的な制御サービスの外部で使用する必要があることを想定しています。</span><span class="sxs-lookup"><span data-stu-id="67a52-125">We assume that all services operating within the cryptosystem are equally trusted and that the data doesn't need to be generated or consumed outside of the services under our direct control.</span></span> <span data-ttu-id="67a52-126">さらに、ため、web サービスへの各要求が、暗号方式を 1 つまたは複数回の操作ができるだけ高速である必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-126">Furthermore, we require that operations are as fast as possible since each request to the web service might go through the cryptosystem one or more times.</span></span> <span data-ttu-id="67a52-127">これにより、対称暗号方式は、このシナリオに最適となど、必要な時間まで非対称暗号化方式を割引おことができます。</span><span class="sxs-lookup"><span data-stu-id="67a52-127">This makes symmetric cryptography ideal for our scenario, and we can discount asymmetric cryptography until such a time that it's needed.</span></span>

## <a name="design-philosophy"></a><span data-ttu-id="67a52-128">デザインの理念</span><span class="sxs-lookup"><span data-stu-id="67a52-128">Design philosophy</span></span>

<span data-ttu-id="67a52-129">既存のスタックで問題を識別することによって開始します。</span><span class="sxs-lookup"><span data-stu-id="67a52-129">We started by identifying problems with the existing stack.</span></span> <span data-ttu-id="67a52-130">発生しました。 をお既存のソリューションのランドス ケープを調査対象し、する既存のソリューション非常なかったシークお機能という結論に達しました。</span><span class="sxs-lookup"><span data-stu-id="67a52-130">Once we had that, we surveyed the landscape of existing solutions and concluded that no existing solution quite had the capabilities we sought.</span></span> <span data-ttu-id="67a52-131">いくつかの指針に基づいてソリューションを設計しました。</span><span class="sxs-lookup"><span data-stu-id="67a52-131">We then engineered a solution based on several guiding principles.</span></span>

* <span data-ttu-id="67a52-132">システムでは、構成の簡略化のためを提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-132">The system should offer simplicity of configuration.</span></span> <span data-ttu-id="67a52-133">理想的には、システム構成不要、開発者が実行されている地上をヒット可能性があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-133">Ideally the system would be zero-configuration and developers could hit the ground running.</span></span> <span data-ttu-id="67a52-134">開発者が (キー リポジトリ) などの特定の側面を構成する必要がある場合、それらの特定の構成を単純に提供するために考慮対象としてを指定してください。</span><span class="sxs-lookup"><span data-stu-id="67a52-134">In situations where developers need to configure a specific aspect (such as the key repository), consideration should be given to making those specific configurations simple.</span></span>

* <span data-ttu-id="67a52-135">単純な消費者向けの API を提供します。</span><span class="sxs-lookup"><span data-stu-id="67a52-135">Offer a simple consumer-facing API.</span></span> <span data-ttu-id="67a52-136">Api は、適切に使用する簡単で不適切に使用するが困難にする必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-136">The APIs should be easy to use correctly and difficult to use incorrectly.</span></span>

* <span data-ttu-id="67a52-137">開発者は、キー管理の原則に学ぶべきではありません。</span><span class="sxs-lookup"><span data-stu-id="67a52-137">Developers shouldn't learn key management principles.</span></span> <span data-ttu-id="67a52-138">システムには、アルゴリズムの選択と、開発者の代理でキーの有効期間を処理する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-138">The system should handle algorithm selection and key lifetime on the developer's behalf.</span></span> <span data-ttu-id="67a52-139">理想的には、開発者は、生のキー マテリアルへのアクセスもが必要です。</span><span class="sxs-lookup"><span data-stu-id="67a52-139">Ideally the developer should never even have access to the raw key material.</span></span>

* <span data-ttu-id="67a52-140">可能であれば残りの部分でキーを保護する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-140">Keys should be protected at rest when possible.</span></span> <span data-ttu-id="67a52-141">システムは、適切な既定保護メカニズムを確認し、自動的に適用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-141">The system should figure out an appropriate default protection mechanism and apply it automatically.</span></span>

<span data-ttu-id="67a52-142">これらの原則を念頭に、単純なを開発しました[使いやすい](using-data-protection.md)データ保護スタック。</span><span class="sxs-lookup"><span data-stu-id="67a52-142">With these principles in mind we developed a simple, [easy to use](using-data-protection.md) data protection stack.</span></span>

<span data-ttu-id="67a52-143">主に、ASP.NET Core データ保護 Api は社外秘のペイロードの無期限の持続性の目的ではありません。</span><span class="sxs-lookup"><span data-stu-id="67a52-143">The ASP.NET Core data protection APIs are not primarily intended for indefinite persistence of confidential payloads.</span></span> <span data-ttu-id="67a52-144">他のテクノロジと同様に[Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx)と[Azure Rights Management](https://docs.microsoft.com/rights-management/)より永続的ストレージのシナリオに適している、およびこれに対応して強力なキー管理機能があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-144">Other technologies like [Windows CNG DPAPI](https://msdn.microsoft.com/library/windows/desktop/hh706794%28v=vs.85%29.aspx) and [Azure Rights Management](https://docs.microsoft.com/rights-management/) are more suited to the scenario of indefinite storage, and they have correspondingly strong key management capabilities.</span></span> <span data-ttu-id="67a52-145">ただし、機密データの長期的な保護の ASP.NET Core データ保護 Api を使用して、開発者を禁止することは nothing を使用する必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-145">That said, there's nothing prohibiting a developer from using the ASP.NET Core data protection APIs for long-term protection of confidential data.</span></span>

## <a name="audience"></a><span data-ttu-id="67a52-146">対象ユーザー</span><span class="sxs-lookup"><span data-stu-id="67a52-146">Audience</span></span>

<span data-ttu-id="67a52-147">データ保護システムは、5 つの主要なパッケージに分割されます。</span><span class="sxs-lookup"><span data-stu-id="67a52-147">The data protection system is divided into five main packages.</span></span> <span data-ttu-id="67a52-148">これらの Api のさまざまな側面の対象 3 つの主な対象ユーザーです。</span><span class="sxs-lookup"><span data-stu-id="67a52-148">Various aspects of these APIs target three main audiences;</span></span>

1. <span data-ttu-id="67a52-149">[コンシューマー Api の概要](consumer-apis/overview.md)アプリケーションおよびフレームワークの開発者を対象します。</span><span class="sxs-lookup"><span data-stu-id="67a52-149">The [Consumer APIs Overview](consumer-apis/overview.md) target application and framework developers.</span></span>

   <span data-ttu-id="67a52-150">"しないスタックの動作方法に関するまたはそれを構成する方法について説明します。</span><span class="sxs-lookup"><span data-stu-id="67a52-150">"I don't want to learn about how the stack operates or about how it's configured.</span></span> <span data-ttu-id="67a52-151">単純にする Api を正常に使用する可能性が高い、できるだけ単純なとしてのなんらかの操作方法を実行します。</span><span class="sxs-lookup"><span data-stu-id="67a52-151">I simply want to perform some operation in as simple a manner as possible with high probability of using the APIs successfully."</span></span>

2. <span data-ttu-id="67a52-152">[構成 Api](configuration/overview.md)アプリケーションの開発者およびシステム管理者を対象します。</span><span class="sxs-lookup"><span data-stu-id="67a52-152">The [configuration APIs](configuration/overview.md) target application developers and system administrators.</span></span>

   <span data-ttu-id="67a52-153">「に伝える必要データ保護システムの環境には、既定以外のパスまたはの設定が必要である。」</span><span class="sxs-lookup"><span data-stu-id="67a52-153">"I need to tell the data protection system that my environment requires non-default paths or settings."</span></span>

3. <span data-ttu-id="67a52-154">機能拡張 Api ターゲット開発者は、カスタム ポリシーの実装を担当します。</span><span class="sxs-lookup"><span data-stu-id="67a52-154">The extensibility APIs target developers in charge of implementing custom policy.</span></span> <span data-ttu-id="67a52-155">これらの Api の使用状況はまれな状況に制限されますが発生したため、セキュリティの対応する開発者です。</span><span class="sxs-lookup"><span data-stu-id="67a52-155">Usage of these APIs would be limited to rare situations and experienced, security aware developers.</span></span>

   <span data-ttu-id="67a52-156">"を本当に固有の動作要件があるため、システム内でコンポーネント全体を置き換える必要があります。</span><span class="sxs-lookup"><span data-stu-id="67a52-156">"I need to replace an entire component within the system because I have truly unique behavioral requirements.</span></span> <span data-ttu-id="67a52-157">つもりを自分の要件を満たしているプラグインを構築するために、API サーフェスの uncommonly に使用される部分を参照してください。"</span><span class="sxs-lookup"><span data-stu-id="67a52-157">I am willing to learn uncommonly-used parts of the API surface in order to build a plugin that fulfills my requirements."</span></span>

## <a name="package-layout"></a><span data-ttu-id="67a52-158">パッケージのレイアウト</span><span class="sxs-lookup"><span data-stu-id="67a52-158">Package Layout</span></span>

<span data-ttu-id="67a52-159">データ保護スタックは、5 つのパッケージで構成されます。</span><span class="sxs-lookup"><span data-stu-id="67a52-159">The data protection stack consists of five packages.</span></span>

* <span data-ttu-id="67a52-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span><span class="sxs-lookup"><span data-stu-id="67a52-160">Microsoft.AspNetCore.DataProtection.Abstractions contains the basic IDataProtectionProvider and IDataProtector interfaces.</span></span> <span data-ttu-id="67a52-161">これらの種類 (IDataProtector.Protect のオーバー ロードなど) で作業を支援できる便利拡張メソッドも含まれています。</span><span class="sxs-lookup"><span data-stu-id="67a52-161">It also contains useful extension methods that can assist working with these types (e.g., overloads of IDataProtector.Protect).</span></span> <span data-ttu-id="67a52-162">詳細については、コンシューマー インターフェイスのセクションを参照してください。</span><span class="sxs-lookup"><span data-stu-id="67a52-162">See the consumer interfaces section for more information.</span></span> <span data-ttu-id="67a52-163">場合は、他のユーザーの責任者、データ保護システムをインスタンス化して、Api を使用しているだけで、参照 Microsoft.AspNetCore.DataProtection.Abstractions にします。</span><span class="sxs-lookup"><span data-stu-id="67a52-163">If somebody else is responsible for instantiating the data protection system and you are simply consuming the APIs, you'll want to reference Microsoft.AspNetCore.DataProtection.Abstractions.</span></span>

* <span data-ttu-id="67a52-164">Microsoft.AspNetCore.DataProtection には、暗号化操作の中核となる、キー管理、構成、および機能拡張を含む、データ保護システムの基本的な実装が含まれています。</span><span class="sxs-lookup"><span data-stu-id="67a52-164">Microsoft.AspNetCore.DataProtection contains the core implementation of the data protection system, including the core cryptographic operations, key management, configuration, and extensibility.</span></span> <span data-ttu-id="67a52-165">データ保護システムをインスタンス化を担当する場合 (たとえばに追加する、IServiceCollection) Microsoft.AspNetCore.DataProtection の参照にする変更、またはその動作を拡張する、または。</span><span class="sxs-lookup"><span data-stu-id="67a52-165">If you're responsible for instantiating the data protection system (e.g., adding it to an IServiceCollection) or modifying or extending its behavior, you'll want to reference Microsoft.AspNetCore.DataProtection.</span></span>

* <span data-ttu-id="67a52-166">Microsoft.AspNetCore.DataProtection.Extensions には、開発者が役に立つ場合がありますが、コア パッケージに属していませんが、追加の Api が含まれています。</span><span class="sxs-lookup"><span data-stu-id="67a52-166">Microsoft.AspNetCore.DataProtection.Extensions contains additional APIs which developers might find useful but which don't belong in the core package.</span></span> <span data-ttu-id="67a52-167">たとえば、このパッケージには、単純な「依存関係の挿入設定のない特定のキー記憶域ディレクトリを指しているシステムをインスタンス化」API (詳細) が含まれています。</span><span class="sxs-lookup"><span data-stu-id="67a52-167">For instance, this package contains a simple "instantiate the system pointing at a specific key storage directory with no dependency injection setup" API (more info).</span></span> <span data-ttu-id="67a52-168">保護されたペイロード (詳細) の有効期間を制限するための拡張メソッドも含まれています。</span><span class="sxs-lookup"><span data-stu-id="67a52-168">It also contains extension methods for limiting the lifetime of protected payloads (more info).</span></span>

* <span data-ttu-id="67a52-169">Microsoft.AspNetCore.DataProtection.SystemWeb をリダイレクトする既存の ASP.NET 4.x アプリケーションにインストールすることができます、<machineKey>代わりに、新しいデータ保護スタックを使用する操作。</span><span class="sxs-lookup"><span data-stu-id="67a52-169">Microsoft.AspNetCore.DataProtection.SystemWeb can be installed into an existing ASP.NET 4.x application to redirect its <machineKey> operations to instead use the new data protection stack.</span></span> <span data-ttu-id="67a52-170">参照してください[互換性](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey)詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="67a52-170">See [compatibility](compatibility/replacing-machinekey.md#compatibility-replacing-machinekey) for more information.</span></span>

* <span data-ttu-id="67a52-171">Microsoft.AspNetCore.Cryptography.KeyDerivation は PBKDF2 パスワードのルーチンをハッシュの実装を提供し、ユーザーのパスワードを安全に処理する必要があるシステムで使用できます。</span><span class="sxs-lookup"><span data-stu-id="67a52-171">Microsoft.AspNetCore.Cryptography.KeyDerivation provides an implementation of the PBKDF2 password hashing routine and can be used by systems which need to handle user passwords securely.</span></span> <span data-ttu-id="67a52-172">参照してください[パスワード ハッシュ](consumer-apis/password-hashing.md)詳細についてはします。</span><span class="sxs-lookup"><span data-stu-id="67a52-172">See [Password Hashing](consumer-apis/password-hashing.md) for more information.</span></span>
