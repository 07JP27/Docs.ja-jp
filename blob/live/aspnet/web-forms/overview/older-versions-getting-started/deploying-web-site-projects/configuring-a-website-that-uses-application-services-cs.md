---
uid: web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
title: "アプリケーション サービス (c#) を使用する web サイトの構成 |Microsoft ドキュメント"
author: rick-anderson
description: "ASP.NET version 2.0 では、一連の .NET Framework の一部であるし、構築ブロックのスイート サービス yo として機能するアプリケーション サービスを導入しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/23/2009
ms.topic: article
ms.assetid: 1e33d1c6-3f9f-4c26-81e2-2a8f8907bb05
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-getting-started/deploying-web-site-projects/configuring-a-website-that-uses-application-services-cs
msc.type: authoredcontent
ms.openlocfilehash: 030b0bb218ca05ec270b8fb0a9321e31d9ab5180
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="configuring-a-website-that-uses-application-services-c"></a><span data-ttu-id="2f1be-103">アプリケーション サービス (c#) を使用する web サイトを構成します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-103">Configuring a Website that Uses Application Services (C#)</span></span>
====================
<span data-ttu-id="2f1be-104">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2f1be-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2f1be-105">[コードをダウンロードする](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip)または[PDF のダウンロード](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="2f1be-105">[Download Code](http://download.microsoft.com/download/E/6/F/E6FE3A1F-EE3A-4119-989A-33D1A9F6F6DD/ASPNET_Hosting_Tutorial_09_CS.zip) or [Download PDF](http://download.microsoft.com/download/C/3/9/C391A649-B357-4A7B-BAA4-48C96871FEA6/aspnet_tutorial09_AppServicesConfig_cs.pdf)</span></span>

> <span data-ttu-id="2f1be-106">ASP.NET version 2.0 には、一連の .NET Framework の一部であるし、一連の機能を追加する機能豊富な web アプリケーションに使用できるビルド ブロック サービスとして使用するアプリケーション サービスが導入されました。</span><span class="sxs-lookup"><span data-stu-id="2f1be-106">ASP.NET version 2.0 introduced a series of application services, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="2f1be-107">このチュートリアルでは、アプリケーション サービスを使用する実稼働環境で web サイトを構成する方法について説明をユーザー アカウントと実稼働環境でロールの管理の一般的な問題に対処します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-107">This tutorial explores how to configure a website in the production environment to use application services and addresses common issues with managing user accounts and roles on the production environment.</span></span>


## <a name="introduction"></a><span data-ttu-id="2f1be-108">はじめに</span><span class="sxs-lookup"><span data-stu-id="2f1be-108">Introduction</span></span>

<span data-ttu-id="2f1be-109">ASP.NET version 2.0 に導入された、一連の*アプリケーション サービス*、.NET Framework の一部であるおよびビルディング ブロックのスイート サービスとして機能するが、web アプリケーションに豊富な機能を追加に使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-109">ASP.NET version 2.0 introduced a series of *application services*, which are part of the .NET Framework and serve as a suite of building block services that you can use to add rich functionality to your web application.</span></span> <span data-ttu-id="2f1be-110">アプリケーション サービスは次のとおりです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-110">The application services include:</span></span>

- <span data-ttu-id="2f1be-111">**メンバーシップ**- を作成して、ユーザー アカウントを管理するための API です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-111">**Membership** - an API for creating and managing user accounts.</span></span>
- <span data-ttu-id="2f1be-112">**ロール**- ユーザーをグループに分類するための API です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-112">**Roles** - an API for categorizing users into groups.</span></span>
- <span data-ttu-id="2f1be-113">**プロファイル**- カスタムのユーザーに固有のコンテンツを格納するための API です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-113">**Profile** - an API for storing custom, user-specific content.</span></span>
- <span data-ttu-id="2f1be-114">**サイト マップ**- メニューやパンくずリストなどのナビゲーション コントロールを使用して表示されることができますし、階層構造の形式でサイトの論理構造を定義するための API です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-114">**Site Map** - an API for defining a site s logical structure in the form of a hierarchy, which can then be displayed via navigation controls, such as menus and breadcrumbs.</span></span>
- <span data-ttu-id="2f1be-115">**パーソナル化**- で最もよく使用される、カスタマイズ設定を維持するための API [ *WebParts*](https://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-115">**Personalization** - an API for maintaining customization preferences, most often used with [*WebParts*](https://msdn.microsoft.com/en-us/library/e0s9t4ck.aspx).</span></span>
- <span data-ttu-id="2f1be-116">**正常性の監視**- パフォーマンス、セキュリティ、エラー、および実行中の web アプリケーションの他のシステム正常性メトリックを監視するための API です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-116">**Health Monitoring** - an API for monitoring performance, security, errors, and other system health metrics for a running web application.</span></span>
  

<span data-ttu-id="2f1be-117">アプリケーション サービスの Api は、特定の実装に関連付けられていません。</span><span class="sxs-lookup"><span data-stu-id="2f1be-117">The application services APIs are not tied to a specific implementation.</span></span> <span data-ttu-id="2f1be-118">アプリケーションのサービスを使用して、特定するように指示する代わりに、*プロバイダー*、し、そのプロバイダーが特定のテクノロジを使用して、サービスを実装します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-118">Instead, you instruct the application services to use a particular *provider*, and that provider implements the service using a particular technology.</span></span> <span data-ttu-id="2f1be-119">Web ポータルのホストでホストされているインターネット ベースの web アプリケーションに最もよく使用されるプロバイダーは、SQL Server データベースの実装を使用してこれらのプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-119">The most commonly used providers for Internet-based web applications hosted at a web hosting company are those providers that use a SQL Server database implementation.</span></span> <span data-ttu-id="2f1be-120">たとえば、 `SqlMembershipProvider` Microsoft SQL Server データベースにユーザー アカウント情報を格納するメンバーシップ API 用のプロバイダーです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-120">For example, the `SqlMembershipProvider` is a provider for the Membership API that stores user account information in a Microsoft SQL Server database.</span></span>

<span data-ttu-id="2f1be-121">アプリケーションを展開するときに、いくつかの課題を追加するアプリケーション サービスと SQL Server プロバイダーを使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-121">Using the application services and SQL Server providers adds some challenges when deploying the application.</span></span> <span data-ttu-id="2f1be-122">まず、アプリケーション サービスのデータベース オブジェクトを開発および運用の両方のデータベースで適切に作成し、適切に初期化する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-122">For starters, the application services database objects must be properly created on both the development and production databases and appropriately initialized.</span></span> <span data-ttu-id="2f1be-123">重要な構成設定ができるようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-123">There are also important configuration settings that need to be made.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-124">Api は、使用するように設計されていますが、アプリケーション サービス、 [*プロバイダー モデル*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx)s の API の実行時に提供する実装の詳細をできるようにするデザイン パターンです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-124">The application services APIs were designed using the [*provider model*](http://aspnet.4guysfromrolla.com/articles/101905-1.aspx), a design pattern that allows for an API s implementation details to be provided at runtime.</span></span> <span data-ttu-id="2f1be-125">.NET Framework が使用できるなど、アプリケーション サービス プロバイダーの数が付属しています、`SqlMembershipProvider`と`SqlRoleProvider`メンバーシップは、プロバイダーは、および SQL Server を使用してロール Api のデータベースの実装です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-125">The .NET Framework ships with a number of application service providers that can be used, such as the `SqlMembershipProvider` and `SqlRoleProvider`, which are providers for the Membership and Roles APIs that use a SQL Server database implementation.</span></span> <span data-ttu-id="2f1be-126">作成することもでき、プラグイン、カスタム プロバイダー。</span><span class="sxs-lookup"><span data-stu-id="2f1be-126">You can also create and plug-in a custom provider.</span></span> <span data-ttu-id="2f1be-127">書評 web アプリケーションが既にが実際には、サイト マップ API 用のカスタム プロバイダーを含む (`ReviewSiteMapProvider`)、内のデータからのサイト マップを構築する、`Genres`と`Books`データベース内のテーブルです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-127">In fact, the Book Reviews web application already contains a custom provider for the Site Map API (`ReviewSiteMapProvider`), which constructs the site map from the data in the `Genres` and `Books` tables in the database.</span></span>


<span data-ttu-id="2f1be-128">このチュートリアルは、メンバーシップとロールの Api を使用する書評 web アプリケーションを拡張した方法を見てを開始します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-128">This tutorial starts with a look at how I extended the Book Reviews web application to use the Membership and Roles APIs.</span></span> <span data-ttu-id="2f1be-129">これは、SQL Server データベースの実装でアプリケーション サービスを使用し、最後のユーザー アカウントと実稼働環境でロールを管理する一般的な問題を解決している web アプリケーションを配置する方法をについて説明します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-129">It then walks through deploying a web application that uses application services with a SQL Server database implementation, and concludes by addressing common issues with managing user accounts and roles on the production environment.</span></span>

## <a name="updates-to-the-book-reviews-application"></a><span data-ttu-id="2f1be-130">Book レビュー アプリケーションへの更新</span><span class="sxs-lookup"><span data-stu-id="2f1be-130">Updates to the Book Reviews Application</span></span>

<span data-ttu-id="2f1be-131">過去いくつかを Book レビュー web アプリケーションが、データ ドリブン動的な web アプリケーションに静的な web サイトから更新されたチュートリアルはジャンルとレビューを管理するための管理 ページのセットで完了します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-131">Over the past couple tutorials the Book Reviews web application was updated from a static website to a dynamic, data-driven web application complete with a set of administration pages for managing genres and reviews.</span></span> <span data-ttu-id="2f1be-132">ただし、この管理セクションで現在保護されていません - すべてのユーザーの管理ページの URL を知っている (または推測) ことができますワルツのようにし、作成、編集、またはについては、サイトのレビューを削除します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-132">However, this administration section is currently not protected - any user who knows (or guesses) the administration page URL can waltz in and create, edit, or delete reviews on our site.</span></span> <span data-ttu-id="2f1be-133">Web サイトの特定の部分を保護する一般的な方法では、ユーザー アカウントを実装し、URL 承認規則を使用して、特定のユーザーまたはロールのアクセスを制限します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-133">A common way to protect certain portions of a website is to implement user accounts and then use URL authorization rules to restrict access to certain users or roles.</span></span> <span data-ttu-id="2f1be-134">このチュートリアルをダウンロードできる書評 web アプリケーションでは、ユーザー アカウントとロールをサポートします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-134">The Book Reviews web application available for download with this tutorial supports user accounts and roles.</span></span> <span data-ttu-id="2f1be-135">1 つが定義されているロールに管理者がという名前し、このロールのユーザーのみが管理ページにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-135">It has a single role defined named Admin and only users in this role can access the administration pages.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-136">I ve 書評 web アプリケーションで次の 3 つのユーザー アカウントを作成する: Scott、Jisun、および Alice です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-136">I ve created three user accounts in the Book Reviews web application: Scott, Jisun, and Alice.</span></span> <span data-ttu-id="2f1be-137">次の 3 つのすべてのユーザーに同じパスワードがあります:**パスワードです。**</span><span class="sxs-lookup"><span data-stu-id="2f1be-137">All three users have the same password: **password!**</span></span> <span data-ttu-id="2f1be-138">Scott および Jisun 管理者の役割では、Alice はありません。</span><span class="sxs-lookup"><span data-stu-id="2f1be-138">Scott and Jisun are in the Admin role, Alice is not.</span></span> <span data-ttu-id="2f1be-139">サイト %s の非管理ページは匿名ユーザーにアクセスできます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-139">The site s non-administration pages are still accessible to anonymous users.</span></span> <span data-ttu-id="2f1be-140">つまり、する必要はありません、管理するのでない限り、サイトにサインインする場合は、管理者の役割でのユーザーとしてにサインインする必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-140">That is, you do not need to sign in to visit the site, unless you want to administer it, in which case you must sign in as a user in the Admin role.</span></span>


<span data-ttu-id="2f1be-141">認証および匿名ユーザーの別のユーザー インターフェイスを含める書評アプリケーション s のマスター ページが更新されました。</span><span class="sxs-lookup"><span data-stu-id="2f1be-141">The Book Reviews application s master page has been updated to include a different user interface for authenticated and anonymous users.</span></span> <span data-ttu-id="2f1be-142">匿名ユーザーとして、サイトにアクセスする場合は、右上隅でログイン リンクが表示されます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-142">If an anonymous user visits the site she sees a Login link in the upper right corner.</span></span> <span data-ttu-id="2f1be-143">認証されたユーザーに、メッセージが表示される"こそ*username*!"</span><span class="sxs-lookup"><span data-stu-id="2f1be-143">An authenticated user sees the message, "Welcome back, *username*!"</span></span> <span data-ttu-id="2f1be-144">およびログアウトへのリンク。S ログイン ページもあります (`~/Login.aspx`)、訪問者を認証するためのロジックとユーザー インターフェイスを提供するログイン Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="2f1be-144">and a link to log out. There s also a login page (`~/Login.aspx`), which contains a Login Web control that provides the user interface and logic for authenticating a visitor.</span></span> <span data-ttu-id="2f1be-145">管理者のみには、新しいアカウントを作成できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-145">Only administrators can create new accounts.</span></span> <span data-ttu-id="2f1be-146">(ページの作成および管理でのユーザー アカウントは、`~/Admin`フォルダーです)。</span><span class="sxs-lookup"><span data-stu-id="2f1be-146">(There are pages for creating and managing user accounts in the `~/Admin` folder.)</span></span>

### <a name="configuring-the-membership-and-roles-apis"></a><span data-ttu-id="2f1be-147">メンバーシップとロール Api の構成</span><span class="sxs-lookup"><span data-stu-id="2f1be-147">Configuring the Membership and Roles APIs</span></span>

<span data-ttu-id="2f1be-148">書評 web アプリケーションでは、ユーザー アカウントをサポートするために (つまり、Admin ロール) の役割にそれらのユーザーをグループ化して、メンバーシップとロール Api を使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-148">The Book Reviews web application uses the Membership and Roles APIs to support user accounts and to group those users into roles (namely, the Admin role).</span></span> <span data-ttu-id="2f1be-149">`SqlMembershipProvider`と`SqlRoleProvider`プロバイダー クラスは、SQL Server データベースにアカウントとロールの情報を格納する必要があるために使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-149">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes are used because we want to store account and role information in a SQL Server database.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-150">このチュートリアルは、メンバーシップとロールの Api をサポートするために web アプリケーションを構成する方法の詳細についてでものではありません。</span><span class="sxs-lookup"><span data-stu-id="2f1be-150">This tutorial is not intended to be a detailed examination at configuring a web application to support the Membership and Roles APIs.</span></span> <span data-ttu-id="2f1be-151">これらの Api とそれらを使用する web サイトを構成するために必要な手順を詳しく見るには、「マイ[ *web サイトのセキュリティ チュートリアル*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-151">For a thorough look at these APIs and the steps you need to take to configure a website to use them, please read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>


<span data-ttu-id="2f1be-152">SQL Server データベースとアプリケーション サービスを使用するには、ユーザー アカウントとなるデータベースにこれらのプロバイダーによって使用されるデータベース オブジェクトおよび格納されているロール情報を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-152">To use the application services with a SQL Server database you must first add the database objects used by these providers to the database where you want the user account and role information stored.</span></span> <span data-ttu-id="2f1be-153">これらの必要なデータベース オブジェクトには、さまざまなテーブル、ビュー、およびストアド プロシージャが含まれます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-153">These requisite database objects include a variety of tables, views, and stored procedures.</span></span> <span data-ttu-id="2f1be-154">それ以外の場合、指定されていない限り、`SqlMembershipProvider`と`SqlRoleProvider`プロバイダー クラスは、という名前の SQL Server Express Edition データベースを使用して`ASPNETDB`アプリケーション s 内にある`App_Data`フォルダーですこのようなデータベースが存在しない場合、は自動的に作成。実行時にこれらのプロバイダーで必要なデータベース オブジェクトです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-154">Unless specified otherwise, the `SqlMembershipProvider` and `SqlRoleProvider` provider classes use a SQL Server Express Edition database named `ASPNETDB` located in the application s `App_Data` folder; if such a database does not exist, it is automatically created with the necessary database objects by these providers at runtime.</span></span>

<span data-ttu-id="2f1be-155">アプリケーション サービスの web サイトのアプリケーション固有のデータが格納されている同じデータベース内のデータベース オブジェクトを通常最適で、作成して、可能なです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-155">It is possible, and usually ideal, to create the application services database objects in the same database where the website s application-specific data is stored.</span></span> <span data-ttu-id="2f1be-156">という名前のツールが付属しています、.NET Framework`aspnet_regsql.exe`指定したデータベースでデータベース オブジェクトをインストールします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-156">The .NET Framework ships with a tool named `aspnet_regsql.exe` that installs the database objects on a specified database.</span></span> <span data-ttu-id="2f1be-157">続けてがあり、このツールを使用してこれらのオブジェクトを追加、`Reviews.mdf`データベースに格納されて、`App_Data`フォルダー (開発用データベース)。</span><span class="sxs-lookup"><span data-stu-id="2f1be-157">I have gone ahead and used this tool to add these objects to the `Reviews.mdf` database in the `App_Data` folder (the development database).</span></span> <span data-ttu-id="2f1be-158">実稼働データベースにこれらのオブジェクトを追加する際に、このチュートリアルで後ほどこのツールを使用する方法を会いしましょう。</span><span class="sxs-lookup"><span data-stu-id="2f1be-158">We'll see how to use this tool later in this tutorial when we add these objects to the production database.</span></span>

<span data-ttu-id="2f1be-159">アプリケーションがデータベースにデータベース オブジェクトを以外のサービスを追加する場合`ASPNETDB`をカスタマイズする必要があります、`SqlMembershipProvider`と`SqlRoleProvider`プロバイダーは、適切なデータベースを使用するように構成をクラスです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-159">If you add the application services database objects to a database other than `ASPNETDB` you will need to customize the `SqlMembershipProvider` and `SqlRoleProvider` provider classes configurations so that they use the appropriate database.</span></span> <span data-ttu-id="2f1be-160">メンバーシップ プロバイダーの追加をカスタマイズする、 [ *&lt;メンバーシップ&gt;要素*](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx)内で、 `<system.web>` 」の「 `Web.config`; を使用して、 [ *&lt;roleManager&gt;要素*](https://msdn.microsoft.com/en-us/library/ms164660.aspx)ロール プロバイダーを構成します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-160">To customize the Membership provider add a [*&lt;membership&gt; element*](https://msdn.microsoft.com/en-us/library/1b9hw62f.aspx) within the `<system.web>` section in `Web.config`; use the [*&lt;roleManager&gt; element*](https://msdn.microsoft.com/en-us/library/ms164660.aspx) to configure the Roles provider.</span></span> <span data-ttu-id="2f1be-161">次のスニペットは書評アプリケーション s から取得`Web.config`し、メンバーシップとロール Api の設定の構成を示しています。</span><span class="sxs-lookup"><span data-stu-id="2f1be-161">The following snippet is taken from the Book Reviews application s `Web.config` and shows the configure settings for the Membership and Roles APIs.</span></span> <span data-ttu-id="2f1be-162">注 - 新しいプロバイダーを登録両方`ReviewMembership`と`ReviewRole`-を使用する、`SqlMembershipProvider`と`SqlRoleProvider`プロバイダー、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-162">Note that both register a new provider - `ReviewMembership` and `ReviewRole` - that use the `SqlMembershipProvider` and `SqlRoleProvider` providers, respectively.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample1.xml)]

<span data-ttu-id="2f1be-163">`Web.config`ファイルの`<authentication>`フォーム ベース認証をサポートする要素が構成されてもします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-163">The `Web.config` file s `<authentication>` element has also been configured to support forms-based authentication.</span></span>
  

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample2.xml)]

### <a name="limiting-access-to-the-administration-pages"></a><span data-ttu-id="2f1be-164">管理ページへのアクセスを制限します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-164">Limiting Access to the Administration Pages</span></span>

<span data-ttu-id="2f1be-165">ASP.NET では、簡単に特定のファイルまたはフォルダーのユーザーまたはロールを介してアクセス許可または拒否にその*URL 承認*機能します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-165">ASP.NET makes it easy to grant or deny access to a particular file or folder by user or by role via its *URL authorization* feature.</span></span> <span data-ttu-id="2f1be-166">(で URL の承認に簡単に説明した、*コア違いの間で IIS と ASP.NET 開発サーバー*チュートリアルでは IIS と ASP.NET 開発サーバーが静的に異なる URL 承認規則を適用する方法を示しましたと動的なコンテンツです。) との比較アクセスを禁止する必要があるため、`~/Admin`管理者の役割でそれらのユーザーを除くフォルダーで、このフォルダーに URL 承認規則を追加する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-166">(We briefly discussed URL authorization in the *Core Differences Between IIS and the ASP.NET Development Server* tutorial and showed how IIS and the ASP.NET Development Server apply URL authorization rules differently for static versus dynamic content.) Because we want to prohibit access to the `~/Admin` folder except for those users in the Admin role, we need to add URL authorization rules to this folder.</span></span> <span data-ttu-id="2f1be-167">具体的には、URL 承認規則は、管理者の役割でユーザーを許可およびその他のすべてのユーザーを拒否する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-167">Specifically, the URL authorization rules need to allow users in the Admin role and deny all other users.</span></span> <span data-ttu-id="2f1be-168">追加することでこれを行う、`Web.config`ファイルの名前を`~/Admin`フォルダーで、次の内容。</span><span class="sxs-lookup"><span data-stu-id="2f1be-168">This is accomplished by adding a `Web.config` file to the `~/Admin` folder with the following contents:</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample3.xml)]

<span data-ttu-id="2f1be-169">ASP.NET の URL の承認機能とユーザー ロールの場合は、承認規則を綴るの使用方法の詳細については必ずを読み取る、 [*ユーザー ベースの承認*](../../older-versions-security/membership/user-based-authorization-cs.md)と[*ロールベース承認*](../../older-versions-security/roles/role-based-authorization-cs.md)からチュートリアル my [ *web サイトのセキュリティ チュートリアル*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-169">For more information on ASP.NET s URL authorization feature and how to use it to spell out authorization rules for users and for roles, be sure to read the [*User-Based Authorization*](../../older-versions-security/membership/user-based-authorization-cs.md) and [*Role-Based Authorization*](../../older-versions-security/roles/role-based-authorization-cs.md) tutorials from my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span>

## <a name="deploying-a-web-application-that-uses-application-services"></a><span data-ttu-id="2f1be-170">アプリケーション サービスを使用する Web アプリケーションを展開します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-170">Deploying a Web Application That Uses Application Services</span></span>

<span data-ttu-id="2f1be-171">アプリケーション サービスとアプリケーション サービス情報を格納するデータベースのプロバイダーを使用する web サイトを展開するときに、実稼働データベースで、アプリケーション サービスで必要なデータベース オブジェクトを作成することが不可欠です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-171">When deploying a website that uses application services and a provider that stores the application services information in a database, it is imperative that the database objects needed by the application services be created on the production database.</span></span> <span data-ttu-id="2f1be-172">最初に、実稼働データベースにが含まれていないこれらのオブジェクト、そのため、アプリケーションが最初に展開されたときに (またはアプリケーション サービスを追加した後は、最初に配置されるとき)、これらの必要なデータベース オブジェクトを取得する追加の手順を行う必要があります、実稼働データベースです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-172">Initially the production database does not contain these objects, so when the application is first deployed (or when it is deployed for the first time after application services have been added), you must take extra steps to get these requisite database objects on the production database.</span></span>

<span data-ttu-id="2f1be-173">課題の 1 つは、運用環境に開発環境で作成されたユーザー アカウントをレプリケートする場合は、アプリケーション サービスを使用する web サイトを展開するときに発生します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-173">Another challenge can arise when deploying a website that uses application services if you intend to replicate the user accounts created in the development environment to the production environment.</span></span> <span data-ttu-id="2f1be-174">メンバーシップとロールの構成に応じて、可能であれば、実稼働データベースを開発環境で作成されたユーザー アカウントを正常にコピーする場合でも、これらのユーザーが実稼働環境で web アプリケーションにサインインできないことです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-174">Depending on the Membership and Roles configuration, it is possible that even if you successfully copy the user accounts that were created in the development environment to the production database, these users cannot sign into the web application in production.</span></span> <span data-ttu-id="2f1be-175">この問題の原因を拝見し、防ぐ方法について説明します。、</span><span class="sxs-lookup"><span data-stu-id="2f1be-175">We'll look at the cause of this issue and discuss how to prevent it from happening.</span></span>

<span data-ttu-id="2f1be-176">ASP.NET 付属、nice [ *Web サイト管理ツール (WSAT)* ](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx)を Visual Studio から起動できるでき、ユーザー アカウント、ロール、および承認の規則を web ベースで管理します。インターフェイスです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-176">ASP.NET ships with a nice [*Web Site Administration Tool (WSAT)*](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx) that can be launched from Visual Studio and allows the user account, roles, and authorization rules to be managed through a web-based interface.</span></span> <span data-ttu-id="2f1be-177">残念ながら、WSAT だけが、ローカルの web サイト、ユーザー アカウント、ロール、および実稼働環境で web アプリケーションの承認規則をリモート管理を使用できないことを意味します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-177">Unfortunately, the WSAT only works for local websites, meaning that it cannot be used to remotely manage user accounts, roles, and authorization rules for the web application in the production environment.</span></span> <span data-ttu-id="2f1be-178">実稼働 web サイトから WSAT のような動作を実装する方法に紹介します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-178">We'll look at different ways to implement WSAT-like behavior from your production website.</span></span>

### <a name="adding-the-database-objects-using-aspnetregsqlexe"></a><span data-ttu-id="2f1be-179">データベース オブジェクトを使用して aspnet を追加する\_regsql.exe</span><span class="sxs-lookup"><span data-stu-id="2f1be-179">Adding the Database Objects Using aspnet\_regsql.exe</span></span>

<span data-ttu-id="2f1be-180">*データベースの配置*チュートリアルでは、開発用データベースからテーブルとデータを実稼働データベースにコピーする方法を示しましたし、これらの手法は、アプリケーション サービス データベース オブジェクトのコピーを確実に使用できます、実稼働データベースです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-180">The *Deploying a Database* tutorial showed how to copy the tables and data from the development database to the production database, and these techniques can certainly be used to copy the application services database objects to the production database.</span></span> <span data-ttu-id="2f1be-181">別のオプションは、`aspnet_regsql.exe`ツールを追加またはデータベースからアプリケーション サービスのデータベース オブジェクトを削除します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-181">Another option is the `aspnet_regsql.exe` tool, which adds or removes the application services database objects from a database.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-182">`aspnet_regsql.exe`ツールは、指定したデータベースでデータベース オブジェクトを作成します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-182">The `aspnet_regsql.exe` tool creates the database objects on a specified database.</span></span> <span data-ttu-id="2f1be-183">これは移行されませんでは、データベース オブジェクトのデータ、開発用データベースから、実稼働データベースに。</span><span class="sxs-lookup"><span data-stu-id="2f1be-183">It does not migrate data in those database objects from the development database to the production database.</span></span> <span data-ttu-id="2f1be-184">開発用データベースのユーザー アカウントとロール情報を実稼働データベースにコピーすることを意味する場合で説明する方法を使用して、*データベースの配置*チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-184">If you mean to copy the user account and role information in the development database to the production database use the techniques covered in the *Deploying a Database* tutorial.</span></span>


<span data-ttu-id="2f1be-185">使用して実稼働データベースにデータベース オブジェクトを追加する方法を見て s をできるように、`aspnet_regsql.exe`ツールです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-185">Let s look at how to add the database objects to the production database using the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="2f1be-186">Windows エクスプ ローラーを開き、%WINDIR%\ コンピューターに .NET Framework version 2.0 のディレクトリに移動して開始します。Microsoft.NET\Framework\v2.0.50727 です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-186">Start by opening Windows Explorer and navigating to the .NET Framework version 2.0 directory on your computer, %WINDIR%\ Microsoft.NET\Framework\v2.0.50727.</span></span> <span data-ttu-id="2f1be-187">存在する必要がありますが見つかったら、`aspnet_regsql.exe`ツールです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-187">There you should find the `aspnet_regsql.exe` tool.</span></span> <span data-ttu-id="2f1be-188">コマンドラインからこのツールを使用することができますが、グラフィカル ユーザー インターフェイスも含まれています。ダブルクリックして、`aspnet_regsql.exe`グラフィカルなコンポーネントを起動するファイル。</span><span class="sxs-lookup"><span data-stu-id="2f1be-188">This tool can be used from the command-line, but it also includes a graphical user interface; double-click the `aspnet_regsql.exe` file to launch its graphical component.</span></span>

<span data-ttu-id="2f1be-189">その目的を説明するスプラッシュ画面を表示することによって、ツールを開始します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-189">The tool starts by displaying a splash screen explaining its purpose.</span></span> <span data-ttu-id="2f1be-190">「セットアップ オプションを選択して」画面で、図 1 に示す前払い金の横にあるをクリックします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-190">Click Next to advance to the "Select a Setup Option" screen, which is shown in Figure 1.</span></span> <span data-ttu-id="2f1be-191">ここでは、データベース オブジェクトか、データベースから削除して、アプリケーション サービスを追加できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-191">From here you can choose to add the application services database objects or remove them from a database.</span></span> <span data-ttu-id="2f1be-192">ため、実稼働データベースにこれらのオブジェクトを追加する、"アプリケーション サービスの SQL Server を構成する"オプションを選択し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-192">Because we want to add these objects to the production database, select the "Configure SQL Server for application services" option and click Next.</span></span>


<span data-ttu-id="2f1be-193">[![アプリケーション サービスの SQL Server を構成します。](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span><span class="sxs-lookup"><span data-stu-id="2f1be-193">[![Choose to Configure SQL Server for Application Services](configuring-a-website-that-uses-application-services-cs/_static/image2.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image1.jpg)</span></span>

<span data-ttu-id="2f1be-194">**図 1**: アプリケーション サービスの SQL Server の構成を選択 ([フルサイズのイメージを表示するをクリックして](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span><span class="sxs-lookup"><span data-stu-id="2f1be-194">**Figure 1**: Choose to Configure SQL Server for Application Services ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image3.jpg))</span></span>


<span data-ttu-id="2f1be-195">「サーバーとデータベースの選択」で画面は、については、データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-195">In "Select the Server and Database" screen prompts for information to connect to the database.</span></span> <span data-ttu-id="2f1be-196">データベース サーバー、セキュリティ資格情報と、web ホスティング会社によって提供されたデータベース名を入力し、[次へ] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-196">Enter the database server, the security credentials, and the database name supplied to you by your web hosting company and click Next.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-197">データベース サーバーと資格情報を入力した後にデータベースのボックスの一覧を展開するときにエラーが表示することがあります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-197">After entering your database server and credentials you may get an error when expanding the database drop-down list.</span></span> <span data-ttu-id="2f1be-198">`aspnet_regsql.exe`ツールのクエリ、`sysdatabases`システム テーブルに、サーバーがこの情報が公開しないように、データベース サーバーを企業ロックダウンをホストしている一部の web 上のデータベースの一覧を取得します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-198">The `aspnet_regsql.exe` tool queries the `sysdatabases` system table to retrieve a list of databases on the server, but some web hosting companies lock down their database servers so that this information is not publicly available.</span></span> <span data-ttu-id="2f1be-199">このエラーが発生した場合は、ドロップダウン リストに直接、データベース名を入力できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-199">If you get this error you can type the database name directly into the drop-down list.</span></span>


<span data-ttu-id="2f1be-200">[![データベースの接続情報とツールを提供します。](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span><span class="sxs-lookup"><span data-stu-id="2f1be-200">[![Supply the Tool With Your Database s Connection Information](configuring-a-website-that-uses-application-services-cs/_static/image5.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image4.jpg)</span></span>

<span data-ttu-id="2f1be-201">**図 2**: ツールでデータベースの接続情報を指定 ([フルサイズのイメージを表示するをクリックして](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span><span class="sxs-lookup"><span data-stu-id="2f1be-201">**Figure 2**: Supply the Tool With Your Database s Connection Information ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image6.jpg))</span></span>


<span data-ttu-id="2f1be-202">後続の画面は、アプリケーション サービスのデータベース オブジェクトは、指定されたデータベースに追加することを行う、つまりされるアクションにまとめます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-202">The subsequent screen summarizes the actions that are about to take place, namely that the application services database objects are going to be added to the specified database.</span></span> <span data-ttu-id="2f1be-203">この操作の完了の横にある をクリックします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-203">Click Next to complete this action.</span></span> <span data-ttu-id="2f1be-204">しばらくすると、最後の画面が表示されます、(図 3 を参照してください)、データベース オブジェクトが追加されたことに注意してください。</span><span class="sxs-lookup"><span data-stu-id="2f1be-204">After a few moments, the final screen is displayed, noting that the database objects have been added (see Figure 3).</span></span>


<span data-ttu-id="2f1be-205">[![正常にされました。アプリケーション サービスのデータベース オブジェクトが、実稼働データベースに追加されました。](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span><span class="sxs-lookup"><span data-stu-id="2f1be-205">[![Success! The Application Services Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image8.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image7.jpg)</span></span>

<span data-ttu-id="2f1be-206">**図 3**: 成功!</span><span class="sxs-lookup"><span data-stu-id="2f1be-206">**Figure 3**: Success!</span></span> <span data-ttu-id="2f1be-207">アプリケーション サービス データベース オブジェクトに追加された、実稼働データベース ([フルサイズのイメージを表示するをクリックして](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span><span class="sxs-lookup"><span data-stu-id="2f1be-207">The Application Services Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image9.jpg))</span></span>


<span data-ttu-id="2f1be-208">アプリケーション サービスのデータベース オブジェクトが、実稼働データベースに正常に追加されたことを確認するため、SQL Server Management Studio を開き、実稼働データベースに接続します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-208">To verify that the application services database objects were successfully added to the production database, open SQL Server Management Studio and connect to your production database.</span></span> <span data-ttu-id="2f1be-209">図 4 に示すようになりましたアプリケーション サービス データベース テーブルに表示、データベース`aspnet_Applications`、 `aspnet_Membership`、`aspnet_Users`などのようにします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-209">As Figure 4 shows, you should now see the application services database tables in your database, `aspnet_Applications`, `aspnet_Membership`, `aspnet_Users`, and so forth.</span></span>


<span data-ttu-id="2f1be-210">[![データベース オブジェクトが、実稼働データベースに追加されたことを確認します。](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span><span class="sxs-lookup"><span data-stu-id="2f1be-210">[![Confirm That the Database Objects Were Added to the Production Database](configuring-a-website-that-uses-application-services-cs/_static/image11.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image10.jpg)</span></span>

<span data-ttu-id="2f1be-211">**図 4**: データベース オブジェクトが、実稼働データベースに追加されたことを確認 ([フルサイズのイメージを表示するをクリックして](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span><span class="sxs-lookup"><span data-stu-id="2f1be-211">**Figure 4**: Confirm That the Database Objects Were Added to the Production Database ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image12.jpg))</span></span>


<span data-ttu-id="2f1be-212">使用する必要がありますのみ、`aspnet_regsql.exe`ツールを初めて、または最初にアプリケーション サービスの使用を開始した後、web アプリケーションを展開するときにします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-212">You will only need to use the `aspnet_regsql.exe` tool when deploying your web application for the first time or for the first time after you have started using the application services.</span></span> <span data-ttu-id="2f1be-213">後のこれらのデータベース オブジェクトが、実稼働データベースでは、再追加または変更する必要が勝利しました。</span><span class="sxs-lookup"><span data-stu-id="2f1be-213">Once these database objects are on the production database they won t need to be re-added or modified.</span></span>

### <a name="copying-user-accounts-from-development-to-production"></a><span data-ttu-id="2f1be-214">開発環境から実稼働環境にユーザー アカウントのコピー</span><span class="sxs-lookup"><span data-stu-id="2f1be-214">Copying User Accounts from Development to Production</span></span>

<span data-ttu-id="2f1be-215">使用する場合、`SqlMembershipProvider`と`SqlRoleProvider`アプリケーション サービス情報、SQL Server データベースに格納するプロバイダー クラスを含むデータベース テーブルのさまざまな種類でユーザー アカウントとロールの情報が格納されている`aspnet_Users`、 `aspnet_Membership`、`aspnet_Roles`、および`aspnet_UsersInRoles`、その他。</span><span class="sxs-lookup"><span data-stu-id="2f1be-215">When using the `SqlMembershipProvider` and `SqlRoleProvider` provider classes to store the application services information in a SQL Server database, the user account and role information is stored in a variety of database tables, including `aspnet_Users`, `aspnet_Membership`, `aspnet_Roles`, and `aspnet_UsersInRoles`, among others.</span></span> <span data-ttu-id="2f1be-216">開発時に、開発環境でユーザー アカウントを作成する場合は、該当するデータベース テーブルから対応するレコードをコピーして実稼働環境でそれらのユーザー アカウントをレプリケートできます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-216">If during development you create user accounts in the development environment you can replicate those user accounts in production by copying the corresponding records from the applicable database tables.</span></span> <span data-ttu-id="2f1be-217">データベース パブリッシュ ウィザードを使用するアプリケーション サービスのデータベース オブジェクトを展開する場合可能性がありますもことを選択したレコードをコピーします、開発も上にある実稼働環境で作成したユーザー アカウントになります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-217">If you used the Database Publishing Wizard to deploy the application services database objects you may have also elected to copy the records, which would result in the user accounts created in development to also be on production.</span></span> <span data-ttu-id="2f1be-218">ただし、構成の設定に応じてそれらのユーザー アカウントを持つため開発で作成した、実稼働環境にコピーが、実稼働 web サイトからのログインことができないことを見つける可能性があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-218">But, depending on your configuration settings, you may find that those users whose accounts were created in development and copied to production are unable to login from the production website.</span></span> <span data-ttu-id="2f1be-219">なぜでしょう。</span><span class="sxs-lookup"><span data-stu-id="2f1be-219">What gives?</span></span>

<span data-ttu-id="2f1be-220">`SqlMembershipProvider`と`SqlRoleProvider`プロバイダー クラスは、1 つのデータベースとして使用ユーザーのストアの複数のアプリケーションに、理論上、各アプリケーションがでした場所がある重複しているユーザー名を持つユーザーと同じ名前を持つロールになるように設計されました。</span><span class="sxs-lookup"><span data-stu-id="2f1be-220">The `SqlMembershipProvider` and `SqlRoleProvider` provider classes were designed such that a single database could serve as a user store for multiple applications, where each application could, in theory, have users with overlapping usernames and roles with the same name.</span></span> <span data-ttu-id="2f1be-221">このような柔軟性を許容するデータベースでのアプリケーションの一覧を保持、`aspnet_Applications`テーブル、および各ユーザーは、これらのアプリケーションに関連付けられています。</span><span class="sxs-lookup"><span data-stu-id="2f1be-221">To allow for this flexibility, the database maintains a list of applications in the `aspnet_Applications` table, and each user is associated with one of these applications.</span></span> <span data-ttu-id="2f1be-222">具体的には、`aspnet_Users`テーブルには、`ApplicationId`内のレコードには、各ユーザーに結合する列、`aspnet_Applications`テーブル。</span><span class="sxs-lookup"><span data-stu-id="2f1be-222">Specifically, the `aspnet_Users` table has an `ApplicationId` column that ties each user to a record in the `aspnet_Applications` table.</span></span>

<span data-ttu-id="2f1be-223">加え、`ApplicationId`列で、`aspnet_Applications`テーブルも含まれています、`ApplicationName`列で、アプリケーションのよりわかりやすい名前を提供します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-223">In addition to the `ApplicationId` column, the `aspnet_Applications` table also includes an `ApplicationName` column, which provides a more human-friendly name for the application.</span></span> <span data-ttu-id="2f1be-224">Web サイトが区別する必要がありますログイン ページで、ユーザーの資格情報の検証などのユーザー アカウントを使用しようとしたときに、`SqlMembershipProvider`クラスを使用するには、どのようなアプリケーションです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-224">When a website attempts to work with a user account, such as validating a user s credentials from the login page, it must tell the `SqlMembershipProvider` class what application to work with.</span></span> <span data-ttu-id="2f1be-225">通常は、アプリケーション名を指定することによってこれと、この値は内のプロバイダーの構成から取得`Web.config`経由で具体的には、`applicationName`属性。</span><span class="sxs-lookup"><span data-stu-id="2f1be-225">It usually does this by supplying the application name, and the this value comes from the provider s configuration in `Web.config` - specifically via the `applicationName` attribute.</span></span>

<span data-ttu-id="2f1be-226">どうすれば、`applicationName`で属性が指定されていない`Web.config`しますか?</span><span class="sxs-lookup"><span data-stu-id="2f1be-226">But what happens if the `applicationName` attribute is not specified in `Web.config`?</span></span> <span data-ttu-id="2f1be-227">このような場合は、メンバーシップ システム パスを使用して、アプリケーション ルートとして、`applicationName`値。</span><span class="sxs-lookup"><span data-stu-id="2f1be-227">In such a case the Membership system uses the application root path as the `applicationName` value.</span></span> <span data-ttu-id="2f1be-228">場合、`applicationName`属性が明示的に設定されていない`Web.config`、次に、開発環境と運用環境は別のアプリケーション ルートを使用し、そのため、別のアプリケーションに関連付けられる可能性があります。アプリケーション サービスの名前です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-228">If the `applicationName` attribute is not explicitly set in `Web.config`, then, there is the possibility that the development environment and production environment use a different application root and therefore will be associated with different application names in the application services.</span></span> <span data-ttu-id="2f1be-229">開発環境で作成されたユーザーの場合は、このような不一致が発生した場合、`ApplicationId`と一致しない値、`ApplicationId`運用環境の値。</span><span class="sxs-lookup"><span data-stu-id="2f1be-229">If such a mismatch occurs then those users created in the development environment will have an `ApplicationId` value that does not match with the `ApplicationId` value for the production environment.</span></span> <span data-ttu-id="2f1be-230">最終的な結果は、t が勝利したそれらのユーザーが、ログインできることです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-230">The net result is that those users won t be able to login.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-231">ならなくなった場合、この状況で、一致しないと実稼働環境にコピーするユーザー アカウントを使って`ApplicationId`値 - 正しくないこれらを更新するクエリを記述することも`ApplicationId`値を`ApplicationId`実稼働環境で使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-231">If you find yourself in this situation - with user accounts copied to production with a mismatched `ApplicationId` value - you could write a query to update these incorrect `ApplicationId` values to the `ApplicationId` used on production.</span></span> <span data-ttu-id="2f1be-232">更新されると、開発環境で作成されたアカウントを持つユーザーは運用上の web アプリケーションにサインインできるはようになりました。</span><span class="sxs-lookup"><span data-stu-id="2f1be-232">Once updated, the users whose accounts were created on the development environment would now be able to sign into the web application on production.</span></span>


<span data-ttu-id="2f1be-233">良いニュースは、同じ 2 つの環境を使用していることを確認するために行える、簡単な手順が`ApplicationId`- 明示的に設定されて、`applicationName`属性`Web.config`アプリケーション サービス プロバイダーのすべてのです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-233">The good news is that there is a simple step you can take to ensure that the two environments use the same `ApplicationId` - explicitly set the `applicationName` attribute in `Web.config` for all of your application services providers.</span></span> <span data-ttu-id="2f1be-234">明示的に設定すれば、`applicationName`で属性"BookReviews"を`<membership>`と`<roleManager>`要素からこのスニペットとして`Web.config`を示しています。</span><span class="sxs-lookup"><span data-stu-id="2f1be-234">I explicitly set the `applicationName` attribute to "BookReviews" in the `<membership>` and `<roleManager>` elements as this snippet from `Web.config` shows.</span></span>

[!code-xml[Main](configuring-a-website-that-uses-application-services-cs/samples/sample4.xml)]

<span data-ttu-id="2f1be-235">設定の詳細については、`applicationName`属性と、その背後にある論理的根拠を参照してください[ *Scott Guthrie* ](https://weblogs.asp.net/scottgu/) s ブログの投稿「 [*常 applicationName を設定します。ASP.NET メンバーシップとその他のプロバイダーを構成するときにプロパティ*](https://weblogs.asp.net/scottgu/443634)です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-235">For more discussion on setting the `applicationName` attribute and the rationale behind it, refer to [*Scott Guthrie*](https://weblogs.asp.net/scottgu/) s blog post, [*Always set the applicationName property when configuring ASP.NET Membership and other Providers*](https://weblogs.asp.net/scottgu/443634).</span></span>

### <a name="managing-user-accounts-in-the-production-environment"></a><span data-ttu-id="2f1be-236">実稼働環境でユーザー アカウントの管理</span><span class="sxs-lookup"><span data-stu-id="2f1be-236">Managing User Accounts in the Production Environment</span></span>

<span data-ttu-id="2f1be-237">ASP.NET Web サイト管理ツール (WSAT) を容易に作成し、ユーザー アカウントの管理、定義しロールを適用および略さずにユーザーおよびロール ベースの承認規則にします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-237">The ASP.NET Web Site Administration Tool (WSAT) makes it easy to create and manage user accounts, define and apply roles, and spell out user- and role-based authorization rules.</span></span> <span data-ttu-id="2f1be-238">Visual Studio から WSAT を起動するには、ソリューション エクスプ ローラーに移動し、ASP.NET の構成のアイコンをクリックして、または web サイトまたはプロジェクトのメニューに移動し、ASP.NET の構成のメニュー項目を選択します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-238">You can launch the WSAT from Visual Studio by going to the Solution Explorer and clicking the ASP.NET Configuration icon or by going to the Website or Project menus and selecting the ASP.NET Configuration menu item.</span></span> <span data-ttu-id="2f1be-239">残念ながら、WSAT はローカルの web サイトでのみ機能できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-239">Unfortunately, the WSAT can only work with local websites.</span></span> <span data-ttu-id="2f1be-240">したがって、実稼働環境で web サイトを管理するのに、ワークステーションから、WSAT を使用できません。</span><span class="sxs-lookup"><span data-stu-id="2f1be-240">Therefore, you cannot use the WSAT from your workstation to manage the website in the production environment.</span></span>

<span data-ttu-id="2f1be-241">良いニュースは、公開される機能の WSAT によって提供されるすべてが、メンバーシップとロール Api にプログラムを使用できることさらに、WSAT 画面の多くは、標準の ASP.NET ログインに関連するコントロールを使用します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-241">The good news is that all of the functionality exposed provided by the WSAT is available programmatically through the Membership and Roles APIs; furthermore, many of the WSAT screens use the standard ASP.NET Login-related controls.</span></span> <span data-ttu-id="2f1be-242">つまり、必要な管理機能を提供する web サイトに、ASP.NET ページを追加できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-242">In short, you can add ASP.NET pages to your website that offer the necessary management capabilities.</span></span>

<span data-ttu-id="2f1be-243">以前のチュートリアルを含めるように書評 web アプリケーションを更新することに注意してください、`~/Admin`フォルダー、およびこのフォルダーは、ユーザーを管理者の役割でのみ許可に構成されています。</span><span class="sxs-lookup"><span data-stu-id="2f1be-243">Recall that an earlier tutorial updated the Book Reviews web application to include an `~/Admin` folder, and this folder has been configured to only allow users in the Admin role.</span></span> <span data-ttu-id="2f1be-244">そのフォルダーに、ページを追加した`CreateAccount.aspx`からを管理者が新しいユーザー アカウントを作成します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-244">I added a page to that folder named `CreateAccount.aspx` from which an administrator can create a new user account.</span></span> <span data-ttu-id="2f1be-245">このページでは、CreateUserWizard コントロールを使用して、新しいユーザー アカウントを作成するためのユーザー インターフェイスとバックエンド ロジックを表示します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-245">This page uses the CreateUserWizard control to display the user interface and backend logic for creating a new user account.</span></span> <span data-ttu-id="2f1be-246">含める新しいユーザーは、管理者ロールにも追加する必要があるかどうかを要求する チェック ボックス コントロールをカスタマイズする、どのような s (図 5 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="2f1be-246">What s more, I customized the control to include a CheckBox that prompts whether the new user should also be added to the Admin role (see Figure 5).</span></span> <span data-ttu-id="2f1be-247">少しの作業では、ユーザーおよびロール管理に関連するタスクは、それ以外の場合、WSAT によって提供されることを実装するページのカスタム セットを構築できます。</span><span class="sxs-lookup"><span data-stu-id="2f1be-247">With a little bit of work you can build a custom set of pages that implements the user and role management-related tasks that would otherwise be provided by the WSAT.</span></span>

> [!NOTE]
> <span data-ttu-id="2f1be-248">詳細については、ログインに関連する ASP.NET Web コントロールと共に、メンバーシップとロールの Api を使用して上を必ずお読みのマイ[ *web サイトのセキュリティのチュートリアル*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)です。</span><span class="sxs-lookup"><span data-stu-id="2f1be-248">For more information on using the Membership and Roles APIs along with the Login-related ASP.NET Web controls, be sure to read my [*Website Security Tutorials*](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md).</span></span> <span data-ttu-id="2f1be-249">CreateUserWizard コントロールをカスタマイズする方法の詳細を参照してください、 [*ユーザー アカウントを作成する*](../../older-versions-security/membership/creating-user-accounts-cs.md)と[*追加のユーザー情報を格納する*](../../older-versions-security/membership/storing-additional-user-information-cs.md)チュートリアルについては、またはチェック アウト[ *Erich peterson と一緒にお届け*](http://www.erichpeterson.com/) s 記事[ *CreateUserWizard コントロールのカスタマイズ*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span><span class="sxs-lookup"><span data-stu-id="2f1be-249">For more on customizing the CreateUserWizard control refer to the [*Creating User Accounts*](../../older-versions-security/membership/creating-user-accounts-cs.md) and [*Storing Additional User Information*](../../older-versions-security/membership/storing-additional-user-information-cs.md) tutorials, or check out [*Erich Peterson*](http://www.erichpeterson.com/) s article, [*Customizing the CreateUserWizard Control*](http://aspnet.4guysfromrolla.com/articles/070506-1.aspx).</span></span>


<span data-ttu-id="2f1be-250">[![管理者は、新しいユーザー アカウントを作成できます。](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span><span class="sxs-lookup"><span data-stu-id="2f1be-250">[![Administrators Can Create New User Accounts](configuring-a-website-that-uses-application-services-cs/_static/image14.jpg)](configuring-a-website-that-uses-application-services-cs/_static/image13.jpg)</span></span>

<span data-ttu-id="2f1be-251">**図 5**: 管理者が新しいユーザー アカウントを作成 ([フルサイズのイメージを表示するをクリックして](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span><span class="sxs-lookup"><span data-stu-id="2f1be-251">**Figure 5**: Administrators Can Create New User Accounts ([Click to view full-size image](configuring-a-website-that-uses-application-services-cs/_static/image15.jpg))</span></span>


<span data-ttu-id="2f1be-252">WSAT チェック アウトのすべての機能が必要なかどうかは[*ローリング、独自の Web サイト管理ツール*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)著者の Dan Clem 順を追ってカスタム WSAT のようなツールを構築するプロセスです。</span><span class="sxs-lookup"><span data-stu-id="2f1be-252">If you need the full functionality of the WSAT check out [*Rolling Your Own Web Site Administration Tool*](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx), in which author Dan Clem walks through the process of building a custom WSAT-like tool.</span></span> <span data-ttu-id="2f1be-253">Dan は彼アプリケーションのソース コード (C# の場合) を共有し、ホストされる web サイトに追加するための手順を提供します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-253">Dan shares his application s source code (in C#) and provides step-by-step instructions for adding it to your hosted website.</span></span>

## <a name="summary"></a><span data-ttu-id="2f1be-254">概要</span><span class="sxs-lookup"><span data-stu-id="2f1be-254">Summary</span></span>

<span data-ttu-id="2f1be-255">アプリケーション サービス データベースの実装を使用する web アプリケーションを展開するときにまず、実稼働データベースが必要なデータベース オブジェクトを持つことを確認する必要があります。</span><span class="sxs-lookup"><span data-stu-id="2f1be-255">When deploying a web application that uses the application services database implementation you must first ensure that the production database has the requisite database objects.</span></span> <span data-ttu-id="2f1be-256">説明した手法を使用してこれらのオブジェクトを追加することができます、*データベースの配置*チュートリアルです。 また、使用することができます、`aspnet_regsql.exe`ツール、このチュートリアルで示したようにします。</span><span class="sxs-lookup"><span data-stu-id="2f1be-256">These objects can be added using the techniques discussed in the *Deploying a Database* tutorial; alternatively, you can use the `aspnet_regsql.exe` tool, as we saw in this tutorial.</span></span> <span data-ttu-id="2f1be-257">(これは重要なは、実稼働環境では有効にするには、ユーザーと、開発環境で作成されたロールの場合)、開発および運用環境との手法で使用されるアプリケーション名の同期を中心に説明した他の課題ユーザーと、実稼働環境でロールを管理します。</span><span class="sxs-lookup"><span data-stu-id="2f1be-257">Other challenges we touched on center around synchronizing the application name used in the development and production environments (which is important if you want users and roles created in the development environment to be valid on production) and techniques for managing the users and roles in the production environment.</span></span>

<span data-ttu-id="2f1be-258">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="2f1be-258">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="2f1be-259">関連項目</span><span class="sxs-lookup"><span data-stu-id="2f1be-259">Further Reading</span></span>

<span data-ttu-id="2f1be-260">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="2f1be-260">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2f1be-261">*ASP.NET SQL Server の登録ツール (aspnet_regsql.exe)*</span><span class="sxs-lookup"><span data-stu-id="2f1be-261">*ASP.NET SQL Server Registration Tool (aspnet_regsql.exe)*</span></span>](https://msdn.microsoft.com/en-us/library/ms229862.aspx)
- [<span data-ttu-id="2f1be-262">*SQL Server 用のアプリケーション サービス データベースを作成します。*</span><span class="sxs-lookup"><span data-stu-id="2f1be-262">*Creating the Application Services Database for SQL Server*</span></span>](https://msdn.microsoft.com/en-us/library/x28wfk74.aspx)
- [<span data-ttu-id="2f1be-263">*SQL Server でのメンバーシップのスキーマの作成*</span><span class="sxs-lookup"><span data-stu-id="2f1be-263">*Creating the Membership Schema in SQL Server*</span></span>](../../older-versions-security/membership/creating-the-membership-schema-in-sql-server-cs.md)
- [<span data-ttu-id="2f1be-264">*ASP.NET のメンバーシップ、ロール、およびプロファイルを確認します。*</span><span class="sxs-lookup"><span data-stu-id="2f1be-264">*Examining ASP.NET s Membership, Roles, and Profile*</span></span>](http://aspnet.4guysfromrolla.com/articles/120705-1.aspx)
- [<span data-ttu-id="2f1be-265">*独自の Web サイト管理ツールのローリング*</span><span class="sxs-lookup"><span data-stu-id="2f1be-265">*Rolling Your Own Web Site Administration Tool*</span></span>](http://aspnet.4guysfromrolla.com/articles/052307-1.aspx)
- [<span data-ttu-id="2f1be-266">*Web サイトのセキュリティのチュートリアル*</span><span class="sxs-lookup"><span data-stu-id="2f1be-266">*Website Security Tutorials*</span></span>](../../older-versions-security/introduction/security-basics-and-asp-net-support-cs.md)
- [<span data-ttu-id="2f1be-267">*Web サイト管理ツールの概要*</span><span class="sxs-lookup"><span data-stu-id="2f1be-267">*Web Site Administration Tool Overview*</span></span>](https://msdn.microsoft.com/en-us/library/yy40ytx0.aspx)

>[!div class="step-by-step"]
<span data-ttu-id="2f1be-268">[前へ](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[次へ](strategies-for-database-development-and-deployment-cs.md)</span><span class="sxs-lookup"><span data-stu-id="2f1be-268">[Previous](configuring-the-production-web-application-to-use-the-production-database-cs.md)
[Next](strategies-for-database-development-and-deployment-cs.md)</span></span>
