---
uid: web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
title: "回復して、パスワード (VB) の変更 |Microsoft ドキュメント"
author: rick-anderson
description: "ASP.NET には、復旧し、パスワードの変更を支援するための 2 つの Web コントロールが含まれています。 PasswordRecovery コントロールは、彼失わ pa を回復するビジターを使用しています."
ms.author: aspnetcontent
manager: wpickett
ms.date: 04/01/2008
ms.topic: article
ms.assetid: f9adcb5d-6d70-4885-a3bf-ed95efb4da1a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/admin/recovering-and-changing-passwords-vb
msc.type: authoredcontent
ms.openlocfilehash: f7f6e7e4bc3a8cc7e70911bc22a28d385f762af0
ms.sourcegitcommit: 9a9483aceb34591c97451997036a9120c3fe2baf
ms.translationtype: MT
ms.contentlocale: ja-JP
ms.lasthandoff: 11/10/2017
---
<a name="recovering-and-changing-passwords-vb"></a><span data-ttu-id="7291f-104">回復して、パスワード (VB) の変更</span><span class="sxs-lookup"><span data-stu-id="7291f-104">Recovering and Changing Passwords (VB)</span></span>
====================
<span data-ttu-id="7291f-105">によって[Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="7291f-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="7291f-106">[コードをダウンロードする](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip)または[PDF のダウンロード](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="7291f-106">[Download Code](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/VB.13.zip) or [Download PDF](http://download.microsoft.com/download/6/0/e/60e1bd94-e5f9-4d5a-a079-f23c98f4f67d/aspnet_tutorial13_ChangingPasswords_vb.pdf)</span></span>

> <span data-ttu-id="7291f-107">ASP.NET には、復旧し、パスワードの変更を支援するための 2 つの Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7291f-107">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="7291f-108">PasswordRecovery コントロールを使用すると、失われたパスワードを回復する訪問者。</span><span class="sxs-lookup"><span data-stu-id="7291f-108">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="7291f-109">ChangePassword コントロールは、自分のパスワードを更新するユーザーを使用します。</span><span class="sxs-lookup"><span data-stu-id="7291f-109">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="7291f-110">その他のログインに関連する Web コントロールと同様にこれまで見てきたこのチュートリアル シリーズ、PasswordRecovery 全体および ChangePassword がバック グラウンドでユーザーのパスワードをリセットまたは変更メンバーシップ framework での作業を制御します。</span><span class="sxs-lookup"><span data-stu-id="7291f-110">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>


## <a name="introduction"></a><span data-ttu-id="7291f-111">はじめに</span><span class="sxs-lookup"><span data-stu-id="7291f-111">Introduction</span></span>

<span data-ttu-id="7291f-112">マイ銀行、電力会社、電話会社、電子メール アカウント、および個人用に設定された web ポータルの web サイトの間で、ほとんどの人と同様にある多数の異なるパスワードしか記憶します。</span><span class="sxs-lookup"><span data-stu-id="7291f-112">Between the websites for my bank, utility company, phone company, email accounts, and personalized web portals, I, like most people, have dozens of different passwords to remember.</span></span> <span data-ttu-id="7291f-113">最近を記憶する非常に多くの資格情報でユーザーが自分のパスワードを忘れたをためは珍しいことではありません。</span><span class="sxs-lookup"><span data-stu-id="7291f-113">With so many credentials to memorize these days, it's not uncommon for people to forget their password.</span></span> <span data-ttu-id="7291f-114">このアカウントには、ユーザー アカウントを提供している web サイトをユーザーが自分のパスワードを回復する方法を含める必要があります。</span><span class="sxs-lookup"><span data-stu-id="7291f-114">To account for this, websites that offer user accounts need to include a way for a user to recover his password.</span></span> <span data-ttu-id="7291f-115">通常、このプロセスには、新しいランダムなパスワードを生成して、ファイル上のユーザーの電子メール アドレスに電子メールが含まれます。</span><span class="sxs-lookup"><span data-stu-id="7291f-115">This process typically involves generating a new, random password and emailing it to the user's email address on file.</span></span> <span data-ttu-id="7291f-116">新しいパスワードを受信した後ほとんどのユーザー サイトに戻り、パスワードを変更して、覚えやすいものにランダムに生成されたものです。</span><span class="sxs-lookup"><span data-stu-id="7291f-116">After receiving their new password most users return to the site and change their password from the randomly generated one to a more memorable one.</span></span>

<span data-ttu-id="7291f-117">ASP.NET には、復旧し、パスワードの変更を支援するための 2 つの Web コントロールが含まれています。</span><span class="sxs-lookup"><span data-stu-id="7291f-117">ASP.NET includes two Web controls for assisting with recovering and changing passwords.</span></span> <span data-ttu-id="7291f-118">PasswordRecovery コントロールを使用すると、失われたパスワードを回復する訪問者。</span><span class="sxs-lookup"><span data-stu-id="7291f-118">The PasswordRecovery control enables a visitor to recover his lost password.</span></span> <span data-ttu-id="7291f-119">ChangePassword コントロールは、自分のパスワードを更新するユーザーを使用します。</span><span class="sxs-lookup"><span data-stu-id="7291f-119">The ChangePassword control allows the user to update his password.</span></span> <span data-ttu-id="7291f-120">その他のログインに関連する Web コントロールと同様にこれまで見てきたこのチュートリアル シリーズ、PasswordRecovery 全体および ChangePassword がバック グラウンドでユーザーのパスワードをリセットまたは変更メンバーシップ framework での作業を制御します。</span><span class="sxs-lookup"><span data-stu-id="7291f-120">Like the other Login-related Web controls we've seen throughout this tutorial series, the PasswordRecovery and ChangePassword controls work with the Membership framework behind the scenes to reset or modify users' passwords.</span></span>

<span data-ttu-id="7291f-121">このチュートリアルでは、これら 2 つのコントロールの使い方を見ていきます。</span><span class="sxs-lookup"><span data-stu-id="7291f-121">In this tutorial we will examine using these two controls.</span></span> <span data-ttu-id="7291f-122">表示されています。 プログラムで変更してからユーザーのパスワードをリセットする方法、`MembershipUser`クラスの`ChangePassword`と`ResetPassword`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7291f-122">We will also see how to programmatically change and reset a user's password via the `MembershipUser` class's `ChangePassword` and `ResetPassword` methods.</span></span>

## <a name="step-1-helping-users-recover-lost-passwords"></a><span data-ttu-id="7291f-123">手順 1: 支援ユーザー回復パスワードを紛失</span><span class="sxs-lookup"><span data-stu-id="7291f-123">Step 1: Helping Users Recover Lost Passwords</span></span>

<span data-ttu-id="7291f-124">ユーザー アカウントをサポートするすべての web サイトは、ユーザーのパスワードを忘れた場合に回復するための機構を提供する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7291f-124">All websites that support user accounts need to provide users with some mechanism for recovering their forgotten passwords.</span></span> <span data-ttu-id="7291f-125">良いニュースは、ASP.NET でこのような機能を実装する PasswordRecovery Web コントロール感謝もとても簡単です。</span><span class="sxs-lookup"><span data-stu-id="7291f-125">The good news is that implementing such functionality in ASP.NET is a breeze thanks to the PasswordRecovery Web control.</span></span> <span data-ttu-id="7291f-126">PasswordRecovery コントロールは、ユーザー名、ユーザーを要求するインターフェイスを表示し、それらのセキュリティの質問に対する回答が必要な場合です。</span><span class="sxs-lookup"><span data-stu-id="7291f-126">The PasswordRecovery control renders an interface that prompts the user for their username and, if needed, the answer to their security question.</span></span> <span data-ttu-id="7291f-127">これをメールで送信、ユーザーのパスワード。</span><span class="sxs-lookup"><span data-stu-id="7291f-127">It then emails the user their password.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-128">電子メール メッセージにプレーン テキストでネットワーク経由で送信されるのでセキュリティ上のリスクが電子メールでユーザーのパスワードを送信するに関係します。</span><span class="sxs-lookup"><span data-stu-id="7291f-128">Because email messages are transmitted over the wire in plain-text there are security risks involved with sending a user's password via email.</span></span>


<span data-ttu-id="7291f-129">PasswordRecovery コントロールは、3 つのビューで構成されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-129">The PasswordRecovery control consists of three views:</span></span>

- <span data-ttu-id="7291f-130">**ユーザー名**-ビジター、ユーザー名を求められます。</span><span class="sxs-lookup"><span data-stu-id="7291f-130">**UserName** - prompts the visitor for their username.</span></span> <span data-ttu-id="7291f-131">これは、最初のビューです。</span><span class="sxs-lookup"><span data-stu-id="7291f-131">This is the initial view.</span></span>
- <span data-ttu-id="7291f-132">**質問**-ユーザーのセキュリティの質問に対する回答を入力するためのテキスト ボックスと、テキストとしてユーザーのユーザー名とセキュリティの質問が表示されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-132">**Question**- displays the user's username and security question as text, along with a TextBox for the user to enter the answer to his security question.</span></span>
- <span data-ttu-id="7291f-133">**成功**-自分のパスワードは電子メールで送信されたユーザーに通知メッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-133">**Success**- displays a message informing the user that his password has been emailed.</span></span>

<span data-ttu-id="7291f-134">ビューが表示され、PasswordRecovery コントロールによって実行される操作は、次のメンバーシップ構成設定によって異なります。</span><span class="sxs-lookup"><span data-stu-id="7291f-134">The views displayed and actions performed by the PasswordRecovery control depend upon the following Membership configuration settings:</span></span>

- `RequiresQuestionAndAnswer`
- `EnablePasswordRetrieval`
- `EnablePasswordReset`

<span data-ttu-id="7291f-135">メンバーシップ フレームワークの`RequiresQuestionAndAnswer`設定では、アカウントの登録時に、セキュリティの質問と回答を指定する必要があるかどうかを示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-135">The Membership framework's `RequiresQuestionAndAnswer` setting indicates whether users must specify a security question and answer when registering for an account.</span></span> <span data-ttu-id="7291f-136">説明したよう、 <a id="_msoanchor_1"> </a> [*ユーザー アカウントを作成する*](../membership/creating-user-accounts-vb.md)チュートリアル、if`RequiresQuestionAndAnswer`が True (既定値) CreateUserWizard のインターフェイスには、テキスト ボックスが含まれています。新しいユーザーのセキュリティの質問と回答; のコントロール場合`RequiresQuestionAndAnswer`false で、このような情報は収集されません。</span><span class="sxs-lookup"><span data-stu-id="7291f-136">As we discussed in the <a id="_msoanchor_1"></a>[*Creating User Accounts*](../membership/creating-user-accounts-vb.md) tutorial, if `RequiresQuestionAndAnswer` is True (the default) then the CreateUserWizard's interface includes TextBox controls for the new user's security question and answer; if `RequiresQuestionAndAnswer` is False, no such information is collected.</span></span> <span data-ttu-id="7291f-137">同様に場合、`RequiresQuestionAndAnswer`が true の場合、ユーザーが、ユーザー名を入力した後に、質問を表示 PasswordRecovery コントロールの表示以外のパスワードを回復すると、ユーザーが正しいセキュリティ返答を入力した場合にのみです。</span><span class="sxs-lookup"><span data-stu-id="7291f-137">Similarly, if `RequiresQuestionAndAnswer` is True, then the PasswordRecovery control displays the Question view after the user has entered their username; the password is recovered only if the user enters the correct security answer.</span></span> <span data-ttu-id="7291f-138">場合`RequiresQuestionAndAnswer`が False で、ただし、PasswordRecovery コントロール、ユーザー名ビューから直接、成功がビューに移動します。</span><span class="sxs-lookup"><span data-stu-id="7291f-138">If `RequiresQuestionAndAnswer` is False, however, the PasswordRecovery control moves straight from the UserName view to the Success view.</span></span>

<span data-ttu-id="7291f-139">場合、ユーザーを自分のユーザー名、または自分のユーザー名とセキュリティの回答が提供後`RequiresQuestionAndAnswer`PasswordRecovery True では、自分のパスワードをユーザーに電子メール。</span><span class="sxs-lookup"><span data-stu-id="7291f-139">After the user has provided his username - or his username and security answer, if `RequiresQuestionAndAnswer` is True - the PasswordRecovery emails the user his password.</span></span> <span data-ttu-id="7291f-140">場合、`EnablePasswordRetrieval`オプションが True に設定し、ユーザーが、現在のパスワードを電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="7291f-140">If the `EnablePasswordRetrieval` option is set to True, then the user is emailed their current password.</span></span> <span data-ttu-id="7291f-141">False に設定されている場合と`EnablePasswordReset`PasswordRecovery コントロールは、ユーザーの新しいランダムなパスワードを生成し、この新しいパスワードに電子メールで送信し、True に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-141">If it is set to False and `EnablePasswordReset` is set to True, then the PasswordRecovery control generates a new, random password for the user, and emails this new password to them.</span></span> <span data-ttu-id="7291f-142">両方`EnablePasswordRetrieval`と`EnablePasswordReset`false、PasswordRecovery コントロールが例外をスローします。</span><span class="sxs-lookup"><span data-stu-id="7291f-142">If both `EnablePasswordRetrieval` and `EnablePasswordReset` are False, the PasswordRecovery control throws an exception.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-143">注意してください、 `SqlMembershipProvider` 3 つの形式のいずれかでユーザーのパスワードを保存します。: オフ、Hashed (既定)、または暗号化します。</span><span class="sxs-lookup"><span data-stu-id="7291f-143">Recall that the `SqlMembershipProvider` stores users' passwords in one of three formats: Clear, Hashed (the default), or Encrypted.</span></span> <span data-ttu-id="7291f-144">使用記憶域メカニズムは、メンバーシップの構成設定によって異なります。デモ アプリケーションでは、Hashed パスワードの形式を使用します。</span><span class="sxs-lookup"><span data-stu-id="7291f-144">The storage mechanism used depends on the Membership configuration settings; the demo application uses the Hashed password format.</span></span> <span data-ttu-id="7291f-145">Hashed パスワードの形式を使用する場合、`EnablePasswordRetrieval`オプションは、システムは、データベースに格納されているハッシュのバージョンから、ユーザーの実際のパスワードを決定できないために、False に設定する必要があります。</span><span class="sxs-lookup"><span data-stu-id="7291f-145">When using the Hashed password format the `EnablePasswordRetrieval` option must be set to False because the system cannot determine the user's actual password from the hashed version stored in the database.</span></span>


<span data-ttu-id="7291f-146">図 1 は、どのように PasswordRecovery のインターフェイスと動作が影響を受けますメンバーシップの構成を示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-146">Figure 1 illustrates how the PasswordRecovery's interface and behavior is influenced by the Membership configuration.</span></span>


<span data-ttu-id="7291f-147">[![RequiresQuestionAndAnswer、EnablePasswordRetrieval、および EnablePasswordReset PasswordRecovery コントロールの外観と動作に影響を与える](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-147">[![The RequiresQuestionAndAnswer, EnablePasswordRetrieval, and EnablePasswordReset Influence the PasswordRecovery control's Appearance and Behavior](recovering-and-changing-passwords-vb/_static/image2.png)](recovering-and-changing-passwords-vb/_static/image1.png)</span></span>

<span data-ttu-id="7291f-148">**図 1**: `RequiresQuestionAndAnswer`、 `EnablePasswordRetrieval`、および`EnablePasswordReset`PasswordRecovery コントロールの外観と動作に影響を与える ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-148">**Figure 1**: The `RequiresQuestionAndAnswer`, `EnablePasswordRetrieval`, and `EnablePasswordReset` Influence the PasswordRecovery control's Appearance and Behavior  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image3.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7291f-149"><a id="_msoanchor_2"> </a> [*メンバーシップ スキーマを作成する SQL Server で*](../membership/creating-the-membership-schema-in-sql-server-vb.md)チュートリアルを設定してメンバーシップ プロバイダーを構成しました`RequiresQuestionAndAnswer`を True に`EnablePasswordRetrieval`にFalse の場合、および`EnablePasswordReset`True に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-149">In the <a id="_msoanchor_2"></a>[*Creating the Membership Schema in SQL Server*](../membership/creating-the-membership-schema-in-sql-server-vb.md) tutorial we configured the Membership provider by setting `RequiresQuestionAndAnswer` to True, `EnablePasswordRetrieval` to False, and `EnablePasswordReset` to True.</span></span>


### <a name="using-the-passwordrecovery-control"></a><span data-ttu-id="7291f-150">PasswordRecovery コントロールの使用</span><span class="sxs-lookup"><span data-stu-id="7291f-150">Using the PasswordRecovery Control</span></span>

<span data-ttu-id="7291f-151">ASP.NET ページで PasswordRecovery コントロールの使用を見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="7291f-151">Let's look at using the PasswordRecovery control in an ASP.NET page.</span></span> <span data-ttu-id="7291f-152">開いている`RecoverPassword.aspx`とドラッグおよび PasswordRecovery コントロールをツールボックスからデザイナーにドロップの設定、`ID`に`RecoverPwd`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-152">Open `RecoverPassword.aspx` and drag and drop a PasswordRecovery control from the Toolbox onto the Designer; set its `ID` to `RecoverPwd`.</span></span> <span data-ttu-id="7291f-153">ログインと CreateUserWizard Web コントロールと同様には、PasswordRecovery コントロールのビューは、ラベル、テキスト ボックス、ボタン、および検証コントロールが含まれる豊富な複合インターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="7291f-153">Like the Login and CreateUserWizard Web controls, the PasswordRecovery control's views render a rich composite interface that includes Labels, TextBoxes, Buttons, and validation controls.</span></span> <span data-ttu-id="7291f-154">コントロールのスタイル プロパティまたはビューをテンプレートに変換することによって、ビューの外観をカスタマイズすることができます。</span><span class="sxs-lookup"><span data-stu-id="7291f-154">You can customize the appearance of the views through the control's style properties or by converting the views into templates.</span></span> <span data-ttu-id="7291f-155">I のままに練習として、興味のリーダーの。</span><span class="sxs-lookup"><span data-stu-id="7291f-155">I leave this as an exercise for the interested reader.</span></span>

<span data-ttu-id="7291f-156">ユーザーがこのページを訪問したときに、自分のユーザー名を入力し、送信ボタンをクリックして彼女はします。</span><span class="sxs-lookup"><span data-stu-id="7291f-156">When a user visits this page she will enter her username and click the Submit button.</span></span> <span data-ttu-id="7291f-157">設定したため、`RequiresQuestionAndAnswer`プロパティをメンバーシップの構成設定、PasswordRecovery で True を制御し、質問ビューを表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-157">Because we have set the `RequiresQuestionAndAnswer` property to True in our Membership configuration settings, the PasswordRecovery control will then display the Question view.</span></span> <span data-ttu-id="7291f-158">ユーザーは自分正しいセキュリティ返答を入力し、送信をクリックすると、PasswordRecovery コントロールをランダムに生成されたものでは、ユーザーのパスワードを更新し、ファイル上の電子メール アドレスにこのパスワードを電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="7291f-158">After the user enters her correct security answer and clicks Submit, the PasswordRecovery control will update the user's password to a randomly-generated one, and email this password to the email address on file.</span></span> <span data-ttu-id="7291f-159">これはすべてできました私たちが 1 行のコードを記述することです。</span><span class="sxs-lookup"><span data-stu-id="7291f-159">All of this was possible without us having to write a single line of code!</span></span>

<span data-ttu-id="7291f-160">このページをテストする前にしようとする構成の最後の 1 つの部分がある: メール配信の設定を指定する必要があります`Web.config`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-160">Before you test this page, there's one final piece of configuration to tend to: we need to specify the mail delivery settings in `Web.config`.</span></span> <span data-ttu-id="7291f-161">PasswordRecovery コントロールは、電子メールを送信するため、これらの設定に依存します。</span><span class="sxs-lookup"><span data-stu-id="7291f-161">The PasswordRecovery control relies on these settings for sending the email.</span></span>

<span data-ttu-id="7291f-162">メール配信の構成を指定、 [ `<system.net>`要素](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx)の[`<mailSettings>`要素](https://msdn.microsoft.com/en-us/library/w355a94k.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-162">The mail delivery configuration is specified through the [`<system.net>` element](https://msdn.microsoft.com/en-us/library/6484zdc1.aspx)'s [`<mailSettings>` element](https://msdn.microsoft.com/en-us/library/w355a94k.aspx).</span></span> <span data-ttu-id="7291f-163">使用して、 [ `<smtp>`要素](https://msdn.microsoft.com/en-us/library/ms164240.aspx)配信方法とそのアドレスから既定値を示すためにします。</span><span class="sxs-lookup"><span data-stu-id="7291f-163">Use the [`<smtp>` element](https://msdn.microsoft.com/en-us/library/ms164240.aspx) to indicate the delivery method and the default From address.</span></span> <span data-ttu-id="7291f-164">次のマークアップがという名前のネットワークの SMTP サーバーを使用するメールの設定を構成`smtp.example.com`ポート 25 でユーザー名とパスワードのユーザー名/パスワードの資格情報を使用しています。</span><span class="sxs-lookup"><span data-stu-id="7291f-164">The following markup configures mail settings to use a network SMTP server named `smtp.example.com` on port 25 and with username/password credentials of username and password.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-165">`<system.net>`ルートの子要素は、`<configuration>`要素との兄弟`<system.web>`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-165">`<system.net>` is a child element of the root `<configuration>` element and a sibling of `<system.web>`.</span></span> <span data-ttu-id="7291f-166">そのため、配置しない、`<system.net>`内の要素、`<system.web>`要素です。 代わりに、同じレベルに配置します。</span><span class="sxs-lookup"><span data-stu-id="7291f-166">Therefore, do not put the `<system.net>` element within the `<system.web>` element; instead, put it at the same level.</span></span>


[!code-xml[Main](recovering-and-changing-passwords-vb/samples/sample1.xml)]

<span data-ttu-id="7291f-167">に加えて、ネットワーク上の SMTP サーバーを使用して、別の方法として、ピックアップ ディレクトリを送信する電子メール メッセージの格納場所を指定できます。</span><span class="sxs-lookup"><span data-stu-id="7291f-167">In addition to using an SMTP server on the network, you can alternatively specify a pickup directory where email messages to be sent should be deposited.</span></span>

<span data-ttu-id="7291f-168">SMTP 設定を構成した場合を参照してください。、`RecoverPassword.aspx`ページがブラウザーを使用します。</span><span class="sxs-lookup"><span data-stu-id="7291f-168">Once you have configured the SMTP settings, visit the `RecoverPassword.aspx` page through a browser.</span></span> <span data-ttu-id="7291f-169">まず、ユーザー ストアに存在しないユーザー名を入力してください。</span><span class="sxs-lookup"><span data-stu-id="7291f-169">First try entering a username that doesn't exist in the user store.</span></span> <span data-ttu-id="7291f-170">図 2 に示す PasswordRecovery コントロールには、ユーザー情報にアクセスできなかったことを示すメッセージが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-170">As Figure 2 shows, the PasswordRecovery control displays a message indicating that the user information could not be accessed.</span></span> <span data-ttu-id="7291f-171">コントロールのメッセージのテキストをカスタマイズできる[`UserNameFailureText`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-171">The text of the message can be customized through the control's [`UserNameFailureText` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.usernamefailuretext.aspx).</span></span>


<span data-ttu-id="7291f-172">[![無効なユーザー名が入力した場合、エラー メッセージが表示されます。](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-172">[![An Error Message is Displayed if an Invalid Username is Entered](recovering-and-changing-passwords-vb/_static/image5.png)](recovering-and-changing-passwords-vb/_static/image4.png)</span></span>

<span data-ttu-id="7291f-173">**図 2**: 無効なユーザー名が入力した場合、エラー メッセージが表示されます ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-173">**Figure 2**: An Error Message is Displayed if an Invalid Username is Entered  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image6.png))</span></span>


<span data-ttu-id="7291f-174">ここで、ユーザー名を入力します。</span><span class="sxs-lookup"><span data-stu-id="7291f-174">Now enter a username.</span></span> <span data-ttu-id="7291f-175">電子メール アドレス アクセスでき、セキュリティの回答することで、システム内のアカウントのユーザー名の確認に使用します。</span><span class="sxs-lookup"><span data-stu-id="7291f-175">Use the username of an account in the system with an email address that you can access and whose security answer you know.</span></span> <span data-ttu-id="7291f-176">ユーザー名を入力し、送信をクリックして、後に、PasswordRecovery コントロールは、その質問ビューを表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-176">After entering the username and clicking Submit, the PasswordRecovery control displays its Question view.</span></span> <span data-ttu-id="7291f-177">としてと、ユーザー名ビューを入力する場合、正しくない回答、PasswordRecovery コントロールが表示されます (図 3 を参照してください) を示すエラー メッセージします。</span><span class="sxs-lookup"><span data-stu-id="7291f-177">As with the UserName view, if you enter an incorrect answer the PasswordRecovery control displays an error message (see Figure 3).</span></span> <span data-ttu-id="7291f-178">使用して、 [ `QuestionFailureText`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx)このエラー メッセージをカスタマイズします。</span><span class="sxs-lookup"><span data-stu-id="7291f-178">Use the [`QuestionFailureText` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.questionfailuretext.aspx) to customize this error message.</span></span>


<span data-ttu-id="7291f-179">[![ユーザーが、無効なセキュリティ返答を入力した場合、エラー メッセージが表示されます。](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-179">[![An Error Message is Displayed if the User Enters an Invalid Security Answer](recovering-and-changing-passwords-vb/_static/image8.png)](recovering-and-changing-passwords-vb/_static/image7.png)</span></span>

<span data-ttu-id="7291f-180">**図 3**: ユーザーが、無効なセキュリティ返答を入力した場合、エラー メッセージが表示されます ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-180">**Figure 3**: An Error Message is Displayed if the User Enters an Invalid Security Answer  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image9.png))</span></span>


<span data-ttu-id="7291f-181">最後に、適切なセキュリティ返答を入力し、[送信] をクリックします。</span><span class="sxs-lookup"><span data-stu-id="7291f-181">Finally, enter the correct security answer and click Submit.</span></span> <span data-ttu-id="7291f-182">背後では、PasswordRecovery コントロール ランダム パスワードを生成、ユーザー アカウントに割り当てます、その新しいパスワードのユーザーに通知電子メールを送信 (図 4 を参照)、し、成功ビューを表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-182">Behind the scenes, the PasswordRecovery control generates a random password, assigns it to the user account, sends an email informing the user of their new password (see Figure 4), and then displays the Success view.</span></span>


<span data-ttu-id="7291f-183">[![ユーザーが His の新しいパスワードを使用して電子メールを送信します。](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-183">[![The User is Sent an Email with His New Password](recovering-and-changing-passwords-vb/_static/image11.png)](recovering-and-changing-passwords-vb/_static/image10.png)</span></span>

<span data-ttu-id="7291f-184">**図 4**: ユーザーは His の新しいパスワードを使用して電子メールを送信 ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-184">**Figure 4**: The User is Sent an Email with His New Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image12.png))</span></span>


### <a name="customizing-the-email"></a><span data-ttu-id="7291f-185">電子メールのカスタマイズ</span><span class="sxs-lookup"><span data-stu-id="7291f-185">Customizing the Email</span></span>

<span data-ttu-id="7291f-186">PasswordRecovery コントロールによって送信される既定の電子メールではなく鈍い (図 4 を参照) です。</span><span class="sxs-lookup"><span data-stu-id="7291f-186">The default email sent by the PasswordRecovery control is rather dull (see Figure 4).</span></span> <span data-ttu-id="7291f-187">メッセージがで指定されたアカウントから送信された、`<smtp>`要素の`from`サブジェクトのパスワードを持つ属性と、プレーン テキスト本文。</span><span class="sxs-lookup"><span data-stu-id="7291f-187">The message is sent from the account specified in the `<smtp>` element's `from` attribute with the subject Password and the plain-text body:</span></span>

<span data-ttu-id="7291f-188">サイトに戻り、次の情報を使用してログインしてください。</span><span class="sxs-lookup"><span data-stu-id="7291f-188">Please return to the site and log in using the following information.</span></span>

<span data-ttu-id="7291f-189">ユーザー名:*ユーザー名*</span><span class="sxs-lookup"><span data-stu-id="7291f-189">User Name: *username*</span></span>

<span data-ttu-id="7291f-190">パスワード:*パスワード*</span><span class="sxs-lookup"><span data-stu-id="7291f-190">Password: *password*</span></span>

<span data-ttu-id="7291f-191">このメッセージは PasswordRecovery コントロールのイベント ハンドラーによってプログラムでカスタマイズできる[`SendingMail`イベント](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx)、を通じて宣言的または、 [ `MailDefinition`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-191">This message can be customized programmatically through an event handler for the PasswordRecovery control's [`SendingMail` event](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.sendingmail.aspx), or declaratively through the [`MailDefinition` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.passwordrecovery.maildefinition.aspx).</span></span> <span data-ttu-id="7291f-192">これらのオプションのいずれも見てみましょう。</span><span class="sxs-lookup"><span data-stu-id="7291f-192">Let's explore both of these options.</span></span>

<span data-ttu-id="7291f-193">`SendingMail`イベントが発生する直前に、電子メール メッセージが送信され、最後のチャンスをプログラムによって電子メール メッセージを調整します。</span><span class="sxs-lookup"><span data-stu-id="7291f-193">The `SendingMail` event is fired right before the email message is sent and is our last chance to programmatically adjust the email message.</span></span> <span data-ttu-id="7291f-194">このイベントが発生したときに、イベント ハンドラーが渡される型のオブジェクト[ `MailMessageEventArgs`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.mailmessageeventargs.aspx)が`Message`プロパティには、送信する電子メールへの参照が含まれています。</span><span class="sxs-lookup"><span data-stu-id="7291f-194">When this event is raised, the event handler is passed an object of type [`MailMessageEventArgs`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.mailmessageeventargs.aspx), whose `Message` property contains a reference to the email about to be sent.</span></span>

<span data-ttu-id="7291f-195">イベント ハンドラーを作成、`SendingMail`イベント プログラムで追加する次のコードを追加および`webmaster@example.com`[cc] 一覧にします。</span><span class="sxs-lookup"><span data-stu-id="7291f-195">Create an event handler for the `SendingMail` event and add the following code, which programmatically adds `webmaster@example.com` to the CC list.</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample2.vb)]

<span data-ttu-id="7291f-196">宣言型の方法で、電子メール メッセージを構成することもできます。</span><span class="sxs-lookup"><span data-stu-id="7291f-196">The email message can also be configured through declarative means.</span></span> <span data-ttu-id="7291f-197">PasswordRecovery の`MailDefinition`プロパティは、オブジェクトの種類の[ `MailDefinition`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-197">The PasswordRecovery's `MailDefinition` property is an object of type [`MailDefinition`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.aspx).</span></span> <span data-ttu-id="7291f-198">`MailDefinition`クラスには、ホストを含む、電子メールに関連するプロパティの`From`、 `CC`、 `Priority`、 `Subject`、 `IsBodyHtml`、 `BodyFileName`、およびその他。</span><span class="sxs-lookup"><span data-stu-id="7291f-198">The `MailDefinition` class offers a host of email-related properties, including `From`, `CC`, `Priority`, `Subject`, `IsBodyHtml`, `BodyFileName`, and others.</span></span> <span data-ttu-id="7291f-199">まず、設定、 [ `Subject`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.subject.aspx)(パスワード) が既定では、パスワードがリセットされたなどに使用されるものよりもわかりやすいものにしています.</span><span class="sxs-lookup"><span data-stu-id="7291f-199">For starters, set the [`Subject` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.subject.aspx) to something more descriptive than the one used by default ( Password ), such as Your password has been reset...</span></span>

<span data-ttu-id="7291f-200">別の電子メール テンプレート ファイルを作成する必要があります、電子メール メッセージの本文をカスタマイズするには、本文の内容を含むです。</span><span class="sxs-lookup"><span data-stu-id="7291f-200">To customize the body of the email message we need to create a separate email template file that contains the body's contents.</span></span> <span data-ttu-id="7291f-201">という名前の web サイトに新しいフォルダーを作成して開始`EmailTemplates`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-201">Start by creating a new folder in the website named `EmailTemplates`.</span></span> <span data-ttu-id="7291f-202">次に、このという名前のフォルダーに新しいテキスト ファイルを追加`PasswordRecovery.txt`し、次のコンテンツを追加します。</span><span class="sxs-lookup"><span data-stu-id="7291f-202">Next, add a new text file to this folder named `PasswordRecovery.txt` and add the following content:</span></span>

[!code-aspx[Main](recovering-and-changing-passwords-vb/samples/sample3.aspx)]

<span data-ttu-id="7291f-203">プレース ホルダーの使用に注意してください`<%UserName%>`と`<%Password%>`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-203">Note the use of the placeholders `<%UserName%>` and `<%Password%>`.</span></span> <span data-ttu-id="7291f-204">PasswordRecovery コントロールは、ユーザーのユーザー名と電子メールを送信する前に回復パスワードで自動的にこれら 2 つのプレース ホルダーを置き換えます。</span><span class="sxs-lookup"><span data-stu-id="7291f-204">The PasswordRecovery control automatically replaces these two placeholders with the user's username and recovered password prior to sending the email.</span></span>

<span data-ttu-id="7291f-205">最後に、ポイント、`MailDefinition`の[`BodyFileName`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx)先ほど作成した、電子メール通知テンプレートを (`~/EmailTemplates/PasswordRecovery.txt`)。</span><span class="sxs-lookup"><span data-stu-id="7291f-205">Lastly, point the `MailDefinition`'s [`BodyFileName` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.bodyfilename.aspx) to the email template we just created (`~/EmailTemplates/PasswordRecovery.txt`).</span></span>

<span data-ttu-id="7291f-206">これらの変更見直す後、`RecoverPassword.aspx`ページし、ユーザー名とセキュリティの回答を入力します。</span><span class="sxs-lookup"><span data-stu-id="7291f-206">After making these changes revisit the `RecoverPassword.aspx` page and enter your username and security answer.</span></span> <span data-ttu-id="7291f-207">受信した電子メールを次の図 5 のようにする必要があります。</span><span class="sxs-lookup"><span data-stu-id="7291f-207">You receive should an email that looks like the one in Figure 5.</span></span> <span data-ttu-id="7291f-208">なお`webmaster@example.com`[cc]、および件名と本文が更新されていることにしました。</span><span class="sxs-lookup"><span data-stu-id="7291f-208">Note that `webmaster@example.com` has been CC'd and that the subject and body have been updated.</span></span>


<span data-ttu-id="7291f-209">[![件名、本文、および [cc] ボックスの一覧が更新されました](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-209">[![The Subject, Body, and CC List Have Been Updated](recovering-and-changing-passwords-vb/_static/image14.png)](recovering-and-changing-passwords-vb/_static/image13.png)</span></span>

<span data-ttu-id="7291f-210">**図 5**:、件名、本文、および [cc] ボックスの一覧が更新されました ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-210">**Figure 5**: The Subject, Body, and CC List Have Been Updated  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image15.png))</span></span>


<span data-ttu-id="7291f-211">HTML 形式の電子メールを送信する次のように設定します。 [ `IsBodyHtml` ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx)に HTML を含めるには、True (既定値は False) と、電子メール通知テンプレートを更新します。</span><span class="sxs-lookup"><span data-stu-id="7291f-211">To send an HTML-formatted email set [`IsBodyHtml`](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.maildefinition.isbodyhtml.aspx) to True (the default is False) and update the email template to include HTML.</span></span>

<span data-ttu-id="7291f-212">`MailDefinition`プロパティが PasswordRecovery クラスには一意ではありません。</span><span class="sxs-lookup"><span data-stu-id="7291f-212">The `MailDefinition` property is not unique to the PasswordRecovery class.</span></span> <span data-ttu-id="7291f-213">手順 2. でよう、ChangePassword コントロールも用意されています、`MailDefinition`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="7291f-213">As we will see in Step 2, the ChangePassword control also offers a `MailDefinition` property.</span></span> <span data-ttu-id="7291f-214">CreateUserWizard コントロールがこのようなプロパティを含むさらに、自動的に"ようこそ"電子メール メッセージを送信する新しいユーザーを構成することができます。</span><span class="sxs-lookup"><span data-stu-id="7291f-214">Moreover, the CreateUserWizard control includes such a property that you can configure to automatically send a welcome email message to new users.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-215">現在リンクが存在しない、左側のナビゲーションに到達するために、`RecoverPassword.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="7291f-215">Currently there are no links in the left-hand navigation for reaching the `RecoverPassword.aspx` page.</span></span> <span data-ttu-id="7291f-216">ユーザーはだけ彼女が正常にサイトにログオンするできなかった場合は、このページを訪問します。</span><span class="sxs-lookup"><span data-stu-id="7291f-216">A user would only be interested in visiting this page if she was unable to successfully log on to the site.</span></span> <span data-ttu-id="7291f-217">このため、更新、`Login.aspx`をへのリンクを含めるようにページ、`RecoverPassword.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="7291f-217">Therefore, update the `Login.aspx` page to include a link to the `RecoverPassword.aspx` page.</span></span>


### <a name="programmatically-resetting-a-users-password"></a><span data-ttu-id="7291f-218">プログラムによって、ユーザーのパスワードをリセットします。</span><span class="sxs-lookup"><span data-stu-id="7291f-218">Programmatically Resetting a User's Password</span></span>

<span data-ttu-id="7291f-219">制御呼び出しユーザーのパスワード、PasswordRecovery をリセットするときに、`MembershipUser`オブジェクトの[`ResetPassword`メソッド](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.resetpassword.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-219">When resetting a user's password the PasswordRecovery control calls the `MembershipUser` object's [`ResetPassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.resetpassword.aspx).</span></span> <span data-ttu-id="7291f-220">このメソッドでは、2 つのオーバー ロードがあります。</span><span class="sxs-lookup"><span data-stu-id="7291f-220">This method has two overloads:</span></span>

- <span data-ttu-id="7291f-221">**[`ResetPassword`](https://msdn.microsoft.com/en-us/library/d94bdzz2.aspx)**-ユーザーのパスワードをリセットします。</span><span class="sxs-lookup"><span data-stu-id="7291f-221">**[`ResetPassword`](https://msdn.microsoft.com/en-us/library/d94bdzz2.aspx)** - resets a user's password.</span></span> <span data-ttu-id="7291f-222">場合、このオーバー ロードを使用して`RequiresQuestionAndAnswer`は False です。</span><span class="sxs-lookup"><span data-stu-id="7291f-222">Use this overload if `RequiresQuestionAndAnswer` is False.</span></span>
- <span data-ttu-id="7291f-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/en-us/library/d90zte4w.aspx)**-指定されたユーザーの場合にパスワードのみをリセット*securityAnswer*が正しい。</span><span class="sxs-lookup"><span data-stu-id="7291f-223">**[`ResetPassword(securityAnswer)`](https://msdn.microsoft.com/en-us/library/d90zte4w.aspx)** - resets a user's password only if the supplied *securityAnswer* is correct.</span></span> <span data-ttu-id="7291f-224">場合、このオーバー ロードを使用して`RequiresQuestionAndAnswer`true を指定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-224">Use this overload if `RequiresQuestionAndAnswer` is True.</span></span>

<span data-ttu-id="7291f-225">両方のオーバー ロードは、ランダムに生成された新しいパスワードを返します。</span><span class="sxs-lookup"><span data-stu-id="7291f-225">Both overloads return the new, randomly-generated password.</span></span>

<span data-ttu-id="7291f-226">メンバーシップ フレームワーク内の他のメソッドを使用するような`ResetPassword`に構成されているプロバイダーのメソッドのデリゲート。</span><span class="sxs-lookup"><span data-stu-id="7291f-226">Like with the other methods in the Membership framework, the `ResetPassword` method delegates to the configured provider.</span></span> <span data-ttu-id="7291f-227">`SqlMembershipProvider`呼び出します、`aspnet_Membership_ResetPassword`ストアド プロシージャを渡すことで、ユーザーのユーザー名、新しいパスワードおよびその他のフィールドの間で、指定されたパスワードの回答。</span><span class="sxs-lookup"><span data-stu-id="7291f-227">The `SqlMembershipProvider` invokes the `aspnet_Membership_ResetPassword` stored procedure, passing in the user's username, the new password, and the supplied password answer, among other fields.</span></span> <span data-ttu-id="7291f-228">ストアド プロシージャによりことパスワードの回答と一致するユーザーのパスワードを更新します。</span><span class="sxs-lookup"><span data-stu-id="7291f-228">The stored procedure ensures that the password answer matches and then updates the user's password.</span></span>

<span data-ttu-id="7291f-229">いくつかの低レベルの実装に関するメモ:</span><span class="sxs-lookup"><span data-stu-id="7291f-229">A couple of low-level implementation notes:</span></span>

- <span data-ttu-id="7291f-230">ロックされたユーザーは自分のパスワードをリセットできません。</span><span class="sxs-lookup"><span data-stu-id="7291f-230">A locked out user cannot reset her password.</span></span> <span data-ttu-id="7291f-231">ただし、未承認のユーザーでは次のことがあります。</span><span class="sxs-lookup"><span data-stu-id="7291f-231">However, an unapproved user may.</span></span> <span data-ttu-id="7291f-232">について説明します、ロックをしで詳細に状態を承認、 <a id="_msoanchor_3"> </a> [ *Unlocking とユーザーの承認*](unlocking-and-approving-user-accounts-vb.md)アカウント チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="7291f-232">We will discuss the locked out and approved states in more detail in the <a id="_msoanchor_3"></a>[*Unlocking and Approving User*](unlocking-and-approving-user-accounts-vb.md) Accounts tutorial.</span></span>
- <span data-ttu-id="7291f-233">パスワードの回答が正しくない場合は、ユーザーの失敗したパスワード回答試行回数がインクリメントされます。</span><span class="sxs-lookup"><span data-stu-id="7291f-233">If the password answer is incorrect, the user's failed password answer attempt count is incremented.</span></span> <span data-ttu-id="7291f-234">指定した時間枠内で無効なセキュリティ解答の試行数を指定する場合は、ユーザーはロックアウトされます。</span><span class="sxs-lookup"><span data-stu-id="7291f-234">If a specified number of invalid security answer attempts occur within a specified time window, the user is locked out.</span></span>

### <a name="a-word-on-how-the-random-passwords-are-generated"></a><span data-ttu-id="7291f-235">ランダムなパスワード方法で単語が生成されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-235">A Word on How the Random Passwords are Generated</span></span>

<span data-ttu-id="7291f-236">図 4 と 5 で電子メール メッセージで表示される、ランダムに生成されたパスワードがのメンバーシップ クラスは、によって作成された[`GeneratePassword`メソッド](https://msdn.microsoft.com/en-us/library/system.web.security.membership.generatepassword.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-236">The randomly-generated passwords shown in the email messages in Figures 4 and 5 are created by the Membership class's [`GeneratePassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membership.generatepassword.aspx).</span></span> <span data-ttu-id="7291f-237">このメソッドは、次の 2 つの整数の入力パラメーター - を受け取ります*長さ*と*numberOfNonAlphanumericCharacters* -文字列を返すには、少なくとも*長さ*で文字の長さ少なくとも*numberOfNonAlphanumericCharacters*英数字以外の文字数。</span><span class="sxs-lookup"><span data-stu-id="7291f-237">This method accepts two integer input paramters - *length* and *numberOfNonAlphanumericCharacters* - and returns a string at least *length* characters long with at least *numberOfNonAlphanumericCharacters* number of non-alphanumeric characters.</span></span> <span data-ttu-id="7291f-238">これら 2 つのパラメーターの値はメンバーシップの構成によって決まりますメンバーシップ クラスまたはログインに関連する Web コントロール内では、このメソッドからが呼び出されると、`MinRequiredPasswordLength`と`MinRequiredNonalphanumericCharacters`プロパティで、それぞれ 7 と 1 に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-238">When this method is called from within the Membership classes or Login-related Web controls, the values for these two parameters are determined by the Membership configuration's `MinRequiredPasswordLength` and `MinRequiredNonalphanumericCharacters` properties, which we set to 7 and 1, respectively.</span></span>

<span data-ttu-id="7291f-239">`GeneratePassword`メソッドでは、暗号強度が高い乱数ジェネレーターを使用して、どのようなランダムな文字が選択されているでバイアスがないことを確認してください。</span><span class="sxs-lookup"><span data-stu-id="7291f-239">The `GeneratePassword` method uses a cryptographically strong random number generator to ensure that there is no bias in what random characters are selected.</span></span> <span data-ttu-id="7291f-240">さらに、`GeneratePassword`は`Public`、使用することを ASP.NET アプリケーションから直接ランダムな文字列やパスワードを生成する必要がある場合を意味します。</span><span class="sxs-lookup"><span data-stu-id="7291f-240">Furthermore, `GeneratePassword` is `Public`, meaning that you can use it directly from your ASP.NET application if you need to generate random strings or passwords.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-241">`SqlMembershipProvider`クラスは、ランダムなパスワードを常に生成には、少なくとも 14 文字、ため`MinRequiredPasswordLength`14 より小さい場合、その値は無視されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-241">The `SqlMembershipProvider` class always generates a random password at least 14 characters long, so if `MinRequiredPasswordLength` is less than 14 then its value is ignored.</span></span>


## <a name="step-2-changing-passwords"></a><span data-ttu-id="7291f-242">手順 2: パスワードの変更</span><span class="sxs-lookup"><span data-stu-id="7291f-242">Step 2: Changing Passwords</span></span>

<span data-ttu-id="7291f-243">ランダムに生成されたパスワードは覚えにくいです。</span><span class="sxs-lookup"><span data-stu-id="7291f-243">The randomly-generated passwords are difficult to remember.</span></span> <span data-ttu-id="7291f-244">図 4 に示すようにパスワードを検討してください:`WWGUZv(f2yM:Bd`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-244">Consider the password shown in Figure 4: `WWGUZv(f2yM:Bd`.</span></span> <span data-ttu-id="7291f-245">メモリをコミットを再試行してください。</span><span class="sxs-lookup"><span data-stu-id="7291f-245">Try committing that to memory!</span></span> <span data-ttu-id="7291f-246">言うまでも、ユーザーには、この種のランダムに生成されたパスワードが送信された後、覚えやすいパスワードを変更彼女はします。</span><span class="sxs-lookup"><span data-stu-id="7291f-246">Needless to say, after a user is sent a randomly-generated password of this sort, she'll want to change the password to something more memorable.</span></span>

<span data-ttu-id="7291f-247">ChangePassword コントロールを使用すると、ユーザーが自分のパスワードを変更するためのインターフェイスを作成できます。</span><span class="sxs-lookup"><span data-stu-id="7291f-247">Use the ChangePassword control to create an interface for a user to change her password.</span></span> <span data-ttu-id="7291f-248">かなり PasswordRecovery コントロールと同様、ChangePassword コントロールでは 2 つのビュー: パスワードの変更状況と成功します。</span><span class="sxs-lookup"><span data-stu-id="7291f-248">Much like the PasswordRecovery control, the ChangePassword control consists of two views: Change Password and Success.</span></span> <span data-ttu-id="7291f-249">パスワードの変更のビューは、古いマスター_キーと新しいパスワードをユーザーに求めます。</span><span class="sxs-lookup"><span data-stu-id="7291f-249">The Change Password view prompts the user for their old and new passwords.</span></span> <span data-ttu-id="7291f-250">古いパスワードと最小の長さと英数字以外の文字の要件を満たす新しいパスワードを指定して、時に、ChangePassword コントロールは、ユーザーのパスワードを更新し、成功ビューを表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-250">Upon supplying the correct old password and a new password that meets the minimum length and non-alphanumeric character requirements, the ChangePassword control updates the user's password and displays the Success view.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-251">ChangePassword コントロールを呼び出すことによって、ユーザーのパスワードを変更する、`MembershipUser`オブジェクトの[`ChangePassword`メソッド](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.changepassword.aspx)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-251">The ChangePassword control modifies the user's password by invoking the `MembershipUser` object's [`ChangePassword` method](https://msdn.microsoft.com/en-us/library/system.web.security.membershipuser.changepassword.aspx).</span></span> <span data-ttu-id="7291f-252">ChangePassword メソッドでは、2 つ受け取ります`String`入力パラメーター - *oldPassword*と*newPassword*-を持つユーザーのアカウントを更新し、 *newPassword*、指定されたと仮定して*oldPassword*が正しい。</span><span class="sxs-lookup"><span data-stu-id="7291f-252">The ChangePassword method accepts two `String` input parameters - *oldPassword* and *newPassword*- and updates the user's account with the *newPassword*, assuming the supplied *oldPassword* is correct.</span></span>


<span data-ttu-id="7291f-253">開く、`ChangePassword.aspx`ページし、パスワードの変更をコントロールに名前を付け、ページを追加`ChangePwd`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-253">Open the `ChangePassword.aspx` page and add a ChangePassword control to the page, naming it `ChangePwd`.</span></span> <span data-ttu-id="7291f-254">この時点では、デザイン ビューがパスワードの変更を表示する必要があります (図 6 を参照してください) を表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-254">At this point, the Design view should show the Change Password view (see Figure 6).</span></span> <span data-ttu-id="7291f-255">同様に PasswordRecovery コントロールを使用することができますビューを切り替える、コントロールのスマート タグを使用しています。</span><span class="sxs-lookup"><span data-stu-id="7291f-255">Like with the PasswordRecovery control, you can toggle between the views via the control's Smart Tag.</span></span> <span data-ttu-id="7291f-256">さらに、これらのビューの外観は、そのようなさまざまなスタイルのプロパティ、またはテンプレートに変換することでカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="7291f-256">Furthermore, these views' appearances are customizable through the assorted style properties or by converting them to a template.</span></span>


<span data-ttu-id="7291f-257">[![ChangePassword コントロールをページに追加します。](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-257">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image17.png)](recovering-and-changing-passwords-vb/_static/image16.png)</span></span>

<span data-ttu-id="7291f-258">**図 6**: ChangePassword コントロールをページに追加 ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-258">**Figure 6**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image18.png))</span></span>


<span data-ttu-id="7291f-259">ChangePassword コントロールは、現在ログインしているユーザーのパスワードを更新できます*または*別に、指定したユーザーのパスワード。</span><span class="sxs-lookup"><span data-stu-id="7291f-259">The ChangePassword control can update the currently logged in user's password *or* the password of another, specified user.</span></span> <span data-ttu-id="7291f-260">既定のパスワードの変更の表示が 3 つのテキスト ボックス コントロールを表示する図 6 に示す: 古いパスワードと新しいパスワードの 2 つのいずれか。</span><span class="sxs-lookup"><span data-stu-id="7291f-260">As Figure 6 shows, the default Change Password view renders just three TextBox controls: one for the old password and two for the new password.</span></span> <span data-ttu-id="7291f-261">この既定のインターフェイスを使用して、現在ログオンしているユーザーのパスワードを更新します。</span><span class="sxs-lookup"><span data-stu-id="7291f-261">This default interface is used to update the currently logged on user's password.</span></span>

<span data-ttu-id="7291f-262">コントロールを使用する、パスワードの変更を別のユーザーのパスワードを更新して、設定コントロールの[`DisplayUserName`プロパティ](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.changepassword.displayusername.aspx)True に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-262">To use the ChangePassword control to update another user's password, set the control's [`DisplayUserName` property](https://msdn.microsoft.com/en-us/library/system.web.ui.webcontrols.changepassword.displayusername.aspx) to True.</span></span> <span data-ttu-id="7291f-263">これにより、ページで、ユーザーのユーザー名のパスワードを変更するように要求する 4 つ目のテキスト ボックスを追加します。</span><span class="sxs-lookup"><span data-stu-id="7291f-263">Doing so adds a fourth TextBox to the page, prompting for the username of the user whose password to change.</span></span>

<span data-ttu-id="7291f-264">設定`DisplayUserName`を True にログアウト、ユーザーにログインしなくてもパスワードを変更する場合に便利です。</span><span class="sxs-lookup"><span data-stu-id="7291f-264">Setting `DisplayUserName` to True is useful if you want to let a logged out user change her password without having to log in.</span></span> <span data-ttu-id="7291f-265">個人的には、彼女自分のパスワードの変更を許可する前にユーザーがログインを必要とすると問題があると思われます。</span><span class="sxs-lookup"><span data-stu-id="7291f-265">Personally, I think there's nothing wrong with requiring a user to login before allowing her to change her password.</span></span> <span data-ttu-id="7291f-266">そのためのままにして`DisplayUserName`False (既定値) に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-266">Therefore, leave `DisplayUserName` set to False (its default).</span></span> <span data-ttu-id="7291f-267">この決定を行うにただし、お基本的には、なし機能匿名ユーザーがこのページに到達します。</span><span class="sxs-lookup"><span data-stu-id="7291f-267">In making this decision, however, we essentially are barring anonymous users from reaching this page.</span></span> <span data-ttu-id="7291f-268">匿名ユーザーにアクセスを拒否するために、サイトの URL 承認規則を更新`ChangePassword.aspx`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-268">Update the site's URL authorization rules so as to deny anonymous users from visiting `ChangePassword.aspx`.</span></span> <span data-ttu-id="7291f-269">URL 承認規則の構文上のメモリを更新する必要がある場合に戻って、 <a id="_msoanchor_4"> </a> [*ユーザー ベースの承認*](../membership/user-based-authorization-vb.md)チュートリアルです。</span><span class="sxs-lookup"><span data-stu-id="7291f-269">If you need to refresh your memory on the URL authorization rule syntax, refer back to the <a id="_msoanchor_4"></a>[*User-Based Authorization*](../membership/user-based-authorization-vb.md) tutorial.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-270">感じるかもしれませんが、`DisplayUserName`プロパティは、他のユーザーのパスワードを変更する管理者を許可する場合に役立ちます。</span><span class="sxs-lookup"><span data-stu-id="7291f-270">It may seem that the `DisplayUserName` property is useful for allowing administrators to change other users' passwords.</span></span> <span data-ttu-id="7291f-271">ただし、場合でも`DisplayUserName`が古いパスワードを既知し、入力する必要がありますを True に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-271">However, even when `DisplayUserName` is set to True the correct old password must be known and entered.</span></span> <span data-ttu-id="7291f-272">手順 3 でユーザーのパスワードを変更する管理者を許可する手法について説明します。</span><span class="sxs-lookup"><span data-stu-id="7291f-272">We will talk about techniques for allowing administrators to change users' passwords in Step 3.</span></span>


<span data-ttu-id="7291f-273">参照してください、`ChangePassword.aspx`ブラウザー内でページし、パスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="7291f-273">Visit the `ChangePassword.aspx` page through a browser and change your password.</span></span> <span data-ttu-id="7291f-274">パスワードの長さとメンバーシップの構成で指定された英数字以外の文字の要件を満たしていない場合の新しいパスワードを入力する場合、エラー メッセージが表示されることに注意してください (図 7 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="7291f-274">Note that an error message is displayed if you enter a new password that fails to meet the password length and non-alphanumeric character requirements specified in the Membership configuration (see Figure 7).</span></span>


<span data-ttu-id="7291f-275">[![ChangePassword コントロールをページに追加します。](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-275">[![Add a ChangePassword Control to the Page](recovering-and-changing-passwords-vb/_static/image20.png)](recovering-and-changing-passwords-vb/_static/image19.png)</span></span>

<span data-ttu-id="7291f-276">**図 7**: ChangePassword コントロールをページに追加 ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-276">**Figure 7**: Add a ChangePassword Control to the Page  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image21.png))</span></span>


<span data-ttu-id="7291f-277">ユーザーの古いパスワードと、ログオンしている有効な新しいパスワードを入力時にパスワードが変更され、成功ビューが表示されます。</span><span class="sxs-lookup"><span data-stu-id="7291f-277">Upon entering the correct old password and a valid new password, the logged on user's password is changed and the Success view displayed.</span></span>

### <a name="sending-a-confirmation-email"></a><span data-ttu-id="7291f-278">確認の電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="7291f-278">Sending a Confirmation Email</span></span>

<span data-ttu-id="7291f-279">既定では、ChangePassword コントロールは、パスワードが更新されました、ユーザーに電子メール メッセージを送信しません。</span><span class="sxs-lookup"><span data-stu-id="7291f-279">By default, the ChangePassword control does not send an email message to the user whose password was just updated.</span></span> <span data-ttu-id="7291f-280">電子メールを送信する場合は、単に構成するコントロールの`MailDefinition`プロパティです。</span><span class="sxs-lookup"><span data-stu-id="7291f-280">If you'd like to send an email, simply configure the control's `MailDefinition` property.</span></span> <span data-ttu-id="7291f-281">ユーザーは、新しいパスワードを含む HTML 形式の電子メールを送信できるようにパスワードの変更をするコントロールを構成してみましょう。</span><span class="sxs-lookup"><span data-stu-id="7291f-281">Let's configure the ChangePassword control so that the user is sent an HTML-formatted email that contains their new password.</span></span>

<span data-ttu-id="7291f-282">新しいファイルを作成して開始、`EmailTemplates`という名前のフォルダー`ChangePassword.htm`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-282">Start by creating a new file in the `EmailTemplates` folder named `ChangePassword.htm`.</span></span> <span data-ttu-id="7291f-283">次のマークアップを追加します。</span><span class="sxs-lookup"><span data-stu-id="7291f-283">Add the following markup:</span></span>

[!code-html[Main](recovering-and-changing-passwords-vb/samples/sample4.html)]

<span data-ttu-id="7291f-284">次に、設定、パスワードの変更をコントロールの`MailDefinition`プロパティの`BodyFileName`、 `IsBodyHtml`、および`Subject`プロパティ ~ EmailTemplates/ChangePassword.htm、true の場合、およびパスワードが変更された/!、それぞれします。</span><span class="sxs-lookup"><span data-stu-id="7291f-284">Next, set the ChangePassword control's `MailDefinition` property's `BodyFileName`, `IsBodyHtml`, and `Subject` properties to ~/EmailTemplates/ChangePassword.htm, True, and Your password has changed!, respectively.</span></span>

<span data-ttu-id="7291f-285">これらの変更を行った後、ページを再確認し、もう一度パスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="7291f-285">After making these changes, revisit the page and change your password again.</span></span> <span data-ttu-id="7291f-286">現時点では、ChangePassword コントロール、HTML 形式のカスタマイズされたメールを送信ファイル上のユーザーの電子メール アドレス (図 8 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="7291f-286">This time, the ChangePassword control sends a customized, HTML-formatted email to the user's email address on file (see Figure 8).</span></span>


<span data-ttu-id="7291f-287">[![ユーザーをそのパスワードが変更通知の電子メール メッセージ](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-287">[![An Email Message Informs the User That Their Password has Changed](recovering-and-changing-passwords-vb/_static/image23.png)](recovering-and-changing-passwords-vb/_static/image22.png)</span></span>

<span data-ttu-id="7291f-288">**図 8**: に通知する電子メール メッセージ、ユーザー、そのパスワードが変更 ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-288">**Figure 8**: An Email Message Informs the User That Their Password has Changed  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image24.png))</span></span>


## <a name="step-3-allowing-administrators-to-change-users-passwords"></a><span data-ttu-id="7291f-289">手順 3: ユーザーのパスワードを変更する管理者を許可します。</span><span class="sxs-lookup"><span data-stu-id="7291f-289">Step 3: Allowing Administrators to Change Users' Passwords</span></span>

<span data-ttu-id="7291f-290">ユーザー アカウントをサポートするアプリケーションで共通の機能は、他のユーザーのパスワードを変更する管理ユーザーの機能です。</span><span class="sxs-lookup"><span data-stu-id="7291f-290">A common feature in applications that support user accounts is the ability for an administrative user to change other users' passwords.</span></span> <span data-ttu-id="7291f-291">場合によって、システムがユーザーに、自分のパスワードを変更する機能がないためには、この機能が必要です。</span><span class="sxs-lookup"><span data-stu-id="7291f-291">Sometimes this functionality is required because the system lacks the ability for users to change their own passwords.</span></span> <span data-ttu-id="7291f-292">このような場合は、そのパスワードを回復するユーザーの唯一の方法では、管理者に、新しいパスワードを割り当てます。</span><span class="sxs-lookup"><span data-stu-id="7291f-292">In such a case, the only way for a user to recover their forgotten password would be for the administrator to assign them a new password.</span></span> <span data-ttu-id="7291f-293">PasswordRecovery と ChangePassword コントロールを使用ただし、管理ユーザー必要がありますビジーになっていない自体、ユーザーのパスワードの変更をユーザーがこの自体の処理を実行できるようです。</span><span class="sxs-lookup"><span data-stu-id="7291f-293">With the PasswordRecovery and ChangePassword controls, however, administrative users need not busy themselves with changing users' passwords, as users are capable of doing this themselves.</span></span>

<span data-ttu-id="7291f-294">しかし、場合、クライアントでは管理ユーザーが他のユーザーのパスワードを変更できることと主張してでしょうか。</span><span class="sxs-lookup"><span data-stu-id="7291f-294">But what if your client insists that administrative users should be able to change other users' passwords?</span></span> <span data-ttu-id="7291f-295">残念ながら、この機能を追加すると、作業のビットを指定できます。</span><span class="sxs-lookup"><span data-stu-id="7291f-295">Unfortunately, adding this functionality can be a bit of work.</span></span> <span data-ttu-id="7291f-296">ユーザーのパスワードを変更するには、新旧両方のパスワードを指定する必要があります、`MembershipUser`オブジェクトの`ChangePassword`メソッドは、管理者は、それを変更するのには、ユーザーのパスワードを知っている含めることはできません。</span><span class="sxs-lookup"><span data-stu-id="7291f-296">To change a user's password, both the old and new password must be supplied to the `MembershipUser` object's `ChangePassword` method, but an administrator shouldn't have to know a user's password in order to modify it.</span></span>

<span data-ttu-id="7291f-297">1 つの回避策では、最初に、ユーザーのパスワードをリセットし、次のようにコードを使用して新しいパスワードを変更します。</span><span class="sxs-lookup"><span data-stu-id="7291f-297">One workaround is to first reset the user's password and then change it to the new password using code like the following:</span></span>

[!code-vb[Main](recovering-and-changing-passwords-vb/samples/sample5.vb)]

<span data-ttu-id="7291f-298">このコードの開始に関する情報を取得することによって*ユーザー名*、これは、ユーザーを変更することを希望管理者パスワードを持つ。</span><span class="sxs-lookup"><span data-stu-id="7291f-298">This code starts by retrieving information about *username*, which is the user whose password the administrator wishes to change.</span></span> <span data-ttu-id="7291f-299">次に、`ResetPassword`メソッドが呼び出され、どの割り当てとユーザーの新しいランダムなパスワード。</span><span class="sxs-lookup"><span data-stu-id="7291f-299">Next, the `ResetPassword` method is invoked, which assigns and the user a new, random password.</span></span> <span data-ttu-id="7291f-300">パスワードをランダムに生成されたが、メソッドによって返され、変数に格納されている`resetPwd`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-300">This randomly-generated password is returned by the method and stored in the variable `resetPwd`.</span></span> <span data-ttu-id="7291f-301">呼び出しを使用して変更できますが、ユーザーのパスワードがわかった`ChangePassword`です。</span><span class="sxs-lookup"><span data-stu-id="7291f-301">Now that we know the user's password, we can change it via a call to `ChangePassword`.</span></span>

<span data-ttu-id="7291f-302">問題は、このコードは、メンバーシップ システムの構成が設定されている場合のみが機能するように`RequiresQuestionAndAnswer`は False です。</span><span class="sxs-lookup"><span data-stu-id="7291f-302">The problem is that this code only works if the Membership system configuration is set such that `RequiresQuestionAndAnswer` is False.</span></span> <span data-ttu-id="7291f-303">場合`RequiresQuestionAndAnswer`です。 アプリケーションでは、True の場合は、次に、`ResetPassword`メソッドは、セキュリティの回答を渡される必要がある、それ以外の場合、例外がスローされます。</span><span class="sxs-lookup"><span data-stu-id="7291f-303">If `RequiresQuestionAndAnswer` is True, as it is with our application, then the `ResetPassword` method needs to be passed the security answer, otherwise it will throw an exception.</span></span>

<span data-ttu-id="7291f-304">まだ、クライアントでは管理者が、ユーザーのパスワードを変更できることと主張してメンバーシップ フレームワークがセキュリティの質問と解答を要求するように構成されている場合、次の 3 つのオプションがあります。</span><span class="sxs-lookup"><span data-stu-id="7291f-304">If the Membership framework is configured to require a security question and answer, and yet your client insists that administrators be able to change users' passwords, you have three options:</span></span>

- <span data-ttu-id="7291f-305">無線で自分の手をスローし、実行できない処理を 1 つだけのものであることをクライアントに指示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-305">Throw your hands in the air and tell your client that this is just one thing that cannot be done.</span></span>
- <span data-ttu-id="7291f-306">設定`RequiresQuestionAndAnswer`を false に設定します。</span><span class="sxs-lookup"><span data-stu-id="7291f-306">Set `RequiresQuestionAndAnswer` to False.</span></span> <span data-ttu-id="7291f-307">これにより、安全性の低いアプリケーション。</span><span class="sxs-lookup"><span data-stu-id="7291f-307">This results in a less secure application.</span></span> <span data-ttu-id="7291f-308">悪意のユーザーが別のユーザーの電子メールの受信トレイへのアクセスを得られることを想像してください。</span><span class="sxs-lookup"><span data-stu-id="7291f-308">Imagine that a nefarious user has gained access to another user's email inbox.</span></span> <span data-ttu-id="7291f-309">おそらく侵害されているユーザーは各自のデスク昼食に移動する状態になっているし、そのワークステーションをロックしませんでしたしたり可能性があります、公共の端末から自分の電子メールにアクセス サインアウトがありませんでした。どちらの場合、悪意のユーザーがアクセスできる、`RecoverPassword.aspx`ページし、ユーザーのユーザー名を入力します。</span><span class="sxs-lookup"><span data-stu-id="7291f-309">Perhaps the compromised user has left their desk to go to lunch and didn't lock their workstation, or maybe they accessed their email from a public terminal and didn't sign out. In either case, the nefarious user can visit the `RecoverPassword.aspx` page and enter the user's username.</span></span> <span data-ttu-id="7291f-310">システムは、セキュリティの回答を求めることがなく回復パスワードを電子メールです。</span><span class="sxs-lookup"><span data-stu-id="7291f-310">The system will then email the recovered password without prompting for the security answer.</span></span>
- <span data-ttu-id="7291f-311">メンバーシップ framework および SQL Server データベースを直接操作によって作成された抽象化レイヤーをバイパスします。</span><span class="sxs-lookup"><span data-stu-id="7291f-311">Bypass the abstraction layer created by the Membership framework and work directly with the SQL Server database.</span></span> <span data-ttu-id="7291f-312">メンバーシップのスキーマには、という名前のストアド プロシージャが含まれています。`aspnet_Membership_SetPassword`をユーザーのパスワードを設定し、そのタスクを実行するためにセキュリティの回答や古いパスワードは必要ありません。</span><span class="sxs-lookup"><span data-stu-id="7291f-312">The Membership schema includes a stored procedure named `aspnet_Membership_SetPassword` that sets a user's password and does not require the security answer or old password in order to accomplish its task.</span></span>

<span data-ttu-id="7291f-313">これらのオプションは特に魅力的なものが、方法、開発者の有効期間になる場合があります。</span><span class="sxs-lookup"><span data-stu-id="7291f-313">None of these options are particularly appealing, but that's how the life of a developer goes sometimes.</span></span>

<span data-ttu-id="7291f-314">あらかじめし、3 番目の手法をバイパスするコードの記述を実装すれば、`Membership`と`MembershipUser`クラスし、直接作用、`SecurityTutorials`データベース。</span><span class="sxs-lookup"><span data-stu-id="7291f-314">I went ahead and implemented the third approach, writing code that bypasses the `Membership` and `MembershipUser` classes and operates directly against the `SecurityTutorials` database.</span></span>

> [!NOTE]
> <span data-ttu-id="7291f-315">データベースを直接操作、メンバーシップ、フレームワークによって提供されるカプセル化が割れてます。</span><span class="sxs-lookup"><span data-stu-id="7291f-315">By working directly with the database, the encapsulation provided by the Membership framework is shattered.</span></span> <span data-ttu-id="7291f-316">この決定を結び付けること、 `SqlMembershipProvider`、移植可能な以下のコードを作成します。</span><span class="sxs-lookup"><span data-stu-id="7291f-316">This decision ties us to the `SqlMembershipProvider`, making our code less portable.</span></span> <span data-ttu-id="7291f-317">さらに、このコードが期待どおりに将来のバージョンの ASP.NET メンバーシップ スキーマが変更された場合は機能しません。</span><span class="sxs-lookup"><span data-stu-id="7291f-317">Furthermore, this code may not work as expected in future versions of ASP.NET if the Membership schema changes.</span></span> <span data-ttu-id="7291f-318">この方法は、問題を回避する、およびほとんどの回避策のようにないベスト プラクティスの例です。</span><span class="sxs-lookup"><span data-stu-id="7291f-318">This approach is a workaround and, like most workarounds, is not an example of best practices.</span></span>


<span data-ttu-id="7291f-319">コードは、一部が不適切になる bits を持ち、非常に長きます。</span><span class="sxs-lookup"><span data-stu-id="7291f-319">The code has some unattractive bits and is quite lengthy.</span></span> <span data-ttu-id="7291f-320">そのため、しないことの詳細な検査を使用してこのチュートリアルの煩雑化します。</span><span class="sxs-lookup"><span data-stu-id="7291f-320">Therefore, I don't want to clutter this tutorial with an in-depth examination of it.</span></span> <span data-ttu-id="7291f-321">詳細に知りたい場合は、このチュートリアルとアクセス用コードをダウンロード、`~/Administration/ManageUsers.aspx`ページ。</span><span class="sxs-lookup"><span data-stu-id="7291f-321">If you are interested in learning more, download the code for this tutorial and visit the `~/Administration/ManageUsers.aspx` page.</span></span> <span data-ttu-id="7291f-322">このページで作成した、 <a id="_msoanchor_5"> </a>[前のチュートリアル](building-an-interface-to-select-one-user-account-from-many-vb.md)、各ユーザーを一覧表示します。</span><span class="sxs-lookup"><span data-stu-id="7291f-322">This page, which we created in the <a id="_msoanchor_5"></a>[preceding tutorial](building-an-interface-to-select-one-user-account-from-many-vb.md), lists each user.</span></span> <span data-ttu-id="7291f-323">リンクを含める GridView を更新すれば、 `UserInformation.aspx`  ページで、クエリ文字列を選択したユーザーのユーザー名を渡します。</span><span class="sxs-lookup"><span data-stu-id="7291f-323">I've updated the GridView to include a link to the `UserInformation.aspx` page, passing the selected user's username through the querystring.</span></span> <span data-ttu-id="7291f-324">`UserInformation.aspx`ページには、自分のパスワードを変更するためのテキスト ボックスと選択したユーザーに関する情報が表示されます (図 9 を参照してください)。</span><span class="sxs-lookup"><span data-stu-id="7291f-324">The `UserInformation.aspx` page displays information about the selected user and TextBoxes for changing their password (see Figure 9).</span></span>

<span data-ttu-id="7291f-325">ポストバックに陥ります新しいパスワードを入力する、2 つ目のテキスト ボックスで確認し、更新ユーザー ボタンをクリックした後、`aspnet_Membership_SetPassword`ストアド プロシージャが呼び出される、ユーザーのパスワードを更新します。</span><span class="sxs-lookup"><span data-stu-id="7291f-325">After entering the new password, confirming it in the second TextBox, and clicking the Update User Button, a postback ensues and the `aspnet_Membership_SetPassword` stored procedure is invoked, updating the user's password.</span></span> <span data-ttu-id="7291f-326">それらをコードに慣れるやり直して、パスワードを変更したユーザーに電子メールを送信する対象の機能を拡張するこの機能に興味リーダーことをお勧めします。</span><span class="sxs-lookup"><span data-stu-id="7291f-326">I encourage those readers interested in this functionality to become more familiar with the code and try extending the functionality to include sending an email to the user whose password was changed.</span></span>


<span data-ttu-id="7291f-327">[![管理者がユーザーのパスワードを変更します。](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="7291f-327">[![An Administrator May Change a User's Password](recovering-and-changing-passwords-vb/_static/image26.png)](recovering-and-changing-passwords-vb/_static/image25.png)</span></span>

<span data-ttu-id="7291f-328">**図 9**: 管理者がユーザーのパスワードを変更する ([フルサイズのイメージを表示するをクリックして](recovering-and-changing-passwords-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="7291f-328">**Figure 9**: An Administrator May Change a User's Password  ([Click to view full-size image](recovering-and-changing-passwords-vb/_static/image27.png))</span></span>


> [!NOTE]
> <span data-ttu-id="7291f-329">`UserInformation.aspx`ページは現在動作のみをクリアまたは Hashed 形式でパスワードを保存するメンバーシップ フレームワークが構成されている場合。</span><span class="sxs-lookup"><span data-stu-id="7291f-329">The `UserInformation.aspx` page currently only works if the Membership framework is configured to store passwords in Clear or Hashed format.</span></span> <span data-ttu-id="7291f-330">この機能を追加する招待されていますが、新しいパスワードを暗号化するためのコードが不足しています。</span><span class="sxs-lookup"><span data-stu-id="7291f-330">It lacks the code to encrypt the new password, although you are invited to add this functionality.</span></span> <span data-ttu-id="7291f-331">必要なコードを追加することをお勧めの方法は、のようにコンパイラを使用する[Reflector](http://www.aisto.com/roeder/dotnet/) ; .NET Framework のメソッドのソース コードを調べることを調べることで開始、`SqlMembershipProvider`クラスの`ChangePassword`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7291f-331">The way I recommend adding the necessary code is to use a decompiler like [Reflector](http://www.aisto.com/roeder/dotnet/) to examine the source code for methods in the .NET Framework; start by examining the `SqlMembershipProvider` class's `ChangePassword` method.</span></span> <span data-ttu-id="7291f-332">この手法を使用して、パスワードのハッシュを作成するためのコードを記述します。</span><span class="sxs-lookup"><span data-stu-id="7291f-332">This is the technique I used to write the code for creating a hash of the password.</span></span>


## <a name="summary"></a><span data-ttu-id="7291f-333">概要</span><span class="sxs-lookup"><span data-stu-id="7291f-333">Summary</span></span>

<span data-ttu-id="7291f-334">ASP.NET には、ユーザーが自分のパスワードを管理できる 2 つのコントロールが用意されています。</span><span class="sxs-lookup"><span data-stu-id="7291f-334">ASP.NET offers two controls to help users manage their password.</span></span> <span data-ttu-id="7291f-335">PasswordRecovery コントロールは、自分のパスワードを忘れてしまった方のために役立ちます。</span><span class="sxs-lookup"><span data-stu-id="7291f-335">The PasswordRecovery control is useful for those who have forgotten their passwords.</span></span> <span data-ttu-id="7291f-336">メンバーシップ フレームワークの構成によっては、ユーザーは、既存のパスワードや、ランダムに生成された新しいパスワードか、電子メールで送信します。</span><span class="sxs-lookup"><span data-stu-id="7291f-336">Depending on the Membership framework's configuration, the user is either emailed their existing password or a new, randomly-generated password.</span></span> <span data-ttu-id="7291f-337">ChangePassword コントロールにより、パスワードを更新できます。</span><span class="sxs-lookup"><span data-stu-id="7291f-337">The ChangePassword control enables a user to update their password.</span></span>

<span data-ttu-id="7291f-338">ログインと CreateUserWizard コントロールと同様には、PasswordRecovery と ChangePassword のコントロールは、宣言型マークアップがまったくまたは行のコードを記述することがなく、豊富なユーザー インターフェイスをレンダリングします。</span><span class="sxs-lookup"><span data-stu-id="7291f-338">Like the Login and CreateUserWizard controls, the PasswordRecovery and ChangePassword controls render a rich user interface without having to write a lick of declarative markup or line of code.</span></span> <span data-ttu-id="7291f-339">既定のユーザー インターフェイスがお客様のニーズを満たしていない場合は、さまざまなスタイルのプロパティをカスタマイズできます。</span><span class="sxs-lookup"><span data-stu-id="7291f-339">If the default user interface doesn't meet your needs, you can customize it through a variety of style properties.</span></span> <span data-ttu-id="7291f-340">代わりに、コントロールのインターフェイスも細かく制御のためのテンプレートに変換することがあります。</span><span class="sxs-lookup"><span data-stu-id="7291f-340">Alternatively, the controls' interfaces may be converted into templates, for an even finer degree of control.</span></span> <span data-ttu-id="7291f-341">バック グラウンドでこれらのコントロールは、メンバーシップ API を使用して呼び出し、`MembershipUser`オブジェクトの`ResetPassword`と`ChangePassword`メソッドです。</span><span class="sxs-lookup"><span data-stu-id="7291f-341">Behind the scenes these controls use the Membership API, invoking the `MembershipUser` object's `ResetPassword` and `ChangePassword` methods.</span></span>

<span data-ttu-id="7291f-342">満足プログラミング!</span><span class="sxs-lookup"><span data-stu-id="7291f-342">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="7291f-343">関連項目</span><span class="sxs-lookup"><span data-stu-id="7291f-343">Further Reading</span></span>

<span data-ttu-id="7291f-344">このチュートリアルで説明したトピックの詳細については、次の情報を参照してください。</span><span class="sxs-lookup"><span data-stu-id="7291f-344">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="7291f-345">ChangePassword コントロールのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="7291f-345">ChangePassword Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/changepassword.aspx)
- [<span data-ttu-id="7291f-346">PasswordRecovery コントロールのクイック スタート</span><span class="sxs-lookup"><span data-stu-id="7291f-346">PasswordRecovery Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/passwordrecovery.aspx)
- [<span data-ttu-id="7291f-347">ASP.NET で電子メールを送信します。</span><span class="sxs-lookup"><span data-stu-id="7291f-347">Sending Email in ASP.NET</span></span>](http://aspnet.4guysfromrolla.com/articles/072606-1.aspx)
- [<span data-ttu-id="7291f-348">`System.Net.Mail`よく寄せられる質問</span><span class="sxs-lookup"><span data-stu-id="7291f-348">`System.Net.Mail` FAQs</span></span>](http://www.systemnetmail.com/)

### <a name="about-the-author"></a><span data-ttu-id="7291f-349">作成者について</span><span class="sxs-lookup"><span data-stu-id="7291f-349">About the Author</span></span>

<span data-ttu-id="7291f-350">Scott Mitchell、複数の受け取りますブックの作成者と 4GuysFromRolla.com の創設者は、Microsoft の Web テクノロジと 1998 年取り組んできました。</span><span class="sxs-lookup"><span data-stu-id="7291f-350">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="7291f-351">Scott は、コンサルタント、トレーナー、ライターとして機能します。</span><span class="sxs-lookup"><span data-stu-id="7291f-351">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="7291f-352">最新の著書 *[Sam 学べる自分で ASP.NET 2.0 が 24 時間以内に](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*です。</span><span class="sxs-lookup"><span data-stu-id="7291f-352">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="7291f-353">Scott に到達できる[ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com)または彼のブログでを介して[http://ScottOnWriting.NET](http://scottonwriting.net/)です。</span><span class="sxs-lookup"><span data-stu-id="7291f-353">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="7291f-354">感謝の特別な</span><span class="sxs-lookup"><span data-stu-id="7291f-354">Special Thanks To</span></span>

<span data-ttu-id="7291f-355">このチュートリアルの系列は既に多くの便利なレビュー担当者によって確認済みです。</span><span class="sxs-lookup"><span data-stu-id="7291f-355">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="7291f-356">このチュートリアルの潜在顧客レビュー担当者には、Michael Emmings および Suchi Banerjee が含まれます。</span><span class="sxs-lookup"><span data-stu-id="7291f-356">Lead reviewers for this tutorial include Michael Emmings and Suchi Banerjee.</span></span> <span data-ttu-id="7291f-357">今後、MSDN の記事を確認することに関心のあるですか。</span><span class="sxs-lookup"><span data-stu-id="7291f-357">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="7291f-358">場合は、ドロップ me 一度に 1 行ずつ[mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="7291f-358">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com)</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="7291f-359">[前へ](building-an-interface-to-select-one-user-account-from-many-vb.md)
[次へ](unlocking-and-approving-user-accounts-vb.md)</span><span class="sxs-lookup"><span data-stu-id="7291f-359">[Previous](building-an-interface-to-select-one-user-account-from-many-vb.md)
[Next](unlocking-and-approving-user-accounts-vb.md)</span></span>
